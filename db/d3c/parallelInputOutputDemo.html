<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: Parallel processing for Input-Output, I/O files</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('db/d3c/parallelInputOutputDemo.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Parallel processing for Input-Output, I/O files </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3><a class="anchor" id="autotoc_md193"></a>
Parallel File Systems (PFSs) for the MercuryDPM-MPI parallel-processing framework</h3>
<h4><a class="anchor" id="autotoc_md194"></a>
a) One File-Per-Process, FPP I/O model</h4>
<p>By default, MercuryDPM applications running in serial produce four main output files, in ASCII format. Each of the files carries the name of the code, followed by an extension, .restart, .data, .fstat and .ene. By including the command "problem.setFileType(FileType::ONE_FILE)" in the main method below, we explicitly tell the DPM solver to write these default files:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d02/Mercury3D_8h.html">Mercury3D.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Demo : <span class="keyword">public</span> <a class="code" href="../../d3/db1/classMercury3D.html">Mercury3D</a> {</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="../../d5/d89/classDPMBase.html#a1e4a1079bebb932de0ea70b487eedc5e">setupInitialConditions</a>()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="comment">//define walls, boundary conditions, particle positions here</span></div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  Demo <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>;</div>
<div class="line">  <span class="comment">//define contact law, time step, final time, domain size here</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">//call setup for the one file-per-process output model</span></div>
<div class="line">  <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.setFileType(<a class="code" href="../../d6/db7/File_8h.html#abf84ea5561d58d9410862dc5b49f254fa9c68f021e7d47b8c42946a0f18ad3b69">FileType::ONE_FILE</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.solve();</div>
<div class="line">}</div>
<div class="ttc" id="aFile_8h_html_abf84ea5561d58d9410862dc5b49f254fa9c68f021e7d47b8c42946a0f18ad3b69"><div class="ttname"><a href="../../d6/db7/File_8h.html#abf84ea5561d58d9410862dc5b49f254fa9c68f021e7d47b8c42946a0f18ad3b69">FileType::ONE_FILE</a></div><div class="ttdeci">@ ONE_FILE</div><div class="ttdoc">all data will be written into/ read from a single file called name_</div></div>
<div class="ttc" id="aMercury3D_8h_html"><div class="ttname"><a href="../../d8/d02/Mercury3D_8h.html">Mercury3D.h</a></div></div>
<div class="ttc" id="aT__protectiveWall_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> T_protectiveWall.cpp:194</div></div>
<div class="ttc" id="aclassDPMBase_html_a1e4a1079bebb932de0ea70b487eedc5e"><div class="ttname"><a href="../../d5/d89/classDPMBase.html#a1e4a1079bebb932de0ea70b487eedc5e">DPMBase::setupInitialConditions</a></div><div class="ttdeci">virtual void setupInitialConditions()</div><div class="ttdoc">This function allows to set the initial conditions for our problem to be solved, by default particle ...</div><div class="ttdef"><b>Definition:</b> DPMBase.cc:1987</div></div>
<div class="ttc" id="aclassMercury3D_html"><div class="ttname"><a href="../../d3/db1/classMercury3D.html">Mercury3D</a></div><div class="ttdoc">This adds on the hierarchical grid code for 3D problems.</div><div class="ttdef"><b>Definition:</b> Mercury3D.h:16</div></div>
<div class="ttc" id="asteady__axisym__advection__diffusion_8cc_html_a569d6908c13cebe207584b3d146c851e"><div class="ttname"><a href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a></div><div class="ttdeci">Constructor for SteadyAxisymAdvectionDiffusion problem</div><div class="ttdef"><b>Definition:</b> steady_axisym_advection_diffusion.cc:213</div></div>
</div><!-- fragment --><p>Once the previously shown <a class="el" href="../../d0/db4/mpiDemo.html">spatial decomposition</a> commands are included in the driver program, and the application is run in parallel using MPI, each process will write its own separate set of output files (.restart.n, .data.n, .fstat.n and .ene.n, <em>n</em> being the processor id). This is the so-called one file-per-process I/O model. In the figure below, we plot the .data.n output files for the above mentioned hourglass simulation simulated using MPI on 4 cores. We see separated parts of the entire hourglass simulation, since the .data.n files are written individually. This method requires no message-passing communications, and as a result it's quick. However, it can result into a large number of output files as the number of process/CPUs increases, that might be hard to manage and process.</p>
<div class="image">
<img src="../../FFPModel.png" alt=""/>
</div>
<h4><a class="anchor" id="autotoc_md195"></a>
b) Shared Files, SF I/O model</h4>
<p>Due to the above noted issues associated with the one file-per-process model, it can be desirable to output the data to a common file, written by all processes while running the parallelised code. To do this, we set the file type to either MPI_SHARED_FILE_ASCII or MPI_SHARED_FILE_BINARY, for ASCII and binary formats respectively:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d02/Mercury3D_8h.html">Mercury3D.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Demo : <span class="keyword">public</span> <a class="code" href="../../d3/db1/classMercury3D.html">Mercury3D</a> {</div>
<div class="line">  <span class="keywordtype">void</span> setupInitialConditions()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="comment">//define walls, boundary conditions, particle positions here</span></div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  Demo <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>;</div>
<div class="line">  <span class="comment">//define contact law, time step, final time, domain size here</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">//shared-file output: comment or uncomment for processing either ASCII or Binary output</span></div>
<div class="line">  <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.setFileType(FileType::MPI_SHARED_FILE_ASCII);</div>
<div class="line">  <span class="comment">//problem.setFileType(FileType::MPI_SHARED_FILE_BINARY);</span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.solve();</div>
<div class="line">}</div>
</div><!-- fragment --><p>For the shared-file model, all processes open a common file and read or write different parts of the same file simultaneously. As demonstrated in the Figure below, the shared-file approach maintains a single output file.</p>
<div class="image">
<img src="../../SampleDATAFileMPIIO.png" alt=""/>
<div class="caption">
HourGlass2DDemoMPI.data file, and the corresponding xballs output, for the 2D hourglass simulation, resulting from a 2-by-1-by-2 domain decomposition. Due to the fixed domain decomposition, a majority of the data is processed and written by only two of the four processes.</div></div>
<p>The figure below visualizes the content of the .data.n files obtained from writing one-file-per-process (subplots a and b), and the content of the .data file obtained from writing a shared file (subplot c).</p>
<div class="image">
<img src="../../InterpretedMPIIO.png" alt=""/>
</div>
<h3><a class="anchor" id="autotoc_md196"></a>
The MPI-IO Shared Restart Demo (MPI processes reading from a Common-File)</h3>
<p>Generally, in order to restart a simulation in MercuryDPM, we replace the simple solve command in the main function by solve(argc, argv), for reading in command-line arguments. Running the code with the command-line argument "-r" forces a restart; "-t [time]" can be used to reset the final time. When the MPI shared I/O model is enabled, the parallelised code is executed with the "mpirun" command as illustrated below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d02/Mercury3D_8h.html">Mercury3D.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Demo : <span class="keyword">public</span> <a class="code" href="../../d3/db1/classMercury3D.html">Mercury3D</a> {</div>
<div class="line">  <span class="keywordtype">void</span> setupInitialConditions()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="comment">//define walls, boundary conditions, particle positions here</span></div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">//first run Demo using &quot;./Demo&quot;</span></div>
<div class="line"><span class="comment">//then restart Demo using e.g. &quot;mpirun -np 4 ./Demo -r -tmax 0.2&quot;</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  Demo <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>;</div>
<div class="line">  <span class="comment">//define contact law, time step, final time, domain size here</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">//shared-file output: comment or uncomment for processing either ASCII or Binary output</span></div>
<div class="line">  <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.setFileType(FileType::MPI_SHARED_FILE_ASCII);</div>
<div class="line">  <span class="comment">//problem.setFileType(FileType::MPI_SHARED_FILE_BINARY);</span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.solve(argc,argv);</div>
<div class="line">}</div>
</div><!-- fragment --><p>When restarting the application, all processes in a parallel job will read the entire contents of the common, single restart file. For now, the parallel data readers are not smart enough to read-in only the portion of the data that they need. However, the collection of "actual data or information" that all processes require is accessible and simulations restart smoothly. Below are snapshot visualisations demonstrating the MPI-IO shared restart/read in action.</p>
<div class="image">
<img src="../../RestartDemoMPIIO.png" alt=""/>
<div class="caption">
Several restart-cases through the command: mpirun -np 4 ./# -r -tmax τ, for different values of the maximum simulation time, τ in seconds. The # symbolises the simulation label/name (<code>HourGlass2DDemoMPI</code>).</div></div>
<h3><a class="anchor" id="autotoc_md197"></a>
Performance evaluation for the parallel file systems:</h3>
<p>Finally, some performance results for comparing the above parallel I/O models are provided in the table below:</p>
<div class="image">
<img src="../../mpiioPerformance.png" alt="" width="600px"/>
<div class="caption">
Runtime for the one file-per-process (FPP) and collective (shared) I/O for the MercuryDPM-MPI code, when writing ASCII formatted-files for the Hour Glass 2D test application with 900 particles.</div></div>
<p>On the following pages, you'll find more parallelisation demonstrations:<br  />
<a class="el" href="../../de/d40/openmpDemo.html">Parallel processing using OpenMP</a> <br  />
<a class="el" href="../../d0/db4/mpiDemo.html">Parallel processing using MPI</a> <br  />
 Alternatively, go back to <a class="el" href="../../d7/db9/AdvancedTutorials.html#AdvancedOverview">Overview of advanced tutorials</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">MercuryDPM Reference Manual</a></li><li class="navelem"><a class="el" href="../../d5/dac/Tutorials.html">Fun with MercuryDPM (Tutorials)</a></li><li class="navelem"><a class="el" href="../../d0/db0/BeginnerTutorials.html">Beginner tutorials</a></li><li class="navelem"><a class="el" href="../../d7/db9/AdvancedTutorials.html">Advanced tutorials</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:05:13 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
