<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: Running simulations in parallel</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('db/d67/ParallelFD.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Running simulations in parallel </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>MercuryDPM can run simulations in parallel using MPI. The algorithm uses a simple domain decomposition, splitting the domain into \(n_x \times n_y \times n_z\) subdomains and running each subdomain on a separate processor.</p>
<p>To run simulations in parallel, you need to define all particles in setupInitialConditions and you need to define the domain size in main(). Generally, you should structure your driver code as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d02/Mercury3D_8h.html">Mercury3D.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Demo : <span class="keyword">public</span> <a class="code" href="../../d3/db1/classMercury3D.html">Mercury3D</a> {</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="../../d5/d89/classDPMBase.html#a1e4a1079bebb932de0ea70b487eedc5e">setupInitialConditions</a>()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="comment">//define walls, boundary conditions, particle positions here</span></div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  Demo <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>;</div>
<div class="line">  <span class="comment">//define contact law, time step, final time, domain size here</span></div>
<div class="line">  <a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.solve();</div>
<div class="line">}</div>
<div class="ttc" id="aMercury3D_8h_html"><div class="ttname"><a href="../../d8/d02/Mercury3D_8h.html">Mercury3D.h</a></div></div>
<div class="ttc" id="aT__protectiveWall_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> T_protectiveWall.cpp:194</div></div>
<div class="ttc" id="aclassDPMBase_html_a1e4a1079bebb932de0ea70b487eedc5e"><div class="ttname"><a href="../../d5/d89/classDPMBase.html#a1e4a1079bebb932de0ea70b487eedc5e">DPMBase::setupInitialConditions</a></div><div class="ttdeci">virtual void setupInitialConditions()</div><div class="ttdoc">This function allows to set the initial conditions for our problem to be solved, by default particle ...</div><div class="ttdef"><b>Definition:</b> DPMBase.cc:1987</div></div>
<div class="ttc" id="aclassMercury3D_html"><div class="ttname"><a href="../../d3/db1/classMercury3D.html">Mercury3D</a></div><div class="ttdoc">This adds on the hierarchical grid code for 3D problems.</div><div class="ttdef"><b>Definition:</b> Mercury3D.h:16</div></div>
<div class="ttc" id="asteady__axisym__advection__diffusion_8cc_html_a569d6908c13cebe207584b3d146c851e"><div class="ttname"><a href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a></div><div class="ttdeci">Constructor for SteadyAxisymAdvectionDiffusion problem</div><div class="ttdef"><b>Definition:</b> steady_axisym_advection_diffusion.cc:213</div></div>
</div><!-- fragment --><p>To run your simulation in parallel, you need to compile the code with MPI. Use cmake and turn the flag MercuryDPM_USE_MPI to ON. You can do this either by loading cmake-gui and changing the use USE_MPI flag to ON; or, alternatively you do it on the command line:</p>
<div class="fragment"><div class="line">cd MercuryBuild</div>
<div class="line">cmake . -DMERCURYDPM_USE_MPI=ON</div>
</div><!-- fragment --><p>You also need to tell your program about the decomposition it should use. To split your domain setNumberOfDomains into \(n_x \times n_y \times n_z\), add the following command in your main function, before solve():</p>
<div class="fragment"><div class="line"><span class="comment">//Set the number of domains for parallel decomposition</span></div>
<div class="line"><a class="code" href="../../d0/d5b/steady__axisym__advection__diffusion_8cc.html#a569d6908c13cebe207584b3d146c851e">problem</a>.setNumberOfDomains(<a class="code" href="../../d5/dc1/classVec3D.html">Vec3D</a>(<a class="code" href="../../da/d25/namespaceMesh__Parameters.html#aa5b5e2ce92e5185299a8a4d4fb45d394">nx</a>,<a class="code" href="../../da/d25/namespaceMesh__Parameters.html#afe97d64daaa8aad85626619c2571c291">ny</a>,<a class="code" href="../../da/d25/namespaceMesh__Parameters.html#a31a4cc8f1041191f4f1ceb01cacab091">nz</a>));</div>
<div class="ttc" id="aclassVec3D_html"><div class="ttname"><a href="../../d5/dc1/classVec3D.html">Vec3D</a></div><div class="ttdef"><b>Definition:</b> Kernel/Math/Vector.h:30</div></div>
<div class="ttc" id="anamespaceMesh__Parameters_html_a31a4cc8f1041191f4f1ceb01cacab091"><div class="ttname"><a href="../../da/d25/namespaceMesh__Parameters.html#a31a4cc8f1041191f4f1ceb01cacab091">Mesh_Parameters::nz</a></div><div class="ttdeci">const unsigned nz</div><div class="ttdef"><b>Definition:</b> ConstraintElementsUnitTest.cpp:32</div></div>
<div class="ttc" id="anamespaceMesh__Parameters_html_aa5b5e2ce92e5185299a8a4d4fb45d394"><div class="ttname"><a href="../../da/d25/namespaceMesh__Parameters.html#aa5b5e2ce92e5185299a8a4d4fb45d394">Mesh_Parameters::nx</a></div><div class="ttdeci">const unsigned nx</div><div class="ttdef"><b>Definition:</b> ConstraintElementsUnitTest.cpp:30</div></div>
<div class="ttc" id="anamespaceMesh__Parameters_html_afe97d64daaa8aad85626619c2571c291"><div class="ttname"><a href="../../da/d25/namespaceMesh__Parameters.html#afe97d64daaa8aad85626619c2571c291">Mesh_Parameters::ny</a></div><div class="ttdeci">const unsigned ny</div><div class="ttdef"><b>Definition:</b> ConstraintElementsUnitTest.cpp:31</div></div>
</div><!-- fragment --><p>Now compile your code, and run it with mpirun. Make sure you use the correct number of processors ( \(n=n_x \cdot n_y \cdot n_z\)) needed for the domain decomposition:</p>
<div class="fragment"><div class="line"><span class="comment">//Set the number of domains for parallel decomposition</span></div>
<div class="line">mpirun -np <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> MyDriverCode</div>
<div class="ttc" id="aCG3DPackingUnitTest_8cpp_html_a7026fd16370249ce97cb3d062326baf9"><div class="ttname"><a href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a></div><div class="ttdeci">const unsigned n</div><div class="ttdef"><b>Definition:</b> CG3DPackingUnitTest.cpp:11</div></div>
</div><!-- fragment --><p>For an example of an MPI-ready code, see Drivers/ParallelDrum/testDrum.cpp. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">MercuryDPM Reference Manual</a></li><li class="navelem"><a class="el" href="../../d8/df9/ForDevelopers.html">For Developers</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:05:12 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
