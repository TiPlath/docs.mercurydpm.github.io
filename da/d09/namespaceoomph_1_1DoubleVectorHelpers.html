<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: oomph::DoubleVectorHelpers Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/d09/namespaceoomph_1_1DoubleVectorHelpers.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">oomph::DoubleVectorHelpers Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Namespace for helper functions for DoubleVectors.  
<a href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acf43b80ace3f8a4633190ab36136083b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#acf43b80ace3f8a4633190ab36136083b">concatenate</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;in_vector_pt, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;out_vector)</td></tr>
<tr class="separator:acf43b80ace3f8a4633190ab36136083b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2e2b5728675ea85a48158f5d93f6593"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#ae2e2b5728675ea85a48158f5d93f6593">concatenate</a> (<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;in_vector, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;out_vector)</td></tr>
<tr class="separator:ae2e2b5728675ea85a48158f5d93f6593"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c0fa6de2c35301c556b9530c9ab2bc4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3c0fa6de2c35301c556b9530c9ab2bc4">split</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;in_vector, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;out_vector_pt)</td></tr>
<tr class="separator:a3c0fa6de2c35301c556b9530c9ab2bc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a111654d0a7b7bfaae9cdd8101c8005ca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a111654d0a7b7bfaae9cdd8101c8005ca">split</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;in_vector, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;out_vector)</td></tr>
<tr class="separator:a111654d0a7b7bfaae9cdd8101c8005ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ea9f7c40548e1a88402312e6f15d1fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">concatenate_without_communication</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;in_vector_pt, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;out_vector)</td></tr>
<tr class="separator:a3ea9f7c40548e1a88402312e6f15d1fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a568db46f65c1d234ac6f96ab54fafe60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a568db46f65c1d234ac6f96ab54fafe60">concatenate_without_communication</a> (<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;in_vector, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;out_vector)</td></tr>
<tr class="separator:a568db46f65c1d234ac6f96ab54fafe60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa87594da930b3eed12a27838972f10f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">split_without_communication</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;in_vector, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;out_vector_pt)</td></tr>
<tr class="separator:aa87594da930b3eed12a27838972f10f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66afcc493558424fb89f26bc23dd5bf2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a66afcc493558424fb89f26bc23dd5bf2">split_without_communication</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;in_vector, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;out_vector)</td></tr>
<tr class="separator:a66afcc493558424fb89f26bc23dd5bf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Namespace for helper functions for DoubleVectors. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="acf43b80ace3f8a4633190ab36136083b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf43b80ace3f8a4633190ab36136083b">&#9670;&nbsp;</a></span>concatenate() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::concatenate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_vector_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>out_vector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Concatenate DoubleVectors. Takes a Vector of DoubleVectors. If the out vector is built, we will not build a new distribution. Otherwise we build a uniform distribution.</p>
<p>The rows of the out vector is seen "as it is" in the in vectors. For example, if we have DoubleVectors with distributions A and B, distributed across two processors (p0 and p1),</p>
<p>A: [a0] (on p0) B: [b0] (on p0) [a1] (on p1) [b1] (on P1),</p>
<p>then the out_vector is</p>
<p>[a0 (on p0) a1] (on p0) [b0] (on p1) b1] (on p1),</p>
<p>Communication is required between processors. The sum of the global number of rows in the in vectors must equal to the global number of rows in the out vector. This condition must be met if one is to supply an out vector with a distribution, otherwise we can let the function generate the out vector distribution itself. </p>
<div class="fragment"><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    {</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="comment">// How many in vectors to concatenate?</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordtype">unsigned</span> nvectors = in_vector_pt.size();</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="comment">// PARANIOD checks which involves the in vectors only</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="comment">// Check that there is at least one vector.</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <span class="keywordflow">if</span> (nvectors == 0)</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;There is no vector to concatenate...\n&quot;</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Perhaps you forgot to fill in_vector_pt?\n&quot;</span>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="comment">// Does this vector need concatenating?</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <span class="keywordflow">if</span> (nvectors == 1)</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        std::ostringstream warning_message;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        warning_message &lt;&lt; <span class="stringliteral">&quot;There is only one vector to concatenate...\n&quot;</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;This does not require concatenating...\n&quot;</span>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        OomphLibWarning(warning_message.str(),</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="comment">// Check that all the DoubleVectors in in_vector_pt are built</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keywordflow">if</span> (!in_vector_pt[vec_i]-&gt;built())</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; is not built.\n&quot;</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;I cannot concatenate an unbuilt vector.\n&quot;</span>;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      }</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="comment">// The communicator pointer for the first in vector.</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keyword">const</span> OomphCommunicator* <span class="keyword">const</span> comm_pt =</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        in_vector_pt[0]-&gt;distribution_pt()-&gt;communicator_pt();</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="comment">// Check if the first in vector is distributed.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <span class="keywordtype">bool</span> distributed = in_vector_pt[0]-&gt;distributed();</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="comment">// If the out vector is not built, build it with a uniform distribution.</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordflow">if</span> (!out_vector.built())</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      {</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="comment">// Nrow for the out vector is the sum of the nrow of the in vectors.</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keywordtype">unsigned</span> tmp_nrow = 0;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;          tmp_nrow += in_vector_pt[vec_i]-&gt;nrow();</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        }</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="comment">// Build the out vector with uniform distribution.</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        out_vector.build(</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;          LinearAlgebraDistribution(comm_pt, tmp_nrow, distributed), 0.0);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="comment">// Check that the sum of nrow of in vectors match the nrow in the out</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="comment">// vectors.</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="keywordtype">unsigned</span> in_nrow = 0;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;          in_nrow += in_vector_pt[vec_i]-&gt;nrow();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        }</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">if</span> (in_nrow != out_vector.nrow())</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        {</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The sum of nrow of the in vectors does not match\n&quot;</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;the nrow of the out vector.\n&quot;</span>;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        }</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      }</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="comment">// Check that all communicators of the vectors to concatenate are the same</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="comment">// by comparing all communicators against the out vector.</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keyword">const</span> OomphCommunicator out_comm =</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        *(out_vector.distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="comment">// Get the Communicator for the current vector.</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="keyword">const</span> OomphCommunicator in_comm =</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;          *(in_vector_pt[vec_i]-&gt;distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">if</span> (out_comm != in_comm)</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i &lt;&lt; <span class="stringliteral">&quot; has a\n&quot;</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;different communicator from the out vector.\n&quot;</span>;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        }</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="comment">// Check that the distributed boolean is the same for all vectors.</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="keywordflow">if</span> (out_comm.nproc() != 1)</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> out_distributed = out_vector.distributed();</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;          <span class="keywordflow">if</span> (out_distributed != in_vector_pt[vec_i]-&gt;distributed())</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;          {</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            std::ostringstream error_message;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            error_message &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i &lt;&lt; <span class="stringliteral">&quot; has a\n&quot;</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;different distributed boolean from &quot;</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;the out vector.\n&quot;</span>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          }</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="comment">// Now we do the concatenation.</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">if</span> ((comm_pt-&gt;nproc() == 1) || !distributed)</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="comment">// Serial version of the code.</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="comment">// This is trivial, we simply loop through the in vectors and</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="comment">// fill in the out vector.</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        <span class="comment">// Out vector index.</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        <span class="keywordtype">unsigned</span> out_i = 0;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <span class="comment">// Out vector values.</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        <span class="keywordtype">double</span>* out_value_pt = out_vector.values_pt();</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        <span class="comment">// Loop through the in vectors.</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        {</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;          <span class="comment">// Nrow of current in vector.</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;          <span class="keywordtype">unsigned</span> in_nrow = in_vector_pt[vec_i]-&gt;nrow();</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;          <span class="comment">// In vector values.</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;          <span class="keywordtype">double</span>* in_value_pt = in_vector_pt[vec_i]-&gt;values_pt();</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          <span class="comment">// Loop through the entries of this in vector.</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; in_nrow; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;          {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            out_value_pt[out_i++] = in_value_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;          }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="comment">// Otherwise we are dealing with a distributed vector.</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="comment">// Get the number of processors</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keywordtype">unsigned</span> nproc = comm_pt-&gt;nproc();</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="comment">// My rank</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="keywordtype">unsigned</span> my_rank = comm_pt-&gt;my_rank();</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <span class="comment">// Storage for the data (per processor) to send</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        Vector&lt;Vector&lt;double&gt;&gt; values_to_send(nproc);</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <span class="comment">// The sum of the nrow for the in vectors (so far). This is used as an</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="comment">// offset to calculate the global equation number in the out vector</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sum_of_vec_nrow = 0;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        <span class="comment">// Loop over the in vectors and work out:</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <span class="comment">// out_p: the rank the of receiving processor</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="comment">// out_local_eqn: the local equation number of the receiving processor</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="comment">// Then put the value and out_local_eqn at out_p in values_to_send</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160; </div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        LinearAlgebraDistribution* out_distribution_pt =</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;          out_vector.distribution_pt();</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> in_vec_i = 0; in_vec_i &lt; nvectors; in_vec_i++)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;          <span class="comment">// Loop through the local equations</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;          <span class="keywordtype">unsigned</span> in_vec_nrow_local = in_vector_pt[in_vec_i]-&gt;nrow_local();</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;          <span class="keywordtype">unsigned</span> in_vec_first_row = in_vector_pt[in_vec_i]-&gt;first_row();</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> in_row_i = 0; in_row_i &lt; in_vec_nrow_local; in_row_i++)</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          {</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            <span class="comment">// Calculate the global equation number for this in_row_i</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <span class="keywordtype">unsigned</span> out_global_eqn =</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;              in_row_i + in_vec_first_row + sum_of_vec_nrow;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <span class="comment">// Get the processor that this global row belongs to.</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;            <span class="comment">// The rank_of_global_row(...) function loops through all the</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            <span class="comment">// processors and does two unsigned comparisons. Since we have to do</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            <span class="comment">// this for every row, it may be better to store a list mapping for</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            <span class="comment">// very large number of processors.</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            <span class="keywordtype">unsigned</span> out_p =</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;              out_distribution_pt-&gt;rank_of_global_row(out_global_eqn);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            <span class="comment">//         unsigned out_p = out_distribution_pt</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            <span class="comment">//           -&gt;rank_of_global_row_map(out_global_eqn);</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160; </div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <span class="comment">// Knowing out_p enables us to work out the out_first_row and</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <span class="comment">// out_local_eqn.</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            <span class="keywordtype">unsigned</span> out_first_row = out_distribution_pt-&gt;first_row(out_p);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            <span class="keywordtype">unsigned</span> out_local_eqn = out_global_eqn - out_first_row;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            <span class="comment">// Now push back the out_local_eqn and the value</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            values_to_send[out_p].push_back(out_local_eqn);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            values_to_send[out_p].push_back(</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;              (*in_vector_pt[in_vec_i])[in_row_i]);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;          }</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="comment">// Update the offset.</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          sum_of_vec_nrow += in_vector_pt[in_vec_i]-&gt;nrow();</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="comment">// Prepare to send the data!</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        <span class="comment">// Storage for the number of data to be sent to each processor.</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        Vector&lt;int&gt; send_n(nproc, 0);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="comment">// Storage for all the values to be send to each processor.</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        Vector&lt;double&gt; send_values_data;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <span class="comment">// Storage location within send_values_data</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        Vector&lt;int&gt; send_displacement(nproc, 0);</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="comment">// Get the total amount of data which needs to be sent, so we can</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <span class="comment">// reserve space for it.</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="keywordtype">unsigned</span> total_ndata = 0;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rank = 0; rank &lt; nproc; rank++)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          <span class="keywordflow">if</span> (rank != my_rank)</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          {</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            total_ndata += values_to_send[rank].size();</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;          }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160; </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="comment">// Now we don&#39;t have to re-allocate data/memory when push_back is</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="comment">// called. Nb. Using push_back without reserving memory may cause</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        <span class="comment">// multiple re-allocation behind the scenes, this is expensive.</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        send_values_data.reserve(total_ndata);</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="comment">// Loop over all the processors to &quot;flat pack&quot; the data for sending.</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rank = 0; rank &lt; nproc; rank++)</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;          <span class="comment">// Set the offset for the current processor</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;          send_displacement[rank] = send_values_data.size();</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160; </div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;          <span class="comment">// Don&#39;t bother to do anything if</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;          <span class="comment">// the processor in the loop is the current processor.</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;          <span class="keywordflow">if</span> (rank != my_rank)</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;          {</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;            <span class="comment">// Put the values into the send data vector.</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;            <span class="keywordtype">unsigned</span> n_data = values_to_send[rank].size();</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; n_data; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;            {</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;              send_values_data.push_back(values_to_send[rank][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            } <span class="comment">// Loop over the data</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;          } <span class="comment">// if rank != my_rank</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160; </div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;          <span class="comment">// Find the number of data to be added to the vector.</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;          send_n[rank] = send_values_data.size() - send_displacement[rank];</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        } <span class="comment">// Loop over processors</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160; </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="comment">// Storage for the number of data to be received from each processor.</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        Vector&lt;int&gt; receive_n(nproc, 0);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        MPI_Alltoall(&amp;send_n[0],</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                     1,</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                     MPI_INT,</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                     &amp;receive_n[0],</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                     1,</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                     MPI_INT,</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                     comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <span class="comment">// Prepare the data to be received</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <span class="comment">// by working out the displacement from the received data.</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        Vector&lt;int&gt; receive_displacement(nproc, 0);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="keywordtype">int</span> receive_data_count = 0;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rank = 0; rank &lt; nproc; rank++)</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        {</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;          receive_displacement[rank] = receive_data_count;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;          receive_data_count += receive_n[rank];</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="comment">// Now resize the receive buffer for all data from all processors.</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <span class="comment">// Make sure that it has size of at least one.</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">if</span> (receive_data_count == 0)</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;          receive_data_count++;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        }</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        Vector&lt;double&gt; receive_values_data(receive_data_count);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="comment">// Make sure that the send buffer has size at least one</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="comment">// so that we don&#39;t get a segmentation fault.</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="keywordflow">if</span> (send_values_data.size() == 0)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          send_values_data.resize(1);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="comment">// Now send the data between all processors</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        MPI_Alltoallv(&amp;send_values_data[0],</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                      &amp;send_n[0],</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                      &amp;send_displacement[0],</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                      MPI_DOUBLE,</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                      &amp;receive_values_data[0],</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                      &amp;receive_n[0],</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                      &amp;receive_displacement[0],</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                      MPI_DOUBLE,</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                      comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160; </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="comment">// Data from all other processors are stored in:</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <span class="comment">// receive_values_data</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="comment">// Data already on this processor is stored in:</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="comment">// values_to_send[my_rank]</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <span class="comment">// Loop through the data on this processor.</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordtype">unsigned</span> location_i = 0;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <span class="keywordtype">unsigned</span> my_values_to_send_size = values_to_send[my_rank].size();</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <span class="keywordflow">while</span> (location_i &lt; my_values_to_send_size)</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;          out_vector[<a class="code" href="../../d0/d1d/classunsigned.html">unsigned</a>(values_to_send[my_rank][location_i])] =</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            values_to_send[my_rank][location_i + 1];</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          location_i += 2;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="comment">// Before we loop through the data on other processors, we need to check</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <span class="comment">// if any data has been received.</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordtype">bool</span> data_has_been_received = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="keywordtype">unsigned</span> send_rank = 0;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordflow">while</span> (send_rank &lt; nproc)</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        {</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;          <span class="keywordflow">if</span> (receive_n[send_rank] &gt; 0)</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;          {</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;            data_has_been_received = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          }</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;          send_rank++;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160; </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        location_i = 0;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        <span class="keywordflow">if</span> (data_has_been_received)</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        {</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;          <span class="keywordtype">unsigned</span> receive_values_data_size = receive_values_data.size();</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;          <span class="keywordflow">while</span> (location_i &lt; receive_values_data_size)</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;          {</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            out_vector[<a class="code" href="../../d0/d1d/classunsigned.html">unsigned</a>(receive_values_data[location_i])] =</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;              receive_values_data[location_i + 1];</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            location_i += 2;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;          }</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;I don&#39;t know what to do with distributed vectors\n&quot;</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;without MPI... :(&quot;</span>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        }</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      }</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    } <span class="comment">// function concatenate</span></div>
<div class="ttc" id="aBiCGSTAB__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aclassunsigned_html"><div class="ttname"><a href="../../d0/d1d/classunsigned.html">unsigned</a></div></div>
<div class="ttc" id="aoomph__definitions_8h_html_a25c6813cc7341d125e2502f8923fb6c4"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a></div><div class="ttdeci">#define OOMPH_EXCEPTION_LOCATION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:61</div></div>
<div class="ttc" id="aoomph__definitions_8h_html_aa260cc4af589e30cea7fde997ae16667"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a></div><div class="ttdeci">#define OOMPH_CURRENT_FUNCTION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:86</div></div>
<div class="ttc" id="atut__arithmetic__redux__minmax_8cpp_html_a39513f0f8d942bf9ef17b2e87ac6d34e"><div class="ttname"><a href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a></div><div class="ttdeci">std::ptrdiff_t j</div><div class="ttdef"><b>Definition:</b> tut_arithmetic_redux_minmax.cpp:2</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#a7bcc94c157d6853a0f0502e8a76ed380">oomph::DoubleVector::build()</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#aae402d422ec4344a4a45cdb7659b7161">oomph::DoubleVector::built()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">oomph::LinearAlgebraDistribution::communicator_pt()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">oomph::DistributableLinearAlgebraObject::distributed()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">oomph::LinearAlgebraDistribution::first_row()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">oomph::OomphCommunicator::my_rank()</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">oomph::DistributableLinearAlgebraObject::nrow()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#acd5ffc5ff4b91a8e63677f9677cd0039">oomph::LinearAlgebraDistribution::rank_of_global_row()</a>, and <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#a8c3dcdf8a602a1f266bbe72d98fde2e7">oomph::DoubleVector::values_pt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#ae2e2b5728675ea85a48158f5d93f6593">concatenate()</a>, <a class="el" href="../../da/d32/classoomph_1_1HelmholtzMGPreconditioner.html#a1725e615a59cc6986efd313167295aa5">oomph::HelmholtzMGPreconditioner&lt; DIM &gt;::direct_solve()</a>, <a class="el" href="../../d8/d54/vector__concatenation_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>, and <a class="el" href="../../d1/d7f/classoomph_1_1ExactDGPBlockPreconditioner.html#aa94879739ec1c39b2671cffeb8b72114">oomph::ExactDGPBlockPreconditioner&lt; MATRIX &gt;::preconditioner_solve()</a>.</p>

</div>
</div>
<a id="ae2e2b5728675ea85a48158f5d93f6593"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2e2b5728675ea85a48158f5d93f6593">&#9670;&nbsp;</a></span>concatenate() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::concatenate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>out_vector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wrapper around the other concatenate(...) function. Be careful with Vector of vectors. If the DoubleVectors are resized, there could be reallocation of memory. If we wanted to use the function which takes a Vector of pointers to DoubleVectors, we would either have to invoke new and remember to delete, or create a temporary Vector to store pointers to the DoubleVector objects. This wrapper is meant to make life easier for the user by avoiding calls to new/delete AND without creating a temporary vector of pointers to DoubleVectors. If we had C++ 11, this would be so much nicer since we can use smart pointers which will delete themselves, so we do not have to remember to delete! </p>
<div class="fragment"><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    {</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_in_vector = in_vector.size();</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      Vector&lt;DoubleVector*&gt; in_vector_pt(n_in_vector, 0);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160; </div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_in_vector; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        in_vector_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = &amp;in_vector[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160; </div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#ae2e2b5728675ea85a48158f5d93f6593">DoubleVectorHelpers::concatenate</a>(in_vector_pt, out_vector);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    } <span class="comment">// function concatenate</span></div>
<div class="ttc" id="anamespaceoomph_1_1DoubleVectorHelpers_html_ae2e2b5728675ea85a48158f5d93f6593"><div class="ttname"><a href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#ae2e2b5728675ea85a48158f5d93f6593">oomph::DoubleVectorHelpers::concatenate</a></div><div class="ttdeci">void concatenate(Vector&lt; DoubleVector &gt; &amp;in_vector, DoubleVector &amp;out_vector)</div><div class="ttdef"><b>Definition:</b> double_vector.cc:1381</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#acf43b80ace3f8a4633190ab36136083b">concatenate()</a>, and <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>.</p>

</div>
</div>
<a id="a3ea9f7c40548e1a88402312e6f15d1fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ea9f7c40548e1a88402312e6f15d1fc">&#9670;&nbsp;</a></span>concatenate_without_communication() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::concatenate_without_communication </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_vector_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>out_vector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Concatenate DoubleVectors. Takes a Vector of DoubleVectors. If the out vector is built, we will not build a new distribution. Otherwise a new distribution will be built using LinearAlgebraDistribution::concatenate(...).</p>
<p>The out vector has its rows permuted according to the individual distributions of the in vectors. For example, if we have DoubleVectors with distributions A and B, distributed across two processors (p0 and p1),</p>
<p>A: [a0] (on p0) B: [b0] (on p0) [a1] (on p1) [b1] (on P1),</p>
<p>then the out_vector is</p>
<p>[a0 (on p0) b0] (on p0) [a1 (on p1) b1] (on p1),</p>
<p>as opposed to</p>
<p>[a0 (on p0) a1] (on p0) [b0 (on p1) b1] (on p1).</p>
<p>Note (1): The out vector may not be uniformly distributed even if the in vectors have uniform distributions. The nrow_local of the out vector will be the sum of the nrow_local of the in vectors. Try this out with two distributions of global rows 3 and 5, uniformly distributed across two processors. Compare this against a distribution of global row 8 distributed across two processors.</p>
<p>There are no MPI send and receive, the data stays on the processor as defined by the distributions from the in vectors.</p>
<p>Concatenate DoubleVectors. Takes a Vector of DoubleVectors. If the out vector is built, we will not build a new distribution. Otherwise a new distribution will be built using LinearAlgebraDistribution::concatenate(...).</p>
<p>The out vector has its rows permuted according to the individual distributions of the in vectors. For example, if we have DoubleVectors with distributions A and B, distributed across two processors (p0 and p1),</p>
<p>A: [a0] (on p0) B: [b0] (on p0) [a1] (on p1) [b1] (on P1),</p>
<p>then the out_vector is</p>
<p>[a0 (on p0) b0] (on p0) [a1 (on p1) b1] (on p1),</p>
<p>as opposed to</p>
<p>[a0 (on p0) a1] (on p0) [b0 (on p1) b1] (on p1).</p>
<p>Note (1): The out vector may not be uniformly distributed even if the the in vectors have uniform distributions. The nrow_local of the out vector will be the sum of the nrow_local of the in vectors. Try this out with two distributions of global rows 3 and 5, uniformly distributed across two processors. Compare this against a distribution of global row 8 distributed across two processors.</p>
<p>There are no MPI send and receive, the data stays on the processor as defined by the distributions from the in vectors. </p>
<div class="fragment"><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    {</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <span class="comment">// How many in vectors do we want to concatenate?</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="keywordtype">unsigned</span> nvectors = in_vector_pt.size();</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160; </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="comment">// PARANOID checks which involves the in vectors only.</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;      <span class="comment">// Check that there is at least one vector.</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      <span class="keywordflow">if</span> (nvectors == 0)</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      {</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;There is no vector to concatenate...\n&quot;</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Perhaps you forgot to fill in_vector_pt?\n&quot;</span>;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      }</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160; </div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="comment">// Does this vector need concatenating?</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="keywordflow">if</span> (nvectors == 1)</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        std::ostringstream warning_message;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        warning_message &lt;&lt; <span class="stringliteral">&quot;There is only one vector to concatenate...\n&quot;</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;This does not require concatenating...\n&quot;</span>;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        OomphLibWarning(warning_message.str(),</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160; </div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="comment">// Check that all the DoubleVectors in in_vector_pt are built</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      {</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="keywordflow">if</span> (!in_vector_pt[vec_i]-&gt;built())</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        {</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; is not built.\n&quot;</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;I cannot concatenate an unbuilt vector.\n&quot;</span>;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        }</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      }</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="comment">// If the out vector is not built, build it with the correct distribution.</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <span class="keywordflow">if</span> (!out_vector.built())</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      {</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        Vector&lt;LinearAlgebraDistribution*&gt; in_distribution_pt(nvectors, 0);</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        {</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;          in_distribution_pt[vec_i] = in_vector_pt[vec_i]-&gt;distribution_pt();</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        }</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160; </div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        LinearAlgebraDistribution tmp_distribution;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#ae2e2b5728675ea85a48158f5d93f6593">LinearAlgebraDistributionHelpers::concatenate</a>(in_distribution_pt,</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                                                      tmp_distribution);</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        out_vector.build(tmp_distribution, 0.0);</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      }</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160; </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      <span class="comment">// PARANOID checks which involves all in vectors and out vectors.</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160; </div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;      <span class="comment">// Check that all communicators of the vectors to concatenate are the same</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="comment">// by comparing all communicators against the out vector.</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keyword">const</span> OomphCommunicator out_comm =</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        *(out_vector.distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160; </div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      {</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="comment">// Get the Communicator for the current vector.</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        <span class="keyword">const</span> OomphCommunicator in_comm =</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;          *(in_vector_pt[vec_i]-&gt;distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160; </div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        <span class="keywordflow">if</span> (out_comm != in_comm)</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        {</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i &lt;&lt; <span class="stringliteral">&quot; has a\n&quot;</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;different communicator from the out vector.\n&quot;</span>;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        }</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      }</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160; </div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      <span class="comment">// Check that the distributed boolean is the same for all vectors.</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      <span class="keywordflow">if</span> (out_comm.nproc() &gt; 1)</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      {</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> out_distributed = out_vector.distributed();</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        {</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;          <span class="keywordflow">if</span> (out_distributed != in_vector_pt[vec_i]-&gt;distributed())</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;          {</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;            std::ostringstream error_message;</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            error_message &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i &lt;&lt; <span class="stringliteral">&quot; has a\n&quot;</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;different distributed boolean from the &quot;</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;out vector.\n&quot;</span>;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;          }</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        }</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      }</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160; </div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      <span class="comment">// Check that the distribution from the out vector is indeed the</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      <span class="comment">// same as the one created by</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      <span class="comment">// LinearAlgebraDistributionHelpers::concatenate(...). This test is</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      <span class="comment">// redundant if the out_vector is not built to begin with.</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160; </div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      <span class="comment">// Create tmp_distribution, a concatenation of all distributions from</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      <span class="comment">// the in vectors.</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      Vector&lt;LinearAlgebraDistribution*&gt; in_distribution_pt(nvectors, 0);</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      {</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        in_distribution_pt[vec_i] = in_vector_pt[vec_i]-&gt;distribution_pt();</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      }</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160; </div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      LinearAlgebraDistribution tmp_distribution;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#ae2e2b5728675ea85a48158f5d93f6593">LinearAlgebraDistributionHelpers::concatenate</a>(in_distribution_pt,</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                                                    tmp_distribution);</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      <span class="comment">// The the distribution from the out vector.</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      LinearAlgebraDistribution out_distribution =</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        *(out_vector.distribution_pt());</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      <span class="comment">// Compare them!</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="keywordflow">if</span> (tmp_distribution != out_distribution)</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      {</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the out vector is not correct.\n&quot;</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Please call the function with a cleared out vector,\n&quot;</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;or compare the distribution of the out vector with\n&quot;</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;the distribution created by\n&quot;</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;LinearAlgebraDistributionHelpers::concatenate(...)\n&quot;</span>;</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      }</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160; </div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      <span class="comment">// Do not need these distributions.</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      tmp_distribution.clear();</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      out_distribution.clear();</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160; </div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160; </div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="keywordtype">unsigned</span> out_value_offset = 0;</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160; </div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="keywordtype">double</span>* out_value_pt = out_vector.values_pt();</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160; </div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <span class="comment">// Loop through the vectors.</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvectors; vec_i++)</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        <span class="comment">// Get the nrow_local and</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="comment">// pointer to the values for the current in vector.</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <span class="keywordtype">unsigned</span> in_vector_nrow_local = in_vector_pt[vec_i]-&gt;nrow_local();</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        <span class="keywordtype">double</span>* in_vector_value_pt = in_vector_pt[vec_i]-&gt;values_pt();</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="comment">// Loop through the local values and inset them into the out_vector.</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> val_i = 0; val_i &lt; in_vector_nrow_local; val_i++)</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        {</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;          out_value_pt[out_value_offset + val_i] = in_vector_value_pt[val_i];</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        }</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160; </div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <span class="comment">// Update the offset.</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        out_value_offset += in_vector_nrow_local;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      }</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    } <span class="comment">// function concatenate_without_communication</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#a7bcc94c157d6853a0f0502e8a76ed380">oomph::DoubleVector::build()</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#aae402d422ec4344a4a45cdb7659b7161">oomph::DoubleVector::built()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac23e08b5c10d041a01bead478573a8ea">oomph::LinearAlgebraDistribution::clear()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">oomph::LinearAlgebraDistribution::communicator_pt()</a>, <a class="el" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">oomph::LinearAlgebraDistributionHelpers::concatenate()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">oomph::DistributableLinearAlgebraObject::distributed()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, and <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#a8c3dcdf8a602a1f266bbe72d98fde2e7">oomph::DoubleVector::values_pt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a568db46f65c1d234ac6f96ab54fafe60">concatenate_without_communication()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7efc9f2f0209764902e4e45fcb2556d1">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block_vector()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad356946d5de4f0817cdf8793fa3cdc74">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block_vectors()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1df550d281ec99914115edfa1a40b982">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_dof_level_block()</a>, and <a class="el" href="../../dd/d41/vector__concatenation__without__communication_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a568db46f65c1d234ac6f96ab54fafe60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a568db46f65c1d234ac6f96ab54fafe60">&#9670;&nbsp;</a></span>concatenate_without_communication() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::concatenate_without_communication </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>out_vector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wrapper around the other concatenate_without_communication(...) function. Be careful with Vector of vectors. If the DoubleVectors are resized, there could be reallocation of memory. If we wanted to use the function which takes a Vector of pointers to DoubleVectors, we would either have to invoke new and remember to delete, or create a temporary Vector to store pointers to the DoubleVector objects. This wrapper is meant to make life easier for the user by avoiding calls to new/delete AND without creating a temporary vector of pointers to DoubleVectors. If we had C++ 11, this would be so much nicer since we can use smart pointers which will delete themselves, so we do not have to remember to delete! </p>
<div class="fragment"><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    {</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_in_vector = in_vector.size();</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160; </div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      Vector&lt;DoubleVector*&gt; in_vector_pt(n_in_vector, 0);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160; </div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_in_vector; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      {</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        in_vector_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = &amp;in_vector[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      }</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160; </div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a568db46f65c1d234ac6f96ab54fafe60">DoubleVectorHelpers::concatenate_without_communication</a>(in_vector_pt,</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                                                             out_vector);</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    } <span class="comment">// function concatenate_without_communication</span></div>
<div class="ttc" id="anamespaceoomph_1_1DoubleVectorHelpers_html_a568db46f65c1d234ac6f96ab54fafe60"><div class="ttname"><a href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a568db46f65c1d234ac6f96ab54fafe60">oomph::DoubleVectorHelpers::concatenate_without_communication</a></div><div class="ttdeci">void concatenate_without_communication(Vector&lt; DoubleVector &gt; &amp;in_vector, DoubleVector &amp;out_vector)</div><div class="ttdef"><b>Definition:</b> double_vector.cc:2039</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">concatenate_without_communication()</a>, and <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>.</p>

</div>
</div>
<a id="a3c0fa6de2c35301c556b9530c9ab2bc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c0fa6de2c35301c556b9530c9ab2bc4">&#9670;&nbsp;</a></span>split() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::split </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>in_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_vector_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Split a DoubleVector into the out DoubleVectors. Let vec_A be the in Vector, and let vec_B and vec_C be the out vectors. Then the splitting of vec_A is depicted below: vec_A: [a0 (on p0) a1] (on p0) [a2 (on p1) a3] (on p1)</p>
<p>vec_B: [a0] (on p0) vec_C: [a2] (on p0) [a1] (on p1) [a3] (on p1)</p>
<p>Communication is required between processors. The out_vector_pt must contain pointers to DoubleVector which has already been built with the correct distribution; the sum of the number of global row of the out vectors must be the same the number of global rows of the in vector.</p>
<p>Split a DoubleVector into the out DoubleVectors. Let vec_A be the in Vector, and let vec_B and vec_C be the out vectors. Then the splitting of vec_A is depicted below: vec_A: [a0 (on p0) a1] (on p0) [a2 (on p1) a3] (on p1)</p>
<p>vec_B: [a0] (on p0) vec_C: [a2] (on p0) [a1] (on p1) [a3] (on p1)</p>
<p>Communication is required between processors. The out_vector_pt must contain pointers to DoubleVector which has already been built with the correct distribution; the sum of the number of global row of the out vectors must be the same the the number of global rows of the in vector. </p>
<div class="fragment"><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    {</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <span class="comment">// How many out vectors do we have?</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <span class="keywordtype">unsigned</span> nvec = out_vector_pt.size();</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      <span class="comment">// Check that the in vector is built.</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <span class="keywordflow">if</span> (!in_vector.built())</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      {</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;The in_vector is not built.\n&quot;</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Please build it!.\n&quot;</span>;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      }</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160; </div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      <span class="comment">// Check that all the out vectors are built.</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        <span class="keywordflow">if</span> (!out_vector_pt[vec_i]-&gt;built())</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        {</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The vector at position &quot;</span> &lt;&lt; vec_i</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;  is not built.\n&quot;</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;Please build it!.\n&quot;</span>;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        }</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      }</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160; </div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      <span class="comment">// Check that the sum of the nrow from out vectors is the same as the</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="comment">// nrow from in_vector.</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      <span class="keywordtype">unsigned</span> out_nrow_sum = 0;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      {</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        out_nrow_sum += out_vector_pt[vec_i]-&gt;nrow();</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      }</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160; </div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="keywordflow">if</span> (in_vector.nrow() != out_nrow_sum)</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;The global number of rows in the in_vector\n&quot;</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;is not equal to the sum of the global nrows\n&quot;</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;of the in vectors.\n&quot;</span>;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160; </div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="comment">// Check that all communicators are the same. We use a communicator to</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      <span class="comment">// get the number of processors and my_rank. So we would like them to be</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="comment">// the same for in_vector and all out vectors.</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keyword">const</span> OomphCommunicator in_vector_comm =</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        *(in_vector.distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      {</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        <span class="keyword">const</span> OomphCommunicator dist_i_comm =</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;          *(out_vector_pt[vec_i]-&gt;distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        <span class="keywordflow">if</span> (in_vector_comm != dist_i_comm)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        {</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The communicator for the distribution in the \n&quot;</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;position &quot;</span> &lt;&lt; vec_i</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; is not the same as the in_vector\n&quot;</span>;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        }</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      }</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160; </div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="comment">// Check that the distributed boolean is the same for all vectors.</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="keywordtype">bool</span> para_distributed = in_vector.distributed();</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160; </div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      {</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="keywordflow">if</span> (para_distributed != out_vector_pt[vec_i]-&gt;distributed())</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;          error_message</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i &lt;&lt; <span class="stringliteral">&quot; does not \n&quot;</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; have the same distributed boolean as the in_vector\n&quot;</span>;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        }</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      }</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160; </div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <span class="comment">// The communicator.</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <span class="keyword">const</span> OomphCommunicator* <span class="keyword">const</span> comm_pt =</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        in_vector.distribution_pt()-&gt;communicator_pt();</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160; </div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <span class="comment">// Is this distributed?</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keywordtype">bool</span> distributed = in_vector.distributed();</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160; </div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="comment">// The serial code.</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      <span class="keywordflow">if</span> ((comm_pt-&gt;nproc() == 1) || !distributed)</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      {</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        <span class="comment">// Serial version of the code: loop through all the out vectors and</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="comment">// insert the elements of in_vector.</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160; </div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        <span class="comment">// index for in vector, and in vector values.</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="keywordtype">unsigned</span> in_vec_i = 0;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        <span class="keywordtype">double</span>* in_value_pt = in_vector.values_pt();</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160; </div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <span class="comment">// Fill in the out vectors.</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> out_vec_i = 0; out_vec_i &lt; nvec; out_vec_i++)</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        {</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;          <span class="comment">// out vector nrow and values.</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;          <span class="keywordtype">unsigned</span> out_nrow = out_vector_pt[out_vec_i]-&gt;nrow();</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;          <span class="keywordtype">double</span>* out_value_pt = out_vector_pt[out_vec_i]-&gt;values_pt();</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160; </div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;          <span class="comment">// Fill in the current out vector.</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> out_val_i = 0; out_val_i &lt; out_nrow; out_val_i++)</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;          {</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            out_value_pt[out_val_i] = in_value_pt[in_vec_i++];</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;          }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        }</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      }</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      <span class="comment">// Otherwise we are dealing with a distributed vector.</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      {</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        <span class="comment">// For each entry in the in_vector, we need to work out:</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        <span class="comment">// 1) Which out vector this entry belongs to,</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <span class="comment">// 2) which processor to send the data to and</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        <span class="comment">// 3) the local equation number in the out vector.</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="comment">// We know the in_local_eqn, we can work out the in_global_eqn.</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <span class="comment">// From in_global_eqn we can work out the out vector and</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="comment">// the out_global_eqn.</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="comment">// The out_global_eqn allows us to determine which processor to send to.</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="comment">// With the out_p (processor to send data to) and out vector, we get the</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <span class="comment">// out_first_row which then allows us to work out the out_local_eqn.</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160; </div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160; </div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        <span class="comment">// Get the number of processors</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordtype">unsigned</span> nproc = comm_pt-&gt;nproc();</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160; </div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="comment">// My rank</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <span class="keywordtype">unsigned</span> my_rank = comm_pt-&gt;my_rank();</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160; </div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        <span class="comment">// Storage for the data (per processor) to send.</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        Vector&lt;Vector&lt;double&gt;&gt; values_to_send(nproc);</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="comment">// Sum of the nrow of the out vectors so far. This is used to work out</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        <span class="comment">// which out_vector a in_global_eqn belongs to.</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        Vector&lt;unsigned&gt; sum_of_out_nrow(nvec + 1);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;          sum_of_out_nrow[vec_i + 1] =</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;            sum_of_out_nrow[vec_i] + out_vector_pt[vec_i]-&gt;nrow();</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        }</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160; </div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <span class="comment">// Loop through the in_vector local values.</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <span class="keywordtype">unsigned</span> in_nrow_local = in_vector.nrow_local();</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> in_local_eqn = 0; in_local_eqn &lt; in_nrow_local;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;             in_local_eqn++)</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;          <span class="comment">// The global equation number of this row.</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;          <span class="keywordtype">unsigned</span> in_global_eqn = in_local_eqn + in_vector.first_row();</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160; </div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;          <span class="comment">// Which out_vector does this in_global_eqn belong to?</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;          <span class="keywordtype">unsigned</span> out_vector_i = 0;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;          <span class="keywordflow">while</span> (in_global_eqn &lt; sum_of_out_nrow[out_vector_i] ||</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                 in_global_eqn &gt;= sum_of_out_nrow[out_vector_i + 1])</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;          {</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            out_vector_i++;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;          }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;          <span class="comment">// The out_global_eqn</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;          <span class="comment">// (this is the global equation in the current out vector)</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;          <span class="keywordtype">unsigned</span> out_global_eqn =</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            in_global_eqn - sum_of_out_nrow[out_vector_i];</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160; </div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;          <span class="comment">// The processor to send this row to.</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;          <span class="keywordtype">unsigned</span> out_p =</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            out_vector_pt[out_vector_i]-&gt;distribution_pt()-&gt;rank_of_global_row(</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;              out_global_eqn);</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160; </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;          <span class="comment">// The local_eqn in the out_vector_i</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;          <span class="keywordtype">unsigned</span> out_local_eqn =</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            out_global_eqn -</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            out_vector_pt[out_vector_i]-&gt;distribution_pt()-&gt;first_row(out_p);</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160; </div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160; </div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;          <span class="comment">// Fill in the data to send</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160; </div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;          <span class="comment">// Which out vector to put this data in.</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;          values_to_send[out_p].push_back(out_vector_i);</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160; </div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;          <span class="comment">// The local equation of the data.</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;          values_to_send[out_p].push_back(out_local_eqn);</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160; </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;          <span class="comment">// The actual data.</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;          values_to_send[out_p].push_back(in_vector[in_local_eqn]);</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        }</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160; </div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="comment">// Prepare to send the data!</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160; </div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="comment">// Storage for the number of data to be sent to each processor.</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        Vector&lt;int&gt; send_n(nproc, 0);</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="comment">// Storage for all the values to be send to each processor.</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        Vector&lt;double&gt; send_values_data;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160; </div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <span class="comment">// Storage location within send_values_data</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        Vector&lt;int&gt; send_displacement(nproc, 0);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <span class="comment">// Get the total amount of data which needs to be sent, so we can</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        <span class="comment">// reserve space for it.</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="keywordtype">unsigned</span> total_ndata = 0;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rank = 0; rank &lt; nproc; rank++)</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        {</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;          <span class="keywordflow">if</span> (rank != my_rank)</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;          {</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            total_ndata += values_to_send[rank].size();</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;          }</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        }</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160; </div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        <span class="comment">// Now we don&#39;t have to re-allocate data/memory when push_back is</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <span class="comment">// called. Nb. Using push_back without reserving memory may cause</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <span class="comment">// multiple re-allocation behind the scenes, this is expensive.</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        send_values_data.reserve(total_ndata);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160; </div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="comment">// Loop over all the processors to &quot;flat pack&quot; the data for sending.</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rank = 0; rank &lt; nproc; rank++)</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        {</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;          <span class="comment">// Set the offset for the current processor</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;          send_displacement[rank] = send_values_data.size();</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160; </div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;          <span class="comment">// Don&#39;t bother to do anything if</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;          <span class="comment">// the processor in the loop is the current processor.</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;          <span class="keywordflow">if</span> (rank != my_rank)</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;          {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;            <span class="comment">// Put the values into the send data vector.</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            <span class="keywordtype">unsigned</span> n_data = values_to_send[rank].size();</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; n_data; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;              send_values_data.push_back(values_to_send[rank][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]);</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            } <span class="comment">// Loop over the data</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;          } <span class="comment">// if rank != my_rank</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160; </div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;          <span class="comment">// Find the number of data to be added to the vector.</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;          send_n[rank] = send_values_data.size() - send_displacement[rank];</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        } <span class="comment">// Loop over processors</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="comment">// Storage for the number of data to be received from each processor.</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        Vector&lt;int&gt; receive_n(nproc, 0);</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        MPI_Alltoall(&amp;send_n[0],</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                     1,</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                     MPI_INT,</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                     &amp;receive_n[0],</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                     1,</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                     MPI_INT,</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                     comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160; </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="comment">// Prepare the data to be received</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="comment">// by working out the displacement from the received data.</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        Vector&lt;int&gt; receive_displacement(nproc, 0);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="keywordtype">int</span> receive_data_count = 0;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rank = 0; rank &lt; nproc; rank++)</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        {</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;          receive_displacement[rank] = receive_data_count;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;          receive_data_count += receive_n[rank];</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        }</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160; </div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        <span class="comment">// Now resize the receive buffer for all data from all processors.</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        <span class="comment">// Make sure that it has size of at least one.</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        <span class="keywordflow">if</span> (receive_data_count == 0)</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        {</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;          receive_data_count++;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        }</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        Vector&lt;double&gt; receive_values_data(receive_data_count);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160; </div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        <span class="comment">// Make sure that the send buffer has size at least one</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        <span class="comment">// so that we don&#39;t get a segmentation fault.</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="keywordflow">if</span> (send_values_data.size() == 0)</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        {</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;          send_values_data.resize(1);</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        }</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160; </div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <span class="comment">// Now send the data between all processors</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        MPI_Alltoallv(&amp;send_values_data[0],</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                      &amp;send_n[0],</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                      &amp;send_displacement[0],</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                      MPI_DOUBLE,</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                      &amp;receive_values_data[0],</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                      &amp;receive_n[0],</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                      &amp;receive_displacement[0],</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                      MPI_DOUBLE,</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                      comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="comment">// Data from all other processors are stored in:</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        <span class="comment">// receive_values_data</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <span class="comment">// Data already on this processor is stored in:</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="comment">// values_to_send[my_rank]</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160; </div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <span class="comment">// Index for values_to_send Vector.</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="keywordtype">unsigned</span> location_i = 0;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <span class="comment">// Loop through the data on this processor</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keywordtype">unsigned</span> my_values_to_send_size = values_to_send[my_rank].size();</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="keywordflow">while</span> (location_i &lt; my_values_to_send_size)</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;          <span class="comment">// The vector to put the values in.</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;          <span class="keywordtype">unsigned</span> out_vector_i =</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;            <a class="code" href="../../d0/d1d/classunsigned.html">unsigned</a>(values_to_send[my_rank][location_i++]);</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;          <span class="comment">// Where to put the value.</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;          <span class="keywordtype">unsigned</span> out_local_eqn =</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;            <a class="code" href="../../d0/d1d/classunsigned.html">unsigned</a>(values_to_send[my_rank][location_i++]);</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;          <span class="comment">// The actual value!</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;          <span class="keywordtype">double</span> out_value = values_to_send[my_rank][location_i++];</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160; </div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;          <span class="comment">// Insert the value in the out vector.</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;          (*out_vector_pt[out_vector_i])[out_local_eqn] = out_value;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        }</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160; </div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="comment">// Before we loop through the data on other processors, we need to check</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <span class="comment">// if any data has been received. This is because the</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="comment">// receive_values_data has been resized to at least one, even if no data</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        <span class="comment">// is sent.</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        <span class="keywordtype">bool</span> data_has_been_received = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="keywordtype">unsigned</span> send_rank = 0;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        <span class="keywordflow">while</span> (send_rank &lt; nproc)</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        {</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;          <span class="keywordflow">if</span> (receive_n[send_rank] &gt; 0)</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;          {</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;            data_has_been_received = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;          }</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          send_rank++;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        }</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160; </div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="comment">// Reset the index, it is now being used to index the</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="comment">// receive_values_data vector.</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        location_i = 0;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        <span class="keywordflow">if</span> (data_has_been_received)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        {</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;          <span class="comment">// Extract the data and put it into the out vector.</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;          <span class="keywordtype">unsigned</span> receive_values_data_size = receive_values_data.size();</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;          <span class="keywordflow">while</span> (location_i &lt; receive_values_data_size)</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;          {</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            <span class="comment">// Which out vector to put the value in?</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            <span class="keywordtype">unsigned</span> out_vector_i = <a class="code" href="../../d0/d1d/classunsigned.html">unsigned</a>(receive_values_data[location_i++]);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            <span class="comment">// Where in the out vector to put the value?</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;            <span class="keywordtype">unsigned</span> out_local_eqn =</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;              <a class="code" href="../../d0/d1d/classunsigned.html">unsigned</a>(receive_values_data[location_i++]);</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160; </div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            <span class="comment">// The value to put in.</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;            <span class="keywordtype">double</span> out_value = receive_values_data[location_i++];</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160; </div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            <span class="comment">// Insert the value in the out vector.</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            (*out_vector_pt[out_vector_i])[out_local_eqn] = out_value;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;          }</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        }</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        {</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;You have a distributed vector but with no mpi...\n&quot;</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;I don&#39;t know what to do :( \n&quot;</span>;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            error_message.str(), <span class="stringliteral">&quot;RYARAYERR&quot;</span>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        }</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      }</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    } <span class="comment">// function split(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#aae402d422ec4344a4a45cdb7659b7161">oomph::DoubleVector::built()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">oomph::LinearAlgebraDistribution::communicator_pt()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">oomph::DistributableLinearAlgebraObject::distributed()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">oomph::DistributableLinearAlgebraObject::first_row()</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">oomph::OomphCommunicator::my_rank()</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">oomph::DistributableLinearAlgebraObject::nrow()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">oomph::DistributableLinearAlgebraObject::nrow_local()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, and <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#a8c3dcdf8a602a1f266bbe72d98fde2e7">oomph::DoubleVector::values_pt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/de1/classEigen_1_1MatrixPower.html#aa1258393dc13acd6e401e000f99b915f">Eigen::MatrixPower&lt; MatrixType &gt;::compute()</a>, <a class="el" href="../../da/d32/classoomph_1_1HelmholtzMGPreconditioner.html#a1725e615a59cc6986efd313167295aa5">oomph::HelmholtzMGPreconditioner&lt; DIM &gt;::direct_solve()</a>, <a class="el" href="../../dd/d2c/namespaceread__mercury__cg.html#a2e371f273a36927b4a35f1652ecc84b4">read_mercury_cg::get_raw_data()</a>, <a class="el" href="../../d1/d8d/namespacetools.html#ad50cb346a35f9698f6a887a1ede63ca1">tools::getKeysAndData()</a>, <a class="el" href="../../d6/dc1/namespaceInputData.html#adb25743f74431a62baf399e7e784f6b6">InputData::LoadPebbles()</a>, <a class="el" href="../../db/d57/classframework_1_1Frame.html#af845cd51952c3d518de0fbcf30653fd0">framework.Frame::look_for_mpibinaries()</a>, <a class="el" href="../../da/da7/namespaceComputeWallTorque.html#ac085aacce7bc597c89d7fcd538e2fc57">ComputeWallTorque::main()</a>, <a class="el" href="../../d5/db7/namespacePlotEnergies.html#a56e27fe64c6a33f254d47c6f154ac125">PlotEnergies::main()</a>, <a class="el" href="../../d9/d80/namespacefpsmall.html#aed57ac483939c9bd56b8561e5dc21a62">fpsmall::main()</a>, <a class="el" href="../../dc/d25/vector__split_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>, <a class="el" href="../../d9/d56/namespacemake__index.html#a4fd45f9d41ec657b8924322e2d9c6535">make_index::make_index()</a>, <a class="el" href="../../d3/dd1/namespaceLoadstatistics.html#ab500f5eee0d88daebdf8e85382304212">Loadstatistics::make_readable()</a>, <a class="el" href="../../d4/d39/classoomph-convert_1_1TecplotZone.html#a494e55a8318d59c5bfbfd25e68dfba04">oomph-convert.TecplotZone::parse()</a>, <a class="el" href="../../d3/d81/classoomph-convert_1_1InputPoints.html#a7b6b1916708c9c0a018df5a006a3694c">oomph-convert.InputPoints::parse()</a>, <a class="el" href="../../d1/d7f/classoomph_1_1ExactDGPBlockPreconditioner.html#aa94879739ec1c39b2671cffeb8b72114">oomph::ExactDGPBlockPreconditioner&lt; MATRIX &gt;::preconditioner_solve()</a>, <a class="el" href="../../d3/d8a/structEigen_1_1internal_1_1InnerMostDimReducer_3_01Self_00_01Op_00_01true_00_01true_01_4.html#a9b24b704d06a95e7b2e0c4c7d92a72e8">Eigen::internal::InnerMostDimReducer&lt; Self, Op, true, true &gt;::reduce()</a>, <a class="el" href="../../d1/d11/namespacesimulate.html#abbc85714b04ba9a2cabff464051f7bc9">simulate::runSimulations()</a>, <a class="el" href="../../df/dbe/namespacesimulateAWS.html#aab39bf3d0598b46ec6176d1a7b3de08b">simulateAWS::runSimulations()</a>, <a class="el" href="../../d8/d08/namespaceSaveToStl.html#a7156074e5870df3b4cad6d01001f24a6">SaveToStl::SaveStlSequence()</a>, <a class="el" href="../../db/d57/classframework_1_1Frame.html#a7d4ce105d80b3c572597428ec2edc25c">framework.Frame::set_download()</a>, <a class="el" href="../../db/d57/classframework_1_1Frame.html#ac79a2b064ffce5ba43bbc445e4d382cb">framework.Frame::set_ranlib()</a>, and <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a111654d0a7b7bfaae9cdd8101c8005ca">split()</a>.</p>

</div>
</div>
<a id="a111654d0a7b7bfaae9cdd8101c8005ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a111654d0a7b7bfaae9cdd8101c8005ca">&#9670;&nbsp;</a></span>split() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::split </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>in_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_vector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wrapper around the other split(...) function. Be careful with Vector of vectors. If the DoubleVectors are resized, there could be reallocation of memory. If we wanted to use the function which takes a Vector of pointers to DoubleVectors, we would either have to invoke new and remember to delete, or create a temporary Vector to store pointers to the DoubleVector objects. This wrapper is meant to make life easier for the user by avoiding calls to new/delete AND without creating a temporary vector of pointers to DoubleVectors. If we had C++ 11, this would be so much nicer since we can use smart pointers which will delete themselves, so we do not have to remember to delete! </p>
<div class="fragment"><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_out_vector = out_vector.size();</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      Vector&lt;DoubleVector*&gt; out_vector_pt(n_out_vector, 0);</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160; </div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_out_vector; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      {</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        out_vector_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = &amp;out_vector[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      }</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160; </div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a111654d0a7b7bfaae9cdd8101c8005ca">DoubleVectorHelpers::split</a>(in_vector, out_vector_pt);</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    } <span class="comment">// function split(...)</span></div>
<div class="ttc" id="anamespaceoomph_1_1DoubleVectorHelpers_html_a111654d0a7b7bfaae9cdd8101c8005ca"><div class="ttname"><a href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a111654d0a7b7bfaae9cdd8101c8005ca">oomph::DoubleVectorHelpers::split</a></div><div class="ttdeci">void split(const DoubleVector &amp;in_vector, Vector&lt; DoubleVector &gt; &amp;out_vector)</div><div class="ttdef"><b>Definition:</b> double_vector.cc:1805</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, and <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3c0fa6de2c35301c556b9530c9ab2bc4">split()</a>.</p>

</div>
</div>
<a id="aa87594da930b3eed12a27838972f10f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa87594da930b3eed12a27838972f10f8">&#9670;&nbsp;</a></span>split_without_communication() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::split_without_communication </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>in_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_vector_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Split a DoubleVector into the out DoubleVectors. Data stays on its current processor, no data is sent between processors. This results in our vectors which are a permutation of the in vector.</p>
<p>Let vec_A be the in Vector, and let vec_B and vec_C be the out vectors. Then the splitting of vec_A is depicted below: vec_A: [a0 (on p0) a1] (on p0) [a2 (on p1) a3] (on p1)</p>
<p>vec_B: [a0] (on p0) vec_C: [a1] (on p0) [a2] (on p1) [a3] (on p1).</p>
<p>This means that the distribution of the in vector MUST be a concatenation of the out vector distributions, refer to LinearAlgebraDistributionHelpers::concatenate(...) to concatenate distributions. </p>
<div class="fragment"><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    {</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="comment">// How many out vectors do we need?</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="keywordtype">unsigned</span> nvec = out_vector_pt.size();</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160; </div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      <span class="comment">// Check that in_vector is built</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      <span class="keywordflow">if</span> (!in_vector.built())</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      {</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;The in_vector is not built.\n&quot;</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Please build it!.\n&quot;</span>;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      }</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160; </div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      <span class="comment">// Check that all out vectors are built.</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      {</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        <span class="keywordflow">if</span> (!out_vector_pt[vec_i]-&gt;built())</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        {</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The vector at position &quot;</span> &lt;&lt; vec_i</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; is not built.\n&quot;</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;Please build it!.\n&quot;</span>;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        }</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      }</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160; </div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <span class="comment">// Check that the concatenation of distributions from the out vectors is</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      <span class="comment">// the same as the distribution from in_vector.</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160; </div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      <span class="comment">// Create the distribution from out_distribution.</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      Vector&lt;LinearAlgebraDistribution*&gt; tmp_out_distribution_pt(nvec, 0);</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      {</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        tmp_out_distribution_pt[vec_i] =</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;          out_vector_pt[vec_i]-&gt;distribution_pt();</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      }</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160; </div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      LinearAlgebraDistribution tmp_distribution;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#ae2e2b5728675ea85a48158f5d93f6593">LinearAlgebraDistributionHelpers::concatenate</a>(tmp_out_distribution_pt,</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                                                    tmp_distribution);</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="comment">// Compare the distributions</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      <span class="keywordflow">if</span> (tmp_distribution != *(in_vector.distribution_pt()))</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      {</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;The distribution from the in vector is incorrect.\n&quot;</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;It must be a concatenation of all the distributions\n&quot;</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;from the out vectors.\n&quot;</span>;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      }</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160; </div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="comment">// Clear the distribution.</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      tmp_distribution.clear();</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160; </div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      <span class="comment">// Check that all communicators are the same. We use a communicator to</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      <span class="comment">// get the number of processors and my_rank. So we would like them to be</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      <span class="comment">// the same for the in vector and all the out vectors.</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      <span class="keyword">const</span> OomphCommunicator in_vector_comm =</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        *(in_vector.distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;      {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        <span class="keyword">const</span> OomphCommunicator vec_i_comm =</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;          *(out_vector_pt[vec_i]-&gt;distribution_pt()-&gt;communicator_pt());</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160; </div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        <span class="keywordflow">if</span> (in_vector_comm != vec_i_comm)</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        {</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;The communicator for the vector in position\n&quot;</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                        &lt;&lt; vec_i &lt;&lt; <span class="stringliteral">&quot; is not the same as the in_vector\n&quot;</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;communicator.&quot;</span>;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        }</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      }</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160; </div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <span class="comment">// Check that if the in vector is distributed, then all the out vectors</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;      <span class="comment">// are also distributed.</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <span class="keywordflow">if</span> (in_vector_comm.nproc() &gt; 1)</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;      {</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        <span class="keywordtype">bool</span> in_distributed = in_vector.distributed();</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        {</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;          <span class="keywordflow">if</span> (in_distributed != out_vector_pt[vec_i]-&gt;distributed())</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;          {</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;            std::ostringstream error_message;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;            error_message &lt;&lt; <span class="stringliteral">&quot;The vector in position &quot;</span> &lt;&lt; vec_i</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; does not have\n&quot;</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;the same distributed boolean as the in vector&quot;</span>;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;          }</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        }</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      }</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160; </div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <span class="comment">// Loop through the sub vectors and insert the values from the</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="comment">// in vector.</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="keywordtype">double</span>* in_value_pt = in_vector.values_pt();</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      <span class="keywordtype">unsigned</span> in_value_offset = 0;</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; nvec; vec_i++)</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      {</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        <span class="comment">// The nrow_local and values for the current out vector.</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        <span class="keywordtype">unsigned</span> out_nrow_local = out_vector_pt[vec_i]-&gt;nrow_local();</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <span class="keywordtype">double</span>* out_value_pt = out_vector_pt[vec_i]-&gt;values_pt();</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160; </div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        <span class="comment">// Loop through the local values of out vector.</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> val_i = 0; val_i &lt; out_nrow_local; val_i++)</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        {</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;          out_value_pt[val_i] = in_value_pt[in_value_offset + val_i];</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        }</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160; </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        <span class="comment">// Update the offset.</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        in_value_offset += out_nrow_local;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      }</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    } <span class="comment">// function split_distribution_vector</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#aae402d422ec4344a4a45cdb7659b7161">oomph::DoubleVector::built()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac23e08b5c10d041a01bead478573a8ea">oomph::LinearAlgebraDistribution::clear()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">oomph::LinearAlgebraDistribution::communicator_pt()</a>, <a class="el" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">oomph::LinearAlgebraDistributionHelpers::concatenate()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">oomph::DistributableLinearAlgebraObject::distributed()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, and <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html#a8c3dcdf8a602a1f266bbe72d98fde2e7">oomph::DoubleVector::values_pt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/d3c/vector__split__without__communication_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1dd4d3cd6b64fa64e1ff6730b0deecc7">oomph::BlockPreconditioner&lt; MATRIX &gt;::return_block_vector()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a71d48d8a70151ef0febd4537a2214c53">oomph::BlockPreconditioner&lt; MATRIX &gt;::return_block_vectors()</a>, and <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a66afcc493558424fb89f26bc23dd5bf2">split_without_communication()</a>.</p>

</div>
</div>
<a id="a66afcc493558424fb89f26bc23dd5bf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66afcc493558424fb89f26bc23dd5bf2">&#9670;&nbsp;</a></span>split_without_communication() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::DoubleVectorHelpers::split_without_communication </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>in_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_vector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wrapper around the other split_without_communication(...) function. Be careful with Vector of vectors. If the DoubleVectors are resized, there could be reallocation of memory. If we wanted to use the function which takes a Vector of pointers to DoubleVectors, we would either have to invoke new and remember to delete, or create a temporary Vector to store pointers to the DoubleVector objects. This wrapper is meant to make life easier for the user by avoiding calls to new/delete AND without creating a temporary vector of pointers to DoubleVectors. If we had C++ 11, this would be so much nicer since we can use smart pointers which will delete themselves, so we do not have to remember to delete! </p>
<div class="fragment"><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    {</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_out_vector = out_vector.size();</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160; </div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      Vector&lt;DoubleVector*&gt; out_vector_pt(n_out_vector, 0);</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160; </div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_out_vector; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;      {</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        out_vector_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = &amp;out_vector[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      }</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160; </div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a66afcc493558424fb89f26bc23dd5bf2">DoubleVectorHelpers::split_without_communication</a>(in_vector,</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                                                       out_vector_pt);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160; </div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    } <span class="comment">// function split_distribution_vector</span></div>
<div class="ttc" id="anamespaceoomph_1_1DoubleVectorHelpers_html_a66afcc493558424fb89f26bc23dd5bf2"><div class="ttname"><a href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a66afcc493558424fb89f26bc23dd5bf2">oomph::DoubleVectorHelpers::split_without_communication</a></div><div class="ttdeci">void split_without_communication(const DoubleVector &amp;in_vector, Vector&lt; DoubleVector &gt; &amp;out_vector)</div><div class="ttdef"><b>Definition:</b> double_vector.cc:2216</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, and <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">split_without_communication()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../da/ddf/namespaceoomph.html">oomph</a></li><li class="navelem"><a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html">DoubleVectorHelpers</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:09:39 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
