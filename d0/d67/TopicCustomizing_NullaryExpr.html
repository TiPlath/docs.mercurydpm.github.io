<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: Matrix manipulation via nullary-expressions</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d0/d67/TopicCustomizing_NullaryExpr.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Matrix manipulation via nullary-expressions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The main purpose of the class CwiseNullaryOp is to define <em>procedural</em> matrices such as constant or random matrices as returned by the Ones(), Zero(), Constant(), Identity() and Random() methods. Nevertheless, with some imagination it is possible to accomplish very sophisticated matrix manipulation with minimal efforts such that <a class="el" href="../../d2/d7e/TopicNewExpressionType.html">implementing new expression</a> is rarely needed.</p>
<h1><a class="anchor" id="NullaryExpr_Circulant"></a>
Example 1: circulant matrix</h1>
<p>To explore these possibilities let us start with the <em>circulant</em> example of the <a class="el" href="../../d2/d7e/TopicNewExpressionType.html">implementing new expression</a> topic. Let us recall that a circulant matrix is a matrix where each column is the same as the column to the left, except that it is cyclically shifted downwards. For example, here is a 4-by-4 circulant matrix: </p><p class="formulaDsp">
\[ \begin{bmatrix} 1 &amp; 8 &amp; 4 &amp; 2 \\ 2 &amp; 1 &amp; 8 &amp; 4 \\ 4 &amp; 2 &amp; 1 &amp; 8 \\ 8 &amp; 4 &amp; 2 &amp; 1 \end{bmatrix} \]
</p>
<p> A circulant matrix is uniquely determined by its first column. We wish to write a function <code>makeCirculant</code> which, given the first column, returns an expression representing the circulant matrix.</p>
<p>For this exercise, the return type of <code>makeCirculant</code> will be a CwiseNullaryOp that we need to instantiate with: 1 - a proper <code>circulant_functor</code> storing the input vector and implementing the adequate coefficient accessor <code>operator(i,j)</code> 2 - a template instantiation of class Matrix conveying compile-time information such as the scalar type, sizes, and preferred storage layout.</p>
<p>Calling <code>ArgType</code> the type of the input vector, we can construct the equivalent squared Matrix type as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ArgType&gt;</div>
<div class="line"><span class="keyword">struct </span><a class="code" href="../../d9/dff/structcirculant__helper.html">circulant_helper</a> {</div>
<div class="line">  <span class="keyword">typedef</span> <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">Eigen::Matrix</a>&lt;<span class="keyword">typename</span> <a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a052eb942d12b6404aade6fae4b075fb9">ArgType::Scalar</a>, ArgType::SizeAtCompileTime, ArgType::SizeAtCompileTime,</div>
<div class="line">                        <a class="code" href="../../d3/d95/group__enums.html#ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62">Eigen::ColMajor</a>, ArgType::MaxSizeAtCompileTime, ArgType::MaxSizeAtCompileTime&gt;</div>
<div class="line">      <a class="code" href="../../d1/d3b/benchmark-blocking-sizes_8cpp.html#af5fcaa2ea9f565466ca96c2992ea0771">MatrixType</a>;</div>
<div class="line">};</div>
<div class="ttc" id="abench__gemm_8cpp_html_a052eb942d12b6404aade6fae4b075fb9"><div class="ttname"><a href="../../d8/d3e/bench__gemm_8cpp.html#a052eb942d12b6404aade6fae4b075fb9">Scalar</a></div><div class="ttdeci">SCALAR Scalar</div><div class="ttdef"><b>Definition:</b> bench_gemm.cpp:45</div></div>
<div class="ttc" id="abenchmark-blocking-sizes_8cpp_html_af5fcaa2ea9f565466ca96c2992ea0771"><div class="ttname"><a href="../../d1/d3b/benchmark-blocking-sizes_8cpp.html#af5fcaa2ea9f565466ca96c2992ea0771">MatrixType</a></div><div class="ttdeci">MatrixXf MatrixType</div><div class="ttdef"><b>Definition:</b> benchmark-blocking-sizes.cpp:52</div></div>
<div class="ttc" id="aclassEigen_1_1Matrix_html"><div class="ttname"><a href="../../dc/d34/classEigen_1_1Matrix.html">Eigen::Matrix</a></div><div class="ttdoc">The matrix class, also used for vectors and row-vectors.</div><div class="ttdef"><b>Definition:</b> Eigen/Eigen/src/Core/Matrix.h:186</div></div>
<div class="ttc" id="agroup__enums_html_ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62"><div class="ttname"><a href="../../d3/d95/group__enums.html#ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62">Eigen::ColMajor</a></div><div class="ttdeci">@ ColMajor</div><div class="ttdef"><b>Definition:</b> Constants.h:318</div></div>
<div class="ttc" id="astructcirculant__helper_html"><div class="ttname"><a href="../../d9/dff/structcirculant__helper.html">circulant_helper</a></div><div class="ttdef"><b>Definition:</b> make_circulant2.cpp:22</div></div>
</div><!-- fragment --><p> This little helper structure will help us to implement our <code>makeCirculant</code> function as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ArgType&gt;</div>
<div class="line"><a class="code" href="../../d0/d6a/classEigen_1_1CwiseNullaryOp.html">Eigen::CwiseNullaryOp&lt;circulant_functor&lt;ArgType&gt;</a>, <span class="keyword">typename</span> <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">circulant_helper&lt;ArgType&gt;::MatrixType</a>&gt; <a class="code" href="../../d0/d63/make__circulant2_8cpp.html#ac6fa39ae32f04914f0a9b2baa021a907">makeCirculant</a>(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="../../d9/d25/classEigen_1_1MatrixBase.html">Eigen::MatrixBase&lt;ArgType&gt;</a>&amp; arg) {</div>
<div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">circulant_helper&lt;ArgType&gt;::MatrixType</a> <a class="code" href="../../d1/d3b/benchmark-blocking-sizes_8cpp.html#af5fcaa2ea9f565466ca96c2992ea0771">MatrixType</a>;</div>
<div class="line">  <span class="keywordflow">return</span> MatrixType::NullaryExpr(arg.size(), arg.size(), <a class="code" href="../../d1/ddb/classcirculant__functor.html">circulant_functor&lt;ArgType&gt;</a>(arg.derived()));</div>
<div class="line">}</div>
<div class="ttc" id="aclassEigen_1_1CwiseNullaryOp_html"><div class="ttname"><a href="../../d0/d6a/classEigen_1_1CwiseNullaryOp.html">Eigen::CwiseNullaryOp</a></div><div class="ttdoc">Generic expression of a matrix where all coefficients are defined by a functor.</div><div class="ttdef"><b>Definition:</b> CwiseNullaryOp.h:64</div></div>
<div class="ttc" id="aclassEigen_1_1MatrixBase_html"><div class="ttname"><a href="../../d9/d25/classEigen_1_1MatrixBase.html">Eigen::MatrixBase</a></div><div class="ttdoc">Base class for all dense matrices, vectors, and expressions.</div><div class="ttdef"><b>Definition:</b> MatrixBase.h:52</div></div>
<div class="ttc" id="aclasscirculant__functor_html"><div class="ttname"><a href="../../d1/ddb/classcirculant__functor.html">circulant_functor</a></div><div class="ttdef"><b>Definition:</b> make_circulant2.cpp:6</div></div>
<div class="ttc" id="amake__circulant2_8cpp_html_ac6fa39ae32f04914f0a9b2baa021a907"><div class="ttname"><a href="../../d0/d63/make__circulant2_8cpp.html#ac6fa39ae32f04914f0a9b2baa021a907">makeCirculant</a></div><div class="ttdeci">Eigen::CwiseNullaryOp&lt; circulant_functor&lt; ArgType &gt;, typename circulant_helper&lt; ArgType &gt;::MatrixType &gt; makeCirculant(const Eigen::MatrixBase&lt; ArgType &gt; &amp;arg)</div><div class="ttdef"><b>Definition:</b> make_circulant2.cpp:31</div></div>
</div><!-- fragment --><p> As usual, our function takes as argument a <code>MatrixBase</code> (see this <a class="el" href="../../d4/d45/TopicFunctionTakingEigenTypes.html">page</a> for more details). Then, the CwiseNullaryOp object is constructed through the DenseBase::NullaryExpr static method with the adequate runtime sizes.</p>
<p>Then, we need to implement our <code>circulant_functor</code>, which is a straightforward exercise:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ArgType&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="../../d1/ddb/classcirculant__functor.html">circulant_functor</a> {</div>
<div class="line">  <span class="keyword">const</span> ArgType&amp; m_vec;</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <a class="code" href="../../d1/ddb/classcirculant__functor.html">circulant_functor</a>(<span class="keyword">const</span> ArgType&amp; arg) : m_vec(arg) {}</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a052eb942d12b6404aade6fae4b075fb9">ArgType::Scalar</a>&amp; operator()(<a class="code" href="../../d1/d62/namespaceEigen.html#a62e77e0933482dafde8fe197d9a2cfde">Eigen::Index</a> <a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a>, <a class="code" href="../../d1/d62/namespaceEigen.html#a62e77e0933482dafde8fe197d9a2cfde">Eigen::Index</a> <a class="code" href="../../df/de7/MatrixBase__col_8cpp.html#aa168d9544aa6d49fce0cbfc0bec849b0">col</a>)<span class="keyword"> const </span>{</div>
<div class="line">    <a class="code" href="../../d1/d62/namespaceEigen.html#a62e77e0933482dafde8fe197d9a2cfde">Eigen::Index</a> index = <a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a> - <a class="code" href="../../df/de7/MatrixBase__col_8cpp.html#aa168d9544aa6d49fce0cbfc0bec849b0">col</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (index &lt; 0) index += m_vec.size();</div>
<div class="line">    <span class="keywordflow">return</span> m_vec(index);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aMatrixBase__col_8cpp_html_aa168d9544aa6d49fce0cbfc0bec849b0"><div class="ttname"><a href="../../df/de7/MatrixBase__col_8cpp.html#aa168d9544aa6d49fce0cbfc0bec849b0">col</a></div><div class="ttdeci">m col(1)</div></div>
<div class="ttc" id="aMatrixBase__row_8cpp_html_a64ef8efef59f875033a27e7cbbc879ec"><div class="ttname"><a href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a></div><div class="ttdeci">m row(1)</div></div>
<div class="ttc" id="anamespaceEigen_html_a62e77e0933482dafde8fe197d9a2cfde"><div class="ttname"><a href="../../d1/d62/namespaceEigen.html#a62e77e0933482dafde8fe197d9a2cfde">Eigen::Index</a></div><div class="ttdeci">EIGEN_DEFAULT_DENSE_INDEX_TYPE Index</div><div class="ttdoc">The Index type as used for the API.</div><div class="ttdef"><b>Definition:</b> Meta.h:83</div></div>
</div><!-- fragment --><p> We are now all set to try our new feature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  Eigen::VectorXd vec(4);</div>
<div class="line">  vec &lt;&lt; 1, 2, 4, 8;</div>
<div class="line">  Eigen::MatrixXd <a class="code" href="../../de/dad/EigenUnitTest_8cpp.html#a53252e348541d00a5248231afb886d59">mat</a>;</div>
<div class="line">  <a class="code" href="../../d5/d93/classEigen_1_1SparseMatrix.html">mat</a> = <a class="code" href="../../d0/d63/make__circulant2_8cpp.html#ac6fa39ae32f04914f0a9b2baa021a907">makeCirculant</a>(vec);</div>
<div class="line">  std::cout &lt;&lt; <a class="code" href="../../d5/d93/classEigen_1_1SparseMatrix.html">mat</a> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aEigenUnitTest_8cpp_html_a53252e348541d00a5248231afb886d59"><div class="ttname"><a href="../../de/dad/EigenUnitTest_8cpp.html#a53252e348541d00a5248231afb886d59">mat</a></div><div class="ttdeci">Eigen::SparseMatrix&lt; double &gt; mat</div><div class="ttdef"><b>Definition:</b> EigenUnitTest.cpp:10</div></div>
<div class="ttc" id="aT__protectiveWall_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../d9/d18/T__protectiveWall_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> T_protectiveWall.cpp:194</div></div>
<div class="ttc" id="aclassEigen_1_1SparseMatrix_html"><div class="ttname"><a href="../../d5/d93/classEigen_1_1SparseMatrix.html">Eigen::SparseMatrix&lt; double &gt;</a></div></div>
</div><!-- fragment --><p>If all the fragments are combined, the following output is produced, showing that the program works as expected:</p>
<div class="fragment"></div><!-- fragment --><p>This implementation of <code>makeCirculant</code> is much simpler than <a class="el" href="../../d2/d7e/TopicNewExpressionType.html">defining a new expression</a> from scratch.</p>
<h1><a class="anchor" id="NullaryExpr_Indexing"></a>
Example 2: indexing rows and columns</h1>
<p>The goal here is to mimic MatLab's ability to index a matrix through two vectors of indices referencing the rows and columns to be picked respectively, like this:</p>
<div class="fragment"></div><!-- fragment --><p> To this end, let us first write a nullary-functor storing references to the input matrix and to the two arrays of indices, and implementing the required <code>operator()(i,j)</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ArgType, <span class="keyword">class</span> RowIndexType, <span class="keyword">class</span> ColIndexType&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="../../d1/d6a/classindexing__functor.html">indexing_functor</a> {</div>
<div class="line">  <span class="keyword">const</span> ArgType&amp; m_arg;</div>
<div class="line">  <span class="keyword">const</span> RowIndexType&amp; m_rowIndices;</div>
<div class="line">  <span class="keyword">const</span> ColIndexType&amp; m_colIndices;</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">typedef</span> <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">Eigen::Matrix</a>&lt;<span class="keyword">typename</span> <a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a052eb942d12b6404aade6fae4b075fb9">ArgType::Scalar</a>, RowIndexType::SizeAtCompileTime, ColIndexType::SizeAtCompileTime,</div>
<div class="line">                        ArgType::Flags &amp; <a class="code" href="../../d0/ded/group__flags.html#gae4f56c2a60bbe4bd2e44c5b19cbe8762">Eigen::RowMajorBit</a> ? <a class="code" href="../../d3/d95/group__enums.html#ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f">Eigen::RowMajor</a> : <a class="code" href="../../d3/d95/group__enums.html#ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62">Eigen::ColMajor</a>,</div>
<div class="line">                        RowIndexType::MaxSizeAtCompileTime, ColIndexType::MaxSizeAtCompileTime&gt;</div>
<div class="line">      <a class="code" href="../../d1/d3b/benchmark-blocking-sizes_8cpp.html#af5fcaa2ea9f565466ca96c2992ea0771">MatrixType</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="../../d1/d6a/classindexing__functor.html">indexing_functor</a>(<span class="keyword">const</span> ArgType&amp; arg, <span class="keyword">const</span> RowIndexType&amp; row_indices, <span class="keyword">const</span> ColIndexType&amp; col_indices)</div>
<div class="line">      : m_arg(arg), m_rowIndices(row_indices), m_colIndices(col_indices) {}</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a052eb942d12b6404aade6fae4b075fb9">ArgType::Scalar</a>&amp; operator()(<a class="code" href="../../d1/d62/namespaceEigen.html#a62e77e0933482dafde8fe197d9a2cfde">Eigen::Index</a> <a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a>, <a class="code" href="../../d1/d62/namespaceEigen.html#a62e77e0933482dafde8fe197d9a2cfde">Eigen::Index</a> <a class="code" href="../../df/de7/MatrixBase__col_8cpp.html#aa168d9544aa6d49fce0cbfc0bec849b0">col</a>)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> m_arg(m_rowIndices[<a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a>], m_colIndices[<a class="code" href="../../df/de7/MatrixBase__col_8cpp.html#aa168d9544aa6d49fce0cbfc0bec849b0">col</a>]);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassindexing__functor_html"><div class="ttname"><a href="../../d1/d6a/classindexing__functor.html">indexing_functor</a></div><div class="ttdef"><b>Definition:</b> nullary_indexing.cpp:6</div></div>
<div class="ttc" id="agroup__enums_html_ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f"><div class="ttname"><a href="../../d3/d95/group__enums.html#ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f">Eigen::RowMajor</a></div><div class="ttdeci">@ RowMajor</div><div class="ttdef"><b>Definition:</b> Constants.h:320</div></div>
<div class="ttc" id="agroup__flags_html_gae4f56c2a60bbe4bd2e44c5b19cbe8762"><div class="ttname"><a href="../../d0/ded/group__flags.html#gae4f56c2a60bbe4bd2e44c5b19cbe8762">Eigen::RowMajorBit</a></div><div class="ttdeci">const unsigned int RowMajorBit</div><div class="ttdef"><b>Definition:</b> Constants.h:70</div></div>
</div><!-- fragment --><p> Then, let's create an <code>indexing(A,rows,cols)</code> function creating the nullary expression:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ArgType, <span class="keyword">class</span> RowIndexType, <span class="keyword">class</span> ColIndexType&gt;</div>
<div class="line"><a class="code" href="../../d0/d6a/classEigen_1_1CwiseNullaryOp.html">Eigen::CwiseNullaryOp&lt;indexing_functor&lt;ArgType, RowIndexType, ColIndexType&gt;</a>,</div>
<div class="line">                      <span class="keyword">typename</span> <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">indexing_functor&lt;ArgType, RowIndexType, ColIndexType&gt;::MatrixType</a>&gt;</div>
<div class="line"><a class="code" href="../../db/d80/nullary__indexing_8cpp.html#aeb989abb21a70e616d83aa8f85d397d4">mat_indexing</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d25/classEigen_1_1MatrixBase.html">Eigen::MatrixBase&lt;ArgType&gt;</a>&amp; arg, <span class="keyword">const</span> RowIndexType&amp; row_indices, <span class="keyword">const</span> ColIndexType&amp; col_indices) {</div>
<div class="line">  <span class="keyword">typedef</span> <a class="code" href="../../d1/d6a/classindexing__functor.html">indexing_functor&lt;ArgType, RowIndexType, ColIndexType&gt;</a> Func;</div>
<div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="../../d1/d3b/benchmark-blocking-sizes_8cpp.html#af5fcaa2ea9f565466ca96c2992ea0771">Func::MatrixType</a> <a class="code" href="../../d1/d3b/benchmark-blocking-sizes_8cpp.html#af5fcaa2ea9f565466ca96c2992ea0771">MatrixType</a>;</div>
<div class="line">  <span class="keywordflow">return</span> MatrixType::NullaryExpr(row_indices.size(), col_indices.size(), Func(arg.derived(), row_indices, col_indices));</div>
<div class="line">}</div>
<div class="ttc" id="anullary__indexing_8cpp_html_aeb989abb21a70e616d83aa8f85d397d4"><div class="ttname"><a href="../../db/d80/nullary__indexing_8cpp.html#aeb989abb21a70e616d83aa8f85d397d4">mat_indexing</a></div><div class="ttdeci">Eigen::CwiseNullaryOp&lt; indexing_functor&lt; ArgType, RowIndexType, ColIndexType &gt;, typename indexing_functor&lt; ArgType, RowIndexType, ColIndexType &gt;::MatrixType &gt; mat_indexing(const Eigen::MatrixBase&lt; ArgType &gt; &amp;arg, const RowIndexType &amp;row_indices, const ColIndexType &amp;col_indices)</div><div class="ttdef"><b>Definition:</b> nullary_indexing.cpp:30</div></div>
</div><!-- fragment --><p> Finally, here is an example of how this function can be used:</p>
<div class="fragment"><div class="line">  Eigen::MatrixXi <a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a251721b42e33871f7d05032a0c216d5e">A</a> = Eigen::MatrixXi::Random(4, 4);</div>
<div class="line">  Eigen::Array3i ri(1, 2, 1);</div>
<div class="line">  Eigen::ArrayXi ci(6);</div>
<div class="line">  ci &lt;&lt; 3, 2, 1, 0, 0, 2;</div>
<div class="line">  Eigen::MatrixXi <a class="code" href="../../d6/d74/classoomph_1_1Matrix.html">B</a> = <a class="code" href="../../db/d80/nullary__indexing_8cpp.html#aeb989abb21a70e616d83aa8f85d397d4">mat_indexing</a>(<a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a251721b42e33871f7d05032a0c216d5e">A</a>, ri, ci);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;A =&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a251721b42e33871f7d05032a0c216d5e">A</a> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;A([&quot;</span> &lt;&lt; ri.transpose() &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; ci.transpose() &lt;&lt; <span class="stringliteral">&quot;]) =&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <a class="code" href="../../d6/d74/classoomph_1_1Matrix.html">B</a> &lt;&lt; std::endl;</div>
<div class="ttc" id="abench__gemm_8cpp_html_a251721b42e33871f7d05032a0c216d5e"><div class="ttname"><a href="../../d8/d3e/bench__gemm_8cpp.html#a251721b42e33871f7d05032a0c216d5e">A</a></div><div class="ttdeci">Matrix&lt; SCALARA, Dynamic, Dynamic, opt_A &gt; A</div><div class="ttdef"><b>Definition:</b> bench_gemm.cpp:47</div></div>
<div class="ttc" id="aclassoomph_1_1Matrix_html"><div class="ttname"><a href="../../d6/d74/classoomph_1_1Matrix.html">oomph::Matrix</a></div><div class="ttdef"><b>Definition:</b> matrices.h:74</div></div>
</div><!-- fragment --><p> This straightforward implementation is already quite powerful as the row or column index arrays can also be expressions to perform offsetting, modulo, striding, reverse, etc.</p>
<div class="fragment"><div class="line">  <a class="code" href="../../d6/d74/classoomph_1_1Matrix.html">B</a> = <a class="code" href="../../db/d80/nullary__indexing_8cpp.html#aeb989abb21a70e616d83aa8f85d397d4">mat_indexing</a>(<a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a251721b42e33871f7d05032a0c216d5e">A</a>, ri + 1, ci);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;A(ri+1,ci) =&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <a class="code" href="../../d6/d74/classoomph_1_1Matrix.html">B</a> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="../../d6/d74/classoomph_1_1Matrix.html">B</a> = <a class="code" href="../../db/d80/nullary__indexing_8cpp.html#aeb989abb21a70e616d83aa8f85d397d4">mat_indexing</a>(<a class="code" href="../../d8/d3e/bench__gemm_8cpp.html#a251721b42e33871f7d05032a0c216d5e">A</a>, Eigen::ArrayXi::LinSpaced(13, 0, 12).unaryExpr([](<span class="keywordtype">int</span> <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>) { <span class="keywordflow">return</span> <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a> % 4; }),</div>
<div class="line">                   Eigen::ArrayXi::LinSpaced(4, 0, 3));</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;A(ArrayXi::LinSpaced(13,0,12).unaryExpr([](int x){return x%4;}), ArrayXi::LinSpaced(4,0,3)) =&quot;</span></div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <a class="code" href="../../d6/d74/classoomph_1_1Matrix.html">B</a> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="ttc" id="anamespaceplotDoE_html_a4758fc6194247f040938f29c863d21ee"><div class="ttname"><a href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE.x</a></div><div class="ttdeci">list x</div><div class="ttdef"><b>Definition:</b> plotDoE.py:28</div></div>
</div><!-- fragment --><p> and the output is:</p>
<div class="fragment"></div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">MercuryDPM Reference Manual</a></li><li class="navelem"><a class="el" href="../../d6/d4a/UserManual_CustomizingEigen.html">Extending/Customizing Eigen</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:05:14 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
