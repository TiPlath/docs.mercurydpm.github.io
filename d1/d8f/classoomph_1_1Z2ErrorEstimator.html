<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: oomph::Z2ErrorEstimator Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d1/d8f/classoomph_1_1Z2ErrorEstimator.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../df/dc7/classoomph_1_1Z2ErrorEstimator-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">oomph::Z2ErrorEstimator Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../df/d56/error__estimator_8h_source.html">error_estimator.h</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Inheritance diagram for oomph::Z2ErrorEstimator:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
 <div class="center">
  <img src="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.png" usemap="#oomph::Z2ErrorEstimator_map" alt=""/>
  <map id="oomph::Z2ErrorEstimator_map" name="oomph::Z2ErrorEstimator_map">
<area href="../../d6/dab/classoomph_1_1ErrorEstimator.html" title="Base class for spatial error estimators." alt="oomph::ErrorEstimator" shape="rect" coords="0,0,152,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a75ef55e67b21ec49ed1a37d095cfa9f9"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="../../df/de6/classdouble.html">double</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">CombinedErrorEstimateFctPt</a>) (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;errors)</td></tr>
<tr class="memdesc:a75ef55e67b21ec49ed1a37d095cfa9f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function pointer to combined error estimator function.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">More...</a><br /></td></tr>
<tr class="separator:a75ef55e67b21ec49ed1a37d095cfa9f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1cb0328af843a8bebf5333045cea4553"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1cb0328af843a8bebf5333045cea4553">Z2ErrorEstimator</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>)</td></tr>
<tr class="memdesc:a1cb0328af843a8bebf5333045cea4553"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor: Set order of recovery shape functions.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1cb0328af843a8bebf5333045cea4553">More...</a><br /></td></tr>
<tr class="separator:a1cb0328af843a8bebf5333045cea4553"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35186eeb792bf2b948239d19b2697ca0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a35186eeb792bf2b948239d19b2697ca0">Z2ErrorEstimator</a> ()</td></tr>
<tr class="separator:a35186eeb792bf2b948239d19b2697ca0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab52cb1c86f2a39af3c4f10dfff02a51a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab52cb1c86f2a39af3c4f10dfff02a51a">Z2ErrorEstimator</a> (const <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html">Z2ErrorEstimator</a> &amp;)=delete</td></tr>
<tr class="memdesc:ab52cb1c86f2a39af3c4f10dfff02a51a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken copy constructor.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab52cb1c86f2a39af3c4f10dfff02a51a">More...</a><br /></td></tr>
<tr class="separator:ab52cb1c86f2a39af3c4f10dfff02a51a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70cc1b459e36f42e6654c25c89103319"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a70cc1b459e36f42e6654c25c89103319">operator=</a> (const <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html">Z2ErrorEstimator</a> &amp;)=delete</td></tr>
<tr class="memdesc:a70cc1b459e36f42e6654c25c89103319"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken assignment operator.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a70cc1b459e36f42e6654c25c89103319">More...</a><br /></td></tr>
<tr class="separator:a70cc1b459e36f42e6654c25c89103319"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d1e540fe046f1c55d59690932d4095d"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a3d1e540fe046f1c55d59690932d4095d">~Z2ErrorEstimator</a> ()</td></tr>
<tr class="memdesc:a3d1e540fe046f1c55d59690932d4095d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Empty virtual destructor.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a3d1e540fe046f1c55d59690932d4095d">More...</a><br /></td></tr>
<tr class="separator:a3d1e540fe046f1c55d59690932d4095d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa38b3ecfbb223a91bfe049d4722af6d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa38b3ecfbb223a91bfe049d4722af6d3">get_element_errors</a> (<a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&amp;mesh_pt, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;elemental_error)</td></tr>
<tr class="separator:aa38b3ecfbb223a91bfe049d4722af6d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0fd03123c518ed340bb534c2f6b8cc4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors</a> (<a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&amp;mesh_pt, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;elemental_error, <a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html">DocInfo</a> &amp;doc_info)</td></tr>
<tr class="separator:ae0fd03123c518ed340bb534c2f6b8cc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7a3a28cfc05b291b438b80e87c7f5cc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a> ()</td></tr>
<tr class="memdesc:af7a3a28cfc05b291b438b80e87c7f5cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function for order of recovery polynomials.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">More...</a><br /></td></tr>
<tr class="separator:af7a3a28cfc05b291b438b80e87c7f5cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad463b5c01e6bb5b9e4ec9b3a02f9fb4a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ad463b5c01e6bb5b9e4ec9b3a02f9fb4a">recovery_order</a> () const</td></tr>
<tr class="memdesc:ad463b5c01e6bb5b9e4ec9b3a02f9fb4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function for order of recovery polynomials (const version)  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ad463b5c01e6bb5b9e4ec9b3a02f9fb4a">More...</a><br /></td></tr>
<tr class="separator:ad463b5c01e6bb5b9e4ec9b3a02f9fb4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1719ff79e67f2f0b2b8194a91f52d3d2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">CombinedErrorEstimateFctPt</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1719ff79e67f2f0b2b8194a91f52d3d2">combined_error_fct_pt</a> ()</td></tr>
<tr class="memdesc:a1719ff79e67f2f0b2b8194a91f52d3d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function: Pointer to combined error estimate function.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1719ff79e67f2f0b2b8194a91f52d3d2">More...</a><br /></td></tr>
<tr class="separator:a1719ff79e67f2f0b2b8194a91f52d3d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa961268bfdb517d9a59a68eb159042c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">CombinedErrorEstimateFctPt</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa961268bfdb517d9a59a68eb159042c9">combined_error_fct_pt</a> () const</td></tr>
<tr class="separator:aa961268bfdb517d9a59a68eb159042c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c8a3d6e46d9b9ba31c768cb5b026bba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a5c8a3d6e46d9b9ba31c768cb5b026bba">setup_patches</a> (<a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&amp;mesh_pt, std::map&lt; <a class="el" href="../../dc/db7/classoomph_1_1Node.html">Node</a> *, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html">ElementWithZ2ErrorEstimator</a> * &gt; * &gt; &amp;adjacent_elements_pt, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../dc/db7/classoomph_1_1Node.html">Node</a> * &gt; &amp;vertex_node_pt)</td></tr>
<tr class="separator:a5c8a3d6e46d9b9ba31c768cb5b026bba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a997dc6ba0b546a0f7363949a8d33d133"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de6/classdouble.html">double</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a997dc6ba0b546a0f7363949a8d33d133">reference_flux_norm</a> ()</td></tr>
<tr class="memdesc:a997dc6ba0b546a0f7363949a8d33d133"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function for prescribed reference flux norm.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a997dc6ba0b546a0f7363949a8d33d133">More...</a><br /></td></tr>
<tr class="separator:a997dc6ba0b546a0f7363949a8d33d133"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a7902d3e80dc64406e1f367c02ec4e3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de6/classdouble.html">double</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a4a7902d3e80dc64406e1f367c02ec4e3">reference_flux_norm</a> () const</td></tr>
<tr class="memdesc:a4a7902d3e80dc64406e1f367c02ec4e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function for prescribed reference flux norm (const. version)  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a4a7902d3e80dc64406e1f367c02ec4e3">More...</a><br /></td></tr>
<tr class="separator:a4a7902d3e80dc64406e1f367c02ec4e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53d7a1ac66dd41b39d6794e1d00080fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de6/classdouble.html">double</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a53d7a1ac66dd41b39d6794e1d00080fc">get_combined_error_estimate</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;compound_error)</td></tr>
<tr class="memdesc:a53d7a1ac66dd41b39d6794e1d00080fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a combined error estimate from all compound errors.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a53d7a1ac66dd41b39d6794e1d00080fc">More...</a><br /></td></tr>
<tr class="separator:a53d7a1ac66dd41b39d6794e1d00080fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classoomph_1_1ErrorEstimator"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classoomph_1_1ErrorEstimator')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html">oomph::ErrorEstimator</a></td></tr>
<tr class="memitem:a43b3800b6695fe3fd13241b0530a0d0c inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a43b3800b6695fe3fd13241b0530a0d0c">ErrorEstimator</a> ()</td></tr>
<tr class="memdesc:a43b3800b6695fe3fd13241b0530a0d0c inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default empty constructor.  <a href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a43b3800b6695fe3fd13241b0530a0d0c">More...</a><br /></td></tr>
<tr class="separator:a43b3800b6695fe3fd13241b0530a0d0c inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a643d7d4ec8782a158577feb1ff2b47cb inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a643d7d4ec8782a158577feb1ff2b47cb">ErrorEstimator</a> (const <a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html">ErrorEstimator</a> &amp;)=delete</td></tr>
<tr class="memdesc:a643d7d4ec8782a158577feb1ff2b47cb inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken copy constructor.  <a href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a643d7d4ec8782a158577feb1ff2b47cb">More...</a><br /></td></tr>
<tr class="separator:a643d7d4ec8782a158577feb1ff2b47cb inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afce4303c8d969e87ee38133dd98bc381 inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html#afce4303c8d969e87ee38133dd98bc381">operator=</a> (const <a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html">ErrorEstimator</a> &amp;)=delete</td></tr>
<tr class="memdesc:afce4303c8d969e87ee38133dd98bc381 inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken assignment operator.  <a href="../../d6/dab/classoomph_1_1ErrorEstimator.html#afce4303c8d969e87ee38133dd98bc381">More...</a><br /></td></tr>
<tr class="separator:afce4303c8d969e87ee38133dd98bc381 inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57ddd866184d95a75f024353ca936b5b inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a57ddd866184d95a75f024353ca936b5b">~ErrorEstimator</a> ()</td></tr>
<tr class="memdesc:a57ddd866184d95a75f024353ca936b5b inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Empty virtual destructor.  <a href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a57ddd866184d95a75f024353ca936b5b">More...</a><br /></td></tr>
<tr class="separator:a57ddd866184d95a75f024353ca936b5b inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b12c5d2579360a08b6b6298cea8b142 inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a3b12c5d2579360a08b6b6298cea8b142">get_element_errors</a> (<a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&amp;mesh_pt, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;elemental_error)</td></tr>
<tr class="separator:a3b12c5d2579360a08b6b6298cea8b142 inherit pub_methods_classoomph_1_1ErrorEstimator"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a0384127746b7eea7fcf0d08f2d34c647"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a0384127746b7eea7fcf0d08f2d34c647">get_recovered_flux_in_patch</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html">ElementWithZ2ErrorEstimator</a> * &gt; &amp;patch_el_pt, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;num_recovery_terms, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;num_flux_terms, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;dim, <a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html">DenseMatrix</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; *&amp;recovered_flux_coefficient_pt)</td></tr>
<tr class="separator:a0384127746b7eea7fcf0d08f2d34c647"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1782984fa64738f9a8e7ca40d585597a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1782984fa64738f9a8e7ca40d585597a">nrecovery_terms</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;dim)</td></tr>
<tr class="separator:a1782984fa64738f9a8e7ca40d585597a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab57514ecde88f7ae970439fd4900996a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab57514ecde88f7ae970439fd4900996a">shape_rec</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;<a class="el" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a61b7da262276970831d88a2f37dbe509">x</a>, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;dim, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;psi_r)</td></tr>
<tr class="separator:ab57514ecde88f7ae970439fd4900996a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac53b6d73d9e73140c92302c2aa70203a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/d70/classoomph_1_1Integral.html">Integral</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ac53b6d73d9e73140c92302c2aa70203a">integral_rec</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;dim, const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;is_q_mesh)</td></tr>
<tr class="separator:ac53b6d73d9e73140c92302c2aa70203a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad84f3b903d0508093d6e2a905198b438"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ad84f3b903d0508093d6e2a905198b438">doc_flux</a> (<a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *mesh_pt, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;num_flux_terms, <a class="el" href="../../d4/dbb/classoomph_1_1MapMatrixMixed.html">MapMatrixMixed</a>&lt; <a class="el" href="../../dc/db7/classoomph_1_1Node.html">Node</a> *, <a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>, <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;rec_flux_map, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;elemental_error, <a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html">DocInfo</a> &amp;doc_info)</td></tr>
<tr class="memdesc:ad84f3b903d0508093d6e2a905198b438"><td class="mdescLeft">&#160;</td><td class="mdescRight">Doc flux and recovered flux.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ad84f3b903d0508093d6e2a905198b438">More...</a><br /></td></tr>
<tr class="separator:ad84f3b903d0508093d6e2a905198b438"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a9aafff3d80518811ba7d9bb12a240a7c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a></td></tr>
<tr class="memdesc:a9aafff3d80518811ba7d9bb12a240a7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Order of recovery polynomials.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">More...</a><br /></td></tr>
<tr class="separator:a9aafff3d80518811ba7d9bb12a240a7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa024a307366bb987b1c9ba379b837e8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">Recovery_order_from_first_element</a></td></tr>
<tr class="separator:afa024a307366bb987b1c9ba379b837e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa170691c5d84fbf0eb6dc5f480bbb187"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de6/classdouble.html">double</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a></td></tr>
<tr class="memdesc:aa170691c5d84fbf0eb6dc5f480bbb187"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prescribed reference flux norm.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">More...</a><br /></td></tr>
<tr class="separator:aa170691c5d84fbf0eb6dc5f480bbb187"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34a013732989e82f50cb7e72f25632a7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">CombinedErrorEstimateFctPt</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a></td></tr>
<tr class="memdesc:a34a013732989e82f50cb7e72f25632a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function pointer to combined error estimator function.  <a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">More...</a><br /></td></tr>
<tr class="separator:a34a013732989e82f50cb7e72f25632a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Z2-error-estimator: Elements that can be used with Z2 error estimation should be derived from the base class ElementWithZ2ErrorEstimator and implement its pure virtual member functions to provide the following functionality:</p><ul>
<li>pointer-based access to the vertex nodes in the element (this is required to facilitate setup of element patches).</li>
<li>the computation of a suitable "flux vector" which represents a quantity whose FE representation is discontinuous across element boundaries but would become continuous under infinite mesh refinement.</li>
</ul>
<p>As an example consider the finite element solution of the Laplace problem, \( \partial^2 u/\partial x_i^2 = 0 \). If we approximate the unknown \( u \) on a finite element mesh with \( N \) nodes as </p><p class="formulaDsp">
\[ u^{[FE]}(x_k) = \sum_{j=1}^{N} U_j \ \psi_j(x_k), \]
</p>
<p> where the \( \psi_j(x_k) \) are the (global) \( C^0 \) basis functions, the finite-element representation of the flux, \( f_i = \partial u/\partial x_i \), </p><p class="formulaDsp">
\[ f_i^{[FE]} = \sum_{j=1}^{N} U_j \ \frac{\partial \psi_j}{\partial x_i} \]
</p>
<p> is discontinuous between elements but the magnitude of the jump decreases under mesh refinement. We denote the number of flux terms by \(N_{flux}\), so for a 2D (3D) Laplace problem, \(N_{flux}=2 \ (3).\)</p>
<p>The idea behind Z2 error estimation is to compute an approximation for the flux that is more accurate than the value \( f_i^{[FE]} \) obtained directly from the finite element solution. We refer to the improved approximation for the flux as the "recovered flux" and denote it by \( f_i^{[rec]} \). Since \( f_i^{[rec]} \) is more accurate than \( f_i^{[FE]} \), the difference between the two provides a measure of the error. In Z2 error estimation, the "recovered flux" is determined by projecting the discontinuous, FE-based flux \( f_i^{[FE]} \) onto a set of continuous basis functions, known as the "recovery shape
functions". In principle, one could use the finite element shape functions \( \psi_j(x_k) \) as the recovery shape functions but then the determination of the recovered flux would involve the solution of a linear system that is as big as the original problem. To avoid this, the projection is performed over small patches of elements within which low-order polynomials (defined in terms of the global, Eulerian coordinates) are used as the recovery shape functions.</p>
<p>Z2 error estimation is known to be "optimal" for many self-adjoint problems. See, e.g., Zienkiewicz &amp; Zhu's original papers "The superconvergent patch recovery and a posteriori error estimates." International Journal for Numerical Methods in Engineering <b>33</b> (1992) Part I: 1331-1364; Part II: 1365-1382. In non-self adjoint problems, the error estimator only analyses the "self-adjoint part" of the differential operator. However, in many cases, this still produces good error indicators since the error estimator detects under-resolved, sharp gradients in the solution.</p>
<p>Z2 error estimation works as follows:</p><ol type="1">
<li>We combine the elements in the mesh into a number of "patches", which consist of all elements that share a common vertex node. Most elements will therefore be members of multiple patches.</li>
<li><p class="startli">Within each patch \(p\), we expand the "recovered flux" as</p>
<p class="formulaDsp">
\[ f^{[rec](p)}_i(x_k) = \sum_{j=1}^{N_{rec}} F^{(p)}_{ij} \ \psi^{[rec]}_j(x_k) \mbox{ \ \ \ for $i=1,...,N_{flux}$,} \]
</p>
<p> where the functions \( \psi^{[rec]}_j(x_k)\) are the recovery shape functions, which are functions of the global, Eulerian coordinates. Typically, these are chosen to be low-order polynomials. For instance, in 2D, a bilinear representation of \( f^{(p)}_i(x_0,x_1) \) involves the \(N_{rec}=3\) recovery shape functions \( \psi^{[rec]}_0(x_0,x_1)=1, \ \psi^{[rec]}_1(x_0,x_1)=x_0 \) and \( \psi^{[rec]}_2(x_0,x_1)=x_1\).</p>
<p class="startli">We determine the coefficients \( F^{(p)}_{ij} \) by enforcing \( f^{(p)}_i(x_k) = f^{[FE]}_i(x_k)\) in its weak form:</p>
<p class="formulaDsp">
\[ \int_{\mbox{Patch $p$}} \left( f^{[FE]}_i(x_k) - \sum_{j=1}^{N_{rec}} F^{(p)}_{ij} \ \psi^{[rec]}_j(x_k) \right) \psi^{[rec]}_l(x_k)\ dv = 0 \mbox{ \ \ \ \ for $l=1,...,N_{rec}$ and $i=1,...,N_{flux}$}. \]
</p>
<p> Once the \( F^{(p)}_{ij} \) are determined in a given patch, we determine the values of the recovered flux at all nodes that are part of the patch. We denote the value of the recovered flux at node \( k \) by \( {\cal F}^{(p)}_{ik}\).</p>
<p class="startli">We repeat this procedure for every patch. For nodes that are part of multiple patches, the procedure will provide multiple, slightly different nodal values for the recovered flux. We average these values via </p><p class="formulaDsp">
\[ {\cal F}_{ij} = \frac{1}{N_p(j)} \sum_{\mbox{Node $j \in $ patch $p$}} {\cal F}^{(p)}_{ij}, \]
</p>
<p> where \(N_p(j)\) denotes the number of patches that node \( j\) is a member of. This allows us to obtain a globally-continuous, finite-element based representation of the recovered flux as </p><p class="formulaDsp">
\[ f_i^{[rec]} = \sum_{j=1}^{N} {\cal F}_{ij}\ \psi_j, \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (1) \]
</p>
<p> where the \( \psi_j \) are the (global) finite element shape functions.</p>
</li>
<li><p class="startli">Since the recovered flux in (1), is based on nodal values, we can evaluate it locally within each of the \( N_e\) elements in the mesh to obtain a normalised elemental error estimate via</p>
<p class="formulaDsp">
\[ E_{e} = \sqrt{ \frac{ \int_{\mbox{$e$}} \left( f_i^{[rec]} - f_i^{[FE]} \right)^2 dv} {\sum_{e&#39;=1}^{N_e} \int_{\mbox{$e&#39;$}} \left( f_i^{[rec]} \right)^2 dv} } \mbox{\ \ \ for $e=1,...,N_e$.} \]
</p>
<p> In this (default) form, mesh refinement, based on this error estimate will lead to an equidistribution of the error across all elements. Usually, this is the desired behaviour. However, there are cases in which the solution evolves towards a state in which the flux tends to zero while the solution itself becomes so simple that it can be represented exactly on any finite element mesh (e.g. in spin-up problems in which the fluid motion approaches a rigid body rotation). In that case the mesh adaptation tries to equidistribute any small roundoff errors in the solution, causing strong, spatially uniform mesh refinement throughout the domain, even though the solution is already fully converged. For such cases, it is possible to replace the denominator in the above expression by a prescribed reference flux, which may be specified via the access function </p><div class="fragment"><div class="line"><a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a997dc6ba0b546a0f7363949a8d33d133">reference_flux_norm</a>()</div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_a997dc6ba0b546a0f7363949a8d33d133"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a997dc6ba0b546a0f7363949a8d33d133">oomph::Z2ErrorEstimator::reference_flux_norm</a></div><div class="ttdeci">double &amp; reference_flux_norm()</div><div class="ttdoc">Access function for prescribed reference flux norm.</div><div class="ttdef"><b>Definition:</b> error_estimator.h:355</div></div>
</div><!-- fragment --> </li>
</ol>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a75ef55e67b21ec49ed1a37d095cfa9f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75ef55e67b21ec49ed1a37d095cfa9f9">&#9670;&nbsp;</a></span>CombinedErrorEstimateFctPt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="../../df/de6/classdouble.html">double</a>(* oomph::Z2ErrorEstimator::CombinedErrorEstimateFctPt) (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;errors)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function pointer to combined error estimator function. </p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a1cb0328af843a8bebf5333045cea4553"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cb0328af843a8bebf5333045cea4553">&#9670;&nbsp;</a></span>Z2ErrorEstimator() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">oomph::Z2ErrorEstimator::Z2ErrorEstimator </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>recovery_order</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor: Set order of recovery shape functions. </p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      : <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>(<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>),</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">Recovery_order_from_first_element</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>(0.0),</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>(0)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_a34a013732989e82f50cb7e72f25632a7"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">oomph::Z2ErrorEstimator::Combined_error_fct_pt</a></div><div class="ttdeci">CombinedErrorEstimateFctPt Combined_error_fct_pt</div><div class="ttdoc">Function pointer to combined error estimator function.</div><div class="ttdef"><b>Definition:</b> error_estimator.h:420</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_a9aafff3d80518811ba7d9bb12a240a7c"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">oomph::Z2ErrorEstimator::Recovery_order</a></div><div class="ttdeci">unsigned Recovery_order</div><div class="ttdoc">Order of recovery polynomials.</div><div class="ttdef"><b>Definition:</b> error_estimator.h:403</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_aa170691c5d84fbf0eb6dc5f480bbb187"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">oomph::Z2ErrorEstimator::Reference_flux_norm</a></div><div class="ttdeci">double Reference_flux_norm</div><div class="ttdoc">Prescribed reference flux norm.</div><div class="ttdef"><b>Definition:</b> error_estimator.h:417</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_af7a3a28cfc05b291b438b80e87c7f5cc"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">oomph::Z2ErrorEstimator::recovery_order</a></div><div class="ttdeci">unsigned &amp; recovery_order()</div><div class="ttdoc">Access function for order of recovery polynomials.</div><div class="ttdef"><b>Definition:</b> error_estimator.h:322</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_afa024a307366bb987b1c9ba379b837e8"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">oomph::Z2ErrorEstimator::Recovery_order_from_first_element</a></div><div class="ttdeci">bool Recovery_order_from_first_element</div><div class="ttdef"><b>Definition:</b> error_estimator.h:407</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a35186eeb792bf2b948239d19b2697ca0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35186eeb792bf2b948239d19b2697ca0">&#9670;&nbsp;</a></span>Z2ErrorEstimator() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">oomph::Z2ErrorEstimator::Z2ErrorEstimator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Constructor: Leave order of recovery shape functions open for now &ndash; they will be read out from first element of the mesh when the error estimator is applied </p>
<div class="fragment"><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      : <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>(0),</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">Recovery_order_from_first_element</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>(0.0),</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>(0)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab52cb1c86f2a39af3c4f10dfff02a51a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab52cb1c86f2a39af3c4f10dfff02a51a">&#9670;&nbsp;</a></span>Z2ErrorEstimator() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">oomph::Z2ErrorEstimator::Z2ErrorEstimator </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html">Z2ErrorEstimator</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Broken copy constructor. </p>

</div>
</div>
<a id="a3d1e540fe046f1c55d59690932d4095d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d1e540fe046f1c55d59690932d4095d">&#9670;&nbsp;</a></span>~Z2ErrorEstimator()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual oomph::Z2ErrorEstimator::~Z2ErrorEstimator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Empty virtual destructor. </p>
<div class="fragment"><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;{}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a1719ff79e67f2f0b2b8194a91f52d3d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1719ff79e67f2f0b2b8194a91f52d3d2">&#9670;&nbsp;</a></span>combined_error_fct_pt() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">CombinedErrorEstimateFctPt</a>&amp; oomph::Z2ErrorEstimator::combined_error_fct_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function: Pointer to combined error estimate function. </p>
<div class="fragment"><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>.</p>

</div>
</div>
<a id="aa961268bfdb517d9a59a68eb159042c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa961268bfdb517d9a59a68eb159042c9">&#9670;&nbsp;</a></span>combined_error_fct_pt() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">CombinedErrorEstimateFctPt</a> oomph::Z2ErrorEstimator::combined_error_fct_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Access function: Pointer to combined error estimate function. Const version </p>
<div class="fragment"><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>.</p>

</div>
</div>
<a id="ad84f3b903d0508093d6e2a905198b438"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad84f3b903d0508093d6e2a905198b438">&#9670;&nbsp;</a></span>doc_flux()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::Z2ErrorEstimator::doc_flux </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&#160;</td>
          <td class="paramname"><em>mesh_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>num_flux_terms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/dbb/classoomph_1_1MapMatrixMixed.html">MapMatrixMixed</a>&lt; <a class="el" href="../../dc/db7/classoomph_1_1Node.html">Node</a> *, <a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>, <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>rec_flux_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>elemental_error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html">DocInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>doc_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Doc flux and recovered flux. </p>
<p>Doc FE and recovered flux. </p>
<div class="fragment"><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  {</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160; </div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="comment">// Get communicator from mesh</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    OomphCommunicator* comm_pt = mesh_pt-&gt;communicator_pt();</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160; </div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160; </div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="comment">// Dummy communicator</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    OomphCommunicator* comm_pt = <a class="code" href="../../df/d58/classoomph_1_1MPI__Helpers.html#ac16964b22bfd4f657490802beb600ffe">MPI_Helpers::communicator_pt</a>();</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160; </div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160; </div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <span class="comment">// Setup output files</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    std::ofstream some_file, feflux_file;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    std::ostringstream <a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a>;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a> &lt;&lt; doc_info.directory() &lt;&lt; <span class="stringliteral">&quot;/flux_rec&quot;</span> &lt;&lt; doc_info.number()</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;_on_proc_&quot;</span> &lt;&lt; comm_pt-&gt;my_rank() &lt;&lt; <span class="stringliteral">&quot;.dat&quot;</span>;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    some_file.open(<a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a>.str().c_str());</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a>.str(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a> &lt;&lt; doc_info.directory() &lt;&lt; <span class="stringliteral">&quot;/flux_fe&quot;</span> &lt;&lt; doc_info.number()</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;_on_proc_&quot;</span> &lt;&lt; comm_pt-&gt;my_rank() &lt;&lt; <span class="stringliteral">&quot;.dat&quot;</span>;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    feflux_file.open(<a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a>.str().c_str());</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160; </div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordtype">unsigned</span> nel = mesh_pt-&gt;nelement();</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordflow">if</span> (nel &gt; 0)</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    {</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      <span class="comment">// Extract first element to determine spatial dimension</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      FiniteElement* el_pt = mesh_pt-&gt;finite_element_pt(0);</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <span class="keywordtype">unsigned</span> dim = el_pt-&gt;dim();</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      Vector&lt;double&gt; <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>(dim);</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160; </div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      <span class="comment">// Decide on the number of plot points</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordtype">unsigned</span> nplot = 5;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160; </div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="comment">// Loop over all elements</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nel; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;          <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(mesh_pt-&gt;element_pt(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>));</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160; </div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        <span class="comment">// Write tecplot header</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        feflux_file &lt;&lt; el_pt-&gt;tecplot_zone_string(nplot);</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        some_file &lt;&lt; el_pt-&gt;tecplot_zone_string(nplot);</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160; </div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        <span class="keywordtype">unsigned</span> num_plot_points = el_pt-&gt;nplot_points(nplot);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iplot = 0; iplot &lt; num_plot_points; iplot++)</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        {</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;          <span class="comment">// Get local coordinates of plot point</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;          el_pt-&gt;get_s_plot(iplot, nplot, <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>);</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160; </div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;          <span class="comment">// Coordinate</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;          Vector&lt;double&gt; <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>(dim);</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;          el_pt-&gt;interpolated_x(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160; </div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;          <span class="comment">// Number of FE nodes</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;          <span class="keywordtype">unsigned</span> n_node = el_pt-&gt;nnode();</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160; </div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;          <span class="comment">// FE shape function</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;          Shape psi(n_node);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160; </div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;          <span class="comment">// Get values of FE shape function</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;          el_pt-&gt;shape(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, psi);</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160; </div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;          <span class="comment">// Initialise recovered flux Vector</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;          Vector&lt;double&gt; rec_flux(num_flux_terms, 0.0);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160; </div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;          <span class="comment">// Loop over nodes to assemble contribution</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = 0; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &lt; n_node; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>++)</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;          {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;            Node* nod_pt = el_pt-&gt;node_pt(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160; </div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;            <span class="comment">// Loop over components</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            {</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;              rec_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] += rec_flux_map(nod_pt, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) * psi[<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>];</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;          }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160; </div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;          <span class="comment">// FE flux</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;          Vector&lt;double&gt; fe_flux(num_flux_terms);</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;          el_pt-&gt;get_Z2_flux(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, fe_flux);</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160; </div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;          {</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            some_file &lt;&lt; <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;          }</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;          {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            some_file &lt;&lt; rec_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;          }</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;          some_file &lt;&lt; elemental_error[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160; </div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;          {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;            feflux_file &lt;&lt; <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;          }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;          {</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            feflux_file &lt;&lt; fe_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;          }</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;          feflux_file &lt;&lt; elemental_error[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        }</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      }</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160; </div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      <span class="comment">// Write tecplot footer (e.g. FE connectivity lists)</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      <span class="comment">// using the first element&#39;s output info.</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      FiniteElement* first_el_pt = mesh_pt-&gt;finite_element_pt(0);</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      first_el_pt-&gt;write_tecplot_zone_footer(some_file, nplot);</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      first_el_pt-&gt;write_tecplot_zone_footer(feflux_file, nplot);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    }</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160; </div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    some_file.close();</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    feflux_file.close();</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  }</div>
<div class="ttc" id="aBiCGSTAB__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aCG3DPackingUnitTest_8cpp_html_a7026fd16370249ce97cb3d062326baf9"><div class="ttname"><a href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a></div><div class="ttdeci">const unsigned n</div><div class="ttdef"><b>Definition:</b> CG3DPackingUnitTest.cpp:11</div></div>
<div class="ttc" id="aCwise__array__power__array_8cpp_html_a9eb5e92d9d691c1393e5e7c914731dbf"><div class="ttname"><a href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a></div><div class="ttdeci">Array&lt; double, 1, 3 &gt; e(1./3., 0.5, 2.)</div></div>
<div class="ttc" id="aclassoomph_1_1MPI__Helpers_html_ac16964b22bfd4f657490802beb600ffe"><div class="ttname"><a href="../../df/d58/classoomph_1_1MPI__Helpers.html#ac16964b22bfd4f657490802beb600ffe">oomph::MPI_Helpers::communicator_pt</a></div><div class="ttdeci">static OomphCommunicator * communicator_pt()</div><div class="ttdoc">access to the global oomph-lib communicator</div><div class="ttdef"><b>Definition:</b> oomph_utilities.cc:1046</div></div>
<div class="ttc" id="alevel1__cplx__impl_8h_html_a462761ca92ad97a9a705cb875828b0b8"><div class="ttname"><a href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a></div><div class="ttdeci">RealScalar s</div><div class="ttdef"><b>Definition:</b> level1_cplx_impl.h:130</div></div>
<div class="ttc" id="anamespaceMergeRestartFiles_html_a210231ed06d822ca8be83bd7f75aa572"><div class="ttname"><a href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">MergeRestartFiles.filename</a></div><div class="ttdeci">string filename</div><div class="ttdef"><b>Definition:</b> MergeRestartFiles.py:39</div></div>
<div class="ttc" id="anamespaceplotDoE_html_a4758fc6194247f040938f29c863d21ee"><div class="ttname"><a href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE.x</a></div><div class="ttdeci">list x</div><div class="ttdef"><b>Definition:</b> plotDoE.py:28</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/d58/classoomph_1_1MPI__Helpers.html#ac16964b22bfd4f657490802beb600ffe">oomph::MPI_Helpers::communicator_pt()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a3b2c1aba0f9cb4e1767c65f9a3162577">oomph::Mesh::communicator_pt()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a5f8fe59f06da1da9f6b7bbcbdb90ef93">oomph::FiniteElement::dim()</a>, <a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html#a85d58bcfce0a7b7cae461624e6fcd08a">oomph::DocInfo::directory()</a>, <a class="el" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">oomph::Mesh::element_pt()</a>, <a class="el" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">MergeRestartFiles::filename</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a4f274774435e9454bf77bf70de69367a">oomph::Mesh::finite_element_pt()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a82da844fd3ebb2005842464cdc148a03">oomph::FiniteElement::get_s_plot()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#a5688ff5f546d81771cabad82ca5a7556">oomph::ElementWithZ2ErrorEstimator::get_Z2_flux()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a4a011bbbef38e7ed244f699577f46b4a">oomph::FiniteElement::interpolated_x()</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">oomph::OomphCommunicator::my_rank()</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#af01dfefb66c15579b540be62999d93ee">oomph::Mesh::nelement()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a6219ed269a6d89b5aa14659cce48905a">oomph::FiniteElement::nnode()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a28ae3eb7760edc5c9d6427611d8e6fb6">oomph::FiniteElement::node_pt()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a8ed563c7ff0cfd8bafdbb0132b388106">oomph::FiniteElement::nplot_points()</a>, <a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html#af27224b25da5b758442753f0947e62d4">oomph::DocInfo::number()</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a58a25b6859ddd43b7bfe64a19fee5023">oomph::FiniteElement::shape()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a3193df31f9ce38e0609d17a8ffb386c6">oomph::FiniteElement::tecplot_zone_string()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#ac3987a5ead7dc20c63d86b333466e2b5">oomph::FiniteElement::write_tecplot_zone_footer()</a>, and <a class="el" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>.</p>

</div>
</div>
<a id="a53d7a1ac66dd41b39d6794e1d00080fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53d7a1ac66dd41b39d6794e1d00080fc">&#9670;&nbsp;</a></span>get_combined_error_estimate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/de6/classdouble.html">double</a> oomph::Z2ErrorEstimator::get_combined_error_estimate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>compound_error</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a combined error estimate from all compound errors. </p>
<p>Return a combined error estimate from all compound flux errors The default is to return the maximum of the compound flux errors which will always force refinment if any field is above the single mesh error threshold and unrefinement if both are below the lower limit. Any other fancy combinations can be selected by specifying a user-defined combined estimate by setting a function pointer. </p>
<div class="fragment"><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="comment">// If the function pointer has been set, call that function</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a> != 0)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">return</span> (*<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>)(compound_error);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// Otherwise simply return the maximum of the compound errors</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_compound_error = compound_error.size();</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">// If there are no errors then we have a problem</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span> (n_compound_error == 0)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="stringliteral">&quot;No compound errors have been passed, so maximum cannot be found.&quot;</span>,</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">// Initialise the maxmimum to the first compound error</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d8/d32/namespaceMeshRefinement.html#ad4bd7b1ccfd3d0b55237df5bdaeb6591">max_error</a> = compound_error[0];</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// Loop over the other errors to find the maximum</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">//(we have already taken absolute values, so we don&#39;t need to do so here)</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_error; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">if</span> (compound_error[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &gt; <a class="code" href="../../d8/d32/namespaceMeshRefinement.html#ad4bd7b1ccfd3d0b55237df5bdaeb6591">max_error</a>)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="../../d8/d32/namespaceMeshRefinement.html#ad4bd7b1ccfd3d0b55237df5bdaeb6591">max_error</a> = compound_error[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// Return the maximum</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d8/d32/namespaceMeshRefinement.html#ad4bd7b1ccfd3d0b55237df5bdaeb6591">max_error</a>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  }</div>
<div class="ttc" id="anamespaceMeshRefinement_html_ad4bd7b1ccfd3d0b55237df5bdaeb6591"><div class="ttname"><a href="../../d8/d32/namespaceMeshRefinement.html#ad4bd7b1ccfd3d0b55237df5bdaeb6591">MeshRefinement::max_error</a></div><div class="ttdeci">double max_error</div><div class="ttdef"><b>Definition:</b> MortaringCantileverCompareToNonMortaring.cpp:188</div></div>
<div class="ttc" id="aoomph__definitions_8h_html_a25c6813cc7341d125e2502f8923fb6c4"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a></div><div class="ttdeci">#define OOMPH_EXCEPTION_LOCATION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:61</div></div>
<div class="ttc" id="aoomph__definitions_8h_html_aa260cc4af589e30cea7fde997ae16667"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a></div><div class="ttdeci">#define OOMPH_CURRENT_FUNCTION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:86</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a34a013732989e82f50cb7e72f25632a7">Combined_error_fct_pt</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../d8/d32/namespaceMeshRefinement.html#ad4bd7b1ccfd3d0b55237df5bdaeb6591">MeshRefinement::max_error</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>.</p>

</div>
</div>
<a id="aa38b3ecfbb223a91bfe049d4722af6d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa38b3ecfbb223a91bfe049d4722af6d3">&#9670;&nbsp;</a></span>get_element_errors() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::Z2ErrorEstimator::get_element_errors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&amp;&#160;</td>
          <td class="paramname"><em>mesh_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>elemental_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Compute the elemental error measures for a given mesh and store them in a vector. </p>
<div class="fragment"><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">// Create dummy doc info object and switch off output</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      DocInfo doc_info;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      doc_info.disable_doc();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="comment">// Forward call to version with doc.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa38b3ecfbb223a91bfe049d4722af6d3">get_element_errors</a>(mesh_pt, elemental_error, doc_info);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_aa38b3ecfbb223a91bfe049d4722af6d3"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa38b3ecfbb223a91bfe049d4722af6d3">oomph::Z2ErrorEstimator::get_element_errors</a></div><div class="ttdeci">void get_element_errors(Mesh *&amp;mesh_pt, Vector&lt; double &gt; &amp;elemental_error)</div><div class="ttdef"><b>Definition:</b> error_estimator.h:303</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html#a666a20817ab9c396b225d8652bc0a338">oomph::DocInfo::disable_doc()</a>.</p>

</div>
</div>
<a id="ae0fd03123c518ed340bb534c2f6b8cc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0fd03123c518ed340bb534c2f6b8cc4">&#9670;&nbsp;</a></span>get_element_errors() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::Z2ErrorEstimator::get_element_errors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&amp;&#160;</td>
          <td class="paramname"><em>mesh_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>elemental_error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html">DocInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>doc_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Compute the elemental error measures for a given mesh and store them in a vector. If doc_info.enable_doc(), doc FE and recovered fluxes in</p><ul>
<li>flux_fe*.dat</li>
<li>flux_rec*.dat</li>
</ul>
<p>Get Vector of Z2-based error estimates for all elements in mesh. If doc_info.is_doc_enabled()=true, doc FE and recovered fluxes in</p><ul>
<li>flux_fe*.dat</li>
<li>flux_rec*.dat </li>
</ul>

<p>Implements <a class="el" href="../../d6/dab/classoomph_1_1ErrorEstimator.html#a77e85262d309d6e7da0ca71e98b7afff">oomph::ErrorEstimator</a>.</p>
<div class="fragment"><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">// Storage for number of processors and current processor</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordtype">int</span> n_proc = 1;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordtype">int</span> my_rank = 0;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordflow">if</span> (mesh_pt-&gt;communicator_pt() != 0)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      my_rank = mesh_pt-&gt;communicator_pt()-&gt;my_rank();</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      n_proc = mesh_pt-&gt;communicator_pt()-&gt;nproc();</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d58/classoomph_1_1MPI__Helpers.html#aa376d403f6bc99e8595d227135932b0e">MPI_Helpers::mpi_has_been_initialised</a>())</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      my_rank = <a class="code" href="../../df/d58/classoomph_1_1MPI__Helpers.html#ac16964b22bfd4f657490802beb600ffe">MPI_Helpers::communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      n_proc = <a class="code" href="../../df/d58/classoomph_1_1MPI__Helpers.html#ac16964b22bfd4f657490802beb600ffe">MPI_Helpers::communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    MPI_Status status;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">// Initialise local values for all processes on mesh</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordtype">unsigned</span> num_flux_terms_local = 0;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordtype">unsigned</span> dim_local = 0;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordtype">unsigned</span> recovery_order_local = 0;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="comment">// Global variables</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordtype">unsigned</span> num_flux_terms = 0;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordtype">unsigned</span> dim = 0;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">// It may be possible that a submesh contains no elements on a</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// particular process after distribution. In order to instigate the</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">// error estimator calculations we need some information from the</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// &quot;first&quot; element in a mesh; the following uses an MPI_Allreduce</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">// to figure out this information and communicate it to all processors</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">if</span> (mesh_pt-&gt;nelement() &gt; 0)</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="comment">// Extract a few vital parameters from first element in mesh:</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(mesh_pt-&gt;element_pt(0));</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">if</span> (el_pt == 0)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;          <span class="stringliteral">&quot;Element needs to inherit from ElementWithZ2ErrorEstimator!&quot;</span>,</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;          <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="comment">// Number of &#39;flux&#39;-like terms to be recovered</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      num_flux_terms_local = el_pt-&gt;num_Z2_flux_terms();</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="comment">// Determine spatial dimension of all elements from first element</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      dim_local = el_pt-&gt;dim();</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <span class="comment">// Do we need to determine the recovery order from first element?</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">Recovery_order_from_first_element</a>)</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      {</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        recovery_order_local = el_pt-&gt;nrecovery_order();</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    } <span class="comment">// end if (mesh_pt-&gt;nelement()&gt;0)</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="comment">// Storage for the recovery order</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a> = 0;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="comment">// Now communicate these via an MPI_Allreduce to every process</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">// if the mesh has been distributed</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">if</span> (mesh_pt-&gt;is_mesh_distributed())</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="comment">// Get communicator from mesh</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      OomphCommunicator* comm_pt = mesh_pt-&gt;communicator_pt();</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      MPI_Allreduce(&amp;num_flux_terms_local,</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                    &amp;num_flux_terms,</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                    1,</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                    MPI_UNSIGNED,</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                    MPI_MAX,</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                    comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      MPI_Allreduce(&amp;dim_local, &amp;dim, 1, MPI_INT, MPI_MAX, comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      MPI_Allreduce(&amp;recovery_order_local,</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                    &amp;<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>,</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                    1,</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                    MPI_UNSIGNED,</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                    MPI_MAX,</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                    comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      num_flux_terms = num_flux_terms_local;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      dim = dim_local;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a> = recovery_order_local;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// Do we need to determine the recovery order from first element?</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">Recovery_order_from_first_element</a>)</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    {</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a> = <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="preprocessor">#else </span><span class="comment">// !OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="comment">// Extract a few vital parameters from first element in mesh:</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(mesh_pt-&gt;element_pt(0));</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">if</span> (el_pt == 0)</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="stringliteral">&quot;Element needs to inherit from ElementWithZ2ErrorEstimator!&quot;</span>,</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">// Number of &#39;flux&#39;-like terms to be recovered</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    num_flux_terms = el_pt-&gt;num_Z2_flux_terms();</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">// Determine spatial dimension of all elements from first element</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    dim = el_pt-&gt;dim();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// Do we need to determine the recovery order from first element?</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">Recovery_order_from_first_element</a>)</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    {</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a> = el_pt-&gt;nrecovery_order();</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    }</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="comment">// Determine number of coefficients for expansion of recovered fluxes</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="comment">// Use complete polynomial of given order for recovery</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordtype">unsigned</span> num_recovery_terms = <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1782984fa64738f9a8e7ca40d585597a">nrecovery_terms</a>(dim);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">// Setup patches (also returns Vector of vertex nodes)</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="comment">//====================================================</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    std::map&lt;Node*, Vector&lt;ElementWithZ2ErrorEstimator*&gt;*&gt; adjacent_elements_pt;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    Vector&lt;Node*&gt; vertex_node_pt;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a5c8a3d6e46d9b9ba31c768cb5b026bba">setup_patches</a>(mesh_pt, adjacent_elements_pt, vertex_node_pt);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// Loop over all patches to get recovered flux value coefficients</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="comment">//===============================================================</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// Map to store sets of pointers to the recovered flux coefficient matrices</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">// for each node.</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    std::map&lt;Node*, std::set&lt;DenseMatrix&lt;double&gt;*&gt;&gt; flux_coeff_pt;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// We store the pointers to the recovered flux coefficient matrices for</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// various patches in a vector so we can delete them later</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    Vector&lt;DenseMatrix&lt;double&gt;*&gt; vector_of_recovered_flux_coefficient_pt;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keyword">typedef</span> std::map&lt;Node*, Vector&lt;ElementWithZ2ErrorEstimator*&gt;*&gt;::iterator IT;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">// Need to translate ElementWithZ2ErrorEstimator pointer to element number</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="comment">// in order to give each processor elements to work on if the problem</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">// has not yet been distributed.  In order to reduce the use of #ifdef this</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="comment">// is also done for the serial problem and the code is amended accordingly.</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    std::map&lt;ElementWithZ2ErrorEstimator*, int&gt; elem_num;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordtype">unsigned</span> nelem = mesh_pt-&gt;nelement();</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    {</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      elem_num[<span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        mesh_pt-&gt;element_pt(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>))] = <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="comment">// This isn&#39;t a global variable</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordtype">int</span> n_patch = adjacent_elements_pt.size(); <span class="comment">// also needed by serial version</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="comment">// Default values for serial AND parallel distributed problem</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordtype">int</span> itbegin = 0;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordtype">int</span> itend = n_patch;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; </div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordtype">int</span> range = n_patch;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="comment">// Work out values for parallel non-distributed problem</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span> (!(mesh_pt-&gt;is_mesh_distributed()))</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="comment">// setup the loop variables</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      range = n_patch / n_proc; <span class="comment">// number of patches on each proc</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160; </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      itbegin = my_rank * range;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      itend = (my_rank + 1) * range;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="comment">// if on the last processor, ensure the end matches</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <span class="keywordflow">if</span> (my_rank == (n_proc - 1))</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        itend = n_patch;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    }</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">// Set up matrices and vectors which will be sent later</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// - full matrix of all recovered coefficients</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    Vector&lt;DenseMatrix&lt;double&gt;*&gt;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      vector_of_recovered_flux_coefficient_pt_to_send;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="comment">// - vectors containing element numbers in each patch</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    Vector&lt;Vector&lt;int&gt;&gt; vector_of_elements_in_patch_to_send;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// Now we can loop over the patches on the current process</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = itbegin; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; itend; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    {</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="comment">// Which vertex node are we at?</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      Node* nod_pt = vertex_node_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="comment">// Pointer to vector of pointers to elements that make up</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      <span class="comment">// the patch.</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      Vector&lt;ElementWithZ2ErrorEstimator*&gt;* el_vec_pt =</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        adjacent_elements_pt[nod_pt];</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="comment">// Is the corner node that is central to the patch surrounded by</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="comment">// at least two elements?</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="keywordtype">unsigned</span> nelem = (*el_vec_pt).size();</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="keywordflow">if</span> (nelem &gt;= 2)</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      {</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="comment">// store the number of elements in the patch</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        Vector&lt;int&gt; elements_in_this_patch;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;          elements_in_this_patch.push_back(elem_num[(*el_vec_pt)[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>]]);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        }</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160; </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <span class="comment">// put them into storage vector ready to send</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        vector_of_elements_in_patch_to_send.push_back(elements_in_this_patch);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="comment">// Given the vector of elements that make up the patch,</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="comment">// the number of recovery and flux terms, and the spatial</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <span class="comment">// dimension of the problem,  compute</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <span class="comment">// the matrix of recovered flux coefficients and return</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="comment">// a pointer to it.</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a>* recovered_flux_coefficient_pt = 0;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a0384127746b7eea7fcf0d08f2d34c647">get_recovered_flux_in_patch</a>(*el_vec_pt,</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                                    num_recovery_terms,</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                                    num_flux_terms,</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                                    dim,</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                                    recovered_flux_coefficient_pt);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="comment">// Store pointer to recovered flux coefficients for</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="comment">// current patch in vector so we can send and then delete it later</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        vector_of_recovered_flux_coefficient_pt_to_send.push_back(</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;          recovered_flux_coefficient_pt);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      } <span class="comment">// end of if(nelem&gt;=2)</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="comment">// Now broadcast the result from each process to every other process</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">// if the mesh has not yet been distributed and MPI is initialised</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160; </div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">if</span> (!mesh_pt-&gt;is_mesh_distributed() &amp;&amp;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <a class="code" href="../../df/d58/classoomph_1_1MPI__Helpers.html#aa376d403f6bc99e8595d227135932b0e">MPI_Helpers::mpi_has_been_initialised</a>())</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="comment">// Get communicator from namespace</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      OomphCommunicator* comm_pt = <a class="code" href="../../df/d58/classoomph_1_1MPI__Helpers.html#ac16964b22bfd4f657490802beb600ffe">MPI_Helpers::communicator_pt</a>();</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="comment">// All local recovered fluxes have been calculated, so now share result</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iproc = 0; iproc &lt; n_proc; iproc++)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      {</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="comment">// Broadcast number of patches processed</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="keywordtype">int</span> n_patches = vector_of_recovered_flux_coefficient_pt_to_send.size();</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        MPI_Bcast(&amp;n_patches, 1, MPI_INT, iproc, comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="comment">// Loop over these patches, broadcast recovered flux coefficients</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipatch = 0; ipatch &lt; n_patches; ipatch++)</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        {</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <span class="comment">// Number of elements in this patch</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          Vector&lt;int&gt; elements(0);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;          <span class="keywordtype">unsigned</span> nelements = 0;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          <span class="comment">// Which processor are we on?</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;          <span class="keywordflow">if</span> (my_rank == iproc)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            elements = vector_of_elements_in_patch_to_send[ipatch];</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            nelements = elements.size();</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;          }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;          <span class="comment">// Broadcast elements</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          comm_pt-&gt;broadcast(iproc, elements);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;          <span class="comment">// Now get recovered flux coefficients</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;          <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a>* recovered_flux_coefficient_pt;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160; </div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          <span class="comment">// Which processor are we on?</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;          <span class="keywordflow">if</span> (my_rank == iproc)</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;          {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            recovered_flux_coefficient_pt =</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;              vector_of_recovered_flux_coefficient_pt_to_send[ipatch];</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          }</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            recovered_flux_coefficient_pt = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160; </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;          <span class="comment">// broadcast this matrix from the loop processor</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;          <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a> mattosend = *recovered_flux_coefficient_pt;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;          comm_pt-&gt;broadcast(iproc, mattosend);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          <span class="comment">// Set pointer on all processors</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;          *recovered_flux_coefficient_pt = mattosend;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;          <span class="comment">// End of parallel broadcasting</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;          vector_of_recovered_flux_coefficient_pt.push_back(</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;            recovered_flux_coefficient_pt);</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;          <span class="comment">// Loop over elements in patch (work out nelements again after bcast)</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          nelements = elements.size();</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelements; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;          {</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            <span class="comment">// Get pointer to element</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;              <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                mesh_pt-&gt;element_pt(elements[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>]));</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160; </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;            <span class="comment">// Loop over all nodes in element</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;            <span class="keywordtype">unsigned</span> num_nod = el_pt-&gt;nnode();</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = 0; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &lt; num_nod; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>++)</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            {</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;              <span class="comment">// Get the node</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;              Node* nod_pt = el_pt-&gt;node_pt(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;              <span class="comment">// Add the pointer to the current flux coefficient matrix</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;              <span class="comment">// to the set for the node</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;              <span class="comment">// Mesh not distributed here so nod_pt cannot be halo</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;              flux_coeff_pt[nod_pt].insert(recovered_flux_coefficient_pt);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;            }</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;          }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        } <span class="comment">// end loop over patches on current processor</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      } <span class="comment">// end loop over processors</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keywordflow">else</span> <span class="comment">// is_mesh_distributed=true</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    {</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="preprocessor">#endif </span><span class="comment">// end ifdef OOMPH_HAS_MPI for parallel job without mesh distribution</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160; </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="comment">// Do the same for a distributed mesh as for a serial job</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="comment">// up to the point where the elemental error is calculated</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="comment">// and then communicate that (see below)</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="keywordtype">int</span> n_patches = vector_of_recovered_flux_coefficient_pt_to_send.size();</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160; </div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <span class="comment">// Loop over these patches</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipatch = 0; ipatch &lt; n_patches; ipatch++)</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      {</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="comment">// Number of elements in this patch</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        Vector&lt;int&gt; elements;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordtype">int</span> nelements; <span class="comment">// Needs to be int for elem_num call later</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        elements = vector_of_elements_in_patch_to_send[ipatch];</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        nelements = elements.size();</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="comment">// Now get recovered flux coefficients</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a>* recovered_flux_coefficient_pt;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        recovered_flux_coefficient_pt =</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;          vector_of_recovered_flux_coefficient_pt_to_send[ipatch];</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        vector_of_recovered_flux_coefficient_pt.push_back(</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;          recovered_flux_coefficient_pt);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160; </div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelements; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;          <span class="comment">// Get pointer to element</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;          ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;              mesh_pt-&gt;element_pt(elements[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>]));</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160; </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          <span class="comment">// Loop over all nodes in element</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;          <span class="keywordtype">unsigned</span> num_nod = el_pt-&gt;nnode();</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = 0; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &lt; num_nod; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>++)</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;          {</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            <span class="comment">// Get the node</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            Node* nod_pt = el_pt-&gt;node_pt(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="comment">// Add the pointer to the current flux coefficient matrix</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="comment">// to the set for this node</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            flux_coeff_pt[nod_pt].insert(recovered_flux_coefficient_pt);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      } <span class="comment">// End loop over patches on current processor</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160; </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160; </div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    } <span class="comment">// End if(is_mesh_distributed)</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="comment">// Cleanup patch storage scheme</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <span class="keywordflow">for</span> (IT it = adjacent_elements_pt.begin(); it != adjacent_elements_pt.end();</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;         it++)</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    {</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="keyword">delete</span> it-&gt;second;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    adjacent_elements_pt.clear();</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// Loop over all nodes, take average of recovered flux values</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">//-----------------------------------------------------------</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="comment">// and evaluate recovered flux at nodes</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="comment">//-------------------------------------</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160; </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="comment">// Map of (averaged) recoverd flux values at nodes</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    MapMatrixMixed&lt;Node*, int, double&gt; rec_flux_map;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="comment">// Loop over all nodes</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordtype">unsigned</span> n_node = mesh_pt-&gt;nnode();</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = 0; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &lt; n_node; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>++)</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      Node* nod_pt = mesh_pt-&gt;node_pt(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <span class="comment">// How many patches is this node a member of?</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      <span class="keywordtype">unsigned</span> npatches = flux_coeff_pt[nod_pt].size();</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="comment">// Matrix of averaged coefficients for this node</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a> averaged_flux_coeff(</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        num_recovery_terms, num_flux_terms, 0.0);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      <span class="comment">// Loop over matrices for different patches and add contributions</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      <span class="keyword">typedef</span> std::set&lt;DenseMatrix&lt;double&gt;*&gt;::iterator IT;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      <span class="keywordflow">for</span> (IT it = flux_coeff_pt[nod_pt].begin();</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;           it != flux_coeff_pt[nod_pt].end();</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;           it++)</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      {</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_recovery_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        {</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; num_flux_terms; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160; </div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;          {</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            <span class="comment">// ...just add it -- we&#39;ll divide by the number of patches later</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;            averaged_flux_coeff(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>) += (*(*it))(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>);</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;          }</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        }</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      }</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160; </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <span class="comment">// Now evaluate the recovered flux (based on the averaged coefficients)</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="comment">//---------------------------------------------------------------------</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="comment">// at the nodal position itself.</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <span class="comment">//------------------------------</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160; </div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="comment">// Get global (Eulerian) nodal position</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      Vector&lt;double&gt; <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>(dim);</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      {</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = nod_pt-&gt;x(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      }</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160; </div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <span class="comment">// Evaluate global recovery functions at node</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      Vector&lt;double&gt; psi_r(num_recovery_terms);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab57514ecde88f7ae970439fd4900996a">shape_rec</a>(<a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>, dim, psi_r);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160; </div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <span class="comment">// Initialise nodal fluxes</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        rec_flux_map(nod_pt, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) = 0.0;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      }</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160; </div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="comment">// Loop over coefficients for flux recovery</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> icoeff = 0; icoeff &lt; num_recovery_terms; icoeff++)</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        {</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          rec_flux_map(nod_pt, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) +=</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;            averaged_flux_coeff(icoeff, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) * psi_r[icoeff];</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        }</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <span class="comment">// Now take averaging into account</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        rec_flux_map(nod_pt, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) /= <a class="code" href="../../df/de6/classdouble.html">double</a>(npatches);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      }</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    } <span class="comment">// end loop over nodes</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160; </div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="comment">// We&#39;re done with the recovered flux coefficient matrices for</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// the various patches and can delete them</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordtype">unsigned</span> npatch = vector_of_recovered_flux_coefficient_pt.size();</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; npatch; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    {</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="keyword">delete</span> vector_of_recovered_flux_coefficient_pt[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    }</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="comment">// NOTE FOR FUTURE REFERENCE - revisit in case of adaptivity problems in</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="comment">// parallel jobs</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="comment">// The current method for distributed problems neglects recovered flux</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="comment">// contributions from patches that cannot be assembled on the current</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="comment">// processor, but would be assembled if the problem was not distributed.</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="comment">// The only nodes for which this is the case are nodes which lie on the</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="comment">// exact boundary between processors.</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="comment">// See the note at the start of setup_patches (above) for more details.</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160; </div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="comment">// Get error estimates for all elements</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="comment">//======================================</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160; </div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="comment">// Find the number of compound fluxes</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="comment">// Loop over all (non-halo) elements</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    nelem = mesh_pt-&gt;nelement();</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="comment">// Initialise the number of compound fluxes</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="comment">// Must be an integer for an MPI call later on</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keywordtype">int</span> n_compound_flux = 1;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    {</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(mesh_pt-&gt;element_pt(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>));</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160; </div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <span class="comment">// Ignore halo elements</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      <span class="keywordflow">if</span> (!el_pt-&gt;is_halo())</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="comment">// Find the number of compound fluxes in the element</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> n_compound_flux_el = el_pt-&gt;ncompound_fluxes();</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="comment">// If it&#39;s greater than the current (global) number of compound fluxes</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <span class="comment">// bump up the global number</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">if</span> (n_compound_flux_el &gt; n_compound_flux)</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;          n_compound_flux = n_compound_flux_el;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      } <span class="comment">// end if (!el_pt-&gt;is_halo())</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    }</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160; </div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="comment">// Initialise a vector of flux norms</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    Vector&lt;double&gt; flux_norm(n_compound_flux, 0.0);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; </div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordtype">unsigned</span> test_count = 0;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160; </div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="comment">// Storage for the elemental compound flux error</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a> elemental_compound_flux_error(</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      nelem, n_compound_flux, 0.0);</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="comment">// Loop over all (non-halo) elements again</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(mesh_pt-&gt;element_pt(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>));</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160; </div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <span class="comment">// Ignore halo elements</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="keywordflow">if</span> (!el_pt-&gt;is_halo())</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      {</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160; </div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        Vector&lt;double&gt; <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>(dim);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160; </div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="comment">// Initialise elemental error one for each compound flux in the element</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_compound_flux_el = el_pt-&gt;ncompound_fluxes();</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        Vector&lt;double&gt; <a class="code" href="../../d9/d33/namespacecalibrate.html#a4dbebf21da853ac368a3a9af2fbab442">error</a>(n_compound_flux_el, 0.0);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160; </div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        Integral* integ_pt = el_pt-&gt;integral_pt();</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        <span class="comment">// Set the value of Nintpt</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_intpt = integ_pt-&gt;nweight();</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <span class="comment">// Loop over the integration points</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ipt = 0; ipt &lt; n_intpt; ipt++)</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        {</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;          <span class="comment">// Assign values of s</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;          {</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = integ_pt-&gt;knot(ipt, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;          }</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160; </div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;          <span class="comment">// Get the integral weight</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a> = integ_pt-&gt;weight(ipt);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160; </div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;          <span class="comment">// Jacobian of mapping</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../dc/da8/Jacobi__makeJacobi_8cpp.html#a4804f9d1c212b9655934738d0ae395ab">J</a> = el_pt-&gt;J_eulerian(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160; </div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;          <span class="comment">// Get the Eulerian position</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;          Vector&lt;double&gt; <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>(dim);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;          el_pt-&gt;interpolated_x(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160; </div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;          <span class="comment">// Premultiply the weights and the Jacobian</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;          <span class="comment">// and the geometric jacobian weight (used in axisymmetric</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;          <span class="comment">// and spherical coordinate systems)</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">W</a> = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a> * <a class="code" href="../../dc/da8/Jacobi__makeJacobi_8cpp.html#a4804f9d1c212b9655934738d0ae395ab">J</a> * (el_pt-&gt;geometric_jacobian(<a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>));</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160; </div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;          <span class="comment">// Number of FE nodes</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;          <span class="keywordtype">unsigned</span> n_node = el_pt-&gt;nnode();</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160; </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;          <span class="comment">// FE shape function</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;          Shape psi(n_node);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160; </div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;          <span class="comment">// Get values of FE shape function</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;          el_pt-&gt;shape(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, psi);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;          <span class="comment">// Initialise recovered flux Vector</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;          Vector&lt;double&gt; rec_flux(num_flux_terms, 0.0);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160; </div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;          <span class="comment">// Loop over all nodes (incl. halo nodes) to assemble contribution</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = 0; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &lt; n_node; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>++)</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;          {</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            Node* nod_pt = el_pt-&gt;node_pt(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160; </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            <span class="comment">// Loop over components</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            {</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;              rec_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] += rec_flux_map(nod_pt, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) * psi[<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>];</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            }</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;          }</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;          <span class="comment">// FE flux</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;          Vector&lt;double&gt; fe_flux(num_flux_terms);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;          el_pt-&gt;get_Z2_flux(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, fe_flux);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;          <span class="comment">// Get compound flux indices. Initialised to zero</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;          Vector&lt;unsigned&gt; flux_index(num_flux_terms, 0);</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;          el_pt-&gt;get_Z2_compound_flux_indices(flux_index);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160; </div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;          <span class="comment">// Add to RMS errors for each compound flux:</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;          Vector&lt;double&gt; sum(n_compound_flux_el, 0.0);</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;          Vector&lt;double&gt; sum2(n_compound_flux_el, 0.0);</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;          {</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            sum[flux_index[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] +=</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;              (rec_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] - fe_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]) * (rec_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] - fe_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            sum2[flux_index[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] += rec_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * rec_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;          }</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160; </div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux_el; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;          {</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            <span class="comment">// Add the errors to the appropriate compound flux error</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            <a class="code" href="../../d9/d33/namespacecalibrate.html#a4dbebf21da853ac368a3a9af2fbab442">error</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] += sum[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            <span class="comment">// Add to flux norm</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;            flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] += sum2[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;          }</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <span class="comment">// Unscaled elemental RMS error:</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        test_count++; <span class="comment">// counting elements visited</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160; </div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <span class="comment">// elemental_error[e]=sqrt(error);</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        <span class="comment">// Take the square-root of the appropriate flux error and</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        <span class="comment">// store the result</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux_el; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        {</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;          elemental_compound_flux_error(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(<a class="code" href="../../d9/d33/namespacecalibrate.html#a4dbebf21da853ac368a3a9af2fbab442">error</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160; </div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      } <span class="comment">// end if (!el_pt-&gt;is_halo())</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    } <span class="comment">// end of loop over elements</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="comment">// Communicate the error for haloed elements to halo elements:</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <span class="comment">// - loop over processors</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <span class="comment">// - if current process, receive to halo element error</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="comment">// - if not current process, send haloed element error</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="comment">// How do we know which part of elemental_error to send?</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="comment">// Loop over haloed elements and find element number using elem_num map;</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="comment">// send this - order preservation of halo/haloed elements</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="comment">// guarantees that they get through in the correct order</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160; </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">if</span> (mesh_pt-&gt;is_mesh_distributed())</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="comment">// Get communicator from mesh</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      OomphCommunicator* comm_pt = mesh_pt-&gt;communicator_pt();</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160; </div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iproc = 0; iproc &lt; n_proc; iproc++)</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <span class="keywordflow">if</span> (iproc != my_rank) <span class="comment">// Not current process, so send</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        {</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;          <span class="comment">// Get the haloed elements</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;          Vector&lt;GeneralisedElement*&gt; haloed_elem_pt =</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            mesh_pt-&gt;haloed_element_pt(iproc);</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;          <span class="comment">// Find the number of haloed elements</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;          <span class="keywordtype">int</span> nelem_haloed = haloed_elem_pt.size();</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;          <span class="comment">// If there are some haloed elements, assemble and send the</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;          <span class="comment">// errors</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;          <span class="keywordflow">if</span> (nelem_haloed != 0)</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;          {</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            <span class="comment">// Find the number of error entires:</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="comment">// number of haloed elements x number of compound fluxes</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            <span class="keywordtype">int</span> n_elem_error_haloed = nelem_haloed * n_compound_flux;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            <span class="comment">// Vector for elemental errors</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            Vector&lt;double&gt; haloed_elem_error(n_elem_error_haloed);</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            <span class="comment">// Counter for the vector index</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            <span class="keywordtype">unsigned</span> count = 0;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem_haloed; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;              <span class="comment">// Find element number</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;              <span class="keywordtype">int</span> element_num =</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                elem_num[<span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                  haloed_elem_pt[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>])];</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;              <span class="comment">// Put the error in a vector to send</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;              {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                haloed_elem_error[count] =</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                  elemental_compound_flux_error(element_num, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                ++count;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;              }</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            }</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            <span class="comment">// Send the errors</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            MPI_Send(&amp;haloed_elem_error[0],</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                     n_elem_error_haloed,</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                     MPI_DOUBLE,</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                     iproc,</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                     0,</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                     comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;          }</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        <span class="keywordflow">else</span> <span class="comment">// iproc=my_rank, so receive errors from others</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        {</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> send_rank = 0; send_rank &lt; n_proc; send_rank++)</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;          {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            <span class="keywordflow">if</span> (iproc != send_rank) <span class="comment">// iproc=my_rank already!</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;              Vector&lt;GeneralisedElement*&gt; halo_elem_pt =</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                mesh_pt-&gt;halo_element_pt(send_rank);</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;              <span class="comment">// Find number of halo elements</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;              <span class="keywordtype">int</span> nelem_halo = halo_elem_pt.size();</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;              <span class="comment">// If there are some halo elements, receive errors and</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;              <span class="comment">// put in the appropriate places</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;              <span class="keywordflow">if</span> (nelem_halo != 0)</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;              {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                <span class="comment">// Find the number of error entires:</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                <span class="comment">// number of haloed elements x number of compound fluxes</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                <span class="keywordtype">int</span> n_elem_error_halo = nelem_halo * n_compound_flux;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                <span class="comment">// Vector for elemental errors</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                Vector&lt;double&gt; halo_elem_error(n_elem_error_halo);</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160; </div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160; </div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                <span class="comment">// Receive the errors from processor send_rank</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                MPI_Recv(&amp;halo_elem_error[0],</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                         n_elem_error_halo,</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                         MPI_DOUBLE,</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                         send_rank,</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                         0,</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                         comm_pt-&gt;mpi_comm(),</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                         &amp;status);</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160; </div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                <span class="comment">// Counter for the vector index</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                <span class="keywordtype">unsigned</span> count = 0;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem_halo; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                {</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                  <span class="comment">// Find element number</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                  <span class="keywordtype">int</span> element_num =</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                    elem_num[<span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                      halo_elem_pt[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>])];</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                  <span class="comment">// Put the error in the correct location</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                  {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                    elemental_compound_flux_error(element_num, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) =</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                      halo_elem_error[count];</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                    ++count;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                  }</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                }</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;              }</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;            }</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;          } <span class="comment">// End of interior loop over processors</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      } <span class="comment">// End of exterior loop over processors</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    } <span class="comment">// End of if (mesh has been distributed)</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160; </div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="comment">// NOTE FOR FUTURE REFERENCE - revisit in case of adaptivity problems in</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="comment">// parallel jobs</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <span class="comment">// The current method for distributed problems neglects recovered flux</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="comment">// contributions from patches that cannot be assembled on the current</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="comment">// processor, but would be assembled if the problem was not distributed.</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="comment">// The only nodes for which this is the case are nodes which lie on the</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">// exact boundary between processors.</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="comment">// See the note at the start of setup_patches (above) for more details.</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160; </div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="comment">// Use computed flux norm or externally imposed reference value?</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a> != 0.0)</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    {</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      <span class="comment">// At the moment assume that all fluxes have the same reference norm</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      {</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      }</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    }</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    {</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="comment">// In parallel, perform reduction operation to get global value</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="keywordflow">if</span> (mesh_pt-&gt;is_mesh_distributed())</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      {</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="comment">// Get communicator from mesh</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        OomphCommunicator* comm_pt = mesh_pt-&gt;communicator_pt();</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160; </div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        Vector&lt;double&gt; total_flux_norm(n_compound_flux);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="comment">// every process needs to know the sum</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        MPI_Allreduce(&amp;flux_norm[0],</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                      &amp;total_flux_norm[0],</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                      n_compound_flux,</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                      MPI_DOUBLE,</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                      MPI_SUM,</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                      comm_pt-&gt;mpi_comm());</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="comment">// take sqrt</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(total_flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      }</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      <span class="keywordflow">else</span> <span class="comment">// mesh has not been distributed, so flux_norm already global</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;      {</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        {</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;          flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        }</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      }</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="preprocessor">#else </span><span class="comment">// serial problem, so flux_norm already global</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      {</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      }</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160; </div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="comment">// Now loop over (all!) elements again and</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="comment">// normalise errors by global flux norm</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160; </div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    nelem = mesh_pt-&gt;nelement();</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    {</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="comment">// Get the vector of normalised compound fluxes</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      Vector&lt;double&gt; normalised_compound_flux_error(n_compound_flux);</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_compound_flux; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      {</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="keywordflow">if</span> (flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] != 0.0)</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        {</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;          normalised_compound_flux_error[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] =</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            elemental_compound_flux_error(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) / flux_norm[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        }</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        {</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;          normalised_compound_flux_error[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] =</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            elemental_compound_flux_error(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        }</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      }</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="comment">// calculate the combined error estimate</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      elemental_error[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>] =</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a53d7a1ac66dd41b39d6794e1d00080fc">get_combined_error_estimate</a>(normalised_compound_flux_error);</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    }</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160; </div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="comment">// Doc global fluxes?</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="keywordflow">if</span> (doc_info.is_doc_enabled())</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ad84f3b903d0508093d6e2a905198b438">doc_flux</a>(</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        mesh_pt, num_flux_terms, rec_flux_map, elemental_error, doc_info);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    }</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  }</div>
<div class="ttc" id="aAnnoyingScalar_8h_html_abe7b2405f1f05f9997193c680e8e2fe0"><div class="ttname"><a href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a></div><div class="ttdeci">AnnoyingScalar sqrt(const AnnoyingScalar &amp;x)</div><div class="ttdef"><b>Definition:</b> AnnoyingScalar.h:134</div></div>
<div class="ttc" id="aJacobi__makeJacobi_8cpp_html_a4804f9d1c212b9655934738d0ae395ab"><div class="ttname"><a href="../../dc/da8/Jacobi__makeJacobi_8cpp.html#a4804f9d1c212b9655934738d0ae395ab">J</a></div><div class="ttdeci">JacobiRotation&lt; float &gt; J</div><div class="ttdef"><b>Definition:</b> Jacobi_makeJacobi.cpp:3</div></div>
<div class="ttc" id="aMatrix__resize__int_8cpp_html_aab236ce080522c9832217fd5f157541b"><div class="ttname"><a href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a></div><div class="ttdeci">RowVector3d w</div><div class="ttdef"><b>Definition:</b> Matrix_resize_int.cpp:3</div></div>
<div class="ttc" id="aTutorial__Map__using_8cpp_html_a7fe964f6b1afd4591f637999272ab9a2"><div class="ttname"><a href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a></div><div class="ttdeci">float * p</div><div class="ttdef"><b>Definition:</b> Tutorial_Map_using.cpp:9</div></div>
<div class="ttc" id="aclassEigen_1_1Matrix_html"><div class="ttname"><a href="../../dc/d34/classEigen_1_1Matrix.html">Eigen::Matrix&lt; Scalar, Dynamic, Dynamic &gt;</a></div></div>
<div class="ttc" id="aclassdouble_html"><div class="ttname"><a href="../../df/de6/classdouble.html">double</a></div></div>
<div class="ttc" id="aclassoomph_1_1MPI__Helpers_html_aa376d403f6bc99e8595d227135932b0e"><div class="ttname"><a href="../../df/d58/classoomph_1_1MPI__Helpers.html#aa376d403f6bc99e8595d227135932b0e">oomph::MPI_Helpers::mpi_has_been_initialised</a></div><div class="ttdeci">static bool mpi_has_been_initialised()</div><div class="ttdoc">return true if MPI has been initialised</div><div class="ttdef"><b>Definition:</b> oomph_utilities.h:851</div></div>
<div class="ttc" id="aclassoomph_1_1OomphCommunicator_html_a670b34aab05bfe0b96d0e0fabf583c7a"><div class="ttname"><a href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">oomph::OomphCommunicator::my_rank</a></div><div class="ttdeci">int my_rank() const</div><div class="ttdoc">my rank</div><div class="ttdef"><b>Definition:</b> communicator.h:176</div></div>
<div class="ttc" id="aclassoomph_1_1OomphCommunicator_html_a6c78c72666f4b102c2bccf200f0853b7"><div class="ttname"><a href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc</a></div><div class="ttdeci">int nproc() const</div><div class="ttdoc">number of processors</div><div class="ttdef"><b>Definition:</b> communicator.h:157</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_a0384127746b7eea7fcf0d08f2d34c647"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a0384127746b7eea7fcf0d08f2d34c647">oomph::Z2ErrorEstimator::get_recovered_flux_in_patch</a></div><div class="ttdeci">void get_recovered_flux_in_patch(const Vector&lt; ElementWithZ2ErrorEstimator * &gt; &amp;patch_el_pt, const unsigned &amp;num_recovery_terms, const unsigned &amp;num_flux_terms, const unsigned &amp;dim, DenseMatrix&lt; double &gt; *&amp;recovered_flux_coefficient_pt)</div><div class="ttdef"><b>Definition:</b> error_estimator.cc:666</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_a1782984fa64738f9a8e7ca40d585597a"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1782984fa64738f9a8e7ca40d585597a">oomph::Z2ErrorEstimator::nrecovery_terms</a></div><div class="ttdeci">unsigned nrecovery_terms(const unsigned &amp;dim)</div><div class="ttdef"><b>Definition:</b> error_estimator.cc:812</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_a53d7a1ac66dd41b39d6794e1d00080fc"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a53d7a1ac66dd41b39d6794e1d00080fc">oomph::Z2ErrorEstimator::get_combined_error_estimate</a></div><div class="ttdeci">double get_combined_error_estimate(const Vector&lt; double &gt; &amp;compound_error)</div><div class="ttdoc">Return a combined error estimate from all compound errors.</div><div class="ttdef"><b>Definition:</b> error_estimator.cc:460</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_a5c8a3d6e46d9b9ba31c768cb5b026bba"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a5c8a3d6e46d9b9ba31c768cb5b026bba">oomph::Z2ErrorEstimator::setup_patches</a></div><div class="ttdeci">void setup_patches(Mesh *&amp;mesh_pt, std::map&lt; Node *, Vector&lt; ElementWithZ2ErrorEstimator * &gt; * &gt; &amp;adjacent_elements_pt, Vector&lt; Node * &gt; &amp;vertex_node_pt)</div><div class="ttdef"><b>Definition:</b> error_estimator.cc:505</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_ab57514ecde88f7ae970439fd4900996a"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab57514ecde88f7ae970439fd4900996a">oomph::Z2ErrorEstimator::shape_rec</a></div><div class="ttdeci">void shape_rec(const Vector&lt; double &gt; &amp;x, const unsigned &amp;dim, Vector&lt; double &gt; &amp;psi_r)</div><div class="ttdef"><b>Definition:</b> error_estimator.cc:44</div></div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_ad84f3b903d0508093d6e2a905198b438"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ad84f3b903d0508093d6e2a905198b438">oomph::Z2ErrorEstimator::doc_flux</a></div><div class="ttdeci">void doc_flux(Mesh *mesh_pt, const unsigned &amp;num_flux_terms, MapMatrixMixed&lt; Node *, int, double &gt; &amp;rec_flux_map, const Vector&lt; double &gt; &amp;elemental_error, DocInfo &amp;doc_info)</div><div class="ttdoc">Doc flux and recovered flux.</div><div class="ttdef"><b>Definition:</b> error_estimator.cc:1802</div></div>
<div class="ttc" id="anamespacecalibrate_html_a4dbebf21da853ac368a3a9af2fbab442"><div class="ttname"><a href="../../d9/d33/namespacecalibrate.html#a4dbebf21da853ac368a3a9af2fbab442">calibrate.error</a></div><div class="ttdeci">int error</div><div class="ttdef"><b>Definition:</b> calibrate.py:297</div></div>
<div class="ttc" id="anamespaceoomph_1_1QuadTreeNames_html_a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6"><div class="ttname"><a href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">oomph::QuadTreeNames::W</a></div><div class="ttdeci">@ W</div><div class="ttdef"><b>Definition:</b> quadtree.h:63</div></div>
<div class="ttc" id="atut__arithmetic__redux__minmax_8cpp_html_a39513f0f8d942bf9ef17b2e87ac6d34e"><div class="ttname"><a href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a></div><div class="ttdeci">std::ptrdiff_t j</div><div class="ttdef"><b>Definition:</b> tut_arithmetic_redux_minmax.cpp:2</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/d58/classoomph_1_1MPI__Helpers.html#ac16964b22bfd4f657490802beb600ffe">oomph::MPI_Helpers::communicator_pt()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a3b2c1aba0f9cb4e1767c65f9a3162577">oomph::Mesh::communicator_pt()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a5f8fe59f06da1da9f6b7bbcbdb90ef93">oomph::FiniteElement::dim()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ad84f3b903d0508093d6e2a905198b438">doc_flux()</a>, <a class="el" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">oomph::Mesh::element_pt()</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a4dbebf21da853ac368a3a9af2fbab442">calibrate::error</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#ad2add457436f34d0d4b9e48900be309c">oomph::ElementWithZ2ErrorEstimator::geometric_jacobian()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a53d7a1ac66dd41b39d6794e1d00080fc">get_combined_error_estimate()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a0384127746b7eea7fcf0d08f2d34c647">get_recovered_flux_in_patch()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#a2d894f4d55c63e77bd9f3420ccf9d315">oomph::ElementWithZ2ErrorEstimator::get_Z2_compound_flux_indices()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#a5688ff5f546d81771cabad82ca5a7556">oomph::ElementWithZ2ErrorEstimator::get_Z2_flux()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a751dc02ff1325f799840d79ee415753a">oomph::FiniteElement::integral_pt()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a4a011bbbef38e7ed244f699577f46b4a">oomph::FiniteElement::interpolated_x()</a>, <a class="el" href="../../d7/d2c/classoomph_1_1DocInfo.html#a2ce90cf54f24b4ab523c624031fbb76b">oomph::DocInfo::is_doc_enabled()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a1ab35b022b95f2d28c53aa58859bd6b5">oomph::Mesh::is_mesh_distributed()</a>, <a class="el" href="../../dc/da8/Jacobi__makeJacobi_8cpp.html#a4804f9d1c212b9655934738d0ae395ab">J</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#af4f8e5ff88cce696b15c0f69420c46ed">oomph::FiniteElement::J_eulerian()</a>, <a class="el" href="../../de/d70/classoomph_1_1Integral.html#a1a2122f99a87c18649bafdd9ed739758">oomph::Integral::knot()</a>, <a class="el" href="../../df/d58/classoomph_1_1MPI__Helpers.html#aa376d403f6bc99e8595d227135932b0e">oomph::MPI_Helpers::mpi_has_been_initialised()</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">oomph::OomphCommunicator::my_rank()</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#a1c0e819954397f99f8d03a15fecb2e6d">oomph::ElementWithZ2ErrorEstimator::ncompound_fluxes()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#af01dfefb66c15579b540be62999d93ee">oomph::Mesh::nelement()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a6219ed269a6d89b5aa14659cce48905a">oomph::FiniteElement::nnode()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a945e7823d1a2af243b5b7f7866aaff5e">oomph::Mesh::nnode()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a28ae3eb7760edc5c9d6427611d8e6fb6">oomph::FiniteElement::node_pt()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#ab3c2b72c8ef4e9fd35f5998a5e7dc93b">oomph::Mesh::node_pt()</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#af39480835bd3e0f6b2f4f7a9a4044798">oomph::ElementWithZ2ErrorEstimator::nrecovery_order()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1782984fa64738f9a8e7ca40d585597a">nrecovery_terms()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#ae82c5728902e13da31be19c390fc28e3">oomph::ElementWithZ2ErrorEstimator::num_Z2_flux_terms()</a>, <a class="el" href="../../de/d70/classoomph_1_1Integral.html#a1a270de9d99a1fcf1d25a6c1017f65fa">oomph::Integral::nweight()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#afa024a307366bb987b1c9ba379b837e8">Recovery_order_from_first_element</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a5c8a3d6e46d9b9ba31c768cb5b026bba">setup_patches()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a58a25b6859ddd43b7bfe64a19fee5023">oomph::FiniteElement::shape()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab57514ecde88f7ae970439fd4900996a">shape_rec()</a>, <a class="el" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt()</a>, <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>, <a class="el" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">oomph::QuadTreeNames::W</a>, <a class="el" href="../../de/d70/classoomph_1_1Integral.html#ac65335e2aab120b285b3d6c294507b06">oomph::Integral::weight()</a>, <a class="el" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE::x</a>, and <a class="el" href="../../dc/db7/classoomph_1_1Node.html#a056f8e82da938369cd38541c5cdc598a">oomph::Node::x()</a>.</p>

</div>
</div>
<a id="a0384127746b7eea7fcf0d08f2d34c647"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0384127746b7eea7fcf0d08f2d34c647">&#9670;&nbsp;</a></span>get_recovered_flux_in_patch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::Z2ErrorEstimator::get_recovered_flux_in_patch </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html">ElementWithZ2ErrorEstimator</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>patch_el_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>num_recovery_terms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>num_flux_terms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html">DenseMatrix</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; *&amp;&#160;</td>
          <td class="paramname"><em>recovered_flux_coefficient_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Given the vector of elements that make up a patch, the number of recovery and flux terms, and the spatial dimension of the problem, compute the matrix of recovered flux coefficients and return a pointer to it. </p>
<div class="fragment"><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment">// Create/initialise matrix for linear system</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    DenseDoubleMatrix recovery_mat(num_recovery_terms, num_recovery_terms, 0.0);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">// Ceate/initialise vector of RHSs</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    Vector&lt;Vector&lt;double&gt;&gt; rhs(num_flux_terms);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> irhs = 0; irhs &lt; num_flux_terms; irhs++)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      rhs[irhs].resize(num_recovery_terms);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; num_recovery_terms; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        rhs[irhs][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>] = 0.0;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">// Create a new integration scheme based on the recovery order</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// in the elements</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// Need to find the type of the element, default is to assume a quad</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordtype">bool</span> is_q_mesh = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">// If we can dynamic cast to the TElementBase, then it&#39;s a triangle/tet</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="comment">// Note that I&#39;m assuming that all elements are of the same geometry, but</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">// if they weren&#39;t we could adapt...</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">dynamic_cast&lt;</span>TElementBase*<span class="keyword">&gt;</span>(patch_el_pt[0]))</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      is_q_mesh = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    Integral* <span class="keyword">const</span> integ_pt = this-&gt;<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ac53b6d73d9e73140c92302c2aa70203a">integral_rec</a>(dim, is_q_mesh);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="comment">// Loop over all elements in patch to assemble linear system</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordtype">unsigned</span> nelem = patch_el_pt.size();</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="comment">// Get pointer to element</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      ElementWithZ2ErrorEstimator* <span class="keyword">const</span> el_pt = patch_el_pt[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>];</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="comment">// Create storage for the recovery shape function values</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      Vector&lt;double&gt; psi_r(num_recovery_terms);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="comment">// Create vector to hold local coordinates</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      Vector&lt;double&gt; <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>(dim);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="comment">// Loop over the integration points</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d37/namespaceGlobalParameters.html#a91ccc35c57523650c3832d7fd6a9daec">Nintpt</a> = integ_pt-&gt;nweight();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ipt = 0; ipt &lt; <a class="code" href="../../d9/d37/namespaceGlobalParameters.html#a91ccc35c57523650c3832d7fd6a9daec">Nintpt</a>; ipt++)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="comment">// Assign values of s, the local coordinate</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dim; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = integ_pt-&gt;knot(ipt, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="comment">// Get the integral weight</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a> = integ_pt-&gt;weight(ipt);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="comment">// Jaocbian of mapping</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../dc/da8/Jacobi__makeJacobi_8cpp.html#a4804f9d1c212b9655934738d0ae395ab">J</a> = el_pt-&gt;J_eulerian(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="comment">// Interpolate the global (Eulerian) coordinate</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        Vector&lt;double&gt; <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>(dim);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        el_pt-&gt;interpolated_x(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="comment">// Premultiply the weights and the Jacobian</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="comment">// and the geometric jacobian weight (used in axisymmetric</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="comment">// and spherical coordinate systems)</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">W</a> = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a> * <a class="code" href="../../dc/da8/Jacobi__makeJacobi_8cpp.html#a4804f9d1c212b9655934738d0ae395ab">J</a> * (el_pt-&gt;geometric_jacobian(<a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>));</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="comment">// Recovery shape functions at global (Eulerian) coordinate</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab57514ecde88f7ae970439fd4900996a">shape_rec</a>(<a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>, dim, psi_r);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">// Get FE estimates for Z2 flux:</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        Vector&lt;double&gt; fe_flux(num_flux_terms);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        el_pt-&gt;get_Z2_flux(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, fe_flux);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="comment">// Add elemental RHSs and recovery matrix to global versions</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="comment">//----------------------------------------------------------</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="comment">// RHS for different flux components</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_flux_terms; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        {</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <span class="comment">// Loop over the nodes for the test functions</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> l = 0; l &lt; num_recovery_terms; l++)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            rhs[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][l] += fe_flux[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * psi_r[l] * <a class="code" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="comment">// Loop over the nodes for the test functions</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> l = 0; l &lt; num_recovery_terms; l++)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          <span class="comment">// Loop over the nodes for the variables</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> l2 = 0; l2 &lt; num_recovery_terms; l2++)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="comment">// Add contribution to recovery matrix</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            recovery_mat(l, l2) += psi_r[l] * psi_r[l2] * <a class="code" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          }</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        }</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    } <span class="comment">// End of loop over elements that make up patch.</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// Delete the integration scheme</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keyword">delete</span> integ_pt;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">// Linear system is now assembled: Solve recovery system</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// LU decompose the recovery matrix</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    recovery_mat.ludecompose();</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// Back-substitute (and overwrite for all rhs</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> irhs = 0; irhs &lt; num_flux_terms; irhs++)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      recovery_mat.lubksub(rhs[irhs]);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">// Now create a matrix to store the flux recovery coefficients.</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">// Pointer to this matrix will be returned.</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    recovered_flux_coefficient_pt =</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keyword">new</span> <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;double&gt;</a>(num_recovery_terms, num_flux_terms);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="comment">// Copy coefficients</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> icoeff = 0; icoeff &lt; num_recovery_terms; icoeff++)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> irhs = 0; irhs &lt; num_flux_terms; irhs++)</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        (*recovered_flux_coefficient_pt)(icoeff, irhs) = rhs[irhs][icoeff];</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1Z2ErrorEstimator_html_ac53b6d73d9e73140c92302c2aa70203a"><div class="ttname"><a href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ac53b6d73d9e73140c92302c2aa70203a">oomph::Z2ErrorEstimator::integral_rec</a></div><div class="ttdeci">Integral * integral_rec(const unsigned &amp;dim, const bool &amp;is_q_mesh)</div><div class="ttdef"><b>Definition:</b> error_estimator.cc:245</div></div>
<div class="ttc" id="anamespaceGlobalParameters_html_a91ccc35c57523650c3832d7fd6a9daec"><div class="ttname"><a href="../../d9/d37/namespaceGlobalParameters.html#a91ccc35c57523650c3832d7fd6a9daec">GlobalParameters::Nintpt</a></div><div class="ttdeci">unsigned Nintpt</div><div class="ttdoc">Number of integration points for new integration scheme (if used)</div><div class="ttdef"><b>Definition:</b> stefan_boltzmann.cc:112</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#ad2add457436f34d0d4b9e48900be309c">oomph::ElementWithZ2ErrorEstimator::geometric_jacobian()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#a5688ff5f546d81771cabad82ca5a7556">oomph::ElementWithZ2ErrorEstimator::get_Z2_flux()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ac53b6d73d9e73140c92302c2aa70203a">integral_rec()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a4a011bbbef38e7ed244f699577f46b4a">oomph::FiniteElement::interpolated_x()</a>, <a class="el" href="../../dc/da8/Jacobi__makeJacobi_8cpp.html#a4804f9d1c212b9655934738d0ae395ab">J</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#af4f8e5ff88cce696b15c0f69420c46ed">oomph::FiniteElement::J_eulerian()</a>, <a class="el" href="../../de/d70/classoomph_1_1Integral.html#a1a2122f99a87c18649bafdd9ed739758">oomph::Integral::knot()</a>, <a class="el" href="../../dd/d03/classoomph_1_1DenseDoubleMatrix.html#a52515653ab5b792388258ca04e9dcbcc">oomph::DenseDoubleMatrix::lubksub()</a>, <a class="el" href="../../dd/d03/classoomph_1_1DenseDoubleMatrix.html#a741d54dbea2a16e6e3f10bbd2d9d726e">oomph::DenseDoubleMatrix::ludecompose()</a>, <a class="el" href="../../d9/d37/namespaceGlobalParameters.html#a91ccc35c57523650c3832d7fd6a9daec">GlobalParameters::Nintpt</a>, <a class="el" href="../../de/d70/classoomph_1_1Integral.html#a1a270de9d99a1fcf1d25a6c1017f65fa">oomph::Integral::nweight()</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab57514ecde88f7ae970439fd4900996a">shape_rec()</a>, <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>, <a class="el" href="../../dc/d00/namespaceoomph_1_1QuadTreeNames.html#a9ac199adb82120cbaa47bf2365918ab9aabab2a070c062503375f8264f1b6d7d6">oomph::QuadTreeNames::W</a>, <a class="el" href="../../de/d70/classoomph_1_1Integral.html#ac65335e2aab120b285b3d6c294507b06">oomph::Integral::weight()</a>, and <a class="el" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>.</p>

</div>
</div>
<a id="ac53b6d73d9e73140c92302c2aa70203a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac53b6d73d9e73140c92302c2aa70203a">&#9670;&nbsp;</a></span>integral_rec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d70/classoomph_1_1Integral.html">Integral</a> * oomph::Z2ErrorEstimator::integral_rec </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;&#160;</td>
          <td class="paramname"><em>is_q_mesh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Integation scheme associated with the recovery shape functions must be of sufficiently high order to integrate the mass matrix associated with the recovery shape functions</p>
<p>Integation scheme associated with the recovery shape functions must be of sufficiently high order to integrate the mass matrix associated with the recovery shape functions. The argument is the dimension of the elements. The integration is performed locally over the elements, so the integration scheme does depend on the geometry of the element. The type of element is specified by the boolean which is true if elements in the patch are QElements and false if they are TElements (will need change if we ever have other element types) </p>
<p>Which spatial dimension are we dealing with?</p>
<p>Find order of recovery shape functions</p>
<p>Find order of recovery shape functions</p>
<p>Find order of recovery shape functions</p>
<div class="fragment"><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    std::ostringstream error_stream;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">switch</span> (dim)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// 1D:</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">//====</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>())</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="comment">// Complete linear polynomial in 1D</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="comment">//(quadratic terms in mass matrix)</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;1, 2&gt;);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;1, 2&gt;);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="comment">// Complete quadratic polynomial in 1D:</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="comment">//(quartic terms in the mass marix)</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;1, 3&gt;);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;1, 3&gt;);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="comment">// Complete cubic polynomial in 1D:</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="comment">// (order six terms in mass matrix)</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;1, 4&gt;);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;1, 4&gt;);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            error_stream &lt;&lt; <span class="stringliteral">&quot;Recovery shape functions for recovery order &quot;</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                         &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>()</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; haven&#39;t yet been implemented for 1D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_stream.str(),</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="comment">// 2D:</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">//====</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>())</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// Complete linear polynomial in 2D:</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;2, 2&gt;);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;2, 2&gt;);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="comment">// Complete quadratic polynomial in 2D:</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;2, 3&gt;);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;2, 3&gt;);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="comment">// Complete cubic polynomial in 2D:</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;2, 4&gt;);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;2, 4&gt;);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            error_stream &lt;&lt; <span class="stringliteral">&quot;Recovery shape functions for recovery order &quot;</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                         &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>()</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; haven&#39;t yet been implemented for 2D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_stream.str(),</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="comment">// 3D:</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="comment">//====</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"></span>        <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>())</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="comment">// Complete linear polynomial in 3D:</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;3, 2&gt;);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;3, 2&gt;);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="comment">// Complete quadratic polynomial in 3D:</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;3, 3&gt;);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;3, 3&gt;);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <span class="comment">// Complete cubic polynomial in 3D:</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="keywordflow">if</span> (is_q_mesh)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> Gauss&lt;3, 4&gt;);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;              <span class="keywordflow">return</span> (<span class="keyword">new</span> TGauss&lt;3, 5&gt;);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            } <span class="comment">// TGauss&lt;3,4&gt; not implemented</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            error_stream &lt;&lt; <span class="stringliteral">&quot;Recovery shape functions for recovery order &quot;</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                         &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>()</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; haven&#39;t yet been implemented for 3D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_stream.str(),</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment">// Any other dimension?</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment">//=====================</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        error_stream &lt;&lt; <span class="stringliteral">&quot;No recovery shape functions for dim &quot;</span> &lt;&lt; dim</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                     &lt;&lt; std::endl;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          error_stream.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// Dummy return (never get here)</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, and <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a0384127746b7eea7fcf0d08f2d34c647">get_recovered_flux_in_patch()</a>.</p>

</div>
</div>
<a id="a1782984fa64738f9a8e7ca40d585597a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1782984fa64738f9a8e7ca40d585597a">&#9670;&nbsp;</a></span>nrecovery_terms()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> oomph::Z2ErrorEstimator::nrecovery_terms </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>dim</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return number of coefficients for expansion of recovered fluxes for given spatial dimension of elements. (We use complete polynomials of the specified given order.)</p>
<p>Number of coefficients for expansion of recovered fluxes for given spatial dimension of elements. Use complete polynomial of given order for recovery </p>
<div class="fragment"><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordtype">unsigned</span> num_recovery_terms;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">if</span> ((dim != 1) &amp;&amp; (dim != 2) &amp;&amp; (dim != 3))</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <a class="code" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">std::string</a> error_message = <span class="stringliteral">&quot;THIS HASN&#39;T BEEN USED/VALIDATED YET -- &quot;</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                  <span class="stringliteral">&quot;CHECK NUMBER OF RECOVERY TERMS!\n&quot;</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      error_message += <span class="stringliteral">&quot;Then remove this break and continue\n&quot;</span>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        error_message, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="comment">// Linear recovery shape functions</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="comment">//--------------------------------</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">switch</span> (dim)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="comment">// 1D:</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            num_recovery_terms = 2; <span class="comment">// 1, x</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <span class="comment">// 2D:</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            num_recovery_terms = 3; <span class="comment">// 1, x, y</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160; </div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="comment">// 3D:</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            num_recovery_terms = 4; <span class="comment">// 1, x, y, z</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(<span class="stringliteral">&quot;Dim must be 1, 2 or 3&quot;</span>,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="comment">// Quadratic recovery shape functions</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="comment">//-----------------------------------</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">switch</span> (dim)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="comment">// 1D:</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            num_recovery_terms = 3; <span class="comment">// 1, x, x^2</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="comment">// 2D:</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            num_recovery_terms = 6; <span class="comment">// 1, x, y, x^2, xy, y^2</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="comment">// 3D:</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            num_recovery_terms = 10; <span class="comment">// 1, x, y, z, x^2, y^2, z^2, xy, xz, yz</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(<span class="stringliteral">&quot;Dim must be 1, 2 or 3&quot;</span>,</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">// Cubic recovery shape functions</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">//--------------------------------</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="keywordflow">switch</span> (dim)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            <span class="comment">// 1D:</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            num_recovery_terms = 4; <span class="comment">// 1, x, x^2, x^3</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <span class="comment">// 2D:</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            num_recovery_terms =</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;              10; <span class="comment">// 1, x, y, x^2, xy, y^2, x^3, y^3, x^2 y, x y^2</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <span class="comment">// 3D:</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            num_recovery_terms = 20; <span class="comment">// 1, x, y, z, x^2, y^2, z^2, xy, xz, yz,</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <span class="comment">// x^3, y^3, z^3,</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            <span class="comment">// x^2 y, x^2 z,</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="comment">// y^2 x, y^2 z,</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <span class="comment">// z^2 x, z^2 y</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <span class="comment">// xyz</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(<span class="stringliteral">&quot;Dim must be 1, 2 or 3&quot;</span>,</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="comment">// Any other recovery order?</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="comment">//--------------------------</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        std::ostringstream error_stream;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        error_stream &lt;&lt; <span class="stringliteral">&quot;Wrong Recovery_order &quot;</span> &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;          error_stream.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">return</span> num_recovery_terms;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  }</div>
<div class="ttc" id="anamespaceoomph_1_1Global__string__for__annotation_html_ac5379de2fa7fe44f2cb31785fc208135"><div class="ttname"><a href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">oomph::Global_string_for_annotation::string</a></div><div class="ttdeci">std::string string(const unsigned &amp;i)</div><div class="ttdef"><b>Definition:</b> oomph_definitions.cc:286</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>, and <a class="el" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">oomph::Global_string_for_annotation::string()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>.</p>

</div>
</div>
<a id="a70cc1b459e36f42e6654c25c89103319"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70cc1b459e36f42e6654c25c89103319">&#9670;&nbsp;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::Z2ErrorEstimator::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html">Z2ErrorEstimator</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Broken assignment operator. </p>

</div>
</div>
<a id="af7a3a28cfc05b291b438b80e87c7f5cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7a3a28cfc05b291b438b80e87c7f5cc">&#9670;&nbsp;</a></span>recovery_order() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&amp; oomph::Z2ErrorEstimator::recovery_order </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function for order of recovery polynomials. </p>
<div class="fragment"><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ac53b6d73d9e73140c92302c2aa70203a">integral_rec()</a>, and <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ab57514ecde88f7ae970439fd4900996a">shape_rec()</a>.</p>

</div>
</div>
<a id="ad463b5c01e6bb5b9e4ec9b3a02f9fb4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad463b5c01e6bb5b9e4ec9b3a02f9fb4a">&#9670;&nbsp;</a></span>recovery_order() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> oomph::Z2ErrorEstimator::recovery_order </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function for order of recovery polynomials (const version) </p>
<div class="fragment"><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>.</p>

</div>
</div>
<a id="a997dc6ba0b546a0f7363949a8d33d133"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a997dc6ba0b546a0f7363949a8d33d133">&#9670;&nbsp;</a></span>reference_flux_norm() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/de6/classdouble.html">double</a>&amp; oomph::Z2ErrorEstimator::reference_flux_norm </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function for prescribed reference flux norm. </p>
<div class="fragment"><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/df4/refineable__spin__up_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a>, and <a class="el" href="../../d0/d94/classRotatingCylinderProblem.html#abfb7f77b97e9ac061edbaa97a018cd24">RotatingCylinderProblem&lt; ELEMENT, TIMESTEPPER &gt;::unsteady_run()</a>.</p>

</div>
</div>
<a id="a4a7902d3e80dc64406e1f367c02ec4e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a7902d3e80dc64406e1f367c02ec4e3">&#9670;&nbsp;</a></span>reference_flux_norm() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/de6/classdouble.html">double</a> oomph::Z2ErrorEstimator::reference_flux_norm </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function for prescribed reference flux norm (const. version) </p>
<div class="fragment"><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#aa170691c5d84fbf0eb6dc5f480bbb187">Reference_flux_norm</a>.</p>

</div>
</div>
<a id="a5c8a3d6e46d9b9ba31c768cb5b026bba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c8a3d6e46d9b9ba31c768cb5b026bba">&#9670;&nbsp;</a></span>setup_patches()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::Z2ErrorEstimator::setup_patches </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&amp;&#160;</td>
          <td class="paramname"><em>mesh_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; <a class="el" href="../../dc/db7/classoomph_1_1Node.html">Node</a> *, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html">ElementWithZ2ErrorEstimator</a> * &gt; * &gt; &amp;&#160;</td>
          <td class="paramname"><em>adjacent_elements_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../dc/db7/classoomph_1_1Node.html">Node</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>vertex_node_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Setup patches: For each vertex node pointed to by nod_pt, adjacent_elements_pt[nod_pt] contains the pointer to the vector that contains the pointers to the elements that the node is part of.</p>
<p>Setup patches: For each vertex node pointed to by nod_pt, adjacent_elements_pt[nod_pt] contains the pointer to the vector that contains the pointers to the elements that the node is part of. Also returns a Vector of vertex nodes for use in get_element_errors. </p>
<div class="fragment"><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">// (see also note at the end of get_element_errors below)</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// NOTE FOR FUTURE REFERENCE - revisit in case of adaptivity problems in</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="comment">//  parallel jobs at the boundaries between processes</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// The current method for distributed problems neglects recovered flux</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">// contributions from patches that cannot be assembled from (vertex) nodes</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">// on the current process, but would be assembled if the problem was not</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="comment">// distributed.  The only nodes for which this is the case are nodes which</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// lie on the exact boundary between processes.</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">// The suggested method for fixing this requires the current process (A) to</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// receive information from the process (B) on which the patch is</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// assembled.  These patches are precisely the patches on process B which</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// contain no halo elements.  The contribution from these patches needs to</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">// be sent to the nodes (on process A) that are on the boundary between</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">// A and B.  Therefore a map is required to denote such nodes; a node is on</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// the boundary of a process if it is a member of at least one halo element</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">// and one non-halo element for that process.  Create a vector of bools</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// which is the size of the number of processes and make the entry true if</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// the node (through a map(nod_pt,vector&lt;bools&gt; node_bnd)) is on the</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">// boundary for a process and false otherwise.  This should be done here in</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// setup_patches.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">// When it comes to the error calculation in get_element_errors (see later)</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// the communication needs to take place after rec_flux_map(nod_pt,i) has</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="comment">// been assembled for all other patches.  A separate vector for the patches</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// to be sent needs to be assembled: the recovered flux contribution at</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">// a node on process B is sent to the equivalent node on process A if the</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// patch contains ONLY halo elements AND the node is on the boundary between</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// A and B (i.e. both the entries in the mapped vector are set to true).</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">// If anyone else read this and has any questions, I have a fuller</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// explanation written out (with some relevant diagrams in the 2D case).</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">// Andrew.Gait@manchester.ac.uk</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// Auxiliary map that contains element-adjacency for ALL nodes</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    std::map&lt;Node*, Vector&lt;ElementWithZ2ErrorEstimator*&gt;*&gt;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      aux_adjacent_elements_pt;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// Check if all elements request the same recovery order</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordtype">unsigned</span> ndisagree = 0;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">// Loop over all elements to setup adjacency for all nodes.</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">// Need to do this because midside nodes can be corner nodes for</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// adjacent smaller elements! Admittedly, the inclusion of interior</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">// nodes is wasteful...</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordtype">unsigned</span> nelem = mesh_pt-&gt;nelement();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(mesh_pt-&gt;element_pt(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>));</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="comment">// Check if all elements request the same recovery order</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">if</span> (el_pt-&gt;nrecovery_order() != <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        ndisagree++;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="comment">// Loop all nodes in element</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordtype">unsigned</span> nnod = el_pt-&gt;nnode();</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = 0; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &lt; nnod; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>++)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        Node* nod_pt = el_pt-&gt;node_pt(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="comment">// Has this node been considered before?</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">if</span> (aux_adjacent_elements_pt[nod_pt] == 0)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          <span class="comment">// Create Vector of pointers to its adjacent elements</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          aux_adjacent_elements_pt[nod_pt] =</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keyword">new</span> Vector&lt;ElementWithZ2ErrorEstimator*&gt;;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="comment">// Add pointer to adjacent element</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        (*aux_adjacent_elements_pt[nod_pt]).push_back(el_pt);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="comment">//       }</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    } <span class="comment">// end element loop</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">// Check if all elements request the same recovery order</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span> (ndisagree != 0)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;\n\n========================================================\n&quot;</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;WARNING: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; ndisagree &lt;&lt; <span class="stringliteral">&quot; out of &quot;</span> &lt;&lt; mesh_pt-&gt;nelement()</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; elements\n&quot;</span>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;have different preferences for the order of the recovery\n&quot;</span>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;shape functions. We are using: Recovery_order=&quot;</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                 &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;========================================================\n\n&quot;</span>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">// Loop over all elements, extract adjacency for corner nodes only</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    nelem = mesh_pt-&gt;nelement();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nelem; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      ElementWithZ2ErrorEstimator* el_pt =</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>ElementWithZ2ErrorEstimator*<span class="keyword">&gt;</span>(mesh_pt-&gt;element_pt(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>));</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="comment">// Loop over corner nodes</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordtype">unsigned</span> n_node = el_pt-&gt;nvertex_node();</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = 0; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &lt; n_node; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>++)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        Node* nod_pt = el_pt-&gt;vertex_node_pt(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// Has this node been considered before?</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span> (adjacent_elements_pt[nod_pt] == 0)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          <span class="comment">// Add the node pointer to the vertex node container</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          vertex_node_pt.push_back(nod_pt);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="comment">// Create Vector of pointers to its adjacent elements</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          adjacent_elements_pt[nod_pt] =</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keyword">new</span> Vector&lt;ElementWithZ2ErrorEstimator*&gt;;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          <span class="comment">// Copy across:</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          <span class="keywordtype">unsigned</span> nel = (*aux_adjacent_elements_pt[nod_pt]).<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; nel; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            (*adjacent_elements_pt[nod_pt])</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;              .push_back((*aux_adjacent_elements_pt[nod_pt])[<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>]);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;          }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        }</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    } <span class="comment">// end of loop over elements</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">// Cleanup</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keyword">typedef</span> std::map&lt;Node*, Vector&lt;ElementWithZ2ErrorEstimator*&gt;*&gt;::iterator</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      ITT;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">for</span> (ITT it = aux_adjacent_elements_pt.begin();</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;         it != aux_adjacent_elements_pt.end();</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;         it++)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keyword">delete</span> it-&gt;second;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  }</div>
<div class="ttc" id="abenchVecAdd_8cpp_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="../../db/ddc/benchVecAdd_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">Scalar Scalar int size</div><div class="ttdef"><b>Definition:</b> benchVecAdd.cpp:17</div></div>
<div class="ttc" id="anamespaceoomph_html_aec474227917784dc0a255faf289cfc16"><div class="ttname"><a href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph::oomph_info</a></div><div class="ttdeci">OomphInfo oomph_info</div><div class="ttdef"><b>Definition:</b> oomph_definitions.cc:319</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">oomph::Mesh::element_pt()</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#af01dfefb66c15579b540be62999d93ee">oomph::Mesh::nelement()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a6219ed269a6d89b5aa14659cce48905a">oomph::FiniteElement::nnode()</a>, <a class="el" href="../../d2/dc6/classoomph_1_1FiniteElement.html#a28ae3eb7760edc5c9d6427611d8e6fb6">oomph::FiniteElement::node_pt()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#af39480835bd3e0f6b2f4f7a9a4044798">oomph::ElementWithZ2ErrorEstimator::nrecovery_order()</a>, <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#a19495a0e77ef4ff35f15fdf7913b4077">oomph::ElementWithZ2ErrorEstimator::nvertex_node()</a>, <a class="el" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph::oomph_info</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a9aafff3d80518811ba7d9bb12a240a7c">Recovery_order</a>, <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, and <a class="el" href="../../df/d8a/classoomph_1_1ElementWithZ2ErrorEstimator.html#a0eedccc33519f852c5dc2055ddf2774b">oomph::ElementWithZ2ErrorEstimator::vertex_node_pt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>.</p>

</div>
</div>
<a id="ab57514ecde88f7ae970439fd4900996a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab57514ecde88f7ae970439fd4900996a">&#9670;&nbsp;</a></span>shape_rec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::Z2ErrorEstimator::shape_rec </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>psi_r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Recovery shape functions as functions of the global, Eulerian coordinate x of dimension dim. The recovery shape functions are complete polynomials of the order specified by Recovery_order. </p>
<p>Which spatial dimension are we dealing with?</p>
<p>Find order of recovery shape functions</p>
<p>Find order of recovery shape functions</p>
<p>Find order of recovery shape functions</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    std::ostringstream error_stream;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">switch</span> (dim)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="comment">// 1D:</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment">//====</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>())</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="comment">// Complete linear polynomial in 1D:</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="comment">// Complete quadratic polynomial in 1D:</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="comment">// Complete cubic polynomial in 1D:</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            psi_r[3] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            error_stream &lt;&lt; <span class="stringliteral">&quot;Recovery shape functions for recovery order &quot;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                         &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>()</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; haven&#39;t yet been implemented for 1D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_stream.str(),</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment">// 2D:</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">//====</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>())</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="comment">// Complete linear polynomial in 2D:</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="comment">// Complete quadratic polynomial in 2D:</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            psi_r[3] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            psi_r[4] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            psi_r[5] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="comment">// Complete cubic polynomial in 2D:</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            psi_r[3] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            psi_r[4] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            psi_r[5] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            psi_r[6] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            psi_r[7] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            psi_r[8] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            psi_r[9] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            error_stream &lt;&lt; <span class="stringliteral">&quot;Recovery shape functions for recovery order &quot;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                         &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>()</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; haven&#39;t yet been implemented for 2D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_stream.str(),</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// 3D:</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">//====</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"></span>        <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>())</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="comment">// Complete linear polynomial in 3D:</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            psi_r[3] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="comment">// Complete quadratic polynomial in 3D:</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            psi_r[3] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            psi_r[4] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            psi_r[5] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            psi_r[6] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            psi_r[7] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            psi_r[8] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            psi_r[9] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="comment">// Complete cubic polynomial in 3D:</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            psi_r[0] = 1.0;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            psi_r[1] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            psi_r[2] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            psi_r[3] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            psi_r[4] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            psi_r[5] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            psi_r[6] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            psi_r[7] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            psi_r[8] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            psi_r[9] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            psi_r[10] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            psi_r[11] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            psi_r[12] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            psi_r[13] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            psi_r[14] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            psi_r[15] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            psi_r[16] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            psi_r[17] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0];</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            psi_r[18] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1];</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            psi_r[19] = <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[0] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[1] * <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[2];</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            error_stream &lt;&lt; <span class="stringliteral">&quot;Recovery shape functions for recovery order &quot;</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                         &lt;&lt; <a class="code" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order</a>()</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; haven&#39;t yet been implemented for 3D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_stream.str(),</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">// Any other dimension?</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment">//=====================</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        error_stream &lt;&lt; <span class="stringliteral">&quot;No recovery shape functions for dim &quot;</span> &lt;&lt; dim</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                     &lt;&lt; std::endl;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          error_stream.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order()</a>, and <a class="el" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>, and <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a0384127746b7eea7fcf0d08f2d34c647">get_recovered_flux_in_patch()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a34a013732989e82f50cb7e72f25632a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34a013732989e82f50cb7e72f25632a7">&#9670;&nbsp;</a></span>Combined_error_fct_pt</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a75ef55e67b21ec49ed1a37d095cfa9f9">CombinedErrorEstimateFctPt</a> oomph::Z2ErrorEstimator::Combined_error_fct_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function pointer to combined error estimator function. </p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1719ff79e67f2f0b2b8194a91f52d3d2">combined_error_fct_pt()</a>, and <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a53d7a1ac66dd41b39d6794e1d00080fc">get_combined_error_estimate()</a>.</p>

</div>
</div>
<a id="a9aafff3d80518811ba7d9bb12a240a7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9aafff3d80518811ba7d9bb12a240a7c">&#9670;&nbsp;</a></span>Recovery_order</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> oomph::Z2ErrorEstimator::Recovery_order</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Order of recovery polynomials. </p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a1782984fa64738f9a8e7ca40d585597a">nrecovery_terms()</a>, <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#af7a3a28cfc05b291b438b80e87c7f5cc">recovery_order()</a>, and <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a5c8a3d6e46d9b9ba31c768cb5b026bba">setup_patches()</a>.</p>

</div>
</div>
<a id="afa024a307366bb987b1c9ba379b837e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa024a307366bb987b1c9ba379b837e8">&#9670;&nbsp;</a></span>Recovery_order_from_first_element</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> oomph::Z2ErrorEstimator::Recovery_order_from_first_element</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bool to indicate if recovery order is to be read out from first element in mesh or set globally </p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>.</p>

</div>
</div>
<a id="aa170691c5d84fbf0eb6dc5f480bbb187"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa170691c5d84fbf0eb6dc5f480bbb187">&#9670;&nbsp;</a></span>Reference_flux_norm</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/de6/classdouble.html">double</a> oomph::Z2ErrorEstimator::Reference_flux_norm</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prescribed reference flux norm. </p>

<p class="reference">Referenced by <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#ae0fd03123c518ed340bb534c2f6b8cc4">get_element_errors()</a>, and <a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html#a997dc6ba0b546a0f7363949a8d33d133">reference_flux_norm()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../df/d56/error__estimator_8h_source.html">error_estimator.h</a></li>
<li><a class="el" href="../../d4/d07/error__estimator_8cc.html">error_estimator.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../da/ddf/namespaceoomph.html">oomph</a></li><li class="navelem"><a class="el" href="../../d1/d8f/classoomph_1_1Z2ErrorEstimator.html">Z2ErrorEstimator</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:09:03 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
