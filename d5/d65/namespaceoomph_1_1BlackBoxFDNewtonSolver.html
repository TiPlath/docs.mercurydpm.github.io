<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: oomph::BlackBoxFDNewtonSolver Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">oomph::BlackBoxFDNewtonSolver Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Namespace for black-box FD Newton solver.  
<a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae43745d4b8933505d52d50820c5ed5bf"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae43745d4b8933505d52d50820c5ed5bf">ResidualFctPt</a>) (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;parameters, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;unknowns, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;residuals)</td></tr>
<tr class="separator:ae43745d4b8933505d52d50820c5ed5bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a8995752628445edff43f942b4d3e88"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6a8995752628445edff43f942b4d3e88">JacobianFctPt</a>) (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;, <a class="el" href="../../dd/d03/classoomph_1_1DenseDoubleMatrix.html">DenseDoubleMatrix</a> &amp;jacobian)</td></tr>
<tr class="separator:a6a8995752628445edff43f942b4d3e88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae132e48f67e6523676abad29b61397ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve</a> (<a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae43745d4b8933505d52d50820c5ed5bf">ResidualFctPt</a> residual_fct, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;params, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;unknowns, <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6a8995752628445edff43f942b4d3e88">JacobianFctPt</a> jacobian_fct)</td></tr>
<tr class="separator:ae132e48f67e6523676abad29b61397ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1361a9b08163b59fe82b3042b0f887"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4a1361a9b08163b59fe82b3042b0f887">line_search</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;x_old, const <a class="el" href="../../df/de6/classdouble.html">double</a> half_residual_squared_old, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;gradient, <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae43745d4b8933505d52d50820c5ed5bf">ResidualFctPt</a> residual_fct, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;params, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;newton_dir, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;<a class="el" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a61b7da262276970831d88a2f37dbe509">x</a>, <a class="el" href="../../df/de6/classdouble.html">double</a> &amp;half_residual_squared, const <a class="el" href="../../df/de6/classdouble.html">double</a> &amp;stpmax)</td></tr>
<tr class="memdesc:a4a1361a9b08163b59fe82b3042b0f887"><td class="mdescLeft">&#160;</td><td class="mdescRight">Line search helper for globally convergent Newton method.  <a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4a1361a9b08163b59fe82b3042b0f887">More...</a><br /></td></tr>
<tr class="separator:a4a1361a9b08163b59fe82b3042b0f887"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a20ac8568daf0d63afa3945a817ff3e2d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a20ac8568daf0d63afa3945a817ff3e2d">Max_iter</a> = 20</td></tr>
<tr class="memdesc:a20ac8568daf0d63afa3945a817ff3e2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Max. # of Newton iterations.  <a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a20ac8568daf0d63afa3945a817ff3e2d">More...</a><br /></td></tr>
<tr class="separator:a20ac8568daf0d63afa3945a817ff3e2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3067ba88fad991fdb619eae7533028bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a3067ba88fad991fdb619eae7533028bd">N_iter_taken</a> = 0</td></tr>
<tr class="memdesc:a3067ba88fad991fdb619eae7533028bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of Newton iterations taken in most recent invocation.  <a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a3067ba88fad991fdb619eae7533028bd">More...</a><br /></td></tr>
<tr class="separator:a3067ba88fad991fdb619eae7533028bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2603699f47446716ca5a818f46a7f17"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ac2603699f47446716ca5a818f46a7f17">Doc_Progress</a> = false</td></tr>
<tr class="separator:ac2603699f47446716ca5a818f46a7f17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f0d2ceb4451e66bb7ef4ab4fdb62bcf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de6/classdouble.html">double</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6f0d2ceb4451e66bb7ef4ab4fdb62bcf">FD_step</a> = 1.0e-8</td></tr>
<tr class="memdesc:a6f0d2ceb4451e66bb7ef4ab4fdb62bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">FD step.  <a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6f0d2ceb4451e66bb7ef4ab4fdb62bcf">More...</a><br /></td></tr>
<tr class="separator:a6f0d2ceb4451e66bb7ef4ab4fdb62bcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bacc59c8e1194e553f698530e9e945e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de6/classdouble.html">double</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4bacc59c8e1194e553f698530e9e945e">Tol</a> = 1.0e-8</td></tr>
<tr class="memdesc:a4bacc59c8e1194e553f698530e9e945e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tolerance.  <a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4bacc59c8e1194e553f698530e9e945e">More...</a><br /></td></tr>
<tr class="separator:a4bacc59c8e1194e553f698530e9e945e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd90cb451fb7ae5a8e30cab0a1884568"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#afd90cb451fb7ae5a8e30cab0a1884568">Use_step_length_control</a> = false</td></tr>
<tr class="memdesc:afd90cb451fb7ae5a8e30cab0a1884568"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use steplength control do make globally convergent (default false)  <a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#afd90cb451fb7ae5a8e30cab0a1884568">More...</a><br /></td></tr>
<tr class="separator:afd90cb451fb7ae5a8e30cab0a1884568"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Namespace for black-box FD Newton solver. </p>
<p>/////////////////////////////////////////////////////////////// /////////////////////////////////////////////////////////////// /////////////////////////////////////////////////////////////// </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a6a8995752628445edff43f942b4d3e88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a8995752628445edff43f942b4d3e88">&#9670;&nbsp;</a></span>JacobianFctPt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* oomph::BlackBoxFDNewtonSolver::JacobianFctPt) (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;, <a class="el" href="../../dd/d03/classoomph_1_1DenseDoubleMatrix.html">DenseDoubleMatrix</a> &amp;jacobian)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae43745d4b8933505d52d50820c5ed5bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae43745d4b8933505d52d50820c5ed5bf">&#9670;&nbsp;</a></span>ResidualFctPt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* oomph::BlackBoxFDNewtonSolver::ResidualFctPt) (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;parameters, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;unknowns, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;residuals)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ae132e48f67e6523676abad29b61397ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae132e48f67e6523676abad29b61397ba">&#9670;&nbsp;</a></span>black_box_fd_newton_solve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::BlackBoxFDNewtonSolver::black_box_fd_newton_solve </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae43745d4b8933505d52d50820c5ed5bf">ResidualFctPt</a>&#160;</td>
          <td class="paramname"><em>residual_fct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>unknowns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6a8995752628445edff43f942b4d3e88">JacobianFctPt</a>&#160;</td>
          <td class="paramname"><em>jacobian_fct</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Black-box FD Newton solver: Calling sequence for residual function is </p><div class="fragment"><div class="line">residual_fct(parameters,unknowns,residuals) </div>
</div><!-- fragment --><p> where all arguments are double Vectors. unknowns.size() = residuals.size() </p>
<p>Reset number of Newton iterations taken in most recent invocation</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="comment">// Jacobian, current and advanced residual Vectors</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordtype">unsigned</span> ndof = unknowns.size();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      DenseDoubleMatrix jacobian(ndof);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      Vector&lt;double&gt; residuals(ndof);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      Vector&lt;double&gt; residuals_pls(ndof);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      Vector&lt;double&gt; dx(ndof);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      Vector&lt;double&gt; gradient(ndof);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      Vector&lt;double&gt; newton_direction(ndof);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordtype">double</span> half_residual_squared = 0.0;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordtype">double</span> max_step = 0.0;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a3067ba88fad991fdb619eae7533028bd">N_iter_taken</a> = 0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="comment">// Newton iterations</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iloop = 0; iloop &lt; <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a20ac8568daf0d63afa3945a817ff3e2d">Max_iter</a>; iloop++)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">// Evaluate current residuals</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        residual_fct(<a class="code" href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">params</a>, unknowns, residuals);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">// Get half of squared residual and find maximum step length</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">// for step length control</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#afd90cb451fb7ae5a8e30cab0a1884568">Use_step_length_control</a>)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          half_residual_squared = 0.0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;          <span class="keywordtype">double</span> sum = 0.0;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; ndof; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;          {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            sum += unknowns[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * unknowns[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            half_residual_squared += residuals[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * residuals[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;          }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          half_residual_squared *= 0.5;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          max_step = 100.0 * <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(<a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(sum), <span class="keywordtype">double</span>(ndof));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">// Check max. residuals</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordtype">double</span> max_res = <a class="code" href="../../d2/d0c/namespaceboost_1_1multiprecision.html#ab6f80ccf8e1d88df8a8e3acd039d63eb">std::fabs</a>(*std::max_element(</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          residuals.begin(), residuals.end(), AbsCmp&lt;double&gt;()));</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">// Doc progress?</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ac2603699f47446716ca5a818f46a7f17">Doc_Progress</a>)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;          <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;\nNewton iteration iter=&quot;</span> &lt;&lt; iloop</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;\ni residual[i] unknown[i] &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; ndof; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;          {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; residuals[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; unknowns[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                       &lt;&lt; std::endl;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">// Converged?</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">if</span> (max_res &lt; <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4bacc59c8e1194e553f698530e9e945e">Tol</a>)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment">// Next iteration...</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a3067ba88fad991fdb619eae7533028bd">N_iter_taken</a>++;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="comment">// ...and how would Sir like his Jacobian?</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">if</span> (jacobian_fct == 0)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;          <span class="comment">// FD loop for Jacobian</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; ndof; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordtype">double</span> backup = unknowns[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            unknowns[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] += <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6f0d2ceb4451e66bb7ef4ab4fdb62bcf">FD_step</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="comment">// Evaluate advanced residuals</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            residual_fct(<a class="code" href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">params</a>, unknowns, residuals_pls);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="comment">// Do FD</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; ndof; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;              jacobian(<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) = (residuals_pls[<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>] - residuals[<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]) / <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6f0d2ceb4451e66bb7ef4ab4fdb62bcf">FD_step</a>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="comment">// Reset fd step</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            unknowns[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = backup;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">// Analytical Jacobian</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;          jacobian_fct(<a class="code" href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">params</a>, unknowns, jacobian);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ac2603699f47446716ca5a818f46a7f17">Doc_Progress</a>)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;\n\nJacobian: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;          jacobian.sparse_indexed_output(*(<a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a>.<a class="code" href="../../d5/d63/classoomph_1_1OomphInfo.html#abcbb5e3dba35ab95c67f543931374d13">stream_pt</a>()));</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">// Get gradient</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#afd90cb451fb7ae5a8e30cab0a1884568">Use_step_length_control</a>)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; ndof; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;          {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordtype">double</span> sum = 0.0;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; ndof; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;              sum += jacobian(<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) * residuals[<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>];</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            gradient[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = sum;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">// Solve</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        jacobian.solve(residuals, newton_direction);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="comment">// Update</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#afd90cb451fb7ae5a8e30cab0a1884568">Use_step_length_control</a>)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; ndof; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            newton_direction[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] *= -1.0;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          <span class="comment">// Update with steplength control</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;          Vector&lt;double&gt; unknowns_old(unknowns);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          <span class="keywordtype">double</span> half_residual_squared_old = half_residual_squared;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4a1361a9b08163b59fe82b3042b0f887">line_search</a>(unknowns_old,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                      half_residual_squared_old,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                      gradient,</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                      residual_fct,</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                      <a class="code" href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">params</a>,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                      newton_direction,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                      unknowns,</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                      half_residual_squared,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                      max_step);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          <span class="comment">// Direct Newton update:</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; ndof; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;          {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            unknowns[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= newton_direction[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="comment">// Failed to converge</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      std::ostringstream error_stream;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      error_stream &lt;&lt; <span class="stringliteral">&quot;Newton solver did not converge in &quot;</span> &lt;&lt; <a class="code" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a20ac8568daf0d63afa3945a817ff3e2d">Max_iter</a></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; steps &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        error_stream.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div>
<div class="ttc" id="aAnnoyingScalar_8h_html_abe7b2405f1f05f9997193c680e8e2fe0"><div class="ttname"><a href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a></div><div class="ttdeci">AnnoyingScalar sqrt(const AnnoyingScalar &amp;x)</div><div class="ttdef"><b>Definition:</b> AnnoyingScalar.h:134</div></div>
<div class="ttc" id="aBiCGSTAB__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aclassoomph_1_1OomphInfo_html_abcbb5e3dba35ab95c67f543931374d13"><div class="ttname"><a href="../../d5/d63/classoomph_1_1OomphInfo.html#abcbb5e3dba35ab95c67f543931374d13">oomph::OomphInfo::stream_pt</a></div><div class="ttdeci">std::ostream *&amp; stream_pt()</div><div class="ttdoc">Access function for the stream pointer.</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:464</div></div>
<div class="ttc" id="adatatypes_8h_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>Definition:</b> datatypes.h:23</div></div>
<div class="ttc" id="anamespaceParticles2023AnalysisHung_html_acd7b1f7c12cabe6d39f47a4f92e58fd8"><div class="ttname"><a href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">Particles2023AnalysisHung.params</a></div><div class="ttdeci">dictionary params</div><div class="ttdef"><b>Definition:</b> Particles2023AnalysisHung.py:35</div></div>
<div class="ttc" id="anamespaceboost_1_1multiprecision_html_ab6f80ccf8e1d88df8a8e3acd039d63eb"><div class="ttname"><a href="../../d2/d0c/namespaceboost_1_1multiprecision.html#ab6f80ccf8e1d88df8a8e3acd039d63eb">boost::multiprecision::fabs</a></div><div class="ttdeci">Real fabs(const Real &amp;a)</div><div class="ttdef"><b>Definition:</b> boostmultiprec.cpp:117</div></div>
<div class="ttc" id="anamespaceoomph_1_1BlackBoxFDNewtonSolver_html_a20ac8568daf0d63afa3945a817ff3e2d"><div class="ttname"><a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a20ac8568daf0d63afa3945a817ff3e2d">oomph::BlackBoxFDNewtonSolver::Max_iter</a></div><div class="ttdeci">unsigned Max_iter</div><div class="ttdoc">Max. # of Newton iterations.</div><div class="ttdef"><b>Definition:</b> black_box_newton_solver.cc:44</div></div>
<div class="ttc" id="anamespaceoomph_1_1BlackBoxFDNewtonSolver_html_a3067ba88fad991fdb619eae7533028bd"><div class="ttname"><a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a3067ba88fad991fdb619eae7533028bd">oomph::BlackBoxFDNewtonSolver::N_iter_taken</a></div><div class="ttdeci">unsigned N_iter_taken</div><div class="ttdoc">Number of Newton iterations taken in most recent invocation.</div><div class="ttdef"><b>Definition:</b> black_box_newton_solver.cc:47</div></div>
<div class="ttc" id="anamespaceoomph_1_1BlackBoxFDNewtonSolver_html_a4a1361a9b08163b59fe82b3042b0f887"><div class="ttname"><a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4a1361a9b08163b59fe82b3042b0f887">oomph::BlackBoxFDNewtonSolver::line_search</a></div><div class="ttdeci">void line_search(const Vector&lt; double &gt; &amp;x_old, const double half_residual_squared_old, const Vector&lt; double &gt; &amp;gradient, ResidualFctPt residual_fct, const Vector&lt; double &gt; &amp;params, Vector&lt; double &gt; &amp;newton_dir, Vector&lt; double &gt; &amp;x, double &amp;half_residual_squared, const double &amp;stpmax)</div><div class="ttdoc">Line search helper for globally convergent Newton method.</div><div class="ttdef"><b>Definition:</b> black_box_newton_solver.cc:233</div></div>
<div class="ttc" id="anamespaceoomph_1_1BlackBoxFDNewtonSolver_html_a4bacc59c8e1194e553f698530e9e945e"><div class="ttname"><a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4bacc59c8e1194e553f698530e9e945e">oomph::BlackBoxFDNewtonSolver::Tol</a></div><div class="ttdeci">double Tol</div><div class="ttdoc">Tolerance.</div><div class="ttdef"><b>Definition:</b> black_box_newton_solver.cc:57</div></div>
<div class="ttc" id="anamespaceoomph_1_1BlackBoxFDNewtonSolver_html_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf"><div class="ttname"><a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6f0d2ceb4451e66bb7ef4ab4fdb62bcf">oomph::BlackBoxFDNewtonSolver::FD_step</a></div><div class="ttdeci">double FD_step</div><div class="ttdoc">FD step.</div><div class="ttdef"><b>Definition:</b> black_box_newton_solver.cc:54</div></div>
<div class="ttc" id="anamespaceoomph_1_1BlackBoxFDNewtonSolver_html_ac2603699f47446716ca5a818f46a7f17"><div class="ttname"><a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ac2603699f47446716ca5a818f46a7f17">oomph::BlackBoxFDNewtonSolver::Doc_Progress</a></div><div class="ttdeci">bool Doc_Progress</div><div class="ttdef"><b>Definition:</b> black_box_newton_solver.cc:51</div></div>
<div class="ttc" id="anamespaceoomph_1_1BlackBoxFDNewtonSolver_html_afd90cb451fb7ae5a8e30cab0a1884568"><div class="ttname"><a href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#afd90cb451fb7ae5a8e30cab0a1884568">oomph::BlackBoxFDNewtonSolver::Use_step_length_control</a></div><div class="ttdeci">bool Use_step_length_control</div><div class="ttdoc">Use steplength control do make globally convergent (default false)</div><div class="ttdef"><b>Definition:</b> black_box_newton_solver.cc:60</div></div>
<div class="ttc" id="anamespaceoomph_html_aec474227917784dc0a255faf289cfc16"><div class="ttname"><a href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph::oomph_info</a></div><div class="ttdeci">OomphInfo oomph_info</div><div class="ttdef"><b>Definition:</b> oomph_definitions.cc:319</div></div>
<div class="ttc" id="aoomph__definitions_8h_html_a25c6813cc7341d125e2502f8923fb6c4"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a></div><div class="ttdeci">#define OOMPH_EXCEPTION_LOCATION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:61</div></div>
<div class="ttc" id="aoomph__definitions_8h_html_aa260cc4af589e30cea7fde997ae16667"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a></div><div class="ttdeci">#define OOMPH_CURRENT_FUNCTION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:86</div></div>
<div class="ttc" id="atut__arithmetic__redux__minmax_8cpp_html_a39513f0f8d942bf9ef17b2e87ac6d34e"><div class="ttname"><a href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a></div><div class="ttdeci">std::ptrdiff_t j</div><div class="ttdef"><b>Definition:</b> tut_arithmetic_redux_minmax.cpp:2</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ac2603699f47446716ca5a818f46a7f17">Doc_Progress</a>, <a class="el" href="../../d2/d0c/namespaceboost_1_1multiprecision.html#ab6f80ccf8e1d88df8a8e3acd039d63eb">boost::multiprecision::fabs()</a>, <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a6f0d2ceb4451e66bb7ef4ab4fdb62bcf">FD_step</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4a1361a9b08163b59fe82b3042b0f887">line_search()</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a20ac8568daf0d63afa3945a817ff3e2d">Max_iter</a>, <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a3067ba88fad991fdb619eae7533028bd">N_iter_taken</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph::oomph_info</a>, <a class="el" href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">Particles2023AnalysisHung::params</a>, <a class="el" href="../../dc/df5/classoomph_1_1DoubleMatrixBase.html#a4d445c4a1204da569f40ec1bdace9ef3">oomph::DoubleMatrixBase::solve()</a>, <a class="el" href="../../d6/d74/classoomph_1_1Matrix.html#a4f97fa3c94e6fd664e46acb8873a80f8">oomph::Matrix&lt; T, MATRIX_TYPE &gt;::sparse_indexed_output()</a>, <a class="el" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt()</a>, <a class="el" href="../../d5/d63/classoomph_1_1OomphInfo.html#abcbb5e3dba35ab95c67f543931374d13">oomph::OomphInfo::stream_pt()</a>, <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#a4bacc59c8e1194e553f698530e9e945e">Tol</a>, and <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#afd90cb451fb7ae5a8e30cab0a1884568">Use_step_length_control</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d82/classAxisymOscillatingDisk.html#a7671a9c1b8d4d854752ea14aa4f5865d">AxisymOscillatingDisk::AxisymOscillatingDisk()</a>, <a class="el" href="../../d5/d34/namespaceoomph_1_1SarahBL.html#aa198aa1de07bb9a2eac422ed63010bc4">oomph::SarahBL::exact_soln()</a>, <a class="el" href="../../db/de7/namespaceSarahBL.html#aedee0a3a4761e47e3f4ac83433c7b230">SarahBL::exact_soln()</a>, <a class="el" href="../../d5/d34/namespaceoomph_1_1SarahBL.html#a80c7c03073f6436ace00d2b2c5bfa501">oomph::SarahBL::full_exact_soln()</a>, <a class="el" href="../../db/de7/namespaceSarahBL.html#a2baa5d96850a8cf3ae308881552ed876">SarahBL::full_exact_soln()</a>, and <a class="el" href="../../dd/dbd/spring__contact_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a>.</p>

</div>
</div>
<a id="a4a1361a9b08163b59fe82b3042b0f887"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a1361a9b08163b59fe82b3042b0f887">&#9670;&nbsp;</a></span>line_search()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oomph::BlackBoxFDNewtonSolver::line_search </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>x_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/de6/classdouble.html">double</a>&#160;</td>
          <td class="paramname"><em>half_residual_squared_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>gradient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae43745d4b8933505d52d50820c5ed5bf">ResidualFctPt</a>&#160;</td>
          <td class="paramname"><em>residual_fct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>newton_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../df/de6/classdouble.html">double</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/de6/classdouble.html">double</a> &amp;&#160;</td>
          <td class="paramname"><em>half_residual_squared</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/de6/classdouble.html">double</a> &amp;&#160;</td>
          <td class="paramname"><em>stpmax</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Line search helper for globally convergent Newton method. </p>
<div class="fragment"><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> min_fct_decrease = 1.0e-4;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordtype">double</span> convergence_tol_on_x = 1.0e-16;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordtype">double</span> f_aux = 0.0;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordtype">double</span> lambda_aux = 0.0;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordtype">double</span> proposed_lambda = 0.0;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = x_old.size();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordtype">double</span> sum = 0.0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        sum += newton_dir[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * newton_dir[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      sum = <a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(sum);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">if</span> (sum &gt; stpmax)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          newton_dir[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] *= stpmax / sum;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordtype">double</span> slope = 0.0;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        slope += gradient[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * newton_dir[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keywordflow">if</span> (slope &gt;= 0.0)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        std::ostringstream error_stream;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        error_stream &lt;&lt; <span class="stringliteral">&quot;Roundoff problem in lnsrch: slope=&quot;</span> &lt;&lt; slope &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          error_stream.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../df/d04/namespacetest.html">test</a> = 0.0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordtype">double</span> temp =</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          <a class="code" href="../../d2/d0c/namespaceboost_1_1multiprecision.html#ab6f80ccf8e1d88df8a8e3acd039d63eb">std::fabs</a>(newton_dir[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]) / <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(<a class="code" href="../../d2/d0c/namespaceboost_1_1multiprecision.html#ab6f80ccf8e1d88df8a8e3acd039d63eb">std::fabs</a>(x_old[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]), 1.0);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">if</span> (temp &gt; <a class="code" href="../../df/d04/namespacetest.html">test</a>) <a class="code" href="../../df/d04/namespacetest.html">test</a> = temp;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordtype">double</span> lambda_min = convergence_tol_on_x / <a class="code" href="../../d1/d62/namespaceEigen.html#ab92f68c35918b3afc48e0056a81ac1b3">test</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> = 1.0;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = x_old[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] + <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> * newton_dir[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="comment">// Evaluate current residuals</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        Vector&lt;double&gt; residuals(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        residual_fct(<a class="code" href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">params</a>, <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>, residuals);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        half_residual_squared = 0.0;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          half_residual_squared += residuals[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * residuals[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        half_residual_squared *= 0.5;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> &lt; lambda_min)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = x_old[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          <span class="comment">// Create an Oomph Lib warning</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          OomphLibWarning(<span class="stringliteral">&quot;Warning: Line search converged on x only!&quot;</span>,</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                          <span class="stringliteral">&quot;BlackBoxFDNewtonSolver::line_search()&quot;</span>,</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                          <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (half_residual_squared &lt;=</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                 half_residual_squared_old + min_fct_decrease * <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> * slope)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> == 1.0)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            proposed_lambda =</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;              -slope / (2.0 * (half_residual_squared -</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                               half_residual_squared_old - slope));</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;          {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordtype">double</span> r1 = half_residual_squared - half_residual_squared_old -</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                        <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> * slope;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordtype">double</span> r2 = f_aux - half_residual_squared_old - lambda_aux * slope;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordtype">double</span> a_poly =</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;              (r1 / (<a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> * <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>) - r2 / (lambda_aux * lambda_aux)) /</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;              (<a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> - lambda_aux);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordtype">double</span> b_poly = (-lambda_aux * r1 / (<a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> * <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>) +</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                             <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> * r2 / (lambda_aux * lambda_aux)) /</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                            (<a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> - lambda_aux);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">if</span> (a_poly == 0.0)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;              proposed_lambda = -slope / (2.0 * b_poly);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;              <span class="keywordtype">double</span> discriminant = b_poly * b_poly - 3.0 * a_poly * slope;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;              <span class="keywordflow">if</span> (discriminant &lt; 0.0)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;              {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                proposed_lambda = 0.5 * <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;              }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b_poly &lt;= 0.0)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;              {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                proposed_lambda =</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                  (-b_poly + <a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(discriminant)) / (3.0 * a_poly);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;              }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;              {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                proposed_lambda = -slope / (b_poly + <a class="code" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt</a>(discriminant));</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;              }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">if</span> (proposed_lambda &gt; 0.5 * <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;              proposed_lambda = 0.5 * <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        lambda_aux = <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        f_aux = half_residual_squared;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a> = <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(proposed_lambda, 0.1 * <a class="code" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    }</div>
<div class="ttc" id="aCG3DPackingUnitTest_8cpp_html_a7026fd16370249ce97cb3d062326baf9"><div class="ttname"><a href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a></div><div class="ttdeci">const unsigned n</div><div class="ttdef"><b>Definition:</b> CG3DPackingUnitTest.cpp:11</div></div>
<div class="ttc" id="aComplexEigenSolver__compute_8cpp_html_a8a21c18d4aa23228bc1b89f9b12182be"><div class="ttname"><a href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a></div><div class="ttdeci">cout&lt;&lt; &quot;The eigenvalues of A are:&quot;&lt;&lt; endl&lt;&lt; ces.eigenvalues()&lt;&lt; endl;cout&lt;&lt; &quot;The matrix of eigenvectors, V, is:&quot;&lt;&lt; endl&lt;&lt; ces.eigenvectors()&lt;&lt; endl&lt;&lt; endl;complex&lt; float &gt; lambda</div><div class="ttdef"><b>Definition:</b> ComplexEigenSolver_compute.cpp:9</div></div>
<div class="ttc" id="anamespaceEigen_html_ab92f68c35918b3afc48e0056a81ac1b3"><div class="ttname"><a href="../../d1/d62/namespaceEigen.html#ab92f68c35918b3afc48e0056a81ac1b3">Eigen::test</a></div><div class="ttdeci">squared absolute sa ArrayBase::abs2 DOXCOMMA MatrixBase::cwiseAbs2 sa Eigen::abs2 DOXCOMMA Eigen::pow DOXCOMMA ArrayBase::square nearest sa Eigen::floor DOXCOMMA Eigen::ceil DOXCOMMA ArrayBase::round nearest integer not less than the given sa Eigen::floor DOXCOMMA ArrayBase::ceil not a number test</div><div class="ttdef"><b>Definition:</b> GlobalFunctions.h:109</div></div>
<div class="ttc" id="anamespaceplotDoE_html_a4758fc6194247f040938f29c863d21ee"><div class="ttname"><a href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE.x</a></div><div class="ttdeci">list x</div><div class="ttdef"><b>Definition:</b> plotDoE.py:28</div></div>
<div class="ttc" id="anamespacetest_html"><div class="ttname"><a href="../../df/d04/namespacetest.html">test</a></div><div class="ttdef"><b>Definition:</b> indexed_view.cpp:20</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d2/d0c/namespaceboost_1_1multiprecision.html#ab6f80ccf8e1d88df8a8e3acd039d63eb">boost::multiprecision::fabs()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../d6/d41/ComplexEigenSolver__compute_8cpp.html#a8a21c18d4aa23228bc1b89f9b12182be">lambda</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../df/d76/namespaceParticles2023AnalysisHung.html#acd7b1f7c12cabe6d39f47a4f92e58fd8">Particles2023AnalysisHung::params</a>, <a class="el" href="../../d8/de9/AnnoyingScalar_8h.html#abe7b2405f1f05f9997193c680e8e2fe0">sqrt()</a>, <a class="el" href="../../d1/d62/namespaceEigen.html#ab92f68c35918b3afc48e0056a81ac1b3">Eigen::test</a>, and <a class="el" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ac2603699f47446716ca5a818f46a7f17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2603699f47446716ca5a818f46a7f17">&#9670;&nbsp;</a></span>Doc_Progress</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> oomph::BlackBoxFDNewtonSolver::Doc_Progress = false</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flag to indicate if progress of Newton iteration is to be documented (defaults to false) </p>

<p class="reference">Referenced by <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve()</a>, and <a class="el" href="../../dd/dbd/spring__contact_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a>.</p>

</div>
</div>
<a id="a6f0d2ceb4451e66bb7ef4ab4fdb62bcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f0d2ceb4451e66bb7ef4ab4fdb62bcf">&#9670;&nbsp;</a></span>FD_step</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/de6/classdouble.html">double</a> oomph::BlackBoxFDNewtonSolver::FD_step = 1.0e-8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FD step. </p>

<p class="reference">Referenced by <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve()</a>, <a class="el" href="../../dc/de5/classoomph_1_1Problem.html#adc456017cfc4fb4ae6f522973e50f496">oomph::Problem::get_derivative_wrt_global_parameter()</a>, <a class="el" href="../../dc/de5/classoomph_1_1Problem.html#a9f3d1c9378e385d7755184a97f5f6f91">oomph::Problem::get_fd_jacobian()</a>, <a class="el" href="../../dc/de5/classoomph_1_1Problem.html#a497518acb5d30a28a253890c3d2a5da2">oomph::Problem::get_hessian_vector_products()</a>, <a class="el" href="../../d4/dcb/classoomph_1_1FoldHandler.html#ad1bec54a2e0c5bd483ff0bf633bd6542">oomph::FoldHandler::get_jacobian()</a>, <a class="el" href="../../d1/d08/classoomph_1_1PitchForkHandler.html#aa6728813a099111bee2b6c79dec20fc4">oomph::PitchForkHandler::get_jacobian()</a>, <a class="el" href="../../d4/da2/classoomph_1_1HopfHandler.html#ab36c50421f53accced01dd9e04d904ef">oomph::HopfHandler::get_jacobian()</a>, <a class="el" href="../../dd/d4b/classoomph_1_1AugmentedBlockFoldLinearSolver.html#a7728fc74802b6802ed966765bc1e62d9">oomph::AugmentedBlockFoldLinearSolver::resolve()</a>, <a class="el" href="../../de/d72/classoomph_1_1AugmentedBlockPitchForkLinearSolver.html#a1d617896a3f1c1b1236ff18dc87ed8d7">oomph::AugmentedBlockPitchForkLinearSolver::resolve()</a>, <a class="el" href="../../dd/d4b/classoomph_1_1AugmentedBlockFoldLinearSolver.html#a11690b33089e999d0c894b4e4b0646d9">oomph::AugmentedBlockFoldLinearSolver::solve()</a>, <a class="el" href="../../de/d72/classoomph_1_1AugmentedBlockPitchForkLinearSolver.html#a0cbeb150ac83d5be1a1e30c0f728a70b">oomph::AugmentedBlockPitchForkLinearSolver::solve()</a>, <a class="el" href="../../df/dbd/classoomph_1_1BlockHopfLinearSolver.html#a5e9ff24466ec138cca8264e5befc31fe">oomph::BlockHopfLinearSolver::solve()</a>, and <a class="el" href="../../df/dbd/classoomph_1_1BlockHopfLinearSolver.html#a9a7cc6bda9ab1a8baf83d5d8e1fe5eea">oomph::BlockHopfLinearSolver::solve_for_two_rhs()</a>.</p>

</div>
</div>
<a id="a20ac8568daf0d63afa3945a817ff3e2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20ac8568daf0d63afa3945a817ff3e2d">&#9670;&nbsp;</a></span>Max_iter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> oomph::BlackBoxFDNewtonSolver::Max_iter = 20</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Max. # of Newton iterations. </p>

<p class="reference">Referenced by <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve()</a>, <a class="el" href="../../df/daa/classoomph_1_1ComplexDampedJacobi.html#a09214dc600fe5d261bdb3795aa943aac">oomph::ComplexDampedJacobi&lt; MATRIX &gt;::complex_solve_helper()</a>, <a class="el" href="../../df/d25/classoomph_1_1ComplexGMRES.html#a848721022a08fde4b2182a143f287ded">oomph::ComplexGMRES&lt; MATRIX &gt;::complex_solve_helper()</a>, <a class="el" href="../../dd/dbd/spring__contact_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a>, <a class="el" href="../../d9/d4b/classoomph_1_1CG.html#af1851e5a56bae04eda6afef9d0a16364">oomph::CG&lt; MATRIX &gt;::solve_helper()</a>, <a class="el" href="../../d7/dfa/classoomph_1_1BiCGStab.html#a6e6e49eb139bbc2aedfcb6cd075de3db">oomph::BiCGStab&lt; MATRIX &gt;::solve_helper()</a>, <a class="el" href="../../d3/d90/classoomph_1_1GS.html#a727ae9502ba5cd458358b5c50a57437e">oomph::GS&lt; MATRIX &gt;::solve_helper()</a>, <a class="el" href="../../d7/d2e/classoomph_1_1DampedJacobi.html#a8293439927a99030a1508f268be8a876">oomph::DampedJacobi&lt; MATRIX &gt;::solve_helper()</a>, <a class="el" href="../../d5/dee/classoomph_1_1GMRES.html#a29da2c2303b12f3f9fa72423f3daf399">oomph::GMRES&lt; MATRIX &gt;::solve_helper()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a3147aa77b5e71a0822cc5c661dd07e0d">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::solve_helper()</a>, and <a class="el" href="../../df/df9/classoomph_1_1HelmholtzFGMRESMG.html#a8bfd5045cf99bbeaf94b69ede3ccf0ad">oomph::HelmholtzFGMRESMG&lt; MATRIX &gt;::solve_helper()</a>.</p>

</div>
</div>
<a id="a3067ba88fad991fdb619eae7533028bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3067ba88fad991fdb619eae7533028bd">&#9670;&nbsp;</a></span>N_iter_taken</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> oomph::BlackBoxFDNewtonSolver::N_iter_taken = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Number of Newton iterations taken in most recent invocation. </p>

<p class="reference">Referenced by <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve()</a>, and <a class="el" href="../../dd/dbd/spring__contact_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a>.</p>

</div>
</div>
<a id="a4bacc59c8e1194e553f698530e9e945e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bacc59c8e1194e553f698530e9e945e">&#9670;&nbsp;</a></span>Tol</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/de6/classdouble.html">double</a> oomph::BlackBoxFDNewtonSolver::Tol = 1.0e-8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tolerance. </p>

<p class="reference">Referenced by <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve()</a>.</p>

</div>
</div>
<a id="afd90cb451fb7ae5a8e30cab0a1884568"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd90cb451fb7ae5a8e30cab0a1884568">&#9670;&nbsp;</a></span>Use_step_length_control</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> oomph::BlackBoxFDNewtonSolver::Use_step_length_control = false</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use steplength control do make globally convergent (default false) </p>

<p class="reference">Referenced by <a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html#ae132e48f67e6523676abad29b61397ba">black_box_fd_newton_solve()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../da/ddf/namespaceoomph.html">oomph</a></li><li class="navelem"><a class="el" href="../../d5/d65/namespaceoomph_1_1BlackBoxFDNewtonSolver.html">BlackBoxFDNewtonSolver</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:09:39 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
