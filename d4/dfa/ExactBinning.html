<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: Exact Binning: Macroscopic data through precise calculation of overlap volumes between spheres and mesh elements</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d4/dfa/ExactBinning.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Exact Binning: Macroscopic data through precise calculation of overlap volumes between spheres and mesh elements </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Coarse graining, as described on the previous page, has the disadvantage of smoothing out sharp boundaries. A solution to this is to calculate macroscopic quantities through a precise calculation of the overlap volumes between spheres and mesh elements, as described below.</p>
<p>MercuryCG offers this capability through the use of Severin Strobl's overlap library (<a href="https://github.com/severinstrobl/overlap">https://github.com/severinstrobl/overlap</a>), which implements the mathematical details of the precise overlap calculations outlined by Strobl et al. <a class="el" href="../../d0/de3/citelist.html#CITEREF_stroblExactCalculationOverlap2016">[1]</a>. The overlap library is included in Mercury as a submodule and has to be activated by setting the CMake option <code>MercuryDPM_OVERLAP</code> to ON. Note that this option requires the CMake option <code>MercuryDPM_EIGEN</code> to be set to ON aswell, as the overlap library itself depends on the Eigen library for its calculations.</p>
<p>Once compiled correctly, macroscopic quantities based on exact overlap calculations can be selected by choosing the function <code>ExactOverlap</code> and the fields <code>StandardFieldsBinning</code> in MercuryCG. An example command line call could look like this: </p><div class="fragment"><div class="line">./MercuryCG nameOfExecutable -coordinates <a class="code" href="../../d5/d17/StatisticsVector_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfac3906aa83f2e1601606b5297cd4508a2">XYZ</a> -fields StandardFieldsBinning -<span class="keyword">function</span> ExactOverlap -<a class="code" href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">x</a> xmin xmax -z <a class="code" href="../../d8/d58/namespaceGlobal__Parameters.html#ac6a17dbcf1b8f1136a1ec5c07efef708">zmin</a> <a class="code" href="../../d8/d58/namespaceGlobal__Parameters.html#a8ee2afb91b9b105939f19a0efa8e1441">zmax</a> -<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a068041cb6b3b60d76ee64be754bedcbe">y</a> ymin ymax -<a class="code" href="../../da/d25/namespaceMesh__Parameters.html#aa5b5e2ce92e5185299a8a4d4fb45d394">nx</a> 20 -<a class="code" href="../../da/d25/namespaceMesh__Parameters.html#a31a4cc8f1041191f4f1ceb01cacab091">nz</a> 20 -<a class="code" href="../../da/d25/namespaceMesh__Parameters.html#afe97d64daaa8aad85626619c2571c291">ny</a> 20 -o nameOfExecutable.exact.stat</div>
<div class="ttc" id="aStatisticsVector_8h_html_a25418fa818fbb01cd8c0b2c4b0732cdfac3906aa83f2e1601606b5297cd4508a2"><div class="ttname"><a href="../../d5/d17/StatisticsVector_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfac3906aa83f2e1601606b5297cd4508a2">XYZ</a></div><div class="ttdeci">@ XYZ</div><div class="ttdef"><b>Definition:</b> StatisticsVector.h:21</div></div>
<div class="ttc" id="alevel1__cplx__impl_8h_html_a068041cb6b3b60d76ee64be754bedcbe"><div class="ttname"><a href="../../d2/d2e/level1__cplx__impl_8h.html#a068041cb6b3b60d76ee64be754bedcbe">y</a></div><div class="ttdeci">Scalar * y</div><div class="ttdef"><b>Definition:</b> level1_cplx_impl.h:128</div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a8ee2afb91b9b105939f19a0efa8e1441"><div class="ttname"><a href="../../d8/d58/namespaceGlobal__Parameters.html#a8ee2afb91b9b105939f19a0efa8e1441">Global_Parameters::zmax</a></div><div class="ttdeci">double zmax</div><div class="ttdef"><b>Definition:</b> time_harmonic_fourier_decomposed_linear_elasticity/cylinder/cylinder.cc:71</div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_ac6a17dbcf1b8f1136a1ec5c07efef708"><div class="ttname"><a href="../../d8/d58/namespaceGlobal__Parameters.html#ac6a17dbcf1b8f1136a1ec5c07efef708">Global_Parameters::zmin</a></div><div class="ttdeci">double zmin</div><div class="ttdef"><b>Definition:</b> time_harmonic_fourier_decomposed_linear_elasticity/cylinder/cylinder.cc:69</div></div>
<div class="ttc" id="anamespaceMesh__Parameters_html_a31a4cc8f1041191f4f1ceb01cacab091"><div class="ttname"><a href="../../da/d25/namespaceMesh__Parameters.html#a31a4cc8f1041191f4f1ceb01cacab091">Mesh_Parameters::nz</a></div><div class="ttdeci">const unsigned nz</div><div class="ttdef"><b>Definition:</b> ConstraintElementsUnitTest.cpp:32</div></div>
<div class="ttc" id="anamespaceMesh__Parameters_html_aa5b5e2ce92e5185299a8a4d4fb45d394"><div class="ttname"><a href="../../da/d25/namespaceMesh__Parameters.html#aa5b5e2ce92e5185299a8a4d4fb45d394">Mesh_Parameters::nx</a></div><div class="ttdeci">const unsigned nx</div><div class="ttdef"><b>Definition:</b> ConstraintElementsUnitTest.cpp:30</div></div>
<div class="ttc" id="anamespaceMesh__Parameters_html_afe97d64daaa8aad85626619c2571c291"><div class="ttname"><a href="../../da/d25/namespaceMesh__Parameters.html#afe97d64daaa8aad85626619c2571c291">Mesh_Parameters::ny</a></div><div class="ttdeci">const unsigned ny</div><div class="ttdef"><b>Definition:</b> ConstraintElementsUnitTest.cpp:31</div></div>
<div class="ttc" id="anamespaceplotDoE_html_a4758fc6194247f040938f29c863d21ee"><div class="ttname"><a href="../../db/d46/namespaceplotDoE.html#a4758fc6194247f040938f29c863d21ee">plotDoE.x</a></div><div class="ttdeci">list x</div><div class="ttdef"><b>Definition:</b> plotDoE.py:28</div></div>
</div><!-- fragment --><p> More information on the syntax of MercuryCG's command line interface can be found in MercuryCG's documentation.</p>
<h1><a class="anchor" id="gridCellDef"></a>
Definition of grid cells</h1>
<p>The binning process utilizes a grid of cubic cells. Given the minimum and maximum coordinates \((\mathbf{r}_\text{min} = (x_\text{min},\, y_\text{min},\, z_\text{min})^\text{T})\) and \((\mathbf{r}_\text{max} = (x_\text{max},\, y_\text{max},\, z_\text{max})^\text{T})\) of the considered space, along with the number of grid cells \((\mathbf{n} = (n_x,\, n_y,\, n_z)^\text{T})\), the vector \((\mathbf{d})\) representing the side lengths of the cubic cells in each dimension is determined as </p><p class="formulaDsp">
\[ \mathbf{d} = \left(\frac{x_\text{max} - x_\text{min}}{n_x}, \frac{y_\text{max} - y_\text{min}}{n_y}, \frac{z_\text{max} - z_\text{min}}{n_z}\right)^\text{T}. \]
</p>
<p> The center of each grid cell is calculated by </p><p class="formulaDsp">
\[ \mathbf{r}_{ijk} = \mathbf{r}_\text{min} + \begin{bmatrix} (i + 0.5)d_x \\ (j + 0.5)d_y \\ (k + 0.5)d_z \end{bmatrix}, \]
</p>
<p> where (d_x), (d_y), and (d_z) are the components of (\mathbf{d}), ensuring that the cells do not overlap and the space is fully covered by the grid. Here, the indices (i), (j), and (k) range from (0) to (n_x - 1), (0) to (n_y - 1), and (0) to (n_z - 1), respectively.</p>
<h1><a class="anchor" id="particleCenteredQuantities"></a>
Calculation of Particle-Centered Quantities</h1>
<p>Given a mesh element or grid cell \(c\) of volume \(V_c\), the exact density \(j_c^q\) of a macroscopic quantity \(q_c\) within the space of the selected grid cell is calculated as </p><p class="formulaDsp">
\[ j_c^q = \sum_{i=1}^{N} \frac{V_{c\cap i}}{V_cV_i} q_i. \]
</p>
<p> Here, \(N\) is the number of particles in the simulation, \(q_i\) is the quantity of interest of particle \(i\), \(V_i\) is its volume \(i\), and \(V_{c \cap i}\) is the volume of the intersection of particle \(i\) with cell \(c\).</p>
<p>Figure 1 illustrates the intersection of one particle with a grid cell. The cell is colored in dark grey (its area corresponds to \(V_c\) in 3D); the particle is colored in light grey (its area corresponds to \(V_\text{i}\) in 3D). Their overlapping area is indicated by the hatched pattern (corresponding to \(V_{c\cap i}\) in 3D). </p><div class="image">
<object type="image/svg+xml" data="../../gridExactOverlap.svg" width="500px" style="pointer-events: none;"></object>
<div class="caption">
Figure 1: Twodimensional sketch of a particle in a grid</div></div>
<h2><a class="anchor" id="velocityCalculation"></a>
Momentum and Velocity</h2>
<p>Given this method, the momentum density \(j_c^p\) is calculated as </p><p class="formulaDsp">
\[ \mathbf{j}_c^p = \sum_{i=1}^{N} \frac{V_{c\cap i}}{V_cV_i} m_i \mathbf{v}_i, \]
</p>
<p> where \(m_i\) is the mass and \(\mathbf{v}_i\) is the velocity of particle \(i\).</p>
<p>Thus, the velocity \(\mathbf{v}_c\) of cell \(c\) is calculated as </p><p class="formulaDsp">
\[ \mathbf{v}_c = \frac{\mathbf{j}_c^p}{\rho_c}, \]
</p>
<p> where </p><p class="formulaDsp">
\[ \rho_c = \sum_{i=1}^{N} \frac{V_{c\cap i}}{V_cV_i} m_i \]
</p>
<p> is the mass density of cell \(c\).</p>
<h1><a class="anchor" id="interactionCenteredQuantities"></a>
Calculation of Interaction Properties</h1>
<p>Using the exact binning method, interaction properties are also evaluated in a particle-centered way. For example, the contact force density \(\mathbf{j}_c^f\) is calculated as </p><p class="formulaDsp">
\[ \mathbf{j}_c^f = \sum_{i=1}^{N} \frac{V_{c\cap i}}{V_cV_i} \sum_{j} \mathbf{f}_{ij}, \]
</p>
<p> where the second sum runs over all particles \(j\) interacting with particle \(i\) and \(\mathbf{f}_{ij}\) is the contact force acting on particle \(i\).</p>
<p>In a similar fashion, the contact stress density is calculated as </p><p class="formulaDsp">
\[ \mathbf{\sigma}_{c} = \sum_{i=1}^{N} \frac{V_{c\cap i}}{V_cV_i} \sum_{j} \mathbf{f}_{ij} \otimes \mathbf{l}_{ij}, \]
</p>
<p> where \(\mathbf{l}_{ij}\) is the branch vector pointing from the center of particle \(i\) to the contact point with particle \(j\). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">MercuryDPM Reference Manual</a></li><li class="navelem"><a class="el" href="../../d9/d5c/MercuryDPM_CG.html">Coarse graining: From discrete particles to continuum fields</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:05:12 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
