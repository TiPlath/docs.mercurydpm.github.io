<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MercuryDPM: oomph::BlockPreconditioner&lt; MATRIX &gt; Class Template Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../MDPM.css" rel="stylesheet" type="text/css"/>
<link href="../../codeLabels.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-fork-corner.css" rel="stylesheet" type="text/css"/>
<link href="../../MDPM-dropdown-version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../MDPM-fragment-copy-button.js"></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../MDPM-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="../../MDPM-interactive-toc.js"></script>
<script type="text/javascript">
DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../MDPM-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
  <div id="bitbucket-corner">
   <a href="https://bitbucket.org/mercurydpm/mercurydpm/src/master/" target="_blank" id="fork-corner" class="fork-corner fc-pos-tr fc-animate fc-theme-bitbucket"></a>
  </div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../mercury-logo-chosen-light-slogan.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> <!--MercuryDPM--!>
   <!-- BEGIN version select -->
   <div class="dropdown" id="projectnumber">
    <button class="dropbtn">v1.0</button>
    <div class="dropdown-content">
    </div>
   </div>
   <script type="text/javascript" src="../../MDPM-dropdown-version.js"></script>
<!-- END version select -->
   <!--&#160;<span id="projectnumber">revision: v1.0</span>-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script type="text/javascript" src="../../MDPM-fork-corner.js"></script>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dd/d57/classoomph_1_1BlockPreconditioner.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="../../db/d71/classoomph_1_1BlockPreconditioner-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">oomph::BlockPreconditioner&lt; MATRIX &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../da/d34/block__preconditioner_8h_source.html">block_preconditioner.h</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Inheritance diagram for oomph::BlockPreconditioner&lt; MATRIX &gt;:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
 <div class="center">
  <img src="../../dd/d57/classoomph_1_1BlockPreconditioner.png" usemap="#oomph::BlockPreconditioner_3C_20MATRIX_20_3E_map" alt=""/>
  <map id="oomph::BlockPreconditioner_3C_20MATRIX_20_3E_map" name="oomph::BlockPreconditioner_3C_20MATRIX_20_3E_map">
<area href="../../db/d9e/classoomph_1_1Preconditioner.html" alt="oomph::Preconditioner" shape="rect" coords="0,56,437,80"/>
<area href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html" alt="oomph::DistributableLinearAlgebraObject" shape="rect" coords="0,0,437,24"/>
<area href="../../d5/d9e/classSimpleFSIPreconditioner.html" alt="SimpleFSIPreconditioner&lt; MATRIX &gt;" shape="rect" coords="447,168,884,192"/>
<area href="../../dc/d0b/classoomph_1_1CoarseTwoIntoOne.html" alt="oomph::CoarseTwoIntoOne&lt; MATRIX &gt;" shape="rect" coords="447,224,884,248"/>
<area href="../../d7/d0c/classoomph_1_1CoarseTwoPlusTwoPlusOne.html" alt="oomph::CoarseTwoPlusTwoPlusOne&lt; MATRIX &gt;" shape="rect" coords="447,280,884,304"/>
<area href="../../d0/df4/classoomph_1_1Diagonal.html" alt="oomph::Diagonal&lt; MATRIX &gt;" shape="rect" coords="447,336,884,360"/>
<area href="../../d5/d31/classoomph_1_1GeneralPurposeBlockPreconditioner.html" alt="oomph::GeneralPurposeBlockPreconditioner&lt; MATRIX &gt;" shape="rect" coords="447,392,884,416"/>
<area href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html" title="The GMRES method for the Helmholtz solver." alt="oomph::HelmholtzGMRESMG&lt; MATRIX &gt;" shape="rect" coords="447,448,884,472"/>
<area href="../../dd/dfa/classoomph_1_1NavierStokesExactPreconditioner.html" alt="oomph::NavierStokesExactPreconditioner&lt; MATRIX &gt;" shape="rect" coords="447,504,884,528"/>
<area href="../../dd/ded/classoomph_1_1OnePlusFourWithTwoCoarse.html" alt="oomph::OnePlusFourWithTwoCoarse&lt; MATRIX &gt;" shape="rect" coords="447,560,884,584"/>
<area href="../../de/d98/classoomph_1_1PressureBasedSolidExactPreconditioner.html" alt="oomph::PressureBasedSolidExactPreconditioner&lt; MATRIX &gt;" shape="rect" coords="447,616,884,640"/>
<area href="../../d2/d5b/classoomph_1_1SimpleBlockDiagonalPreconditioner.html" alt="oomph::SimpleBlockDiagonalPreconditioner&lt; MATRIX &gt;" shape="rect" coords="447,672,884,696"/>
<area href="../../d3/d3a/classoomph_1_1SimpleFSIPreconditioner.html" alt="oomph::SimpleFSIPreconditioner&lt; MATRIX &gt;" shape="rect" coords="447,728,884,752"/>
<area href="../../d1/d87/classoomph_1_1SimpleOneDofOnly.html" alt="oomph::SimpleOneDofOnly&lt; MATRIX &gt;" shape="rect" coords="447,784,884,808"/>
<area href="../../d8/de2/classoomph_1_1SimpleTwoDofOnly.html" alt="oomph::SimpleTwoDofOnly&lt; MATRIX &gt;" shape="rect" coords="447,840,884,864"/>
<area href="../../df/ddb/classoomph_1_1TwoPlusOneUpperTriangularPreconditioner.html" alt="oomph::TwoPlusOneUpperTriangularPreconditioner&lt; MATRIX &gt;" shape="rect" coords="447,896,884,920"/>
<area href="../../d4/d7a/classoomph_1_1TwoPlusThree.html" alt="oomph::TwoPlusThree&lt; MATRIX &gt;" shape="rect" coords="447,952,884,976"/>
<area href="../../d2/daf/classoomph_1_1TwoPlusThreeUpperTriangular.html" alt="oomph::TwoPlusThreeUpperTriangular&lt; MATRIX &gt;" shape="rect" coords="447,1008,884,1032"/>
<area href="../../d1/d95/classoomph_1_1TwoPlusThreeUpperTriangularWithOneLevelSubsidiary.html" alt="oomph::TwoPlusThreeUpperTriangularWithOneLevelSubsidiary&lt; MATRIX &gt;" shape="rect" coords="447,1064,884,1088"/>
<area href="../../de/de8/classoomph_1_1TwoPlusThreeUpperTriangularWithReplace.html" alt="oomph::TwoPlusThreeUpperTriangularWithReplace&lt; MATRIX &gt;" shape="rect" coords="447,1120,884,1144"/>
<area href="../../df/d0e/classoomph_1_1TwoPlusThreeUpperTriangularWithTwoLevelSubsidiary.html" alt="oomph::TwoPlusThreeUpperTriangularWithTwoLevelSubsidiary&lt; MATRIX &gt;" shape="rect" coords="447,1176,884,1200"/>
<area href="../../db/dbf/classoomph_1_1UpperTriangular.html" alt="oomph::UpperTriangular&lt; MATRIX &gt;" shape="rect" coords="447,1232,884,1256"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a74c4b4bef4371b72816631445689a2e6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">BlockPreconditioner</a> ()</td></tr>
<tr class="memdesc:a74c4b4bef4371b72816631445689a2e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">More...</a><br /></td></tr>
<tr class="separator:a74c4b4bef4371b72816631445689a2e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78c33fc6f29101f027e22d64d158d567"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a78c33fc6f29101f027e22d64d158d567">~BlockPreconditioner</a> ()</td></tr>
<tr class="memdesc:a78c33fc6f29101f027e22d64d158d567"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a78c33fc6f29101f027e22d64d158d567">More...</a><br /></td></tr>
<tr class="separator:a78c33fc6f29101f027e22d64d158d567"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0634f494e1284446512560cb1dc73a32"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0634f494e1284446512560cb1dc73a32">BlockPreconditioner</a> (const <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a> &amp;)=delete</td></tr>
<tr class="memdesc:a0634f494e1284446512560cb1dc73a32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken copy constructor.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0634f494e1284446512560cb1dc73a32">More...</a><br /></td></tr>
<tr class="separator:a0634f494e1284446512560cb1dc73a32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f07557542d4ebeba0e5a2307c7a7d48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8f07557542d4ebeba0e5a2307c7a7d48">operator=</a> (const <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a> &amp;)=delete</td></tr>
<tr class="memdesc:a8f07557542d4ebeba0e5a2307c7a7d48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken assignment operator.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8f07557542d4ebeba0e5a2307c7a7d48">More...</a><br /></td></tr>
<tr class="separator:a8f07557542d4ebeba0e5a2307c7a7d48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9aac48fd53e579e6db8eeed58933a14b"><td class="memItemLeft" align="right" valign="top">MATRIX *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a> () const</td></tr>
<tr class="separator:a9aac48fd53e579e6db8eeed58933a14b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d977a81515458e59b94438a215e93e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0d977a81515458e59b94438a215e93e1">turn_on_recursive_debug_flag</a> ()</td></tr>
<tr class="separator:a0d977a81515458e59b94438a215e93e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ed741a5fbf514fc29f0a332a211255f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8ed741a5fbf514fc29f0a332a211255f">turn_off_recursive_debug_flag</a> ()</td></tr>
<tr class="separator:a8ed741a5fbf514fc29f0a332a211255f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a271bf5ea70579e43797187498d98f9a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a271bf5ea70579e43797187498d98f9a9">turn_on_debug_flag</a> ()</td></tr>
<tr class="memdesc:a271bf5ea70579e43797187498d98f9a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toggles on the debug flag.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a271bf5ea70579e43797187498d98f9a9">More...</a><br /></td></tr>
<tr class="separator:a271bf5ea70579e43797187498d98f9a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46c57c6a2f4b54e27d2aaccc4ec90665"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a46c57c6a2f4b54e27d2aaccc4ec90665">turn_off_debug_flag</a> ()</td></tr>
<tr class="memdesc:a46c57c6a2f4b54e27d2aaccc4ec90665"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toggles off the debug flag.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a46c57c6a2f4b54e27d2aaccc4ec90665">More...</a><br /></td></tr>
<tr class="separator:a46c57c6a2f4b54e27d2aaccc4ec90665"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8e2478caa8370dd12462f17e1cc8082"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab8e2478caa8370dd12462f17e1cc8082">turn_into_subsidiary_block_preconditioner</a> (<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; *master_block_prec_pt, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;doftype_in_master_preconditioner_coarse)</td></tr>
<tr class="separator:ab8e2478caa8370dd12462f17e1cc8082"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d2887082cf856b680b4ae61b510d29"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac0d2887082cf856b680b4ae61b510d29">turn_into_subsidiary_block_preconditioner</a> (<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; *master_block_prec_pt, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;doftype_in_master_preconditioner_coarse, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&gt; &amp;doftype_coarsen_map_coarse)</td></tr>
<tr class="separator:ac0d2887082cf856b680b4ae61b510d29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af704c4816469cef4fed9d35a9ad651ec"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af704c4816469cef4fed9d35a9ad651ec">block_setup</a> ()</td></tr>
<tr class="separator:af704c4816469cef4fed9d35a9ad651ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b70b51b533002ff33a09013aa084e54"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6b70b51b533002ff33a09013aa084e54">block_setup</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;dof_to_block_map)</td></tr>
<tr class="separator:a6b70b51b533002ff33a09013aa084e54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72b4dbe167da59d9ba12c7eff97d77e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">get_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, MATRIX &amp;output_matrix, const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;ignore_replacement_block=false) const</td></tr>
<tr class="separator:a72b4dbe167da59d9ba12c7eff97d77e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c37f469646c689b5f1e79d0953bd588"><td class="memItemLeft" align="right" valign="top">MATRIX&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4c37f469646c689b5f1e79d0953bd588">get_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;ignore_replacement_block=false) const</td></tr>
<tr class="separator:a4c37f469646c689b5f1e79d0953bd588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a748e2ad8836bc8edf5b9a42373a7ad61"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">set_master_matrix_pt</a> (MATRIX *in_matrix_pt)</td></tr>
<tr class="memdesc:a748e2ad8836bc8edf5b9a42373a7ad61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the matrix_pt in the upper-most master preconditioner.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">More...</a><br /></td></tr>
<tr class="separator:a748e2ad8836bc8edf5b9a42373a7ad61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9dae351352d344321ea82999d7003e17"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9dae351352d344321ea82999d7003e17">get_block_other_matrix</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, MATRIX *in_matrix_pt, MATRIX &amp;output_matrix)</td></tr>
<tr class="separator:a9dae351352d344321ea82999d7003e17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69fa79db7073f39a1ac5333c8bd9c1d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a69fa79db7073f39a1ac5333c8bd9c1d5">get_blocks</a> (<a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html">DenseMatrix</a>&lt; <a class="el" href="../../d9/db9/classbool.html">bool</a> &gt; &amp;required_blocks, <a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html">DenseMatrix</a>&lt; MATRIX * &gt; &amp;block_matrix_pt) const</td></tr>
<tr class="separator:a69fa79db7073f39a1ac5333c8bd9c1d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a314fc14d95f2833be66067cd5b45e093"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a314fc14d95f2833be66067cd5b45e093">get_dof_level_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, MATRIX &amp;output_block, const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;ignore_replacement_block=false) const</td></tr>
<tr class="separator:a314fc14d95f2833be66067cd5b45e093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51636746e5921ee2845daf60b1c322dc"><td class="memItemLeft" align="right" valign="top">MATRIX&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a51636746e5921ee2845daf60b1c322dc">get_concatenated_block</a> (const <a class="el" href="../../d0/dea/classoomph_1_1VectorMatrix.html">VectorMatrix</a>&lt; <a class="el" href="../../dd/da7/classoomph_1_1BlockSelector.html">BlockSelector</a> &gt; &amp;selected_block)</td></tr>
<tr class="separator:a51636746e5921ee2845daf60b1c322dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9321cdab3f506ab95fe51cd9b93deab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af9321cdab3f506ab95fe51cd9b93deab">get_concatenated_block_vector</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_vec_number, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>)</td></tr>
<tr class="separator:af9321cdab3f506ab95fe51cd9b93deab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d5106c0b9dca23aa1cc7f7fd8e696cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6d5106c0b9dca23aa1cc7f7fd8e696cb">return_concatenated_block_vector</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_vec_number, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="memdesc:a6d5106c0b9dca23aa1cc7f7fd8e696cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes concatenated block ordered vector, b, and copies its.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6d5106c0b9dca23aa1cc7f7fd8e696cb">More...</a><br /></td></tr>
<tr class="separator:a6d5106c0b9dca23aa1cc7f7fd8e696cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad356946d5de4f0817cdf8793fa3cdc74"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad356946d5de4f0817cdf8793fa3cdc74">get_block_vectors</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_vec_number, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>) const</td></tr>
<tr class="separator:ad356946d5de4f0817cdf8793fa3cdc74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0517a3678def8b89ae69840345a8f838"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0517a3678def8b89ae69840345a8f838">get_block_vectors</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>) const</td></tr>
<tr class="separator:a0517a3678def8b89ae69840345a8f838"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71d48d8a70151ef0febd4537a2214c53"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a71d48d8a70151ef0febd4537a2214c53">return_block_vectors</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_vec_number, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a71d48d8a70151ef0febd4537a2214c53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a628f3ab6c3c41ccb449da642fb7e1feb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a628f3ab6c3c41ccb449da642fb7e1feb">return_block_vectors</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a628f3ab6c3c41ccb449da642fb7e1feb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7efc9f2f0209764902e4e45fcb2556d1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7efc9f2f0209764902e4e45fcb2556d1">get_block_vector</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/d24/level2__real__impl_8h.html#a1224f27e9a621d957f8124bcade25bed">n</a>, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>) const</td></tr>
<tr class="separator:a7efc9f2f0209764902e4e45fcb2556d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dd4d3cd6b64fa64e1ff6730b0deecc7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1dd4d3cd6b64fa64e1ff6730b0deecc7">return_block_vector</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/d24/level2__real__impl_8h.html#a1224f27e9a621d957f8124bcade25bed">n</a>, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a1dd4d3cd6b64fa64e1ff6730b0deecc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd37323d2b5ba31e2d14f3ce8e6e474d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#afd37323d2b5ba31e2d14f3ce8e6e474d">get_block_ordered_preconditioner_vector</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a080d348cd3ec0d6b60a118c00929effe">w</a>)</td></tr>
<tr class="separator:afd37323d2b5ba31e2d14f3ce8e6e474d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98e920e003f085b02dbb30510fb23a0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a98e920e003f085b02dbb30510fb23a0f">return_block_ordered_preconditioner_vector</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a080d348cd3ec0d6b60a118c00929effe">w</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a98e920e003f085b02dbb30510fb23a0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80808d42be8db74fd58af80b019bf317"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a> () const</td></tr>
<tr class="memdesc:a80808d42be8db74fd58af80b019bf317"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of block types.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">More...</a><br /></td></tr>
<tr class="separator:a80808d42be8db74fd58af80b019bf317"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6cca480686ea8e44244ac60a0db23ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a> () const</td></tr>
<tr class="memdesc:ab6cca480686ea8e44244ac60a0db23ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the total number of DOF types.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">More...</a><br /></td></tr>
<tr class="separator:ab6cca480686ea8e44244ac60a0db23ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c0e92cb77c3e3179007fe9fd99b6428"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>) const</td></tr>
<tr class="separator:a3c0e92cb77c3e3179007fe9fd99b6428"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a193776a271f7c23d20d2102de0ff1cb9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a> () const</td></tr>
<tr class="separator:a193776a271f7c23d20d2102de0ff1cb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a64cfc57ffd16b92ac78499de515138"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">block_number</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;i_dof) const</td></tr>
<tr class="memdesc:a8a64cfc57ffd16b92ac78499de515138"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the block number corresponding to a global index i_dof.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">More...</a><br /></td></tr>
<tr class="separator:a8a64cfc57ffd16b92ac78499de515138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75742d54177935fb22e59d045209b11e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">index_in_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;i_dof) const</td></tr>
<tr class="separator:a75742d54177935fb22e59d045209b11e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77ac0b71404620e7be8b15ac2d588495"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">block_distribution_pt</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>) const</td></tr>
<tr class="memdesc:a77ac0b71404620e7be8b15ac2d588495"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function to the block distributions (const version).  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">More...</a><br /></td></tr>
<tr class="separator:a77ac0b71404620e7be8b15ac2d588495"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace28659098240524c431a41cf419d4ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace28659098240524c431a41cf419d4ba">block_distribution_pt</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>)</td></tr>
<tr class="memdesc:ace28659098240524c431a41cf419d4ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function to the block distributions (non-const version).  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace28659098240524c431a41cf419d4ba">More...</a><br /></td></tr>
<tr class="separator:ace28659098240524c431a41cf419d4ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ee4a9fcf226e8c4438fb25747cb6e93"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">dof_block_distribution_pt</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>)</td></tr>
<tr class="memdesc:a1ee4a9fcf226e8c4438fb25747cb6e93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function to the dof-level block distributions.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">More...</a><br /></td></tr>
<tr class="separator:a1ee4a9fcf226e8c4438fb25747cb6e93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a005d978655022d1a04da7397cf5d0e83"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">master_distribution_pt</a> () const</td></tr>
<tr class="separator:a005d978655022d1a04da7397cf5d0e83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45509677ccef78be13b5e4485312ddc1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">ndof_types_in_mesh</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>) const</td></tr>
<tr class="separator:a45509677ccef78be13b5e4485312ddc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ac4335ec07fc13f7bf1093fd0489c52"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a> () const</td></tr>
<tr class="separator:a9ac4335ec07fc13f7bf1093fd0489c52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a804e1975f170d2ad941b3b7d2dd50407"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a> () const</td></tr>
<tr class="separator:a804e1975f170d2ad941b3b7d2dd50407"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab36e905f7da268328709d62951d64ace"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab36e905f7da268328709d62951d64ace">set_block_output_to_files</a> (const std::string &amp;basefilename)</td></tr>
<tr class="separator:ab36e905f7da268328709d62951d64ace"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45b37f1934144d882831bf354f35d035"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45b37f1934144d882831bf354f35d035">disable_block_output_to_files</a> ()</td></tr>
<tr class="memdesc:a45b37f1934144d882831bf354f35d035"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn off output of blocks (by clearing the basefilename string).  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45b37f1934144d882831bf354f35d035">More...</a><br /></td></tr>
<tr class="separator:a45b37f1934144d882831bf354f35d035"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bd0ab19a7501b79c16c1283766f0abb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0bd0ab19a7501b79c16c1283766f0abb">block_output_on</a> () const</td></tr>
<tr class="memdesc:a0bd0ab19a7501b79c16c1283766f0abb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test if output of blocks is on or not.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0bd0ab19a7501b79c16c1283766f0abb">More...</a><br /></td></tr>
<tr class="separator:a0bd0ab19a7501b79c16c1283766f0abb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adec848504d36ebcd8e27ec60f52f75a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adec848504d36ebcd8e27ec60f52f75a6">output_blocks_to_files</a> (const std::string &amp;basefilename, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;precision=8) const</td></tr>
<tr class="separator:adec848504d36ebcd8e27ec60f52f75a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa760ae71a5aae488547ccf721d412b1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">post_block_matrix_assembly_partial_clear</a> ()</td></tr>
<tr class="separator:aa760ae71a5aae488547ccf721d412b1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab84701c65bdfd8d2c14611176e5e6209"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a> () const</td></tr>
<tr class="memdesc:ab84701c65bdfd8d2c14611176e5e6209"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function to the master block preconditioner pt.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">More...</a><br /></td></tr>
<tr class="separator:ab84701c65bdfd8d2c14611176e5e6209"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7845d9301918e3f5cbecd729ec1e309b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">clear_block_preconditioner_base</a> ()</td></tr>
<tr class="separator:a7845d9301918e3f5cbecd729ec1e309b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a289db176ccafcc3719367fa98340f94d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">document</a> ()</td></tr>
<tr class="separator:a289db176ccafcc3719367fa98340f94d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a39411824a744d4569fe835dec13047"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a39411824a744d4569fe835dec13047">doftype_coarsen_map_fine</a> () const</td></tr>
<tr class="separator:a3a39411824a744d4569fe835dec13047"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a433adda4f658cc7880121bf9ca4293c4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a433adda4f658cc7880121bf9ca4293c4">get_fine_grain_dof_types_in</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>) const</td></tr>
<tr class="separator:a433adda4f658cc7880121bf9ca4293c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50b76a374797805f64e2af34d581cdc2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a50b76a374797805f64e2af34d581cdc2">nfine_grain_dof_types_in</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>) const</td></tr>
<tr class="separator:a50b76a374797805f64e2af34d581cdc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a571824cedc7e458a612111b51f20e5fb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d3a/classoomph_1_1MapMatrix.html">MapMatrix</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">replacement_dof_block_pt</a> () const</td></tr>
<tr class="memdesc:a571824cedc7e458a612111b51f20e5fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function to the replaced dof-level blocks.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">More...</a><br /></td></tr>
<tr class="separator:a571824cedc7e458a612111b51f20e5fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbe1ae854ee9831649249d50162bb6a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adbe1ae854ee9831649249d50162bb6a9">setup_matrix_vector_product</a> (<a class="el" href="../../d1/dac/classoomph_1_1MatrixVectorProduct.html">MatrixVectorProduct</a> *matvec_prod_pt, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> *block_pt, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_col_indices)</td></tr>
<tr class="separator:adbe1ae854ee9831649249d50162bb6a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65059c036724814a0e490716fa6eaf0a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a65059c036724814a0e490716fa6eaf0a">setup_matrix_vector_product</a> (<a class="el" href="../../d1/dac/classoomph_1_1MatrixVectorProduct.html">MatrixVectorProduct</a> *matvec_prod_pt, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> *block_pt, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;block_col_index)</td></tr>
<tr class="separator:a65059c036724814a0e490716fa6eaf0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afba1bef13cebdce65a0a49ff3381269a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#afba1bef13cebdce65a0a49ff3381269a">internal_get_block_ordered_preconditioner_vector</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a080d348cd3ec0d6b60a118c00929effe">w</a>) const</td></tr>
<tr class="separator:afba1bef13cebdce65a0a49ff3381269a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a679a82067056628cc4bbc8bb68d088f2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a679a82067056628cc4bbc8bb68d088f2">internal_return_block_ordered_preconditioner_vector</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a080d348cd3ec0d6b60a118c00929effe">w</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a679a82067056628cc4bbc8bb68d088f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c2b9ed482db072b0cabe5a51eb76efa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a> () const</td></tr>
<tr class="separator:a7c2b9ed482db072b0cabe5a51eb76efa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f3efe468cd6e133d6840ede8c3687b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a> () const</td></tr>
<tr class="separator:a4f3efe468cd6e133d6840ede8c3687b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04e260cc4160a952db2d410109fb2684"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a04e260cc4160a952db2d410109fb2684">internal_return_block_vector</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/d24/level2__real__impl_8h.html#a1224f27e9a621d957f8124bcade25bed">n</a>, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a04e260cc4160a952db2d410109fb2684"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3cf61f61e1aa50e2315e999827e7d59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae3cf61f61e1aa50e2315e999827e7d59">internal_get_block_vector</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/d24/level2__real__impl_8h.html#a1224f27e9a621d957f8124bcade25bed">n</a>, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>) const</td></tr>
<tr class="separator:ae3cf61f61e1aa50e2315e999827e7d59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace6e9dbdfe9a1c3571452e2cd6ec9780"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace6e9dbdfe9a1c3571452e2cd6ec9780">internal_get_block_vectors</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_vec_number, const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>) const</td></tr>
<tr class="separator:ace6e9dbdfe9a1c3571452e2cd6ec9780"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cde8af922cd8054dbf352527dd682b1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0cde8af922cd8054dbf352527dd682b1">internal_get_block_vectors</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>, <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>) const</td></tr>
<tr class="separator:a0cde8af922cd8054dbf352527dd682b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ca7f125e50493073d116ba8da271af5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2ca7f125e50493073d116ba8da271af5">internal_return_block_vectors</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_vec_number, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a2ca7f125e50493073d116ba8da271af5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e2ce77e3efbcdd465f7ad7252936dfd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9e2ce77e3efbcdd465f7ad7252936dfd">internal_return_block_vectors</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;<a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;<a class="el" href="../../df/d7a/MatrixBase__isOrthogonal_8cpp.html#a6ee409cfdca8577a72873ce7105dfce7">v</a>) const</td></tr>
<tr class="separator:a9e2ce77e3efbcdd465f7ad7252936dfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe001ffe270c96e761ec5205364976a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe001ffe270c96e761ec5205364976a7">internal_get_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, MATRIX &amp;output_block) const</td></tr>
<tr class="separator:abe001ffe270c96e761ec5205364976a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3eadb5d8d36200c4738537eac1647a6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;i_dof) const</td></tr>
<tr class="separator:af3eadb5d8d36200c4738537eac1647a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affcfd24c1ba15bf9cac712ffd46dc283"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;i_dof) const</td></tr>
<tr class="separator:affcfd24c1ba15bf9cac712ffd46dc283"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19f8ca9f40ab804262cf95c1d5eb598c"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">internal_block_distribution_pt</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>) const</td></tr>
<tr class="memdesc:a19f8ca9f40ab804262cf95c1d5eb598c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access function to the internal block distributions.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">More...</a><br /></td></tr>
<tr class="separator:a19f8ca9f40ab804262cf95c1d5eb598c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b3c4072be2bf4f0dfdd18f56a5d51bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">insert_auxiliary_block_distribution</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;block_vec_number, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *dist_pt)</td></tr>
<tr class="separator:a9b3c4072be2bf4f0dfdd18f56a5d51bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d8ff67e34e85a71c0f9bb68c0b10496"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4d8ff67e34e85a71c0f9bb68c0b10496">block_matrix_test</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, const MATRIX *block_matrix_pt) const</td></tr>
<tr class="separator:a4d8ff67e34e85a71c0f9bb68c0b10496"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac55e8dea1a0f63fcf32b7b058b0979"><td class="memTemplParams" colspan="2">template&lt;typename myType &gt; </td></tr>
<tr class="memitem:acac55e8dea1a0f63fcf32b7b058b0979"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#acac55e8dea1a0f63fcf32b7b058b0979">get_index_of_value</a> (const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; myType &gt; &amp;vec, const myType val, const <a class="el" href="../../d9/db9/classbool.html">bool</a> sorted=false) const</td></tr>
<tr class="separator:acac55e8dea1a0f63fcf32b7b058b0979"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f714d01cd2fdb791aa0795f34b9610a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f714d01cd2fdb791aa0795f34b9610a">internal_get_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;block_i, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;block_j, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &amp;output_block) const</td></tr>
<tr class="separator:a4f714d01cd2fdb791aa0795f34b9610a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1df550d281ec99914115edfa1a40b982"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1df550d281ec99914115edfa1a40b982">get_dof_level_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;block_i, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;block_j, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &amp;output_block, const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;ignore_replacement_block) const</td></tr>
<tr class="separator:a1df550d281ec99914115edfa1a40b982"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classoomph_1_1Preconditioner"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classoomph_1_1Preconditioner')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html">oomph::Preconditioner</a></td></tr>
<tr class="memitem:a7bd8801e4395ccb88fe1f4296e77e9ab inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a7bd8801e4395ccb88fe1f4296e77e9ab">Preconditioner</a> ()</td></tr>
<tr class="memdesc:a7bd8801e4395ccb88fe1f4296e77e9ab inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#a7bd8801e4395ccb88fe1f4296e77e9ab">More...</a><br /></td></tr>
<tr class="separator:a7bd8801e4395ccb88fe1f4296e77e9ab inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6e58c82c3cc4f4e44434a7d92d8e776 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ab6e58c82c3cc4f4e44434a7d92d8e776">Preconditioner</a> (const <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html">Preconditioner</a> &amp;)=delete</td></tr>
<tr class="memdesc:ab6e58c82c3cc4f4e44434a7d92d8e776 inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken copy constructor.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#ab6e58c82c3cc4f4e44434a7d92d8e776">More...</a><br /></td></tr>
<tr class="separator:ab6e58c82c3cc4f4e44434a7d92d8e776 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63fefcfb21ae1c2a3b4232d2dfbb6340 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a63fefcfb21ae1c2a3b4232d2dfbb6340">operator=</a> (const <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html">Preconditioner</a> &amp;)=delete</td></tr>
<tr class="memdesc:a63fefcfb21ae1c2a3b4232d2dfbb6340 inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken assignment operator.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#a63fefcfb21ae1c2a3b4232d2dfbb6340">More...</a><br /></td></tr>
<tr class="separator:a63fefcfb21ae1c2a3b4232d2dfbb6340 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab60952a82cc1b6b91fff5924eaa62c0e inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ab60952a82cc1b6b91fff5924eaa62c0e">~Preconditioner</a> ()</td></tr>
<tr class="memdesc:ab60952a82cc1b6b91fff5924eaa62c0e inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor (empty)  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#ab60952a82cc1b6b91fff5924eaa62c0e">More...</a><br /></td></tr>
<tr class="separator:ab60952a82cc1b6b91fff5924eaa62c0e inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace1199369e4465cd2b9a34884bb64ec8 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ace1199369e4465cd2b9a34884bb64ec8">preconditioner_solve</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;r, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;z)=0</td></tr>
<tr class="separator:ace1199369e4465cd2b9a34884bb64ec8 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e469ffc87f31f6f2eebbe5ccf03d78b inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a1e469ffc87f31f6f2eebbe5ccf03d78b">preconditioner_solve_transpose</a> (const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;r, <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;z)</td></tr>
<tr class="separator:a1e469ffc87f31f6f2eebbe5ccf03d78b inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b95e7159585b5151f9e5dc1d1713655 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a0b95e7159585b5151f9e5dc1d1713655">setup</a> (<a class="el" href="../../dc/df5/classoomph_1_1DoubleMatrixBase.html">DoubleMatrixBase</a> *<a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a66726e9df31365df646cdf83a975aa26">matrix_pt</a>)</td></tr>
<tr class="separator:a0b95e7159585b5151f9e5dc1d1713655 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a783fae97e4b898f8de72b504a4f4bec6 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a783fae97e4b898f8de72b504a4f4bec6">setup</a> (const <a class="el" href="../../dc/de5/classoomph_1_1Problem.html">Problem</a> *problem_pt, <a class="el" href="../../dc/df5/classoomph_1_1DoubleMatrixBase.html">DoubleMatrixBase</a> *<a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a66726e9df31365df646cdf83a975aa26">matrix_pt</a>)</td></tr>
<tr class="separator:a783fae97e4b898f8de72b504a4f4bec6 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad84467ec9243138945c4d5bbca8fa6c inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#aad84467ec9243138945c4d5bbca8fa6c">enable_silent_preconditioner_setup</a> ()</td></tr>
<tr class="memdesc:aad84467ec9243138945c4d5bbca8fa6c inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up the block preconditioner quietly!  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#aad84467ec9243138945c4d5bbca8fa6c">More...</a><br /></td></tr>
<tr class="separator:aad84467ec9243138945c4d5bbca8fa6c inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a221f120f734fd3ca851db42b8defb53d inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a221f120f734fd3ca851db42b8defb53d">disable_silent_preconditioner_setup</a> ()</td></tr>
<tr class="memdesc:a221f120f734fd3ca851db42b8defb53d inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Be verbose in the block preconditioner setup.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#a221f120f734fd3ca851db42b8defb53d">More...</a><br /></td></tr>
<tr class="separator:a221f120f734fd3ca851db42b8defb53d inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4886f4efe510e5c9b0eb19422943588 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#af4886f4efe510e5c9b0eb19422943588">setup</a> ()=0</td></tr>
<tr class="separator:af4886f4efe510e5c9b0eb19422943588 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46c31c416829bedcd9db238431262027 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a46c31c416829bedcd9db238431262027">clean_up_memory</a> ()</td></tr>
<tr class="memdesc:a46c31c416829bedcd9db238431262027 inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up memory (empty). Generic interface function.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#a46c31c416829bedcd9db238431262027">More...</a><br /></td></tr>
<tr class="separator:a46c31c416829bedcd9db238431262027 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af459b7333c4c64435fd8fa933535901f inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#af459b7333c4c64435fd8fa933535901f">set_matrix_pt</a> (<a class="el" href="../../dc/df5/classoomph_1_1DoubleMatrixBase.html">DoubleMatrixBase</a> *<a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a66726e9df31365df646cdf83a975aa26">matrix_pt</a>)</td></tr>
<tr class="memdesc:af459b7333c4c64435fd8fa933535901f inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the matrix pointer.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#af459b7333c4c64435fd8fa933535901f">More...</a><br /></td></tr>
<tr class="separator:af459b7333c4c64435fd8fa933535901f inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada7219933e05d94f39a46a8ddb4c749a inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual const <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html">OomphCommunicator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a> () const</td></tr>
<tr class="memdesc:ada7219933e05d94f39a46a8ddb4c749a inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get function for comm pointer.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">More...</a><br /></td></tr>
<tr class="separator:ada7219933e05d94f39a46a8ddb4c749a inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a306f5a52f493816fcfda2dc9b2ee1dbf inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a306f5a52f493816fcfda2dc9b2ee1dbf">set_comm_pt</a> (const <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html">OomphCommunicator</a> *const <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>)</td></tr>
<tr class="memdesc:a306f5a52f493816fcfda2dc9b2ee1dbf inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the communicator pointer.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#a306f5a52f493816fcfda2dc9b2ee1dbf">More...</a><br /></td></tr>
<tr class="separator:a306f5a52f493816fcfda2dc9b2ee1dbf inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9202e15534f063a8e21a8a60623eac9f inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de6/classdouble.html">double</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a9202e15534f063a8e21a8a60623eac9f">setup_time</a> () const</td></tr>
<tr class="memdesc:a9202e15534f063a8e21a8a60623eac9f inherit pub_methods_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the time to setup the preconditioner.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#a9202e15534f063a8e21a8a60623eac9f">More...</a><br /></td></tr>
<tr class="separator:a9202e15534f063a8e21a8a60623eac9f inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1183f65956ef8a5b332a1246f418e907 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a1183f65956ef8a5b332a1246f418e907">turn_into_subsidiary_block_preconditioner</a> (<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &gt; *master_block_prec_pt, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;doftype_in_master_preconditioner_coarse)</td></tr>
<tr class="separator:a1183f65956ef8a5b332a1246f418e907 inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad565e8036a34a48259aed3ce91f821ef inherit pub_methods_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ad565e8036a34a48259aed3ce91f821ef">turn_into_subsidiary_block_preconditioner</a> (<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &gt; *master_block_prec_pt, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;doftype_in_master_preconditioner_coarse, const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&gt; &amp;doftype_coarsen_map_coarse)</td></tr>
<tr class="separator:ad565e8036a34a48259aed3ce91f821ef inherit pub_methods_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classoomph_1_1DistributableLinearAlgebraObject')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html">oomph::DistributableLinearAlgebraObject</a></td></tr>
<tr class="memitem:ac9492d59cff9d9b0098712ae72989cd3 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac9492d59cff9d9b0098712ae72989cd3">DistributableLinearAlgebraObject</a> ()</td></tr>
<tr class="memdesc:ac9492d59cff9d9b0098712ae72989cd3 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default constructor - create a distribution.  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac9492d59cff9d9b0098712ae72989cd3">More...</a><br /></td></tr>
<tr class="separator:ac9492d59cff9d9b0098712ae72989cd3 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7522391265c46e6c748fd660eae66f5e inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7522391265c46e6c748fd660eae66f5e">DistributableLinearAlgebraObject</a> (const <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html">DistributableLinearAlgebraObject</a> &amp;<a class="el" href="../../da/d67/level3__impl_8h.html#a21849b14ce38b5bc40d43a5782d89138">matrix</a>)=delete</td></tr>
<tr class="memdesc:a7522391265c46e6c748fd660eae66f5e inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken copy constructor.  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7522391265c46e6c748fd660eae66f5e">More...</a><br /></td></tr>
<tr class="separator:a7522391265c46e6c748fd660eae66f5e inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada5f539f36451c06e69de79bb129521b inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ada5f539f36451c06e69de79bb129521b">operator=</a> (const <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html">DistributableLinearAlgebraObject</a> &amp;)=delete</td></tr>
<tr class="memdesc:ada5f539f36451c06e69de79bb129521b inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broken assignment operator.  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ada5f539f36451c06e69de79bb129521b">More...</a><br /></td></tr>
<tr class="separator:ada5f539f36451c06e69de79bb129521b inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4038de53b5737dc625411e7848d21dad inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a4038de53b5737dc625411e7848d21dad">~DistributableLinearAlgebraObject</a> ()</td></tr>
<tr class="memdesc:a4038de53b5737dc625411e7848d21dad inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a4038de53b5737dc625411e7848d21dad">More...</a><br /></td></tr>
<tr class="separator:a4038de53b5737dc625411e7848d21dad inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a603105384d60c9a3710378af39f538b9 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a> () const</td></tr>
<tr class="memdesc:a603105384d60c9a3710378af39f538b9 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">access to the LinearAlgebraDistribution  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">More...</a><br /></td></tr>
<tr class="separator:a603105384d60c9a3710378af39f538b9 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7569556f14fd68b28508920e89bd5eee inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a> () const</td></tr>
<tr class="memdesc:a7569556f14fd68b28508920e89bd5eee inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">access function to the number of global rows.  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">More...</a><br /></td></tr>
<tr class="separator:a7569556f14fd68b28508920e89bd5eee inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bd7e1d242c69a28da85a804a7717fce inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> () const</td></tr>
<tr class="memdesc:a9bd7e1d242c69a28da85a804a7717fce inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">access function for the num of local rows on this processor.  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">More...</a><br /></td></tr>
<tr class="separator:a9bd7e1d242c69a28da85a804a7717fce inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21e966b025edec79067b41d7f1f25220 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a21e966b025edec79067b41d7f1f25220">nrow_local</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) const</td></tr>
<tr class="memdesc:a21e966b025edec79067b41d7f1f25220 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">access function for the num of local rows on this processor.  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a21e966b025edec79067b41d7f1f25220">More...</a><br /></td></tr>
<tr class="separator:a21e966b025edec79067b41d7f1f25220 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab00a3919b8634c698749f14a4d92947d inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> () const</td></tr>
<tr class="memdesc:ab00a3919b8634c698749f14a4d92947d inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">access function for the first row on this processor  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">More...</a><br /></td></tr>
<tr class="separator:ab00a3919b8634c698749f14a4d92947d inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4266c1d18d8e102bad3f4aec26c9b7cf inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a4266c1d18d8e102bad3f4aec26c9b7cf">first_row</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) const</td></tr>
<tr class="memdesc:a4266c1d18d8e102bad3f4aec26c9b7cf inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">access function for the first row on this processor  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a4266c1d18d8e102bad3f4aec26c9b7cf">More...</a><br /></td></tr>
<tr class="separator:a4266c1d18d8e102bad3f4aec26c9b7cf inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5505731e7e73d7e4251c67c7adec6bf5 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a> () const</td></tr>
<tr class="memdesc:a5505731e7e73d7e4251c67c7adec6bf5 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="mdescLeft">&#160;</td><td class="mdescRight">distribution is serial or distributed  <a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">More...</a><br /></td></tr>
<tr class="separator:a5505731e7e73d7e4251c67c7adec6bf5 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c35baa65e335043f62954c92c090a5a inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a8c35baa65e335043f62954c92c090a5a">distribution_built</a> () const</td></tr>
<tr class="separator:a8c35baa65e335043f62954c92c090a5a inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5340bac40b9559b0378037b57005203 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac5340bac40b9559b0378037b57005203">build_distribution</a> (const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *const dist_pt)</td></tr>
<tr class="separator:ac5340bac40b9559b0378037b57005203 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adad20ac61a61d907f823da7694b50616 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#adad20ac61a61d907f823da7694b50616">build_distribution</a> (const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> &amp;dist)</td></tr>
<tr class="separator:adad20ac61a61d907f823da7694b50616 inherit pub_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:ae055f998f6145656352aacac22e545ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae055f998f6145656352aacac22e545ad">set_nmesh</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/d24/level2__real__impl_8h.html#a1224f27e9a621d957f8124bcade25bed">n</a>)</td></tr>
<tr class="separator:ae055f998f6145656352aacac22e545ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af97821621b570d409e6662939e5f818d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af97821621b570d409e6662939e5f818d">set_mesh</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>, const <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *const <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>, const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;allow_multiple_element_type_in_mesh=false)</td></tr>
<tr class="separator:af97821621b570d409e6662939e5f818d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a0ae880f098d5b1e9df78fc74c31dbf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a0ae880f098d5b1e9df78fc74c31dbf">set_replacement_dof_block</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;block_i, const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;block_j, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> *<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">replacement_dof_block_pt</a>)</td></tr>
<tr class="separator:a8a0ae880f098d5b1e9df78fc74c31dbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fb68db9e79048615984b005f8aa43b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6fb68db9e79048615984b005f8aa43b3">any_mesh_distributed</a> () const</td></tr>
<tr class="separator:a6fb68db9e79048615984b005f8aa43b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb4dff3469cc6718103fddfdf3f3a7bb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">internal_dof_number</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;i_dof) const</td></tr>
<tr class="separator:abb4dff3469cc6718103fddfdf3f3a7bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e0a33327b5042dfba04baf46c045373"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">internal_index_in_dof</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;i_dof) const</td></tr>
<tr class="separator:a1e0a33327b5042dfba04baf46c045373"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac460225afc092cc5ed9d77acc6316536"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>) const</td></tr>
<tr class="separator:ac460225afc092cc5ed9d77acc6316536"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe03c970690224b46a29e55e16992dd7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">internal_dof_block_dimension</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a5a34e27e43935484f804192f7ca3dc24">i</a>) const</td></tr>
<tr class="separator:abe03c970690224b46a29e55e16992dd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e5b553f65e6c25354a5c908d507e8ee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">master_nrow</a> () const</td></tr>
<tr class="separator:a3e5b553f65e6c25354a5c908d507e8ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7297e4d24c2c7ae7af6a9ad009669928"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">internal_master_dof_number</a> (const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;<a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#a9d82f3af1459c1efc910b77f3ccd3180">b</a>) const</td></tr>
<tr class="separator:a7297e4d24c2c7ae7af6a9ad009669928"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a16de88bd5369e729d761a6498fdd3f"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a16de88bd5369e729d761a6498fdd3f">internal_preconditioner_matrix_distribution_pt</a> () const</td></tr>
<tr class="separator:a3a16de88bd5369e729d761a6498fdd3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74eeff188f842dd8abdff1b7d9801d44"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74eeff188f842dd8abdff1b7d9801d44">preconditioner_matrix_distribution_pt</a> () const</td></tr>
<tr class="separator:a74eeff188f842dd8abdff1b7d9801d44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_classoomph_1_1DistributableLinearAlgebraObject"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classoomph_1_1DistributableLinearAlgebraObject')"><img src="../../closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html">oomph::DistributableLinearAlgebraObject</a></td></tr>
<tr class="memitem:a30742aa2ac9abcfa037179f2d28ff43a inherit pro_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a30742aa2ac9abcfa037179f2d28ff43a">clear_distribution</a> ()</td></tr>
<tr class="separator:a30742aa2ac9abcfa037179f2d28ff43a inherit pro_methods_classoomph_1_1DistributableLinearAlgebraObject"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ad2cd49c5c823c4202046e97038f6e080"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d3a/classoomph_1_1MapMatrix.html">MapMatrix</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a></td></tr>
<tr class="memdesc:ad2cd49c5c823c4202046e97038f6e080"><td class="mdescLeft">&#160;</td><td class="mdescRight">The replacement dof-level blocks.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">More...</a><br /></td></tr>
<tr class="separator:ad2cd49c5c823c4202046e97038f6e080"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59e83eca59e3cdc41a93668539e138f1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a></td></tr>
<tr class="memdesc:a59e83eca59e3cdc41a93668539e138f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">The distribution for the blocks.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">More...</a><br /></td></tr>
<tr class="separator:a59e83eca59e3cdc41a93668539e138f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae047d81b8179dfd09b70cf35f40f62ca"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a></td></tr>
<tr class="separator:ae047d81b8179dfd09b70cf35f40f62ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a278946969944848b12bdc2ceaed91a07"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a></td></tr>
<tr class="memdesc:a278946969944848b12bdc2ceaed91a07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mapping for the block types to the most fine grain dof types.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">More...</a><br /></td></tr>
<tr class="separator:a278946969944848b12bdc2ceaed91a07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a015ba85d839a80512c6c4065e39a3d4a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a></td></tr>
<tr class="separator:a015ba85d839a80512c6c4065e39a3d4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4e2e47f537f9b6b4deae5792c493d65"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a></td></tr>
<tr class="separator:aa4e2e47f537f9b6b4deae5792c493d65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38de6514d7065086335e0e6f60dc77a9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a></td></tr>
<tr class="memdesc:a38de6514d7065086335e0e6f60dc77a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage for the default distribution for each internal block.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">More...</a><br /></td></tr>
<tr class="separator:a38de6514d7065086335e0e6f60dc77a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21867eb330dd1177c530a590ad1fa571"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a></td></tr>
<tr class="separator:a21867eb330dd1177c530a590ad1fa571"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f3a3ac8c192a83facd5b560f017413e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2f3a3ac8c192a83facd5b560f017413e">Allow_multiple_element_type_in_mesh</a></td></tr>
<tr class="separator:a2f3a3ac8c192a83facd5b560f017413e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89adb506e8f9103c80b4b36cc309f536"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; const <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a></td></tr>
<tr class="separator:a89adb506e8f9103c80b4b36cc309f536"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e9d73ff61daa00aea4e4deff0d6aff"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">Ndof_types_in_mesh</a></td></tr>
<tr class="separator:a43e9d73ff61daa00aea4e4deff0d6aff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c7426a2c8c096c8f4dc583444e0e0e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a></td></tr>
<tr class="separator:a06c7426a2c8c096c8f4dc583444e0e0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3985436e4645c202eadd47a4f4f466e2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a></td></tr>
<tr class="separator:a3985436e4645c202eadd47a4f4f466e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_classoomph_1_1Preconditioner"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classoomph_1_1Preconditioner')"><img src="../../closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html">oomph::Preconditioner</a></td></tr>
<tr class="memitem:ad191d6be6caf8875700f54c939ec33e6 inherit pro_attribs_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ad191d6be6caf8875700f54c939ec33e6">Silent_preconditioner_setup</a></td></tr>
<tr class="memdesc:ad191d6be6caf8875700f54c939ec33e6 inherit pro_attribs_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Boolean to indicate whether or not the build should be done silently.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#ad191d6be6caf8875700f54c939ec33e6">More...</a><br /></td></tr>
<tr class="separator:ad191d6be6caf8875700f54c939ec33e6 inherit pro_attribs_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a6b2f6cd34495167ea766b47f055a7d inherit pro_attribs_classoomph_1_1Preconditioner"><td class="memItemLeft" align="right" valign="top">std::ostream *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a2a6b2f6cd34495167ea766b47f055a7d">Stream_pt</a></td></tr>
<tr class="memdesc:a2a6b2f6cd34495167ea766b47f055a7d inherit pro_attribs_classoomph_1_1Preconditioner"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the output stream &ndash; defaults to std::cout.  <a href="../../db/d9e/classoomph_1_1Preconditioner.html#a2a6b2f6cd34495167ea766b47f055a7d">More...</a><br /></td></tr>
<tr class="separator:a2a6b2f6cd34495167ea766b47f055a7d inherit pro_attribs_classoomph_1_1Preconditioner"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ae6ce543de76eedb34a2562eecceb222b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">Recursive_debug_flag</a></td></tr>
<tr class="separator:ae6ce543de76eedb34a2562eecceb222b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4647ea06ca7cf44c8de695ba35f3e97"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">Debug_flag</a></td></tr>
<tr class="separator:ab4647ea06ca7cf44c8de695ba35f3e97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab295a391e32dc00c4e56dfb0527ea354"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a></td></tr>
<tr class="separator:ab295a391e32dc00c4e56dfb0527ea354"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aa232afd2a76adac97fb7d484a18c5e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a></td></tr>
<tr class="separator:a4aa232afd2a76adac97fb7d484a18c5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7759d79eefa52fb688caac08a4ff4894"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a></td></tr>
<tr class="separator:a7759d79eefa52fb688caac08a4ff4894"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8c06ce4f4baf8480a2f25b152031dad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">Doftype_in_master_preconditioner_fine</a></td></tr>
<tr class="separator:ae8c06ce4f4baf8480a2f25b152031dad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d341eaf3312c7afcd663c7f4eba6fc2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a></td></tr>
<tr class="separator:a2d341eaf3312c7afcd663c7f4eba6fc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ad82070ce2f6cdfa9ea6c7226ea28af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a></td></tr>
<tr class="separator:a0ad82070ce2f6cdfa9ea6c7226ea28af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37b22a0a25030a4b08f2eaec261ae22b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a></td></tr>
<tr class="separator:a37b22a0a25030a4b08f2eaec261ae22b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55900a517c9e354b9fc49624483b7273"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a></td></tr>
<tr class="separator:a55900a517c9e354b9fc49624483b7273"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79ea9c428aa8533c371ef3f0048a3a92"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a></td></tr>
<tr class="separator:a79ea9c428aa8533c371ef3f0048a3a92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61561c20a262195f1bdacda515a2394b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a></td></tr>
<tr class="separator:a61561c20a262195f1bdacda515a2394b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2f496bfa8307485101a3b8ac57e8c71"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">Dof_number_to_block_number_lookup</a></td></tr>
<tr class="memdesc:ae2f496bfa8307485101a3b8ac57e8c71"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector to the mapping from DOF number to block number.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">More...</a><br /></td></tr>
<tr class="separator:ae2f496bfa8307485101a3b8ac57e8c71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a874cbe5520d546ee24004e229a48037e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">Ndof_in_block</a></td></tr>
<tr class="memdesc:a874cbe5520d546ee24004e229a48037e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of types of degree of freedom associated with each block.  <a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">More...</a><br /></td></tr>
<tr class="separator:a874cbe5520d546ee24004e229a48037e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58079eb938b4d3602d0819cf68b318c0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">Internal_preconditioner_matrix_distribution_pt</a></td></tr>
<tr class="separator:a58079eb938b4d3602d0819cf68b318c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad647cfa61939e3c118dcc2595a7f9240"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a></td></tr>
<tr class="separator:ad647cfa61939e3c118dcc2595a7f9240"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a915ff2775ccef6ac3dadf072566da9e7"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">Output_base_filename</a></td></tr>
<tr class="separator:a915ff2775ccef6ac3dadf072566da9e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a6e6a40988711a64c622c2fd9104c56cf"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6e6a40988711a64c622c2fd9104c56cf">Run_block_matrix_test</a> = false</td></tr>
<tr class="separator:a6e6a40988711a64c622c2fd9104c56cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename MATRIX&gt;<br />
class oomph::BlockPreconditioner&lt; MATRIX &gt;</h3>

<p>Block Preconditioner base class. The block structure of the overall problem is determined from the <code>Mesh's</code> constituent elements. Each constituent element must be block-preconditionable - i.e must implement the <code>GeneralisedElements</code> functions <code>ndof_types()</code> and get_dof_numbers_for_unknowns(...). A <code>Problem</code> can have several <code>Meshes</code>, but each <code>Mesh</code> must contain elements with the same DOF types. The association between global degrees of freedom and their unique local dof numbers is therefore based on information provided by the elements. We refer to the local dof numbers provided by the elements as the elemental dof numbers.</p>
<p>By default each type of DOF is assumed to be unique type of block, but DOF types can be grouped together in a single block when block_setup(...) is called.</p>
<p>This class can function in one of two ways. Either it acts as a stand-alone block preconditioner which computes and stores the association between global degrees of freedom and their unique global block numbers itself. Alternatively, the block preconditioner can act as a subsidiary block preconditioner within a (larger) master block preconditioner (pointed to by Master_block_preconditioner_pt). The master block preconditioner must have an equal or greater number of block types. Examples are the FSI preconditioner which is the 3x3 "master block preconditioner" for the Navier-Stokes preconditioners which deals with the 2x2 fluid-blocks within the overall structure. In this case, <b>only</b> the master block preconditioner computes and stores the master lookup schemes. All block preconditioners compute and store their own optimised lookup schemes.</p>
<p>In cases where a <code>Problem</code> contains elements of different element types (e.g. fluid and solid elements in a fluid-structure interaction problem), access to the elements of the same type must be provided via pointers to (possibly auxiliary) <code>Meshes</code> that only contain elements of a single type. The block preconditioner will then create global block numbers by concatenating the block types. Consider, e.g. a fluid-structure interaction problem in which the first <code>Mesh</code> contains (fluid) elements whose degrees of freedom have been subdivided into types "0" (the velocity, say) and "1" (the pressure say), while the second <code>Mesh</code> contains (solid) elements whose degrees of freedom are the nodal displacements, classified as its type "0". The combined block preconditioner then has three "block types": "0": Fluid velocity, "1": Fluid pressure, "2": Solid nodal positions. NOTE: currently this preconditioner uses the same communicator as the underlying problem. We may need to change this in the future. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a74c4b4bef4371b72816631445689a2e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74c4b4bef4371b72816631445689a2e6">&#9670;&nbsp;</a></span>BlockPreconditioner() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor. </p>
<div class="fragment"><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                          : <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">Ndof_types_in_mesh</a>(0)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="comment">// Initially set the master block preconditioner pointer to zero</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="comment">// indicating that this is stand-alone preconditioner (i.e. the upper most</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="comment">// level preconditioner) that will set up its own block lookup schemes</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="comment">// etc.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a> = 0;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="comment">// The distribution of the concatenation of the internal block</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="comment">// distributions.</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="comment">// I.e. LinearAlgebraDistributionHelpers::concatenate</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="comment">//        (distributions of internal blocks).</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="comment">// The concatenation of the internal block distributions is stored in two</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="comment">// places depending on if this is the upper-most master block</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="comment">// preconditioner or not.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="comment">// If this is a master block preconditioner</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">// (Master_block_preconditioner_pt is null), then it is stored in the</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="comment">// variable Internal_preconditioner_matrix_distribution_pt (below). For</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="comment">// subsidiary block preconditioners, this remains null.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="comment">// Because BlockPreconditioners are DistributedLinearAlgebraObjects, they</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="comment">// have a distribution. For the upper-most master block preconditioner,</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="comment">// this is the distribution of the underlying Jacobian.</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="comment">// For all subsidiary block preconditioners, this remains null. The</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="comment">// concatenation of the distribution of the internal blocks are stored</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">// as the distribution of the BlockPreconditioner.</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="comment">// This seems inconsistent and I cannot figure out why this is done.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">Internal_preconditioner_matrix_distribution_pt</a> = 0;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="comment">// The concatenation of the external block distributions.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a> = 0;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="comment">// Initialise number of rows in this block preconditioner.</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="comment">// This information is maintained if used as subsidiary or</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="comment">// stand-alone block preconditioner (in the latter case it</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="comment">// obviously stores the number of rows within the subsidiary</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="comment">// preconditioner.</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a> = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="comment">// Initialise number of different block types in this preconditioner.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="comment">// This information is maintained if used as subsidiary or</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="comment">// stand-alone block preconditioner (in the latter case it</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="comment">// obviously stores the number of rows within the subsidiary</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="comment">// preconditioner.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a> = 0;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="comment">// Initialise number of different dof types in this preconditioner.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="comment">// This information is maintained if used as subsidiary or</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">// stand-alone block preconditioner (in the latter case it</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="comment">// obviously stores the number of rows within the subsidiary</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="comment">// preconditioner.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> = 0;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="comment">// There are no blocks to start off with.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.resize(0);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">// The distributions of the underlying internal blocks.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>.resize(0);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="comment">// The distribution of the dof-level blocks, these are used during the</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="comment">// concatenation process to create the distribution of the blocks.</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>.resize(0);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="comment">// Clear both the Block_to_dof_map_coarse and Block_to_dof_map_fine</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">// vectors.</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>.resize(0);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>.resize(0);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="comment">// Default the debug flag to false.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">Recursive_debug_flag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="comment">// Default the debug flag to false.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">Debug_flag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    } <span class="comment">// EOFunc constructor</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a06c7426a2c8c096c8f4dc583444e0e0e"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">oomph::BlockPreconditioner::Internal_nblock_types</a></div><div class="ttdeci">unsigned Internal_nblock_types</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3362</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a21867eb330dd1177c530a590ad1fa571"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">oomph::BlockPreconditioner::Dof_block_distribution_pt</a></div><div class="ttdeci">Vector&lt; LinearAlgebraDistribution * &gt; Dof_block_distribution_pt</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3341</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a278946969944848b12bdc2ceaed91a07"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">oomph::BlockPreconditioner::Block_to_dof_map_fine</a></div><div class="ttdeci">Vector&lt; Vector&lt; unsigned &gt; &gt; Block_to_dof_map_fine</div><div class="ttdoc">Mapping for the block types to the most fine grain dof types.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3288</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a38de6514d7065086335e0e6f60dc77a9"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner::Internal_block_distribution_pt</a></div><div class="ttdeci">Vector&lt; LinearAlgebraDistribution * &gt; Internal_block_distribution_pt</div><div class="ttdoc">Storage for the default distribution for each internal block.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3337</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a3985436e4645c202eadd47a4f4f466e2"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">oomph::BlockPreconditioner::Internal_ndof_types</a></div><div class="ttdeci">unsigned Internal_ndof_types</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3368</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a43e9d73ff61daa00aea4e4deff0d6aff"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">oomph::BlockPreconditioner::Ndof_types_in_mesh</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Ndof_types_in_mesh</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3356</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a4aa232afd2a76adac97fb7d484a18c5e"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">oomph::BlockPreconditioner::Nrow</a></div><div class="ttdeci">unsigned Nrow</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3393</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a58079eb938b4d3602d0819cf68b318c0"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">oomph::BlockPreconditioner::Internal_preconditioner_matrix_distribution_pt</a></div><div class="ttdeci">LinearAlgebraDistribution * Internal_preconditioner_matrix_distribution_pt</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3519</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a59e83eca59e3cdc41a93668539e138f1"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner::Block_distribution_pt</a></div><div class="ttdeci">Vector&lt; LinearAlgebraDistribution * &gt; Block_distribution_pt</div><div class="ttdoc">The distribution for the blocks.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3277</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a7759d79eefa52fb688caac08a4ff4894"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner::Master_block_preconditioner_pt</a></div><div class="ttdeci">BlockPreconditioner&lt; MATRIX &gt; * Master_block_preconditioner_pt</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3399</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ab4647ea06ca7cf44c8de695ba35f3e97"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">oomph::BlockPreconditioner::Debug_flag</a></div><div class="ttdeci">bool Debug_flag</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3380</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ad647cfa61939e3c118dcc2595a7f9240"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">oomph::BlockPreconditioner::Preconditioner_matrix_distribution_pt</a></div><div class="ttdeci">LinearAlgebraDistribution * Preconditioner_matrix_distribution_pt</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3523</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ae047d81b8179dfd09b70cf35f40f62ca"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">oomph::BlockPreconditioner::Block_to_dof_map_coarse</a></div><div class="ttdeci">Vector&lt; Vector&lt; unsigned &gt; &gt; Block_to_dof_map_coarse</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3285</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ae6ce543de76eedb34a2562eecceb222b"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">oomph::BlockPreconditioner::Recursive_debug_flag</a></div><div class="ttdeci">bool Recursive_debug_flag</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3375</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_to_dof_map_coarse</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_to_dof_map_fine</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">oomph::BlockPreconditioner&lt; MATRIX &gt;::Debug_flag</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_nblock_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_ndof_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_preconditioner_matrix_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Nrow</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">oomph::BlockPreconditioner&lt; MATRIX &gt;::Preconditioner_matrix_distribution_pt</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Recursive_debug_flag</a>.</p>

</div>
</div>
<a id="a78c33fc6f29101f027e22d64d158d567"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78c33fc6f29101f027e22d64d158d567">&#9670;&nbsp;</a></span>~BlockPreconditioner()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::~<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor. </p>
<div class="fragment"><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">clear_block_preconditioner_base</a>();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    } <span class="comment">// EOFunc destructor</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a7845d9301918e3f5cbecd729ec1e309b"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner::clear_block_preconditioner_base</a></div><div class="ttdeci">void clear_block_preconditioner_base()</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2159</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>.</p>

</div>
</div>
<a id="a0634f494e1284446512560cb1dc73a32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0634f494e1284446512560cb1dc73a32">&#9670;&nbsp;</a></span>BlockPreconditioner() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::<a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Broken copy constructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a6fb68db9e79048615984b005f8aa43b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fb68db9e79048615984b005f8aa43b3">&#9670;&nbsp;</a></span>any_mesh_distributed()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::any_mesh_distributed </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Check if any of the meshes are distributed. This is equivalent to problem.distributed() and is used as a replacement. </p>
<div class="fragment"><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    {</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <span class="comment">// is_mesh_distributed() is only available with MPI</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>(); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;      {</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;is_mesh_distributed())</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        {</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;        }</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      }</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;    }</div>
<div class="ttc" id="aBiCGSTAB__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aCG3DPackingUnitTest_8cpp_html_a7026fd16370249ce97cb3d062326baf9"><div class="ttname"><a href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a></div><div class="ttdeci">const unsigned n</div><div class="ttdef"><b>Definition:</b> CG3DPackingUnitTest.cpp:11</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a193776a271f7c23d20d2102de0ff1cb9"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">oomph::BlockPreconditioner::nmesh</a></div><div class="ttdeci">unsigned nmesh() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1816</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a3c0e92cb77c3e3179007fe9fd99b6428"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">oomph::BlockPreconditioner::mesh_pt</a></div><div class="ttdeci">const Mesh * mesh_pt(const unsigned &amp;i) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1782</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">oomph::BlockPreconditioner&lt; MATRIX &gt;::mesh_pt()</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">oomph::BlockPreconditioner&lt; MATRIX &gt;::nmesh()</a>.</p>

</div>
</div>
<a id="a77ac0b71404620e7be8b15ac2d588495"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77ac0b71404620e7be8b15ac2d588495">&#9670;&nbsp;</a></span>block_distribution_pt() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::block_distribution_pt </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function to the block distributions (const version). </p>
<div class="fragment"><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    {</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.size() == 0)</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      {</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;Block distributions are not set up.\n&quot;</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;Have you called block_setup(...)?\n&quot;</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      }</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>())</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      {</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;You requested the distribution for the block &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>()</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      }</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160; </div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    } <span class="comment">// EOFunc block_distribution_pt(...)</span></div>
<div class="ttc" id="abenchVecAdd_8cpp_html_af9816f50f32fc22762a8289c3cc44f22"><div class="ttname"><a href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div><div class="ttdeci">Scalar * b</div><div class="ttdef"><b>Definition:</b> benchVecAdd.cpp:17</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a80808d42be8db74fd58af80b019bf317"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner::nblock_types</a></div><div class="ttdeci">unsigned nblock_types() const</div><div class="ttdoc">Return the number of block types.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1670</div></div>
<div class="ttc" id="aoomph__definitions_8h_html_a25c6813cc7341d125e2502f8923fb6c4"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a></div><div class="ttdeci">#define OOMPH_EXCEPTION_LOCATION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:61</div></div>
<div class="ttc" id="aoomph__definitions_8h_html_aa260cc4af589e30cea7fde997ae16667"><div class="ttname"><a href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a></div><div class="ttdeci">#define OOMPH_CURRENT_FUNCTION</div><div class="ttdef"><b>Definition:</b> oomph_definitions.h:86</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a51636746e5921ee2845daf60b1c322dc">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_concatenated_block()</a>.</p>

</div>
</div>
<a id="ace28659098240524c431a41cf419d4ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace28659098240524c431a41cf419d4ba">&#9670;&nbsp;</a></span>block_distribution_pt() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::block_distribution_pt </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function to the block distributions (non-const version). </p>
<div class="fragment"><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    {</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.size() == 0)</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      {</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;Block distributions are not set up.\n&quot;</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;Have you called block_setup(...)?\n&quot;</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      }</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>())</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      {</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;You requested the distribution for the block &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>()</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      }</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160; </div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    } <span class="comment">// EOFunc block_distribution_pt(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="a4d8ff67e34e85a71c0f9bb68c0b10496"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d8ff67e34e85a71c0f9bb68c0b10496">&#9670;&nbsp;</a></span>block_matrix_test()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::block_matrix_test </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const MATRIX *&#160;</td>
          <td class="paramname"><em>block_matrix_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Private helper function to check that every element in the block matrix (i,j) matches the corresponding element in the original matrix</p>
<p>test function to check that every element in the block matrix (block_i,block_j) matches the corresponding element in the original matrix </p>
<div class="fragment"><div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;  {</div>
<div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;    <span class="comment">// boolean flag to indicate whether test is passed</span></div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d2/d6d/fastmath_8cpp.html#a1a1a6699085ce0fcd8a4602ac7404e72">check</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160; </div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;    <span class="comment">// number of rows in matrix</span></div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;    <span class="keywordtype">unsigned</span> n_row = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>()-&gt;nrow();</div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160; </div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;    <span class="comment">// number of columns in matrix</span></div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;    <span class="keywordtype">unsigned</span> n_col = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>()-&gt;ncol();</div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160; </div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;    <span class="comment">// loop over rows of original matrix</span></div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_row; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;    {</div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;      <span class="comment">// if this coefficient is associated with a block in this block</span></div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;      <span class="comment">// preconditioner</span></div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(block_i) == this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;      {</div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;        <span class="comment">// loop over columns of original matrix</span></div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; n_col; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;        {</div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;          <span class="comment">// if the coeeficient is associated with a block in this block</span></div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;          <span class="comment">// preconditioner</span></div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(block_j) == this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>))</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;          {</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;            <span class="comment">// check whether elements in original matrix and matrix of block</span></div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;            <span class="comment">// pointers match</span></div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>()-&gt;<span class="keyword">operator</span>()(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>) !=</div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;                block_matrix_pt-&gt;operator()(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;                                            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>)))</div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;            {</div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;              <a class="code" href="../../d2/d6d/fastmath_8cpp.html#a1a1a6699085ce0fcd8a4602ac7404e72">check</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;            }</div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;          }</div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;        }</div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;      }</div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;    }</div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160; </div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;    <span class="comment">// throw error</span></div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d6d/fastmath_8cpp.html#a1a1a6699085ce0fcd8a4602ac7404e72">check</a>)</div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;    {</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The require elements have not been successfully copied&quot;</span></div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; from the original matrix to the block matrices&quot;</span>;</div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;    }</div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a9aac48fd53e579e6db8eeed58933a14b"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">oomph::BlockPreconditioner::matrix_pt</a></div><div class="ttdeci">MATRIX * matrix_pt() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:520</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_af3eadb5d8d36200c4738537eac1647a6"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">oomph::BlockPreconditioner::internal_block_number</a></div><div class="ttdeci">int internal_block_number(const unsigned &amp;i_dof) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2689</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_affcfd24c1ba15bf9cac712ffd46dc283"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">oomph::BlockPreconditioner::internal_index_in_block</a></div><div class="ttdeci">int internal_index_in_block(const unsigned &amp;i_dof) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2705</div></div>
<div class="ttc" id="afastmath_8cpp_html_a1a1a6699085ce0fcd8a4602ac7404e72"><div class="ttname"><a href="../../d2/d6d/fastmath_8cpp.html#a1a1a6699085ce0fcd8a4602ac7404e72">check</a></div><div class="ttdeci">void check(bool b, bool ref)</div><div class="ttdef"><b>Definition:</b> fastmath.cpp:12</div></div>
<div class="ttc" id="atut__arithmetic__redux__minmax_8cpp_html_a39513f0f8d942bf9ef17b2e87ac6d34e"><div class="ttname"><a href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a></div><div class="ttdeci">std::ptrdiff_t j</div><div class="ttdef"><b>Definition:</b> tut_arithmetic_redux_minmax.cpp:2</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d2/d6d/fastmath_8cpp.html#a1a1a6699085ce0fcd8a4602ac7404e72">check()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="a8a64cfc57ffd16b92ac78499de515138"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a64cfc57ffd16b92ac78499de515138">&#9670;&nbsp;</a></span>block_number()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::block_number </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i_dof</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the block number corresponding to a global index i_dof. </p>
<div class="fragment"><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    {</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(i_dof);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160; </div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a> == -1)</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      }</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      {</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        <span class="comment">// Map the internal block to the &quot;external&quot; block number, i.e. what the</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <span class="comment">// writer of the preconditioner is expects.</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        <span class="keywordtype">unsigned</span> block_i = 0;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        <span class="keywordflow">while</span> (std::find(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[block_i].begin(),</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                         <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[block_i].<a class="code" href="../../df/d04/group__Core__Module.html#ga0e45b6b2adead7c6a29815b99f9f14dd">end</a>(),</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                         <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>) ==</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;               <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[block_i].<a class="code" href="../../df/d04/group__Core__Module.html#ga0e45b6b2adead7c6a29815b99f9f14dd">end</a>())</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        {</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;          block_i++;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        }</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160; </div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <span class="keywordflow">return</span> block_i;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      }</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    }</div>
<div class="ttc" id="agroup__Core__Module_html_ga0e45b6b2adead7c6a29815b99f9f14dd"><div class="ttname"><a href="../../df/d04/group__Core__Module.html#ga0e45b6b2adead7c6a29815b99f9f14dd">Eigen::placeholders::end</a></div><div class="ttdeci">static constexpr lastp1_t end</div><div class="ttdef"><b>Definition:</b> IndexedViewHelper.h:79</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_to_dof_map_fine</a>, <a class="el" href="../../df/d04/group__Core__Module.html#ga0e45b6b2adead7c6a29815b99f9f14dd">Eigen::placeholders::end</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_number()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">oomph::BlockPreconditioner&lt; MATRIX &gt;::index_in_block()</a>.</p>

</div>
</div>
<a id="a0bd0ab19a7501b79c16c1283766f0abb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bd0ab19a7501b79c16c1283766f0abb">&#9670;&nbsp;</a></span>block_output_on()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::block_output_on </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Test if output of blocks is on or not. </p>
<div class="fragment"><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    {</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">Output_base_filename</a>.size() &gt; 0;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    } <span class="comment">// EOFunc block_output_on()</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a915ff2775ccef6ac3dadf072566da9e7"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">oomph::BlockPreconditioner::Output_base_filename</a></div><div class="ttdeci">std::string Output_base_filename</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3531</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">oomph::BlockPreconditioner&lt; MATRIX &gt;::Output_base_filename</a>.</p>

</div>
</div>
<a id="af704c4816469cef4fed9d35a9ad651ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af704c4816469cef4fed9d35a9ad651ec">&#9670;&nbsp;</a></span>block_setup() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::block_setup</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Determine the size of the matrix blocks and setup the lookup schemes relating the global degrees of freedom with their "blocks" and their indices (row/column numbers) in those blocks. The distributions of the preconditioner and the internal blocks are automatically specified (and assumed to be uniform) at this stage. This method should be used if the identity dof-to-block mapping is okay, i.e. dof number 0 corresponds to block number 0 dof number 1 corresponds to block number 1 dof number 2 corresponds to block number 2 etc...</p>
<p>Determine the size of the matrix blocks and setup the lookup schemes relating the global degrees of freedom with their "blocks" and their indices (row/column numbers) in those blocks. The distributions of the preconditioner and the blocks are automatically specified (and assumed to be uniform) at this stage. This method should be used if each DOF type corresponds to a unique block type. </p>
<div class="fragment"><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;  {</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160; </div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="comment">// Subsidiary preconditioners don&#39;t really need the meshes</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    {</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>();</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> == 0)</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      {</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;No meshes have been set for this block preconditioner!\n&quot;</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Set one with set_nmesh(...), set_mesh(...)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> = 0; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>++)</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        {</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a>[<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>] == 0)</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;          {</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            err_msg &lt;&lt; <span class="stringliteral">&quot;The mesh pointer to mesh &quot;</span> &lt;&lt; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt;&lt; <span class="stringliteral">&quot; is null!\n&quot;</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Set a non-null one with set_mesh(...)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;              err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;          }</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;        }</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      }</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    }</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160; </div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    <span class="comment">// Get the number of dof types.</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    <span class="keywordtype">unsigned</span> internal_n_dof_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>();</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160; </div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    <span class="comment">// Build the dof to block map - assume that each type of dof corresponds</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    <span class="comment">// to a different type of block.</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    Vector&lt;unsigned&gt; dof_to_block_lookup(internal_n_dof_types);</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; internal_n_dof_types; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    {</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;      dof_to_block_lookup[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    }</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160; </div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="comment">// call the block setup method</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af704c4816469cef4fed9d35a9ad651ec">block_setup</a>(dof_to_block_lookup);</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a804e1975f170d2ad941b3b7d2dd50407"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner::is_master_block_preconditioner</a></div><div class="ttdeci">bool is_master_block_preconditioner() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2068</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a89adb506e8f9103c80b4b36cc309f536"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">oomph::BlockPreconditioner::Mesh_pt</a></div><div class="ttdeci">Vector&lt; const Mesh * &gt; Mesh_pt</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3352</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ab6cca480686ea8e44244ac60a0db23ba"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner::ndof_types</a></div><div class="ttdeci">unsigned ndof_types() const</div><div class="ttdoc">Return the total number of DOF types.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1694</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_af704c4816469cef4fed9d35a9ad651ec"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af704c4816469cef4fed9d35a9ad651ec">oomph::BlockPreconditioner::block_setup</a></div><div class="ttdeci">virtual void block_setup()</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:2483</div></div>
<div class="ttc" id="alevel2__cplx__impl_8h_html_a8d334fd8388055a029936c59d361ff00"><div class="ttname"><a href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a></div><div class="ttdeci">int * m</div><div class="ttdef"><b>Definition:</b> level2_cplx_impl.h:294</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d31/classoomph_1_1GeneralPurposeBlockPreconditioner.html#ae6b28f722b439af1f1a71a2328d4567a">oomph::GeneralPurposeBlockPreconditioner&lt; MATRIX &gt;::gp_preconditioner_block_setup()</a>, <a class="el" href="../../d6/dc0/classoomph_1_1DummyBlockPreconditioner.html#a5bca747d99ecd5b18aef416fb6ad2c99">oomph::DummyBlockPreconditioner&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a5806236b991ac2d7fe4bc7a4f19e98fb">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::solve()</a>, and <a class="el" href="../../df/df9/classoomph_1_1HelmholtzFGMRESMG.html#a36a1d601676df2ebe39fcdb7a0837864">oomph::HelmholtzFGMRESMG&lt; MATRIX &gt;::solve()</a>.</p>

</div>
</div>
<a id="a6b70b51b533002ff33a09013aa084e54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b70b51b533002ff33a09013aa084e54">&#9670;&nbsp;</a></span>block_setup() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::block_setup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>dof_to_block_map_in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Determine the size of the matrix blocks and setup the lookup schemes relating the global degrees of freedom with their "blocks" and their indices (row/column numbers) in those blocks. The distributions of the preconditioner and the blocks are automatically specified (and assumed to be uniform) at this stage. This method should be used if anything other than the identity dof-to-block mapping is required. The argument vector dof_to_block_map should be of length ndof. The indices represents the dof types whilst the value represents the block types. In general we want:</p>
<p>dof_to_block_map[dof_number] = block_number.</p>
<p>Determine the size of the matrix blocks and setup the lookup schemes relating the global degrees of freedom with their "blocks" and their indices (row/column numbers) in those blocks. The distributions of the preconditioner and the blocks are automatically specified (and assumed to be uniform) at this stage. This method should be used if any block contains more than one type of DOF. The argument vector dof_to_block_map should be of length ndof. Each element should contain an integer indicating the block number corresponding to that type of DOF. </p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Subsidiary preconditioners don&#39;t really need the meshes</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> == 0)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;No meshes have been set for this block preconditioner!\n&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Set one with set_nmesh(...), set_mesh(...)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> = 0; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>++)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a>[<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>] == 0)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;          {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            err_msg &lt;&lt; <span class="stringliteral">&quot;The mesh pointer to mesh &quot;</span> &lt;&lt; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt;&lt; <span class="stringliteral">&quot; is null!\n&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Set a non-null one with set_mesh(...)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;              err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;          }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// Create a copy of the vector input so that we can modify it below</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    Vector&lt;unsigned&gt; dof_to_block_map = dof_to_block_map_in;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="comment">// Get the size of the Doftype_in_master_preconditioner_coarse.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordtype">unsigned</span> para_doftype_in_master_preconditioner_coarse_size =</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>.size();</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="comment">// Check that the Doftype_in_master_preconditioner_coarse vector is not</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="comment">// empty. This must be set (via the function</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="comment">// turn_into_subsidiary_block_preconditioner) if this is a</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="comment">// subsidiary block preconditioner.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">if</span> (para_doftype_in_master_preconditioner_coarse_size == 0)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;The mapping from the dof types of the master &quot;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;block preconditioner \n&quot;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;to the subsidiary block preconditioner is empty.\n&quot;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Doftype_in_master_preconditioner_coarse.size() == 0 \n&quot;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;has turn_into_subsidiary_block_preconditioner(...)\n&quot;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;been called with the correct parameters?\n&quot;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                &lt;&lt; std::endl;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="comment">// PARANOID checks for Doftype_coarsen_map_coarse</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="comment">// This is also set in the function</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="comment">// turn_into_subsidiary_block_preconditioner(...).</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="comment">// The Doftype_coarsen_map_coarse vector must satisfy two conditions</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="comment">// for it to be valid.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="comment">// 1) The dof type numbers in the dof_coarsen_map vector must be</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="comment">//    unique. For example, it does not make sense to have the vector</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="comment">//    [[0,1][1,2]] because the first inner vector says</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="comment">//    &quot;treat dof types 0 and 1 as dof type 0&quot; and the second inner vector</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">//    says &quot;treat dof type 1 and 2 as dof type 1&quot;, but dof type 1 is</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="comment">//    already being treated as dof type 0.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">// 2) Every SUBSIDIARY dof type must be mapped to a dof type in the</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="comment">//    Doftype_coarsen_map_coarse vector.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="comment">//    For example, if there are 5 dof types (passed down from the master</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="comment">//    block preconditioner), and this block subsidiary block</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="comment">//    preconditioner only deals with 3 dof types, then all 5 dof types</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="comment">//    must be mapped to a dof type in the subsidiary preconditioner. For</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="comment">//    example if the dof_map is [1,2,3,4,5], then the subsidiary block</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="comment">//    preconditioner knows that 5 dof types have been passed down. But if</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="comment">//    it only works with three dof types, we MUST have three inner vectors</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="comment">//    in the doftype_coarsen_map vector (which corresponds to dof types 0,</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="comment">//    1 and 2), the union of the dof types in the three inner vectors must</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="comment">//    contain dof types 0, 1, 2, 3 and 4 exactly once. It cannot contain,</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="comment">//    say, 0, 1, 5, 7, 9, even though it passes the uniqueness check. We</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">//    ensure this by two conditions:</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="comment">//    2.1) The Doftype_coarsen_map_coarse vector must contain the same</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="comment">//         number of dof types as the dof_map vector.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="comment">//         In other words, recall that Doftype_coarsen_map_coarse is a</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">//         2D vector, this must contain the same number of vectors as</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="comment">//         there are elements in the dof_to_block_map_in vector.</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">//    2.2) The maximum element in the doftype_coarsen_map_coarse vector</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="comment">//         is the length of the dof_map vector minus 1.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="comment">// A set is deal for checking the above three conditions, we shall insert</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="comment">// all the elements in the doftype_coarsen_map_coarse vector into this</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="comment">// set.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      std::set&lt;unsigned&gt; doftype_map_set;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="comment">// Condition (1): Check for uniqueness by inserting all the values of</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="comment">// Doftype_coarsen_map_coarse into a set.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordtype">unsigned</span> para_doftype_coarsen_map_coarse_size =</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.size();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="comment">// Loop through the outer vector of Doftype_coarsen_map_coarse</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="comment">// then loop through the inner vectors and attempt to insert each</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="comment">// element of Doftype_coarsen_map_coarse into doftype_map_set.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="comment">// The inner for loop will throw an error if we cannot insert the</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="comment">// element, this means that it is already inserted and thus not unique.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; para_doftype_coarsen_map_coarse_size; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment">// Loop through the inner vector</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordtype">unsigned</span> para_doftype_coarsen_map_coarse_i_size =</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; para_doftype_coarsen_map_coarse_i_size; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <span class="comment">// Attempt to insert all the values of the inner vector into a set.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          std::pair&lt;std::set&lt;unsigned&gt;::iterator, <span class="keywordtype">bool</span>&gt; doftype_map_ret =</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            doftype_map_set.insert(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          <span class="keywordflow">if</span> (!doftype_map_ret.second)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;          {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            std::ostringstream err_msg;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            err_msg &lt;&lt; <span class="stringliteral">&quot;Error: the doftype number &quot;</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                    &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; is already inserted.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;              err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="comment">// Condition (2.1): Check that the doftype_map_set describes as many</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="comment">// values as doftype_in_master_preconditioner_coarse. I.e. if dof_map</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="comment">// contains 5 dof types, then the doftype_coarsen_map_coarse vector must</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="comment">// also contain 5 dof types.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">if</span> (para_doftype_in_master_preconditioner_coarse_size !=</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          doftype_map_set.size())</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;The size of doftype_in_master_preconditioner_coarse &quot;</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;must be the same as the total\n&quot;</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;number of values in the doftype_coarsen_map_coarse vector.&quot;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                &lt;&lt; std::endl;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="comment">// Condition (2.2): Check that the maximum element in the</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="comment">// doftype_coarsen_map_coarse vector is the length of the</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="comment">// doftype_in_master_preconditioner_coarse minus 1.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordtype">unsigned</span> para_doftype_in_master_preconditioner_coarse_size_minus_one =</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        para_doftype_in_master_preconditioner_coarse_size - 1;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordflow">if</span> (para_doftype_in_master_preconditioner_coarse_size_minus_one !=</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          *doftype_map_set.rbegin())</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;The maximum dof type number in the &quot;</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;doftype_coarsen_map vector must be &quot;</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                &lt;&lt; para_doftype_in_master_preconditioner_coarse_size_minus_one</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                &lt;&lt; std::endl;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="comment">// Set the mapping from the master preconditioner DOF types to the</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="comment">// subsidiary preconditioner DOF types.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="comment">// IMPORTANT: Since DOF types may be coarsened in the master block</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="comment">// preconditioner, this may no longer reflect the actual underlying dof</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="comment">// types. We must get the actual underlying dof types for the</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="comment">// block_setup(...) function to work properly so all the look up schemes</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="comment">// for this (subsidiary) block preconditioner is correct and works</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="comment">// properly, this is for backwards compatibility purposes and to make sure</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="comment">// Richard Muddle&#39;s still works at this (subsidiary) level, although it</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="comment">// may not be used.</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="comment">// If we do not want to make it backwards compatible, we may as well</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="comment">// kill the block_setup(...) for subsidiary block preconditioners -</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="comment">// but other thing may break. Do it at your own risk (take time to</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">// fully understand the whole block preconditioning framework code).</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="comment">// Create the corresponding Doftype_in_master_preconditioner_fine and</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="comment">// Doftype_coarsen_map_fine vectors.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="comment">// First resize the vectors.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">Doftype_in_master_preconditioner_fine</a>.resize(0);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>.resize(0);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="comment">// The Doftype_in_master_preconditioner_fine vector is easy.  We know that</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="comment">// the Doftype_coarsen_map_fine in the master preconditioner must be</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="comment">// constructed already. So we simply loop through the values in</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="comment">// doftype_in_master_preconditioner_coarse, then get the most fine grain</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="comment">// dof types from the master preconditioner&#39;s Doftype_coarsen_map_fine</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="comment">// vector.</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="comment">// For example, if the master preconditioner has the vector:</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">// Doftype_coarsen_map_fine = [0,1,2,3][4,5,6,7][8,9,10,11][12,13][14,15]</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="comment">// and passes the two vectors</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="comment">// doftype_in_master_preconditioner_coarse = [1,2,3]</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="comment">// doftype_coarsen_map_coarse = [[0][1,2]]</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">// Then we want</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="comment">// Doftype_in_master_preconditioner_fine = [4,5,6,7,8,9,10,11,12,13]</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">// We achieve this by looking up the corresponding fine dof types in the</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">// masters&#39; Doftype_coarsen_map_fine vector which corresponds to the</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="comment">// values in Doftype_in_master_preconditioner_coarse.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="comment">// That is, the values in Doftype_in_master_preconditioner_coarse gives us</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="comment">// the index of sub vector we want in the master&#39;s</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="comment">// Doftype_coarsen_map_fine vector.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="comment">// Check that the master block preconditioner&#39;s Doftype_coarsen_map_fine</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="comment">// is set up. Under the current implementation, this would always be set</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="comment">// up properly, but we check it just in case!</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a39411824a744d4569fe835dec13047">doftype_coarsen_map_fine</a>().<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>() ==</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;          0)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;The master block preconditioner&#39;s &quot;</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Doftype_coarsen_map_fine is not\n&quot;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;set up properly.\n&quot;</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;This vector is constructed in the function &quot;</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;block_setup(...).\n&quot;</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                &lt;&lt; std::endl;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordtype">unsigned</span> doftype_in_master_preconditioner_coarse_size =</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>.size();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; doftype_in_master_preconditioner_coarse_size;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;           <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">// The index of the sub vector we want.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordtype">unsigned</span> subvec_index = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="comment">// Get the corresponding most fine grain sub vector from the master</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="comment">// block preconditioner</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        Vector&lt;unsigned&gt; tmp_master_dof_subvec =</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>-&gt;get_fine_grain_dof_types_in(</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            subvec_index);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">Doftype_in_master_preconditioner_fine</a>.insert(</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">Doftype_in_master_preconditioner_fine</a>.end(),</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          tmp_master_dof_subvec.begin(),</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          tmp_master_dof_subvec.end());</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="comment">// The Doftype_coarsen_map_fine vector is a bit more tricky.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">// The Doftype_coarsen_map_coarse vector describes which coarse dof types</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="comment">// of THIS preconditioner are grouped together. We have to translate this</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="comment">// into the most fine grain dof types.</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="comment">// For example, if</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="comment">// Doftype_coarsen_map_coarse = [[0][1,2]]</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="comment">// Doftype_in_master_preconditioner_coarse = [1,2,3]</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">// and the MASTER preconditioner has:</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="comment">// Doftype_coarsen_map_fine= [[0,1,2,3][4,5,6,7][8,9,10,11][12,13][14,15]]</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="comment">// Then [[0][1,2]] tell us that the most fine grain DOF types 1 of the</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="comment">// master preconditioner most be grouped together, and the most fine</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="comment">// grained dof types 2 and 3 of the master preconditioner must be grouped</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="comment">// together.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="comment">// This gives the vector [[4,5,6,7] [8,9,10,11,12,13]], translating this</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="comment">// into the local DOF types of this preconditioner we have</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="comment">// Doftype_coarsen_map_fine = [[0,1,2,3][4,5,6,7,8,9]]. This corresponds</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="comment">// with the Doftype_in_master_preconditioner_fine vector we created above:</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="comment">// Doftype_in_master_preconditioner_fine = [4,5,6,7,8,9,10,11,12,13]</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="comment">// Together, the master block preconditioner says to THIS subsidiary block</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="comment">// preconditioner &quot;work on my DOF types [4,5,6,7,8,9,10,11,12,13], but</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="comment">// group your DOF type [0,1,2,3] together as DOF type 0 and [4,5,6,7,8,9]</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="comment">// together together as DOF type 1&quot;.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// Think of it like this: For each DOF type in Doftype_coarsen_map_coarse</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="comment">// we look at how many values this corresponds to in the master</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="comment">// preconditioner. In this case, Doftype_coarsen_map_coarse:</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="comment">// 1 - corresponds to fine DOF types 0,1,2,3 in this preconditioner,</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="comment">// and 4,5,6,7 in the master preconditioner;</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="comment">// 2 - corresponds to fine DOF types 4,5,6,7 in this preconditioner,</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="comment">// and 8,9,10,11 in the master preconditioner;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="comment">// 3 - corresponds to fine DOF types 8,9 in this preconditioner,</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="comment">// and 12,13 in the master preconditioner.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="comment">// Thus Doftype_coarsen_map_fine = [[0,1,2,3][4,5,6,7,8,9]]</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"></span>      <span class="comment">//</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="comment">// How to do this: First we create a 2D vector which has the corresponds</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="comment">// to the fine dof types in the master preconditioner but starting from</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="comment">// 0. For example, take the above example (repeated below):</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="comment">//   Passed to this prec by the master prec:</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="comment">//   Doftype_coarsen_map_coarse = [[0][1,2]]</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="comment">//   Doftype_in_master_preconditioner_coarse = [1,2,3]</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="comment">// and the MASTER preconditioner has:</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="comment">// Doftype_coarsen_map_fine= [[0,1,2,3][4,5,6,7][8,9,10,11][12,13][14,15]]</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="comment">// Step 1:</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="comment">// Then, the temp 2D vector we want to create is:</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="comment">// master_fine_doftype_translated = [[0 1 2 3], [4,5,6,7], [8,9]]</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="comment">// This comes from using Doftype_in_master_preconditioner_coarse</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="comment">// then get the number of fine dof types in the master.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="comment">// Step 2:</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="comment">// Then:</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="comment">//   Loop through the vector Doftype_coarsen_map_coarse,</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="comment">//     Loop over the inner vectors in Doftype_coarsen_map_coarse</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="comment">//       Each element in the inner vector corresponds to a vector in</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">//       master_fine_doftype_translated. We push in the vectors of</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="comment">//       master_fine_doftype_translated intp Doftype_coarsen_map_fine</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      Vector&lt;Vector&lt;unsigned&gt;&gt; master_fine_doftype_translated;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordtype">unsigned</span> dof_type_index = 0;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; doftype_in_master_preconditioner_coarse_size;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;           <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">// How many fine DOF types are in the master&#39;s</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="comment">// Doftype_in_master_preconditioner_coarse[i]?</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordtype">unsigned</span> coarse_dof = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordtype">unsigned</span> n_master_fine_doftypes =</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>-&gt;nfine_grain_dof_types_in(coarse_dof);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        Vector&lt;unsigned&gt; tmp_sub_vec;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; n_master_fine_doftypes; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          tmp_sub_vec.push_back(dof_type_index);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          dof_type_index++;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        master_fine_doftype_translated.push_back(tmp_sub_vec);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="comment">// master_fine_doftype_translated now contains vectors with values are</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="comment">// from 0, 1, 2, ..,</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="comment">// Now read out the values of master_fine_doftype_translated and place</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="comment">// them in order according to Doftype_coarsen_map_coarse.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordtype">unsigned</span> doftype_coarsen_map_coarse_size =</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.size();</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; doftype_coarsen_map_coarse_size; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        Vector&lt;unsigned&gt; tmp_vec;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordtype">unsigned</span> doftype_coarsen_map_coarse_i_size =</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; doftype_coarsen_map_coarse_i_size; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;          <span class="keywordtype">unsigned</span> subvec_i = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          tmp_vec.insert(tmp_vec.end(),</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                         master_fine_doftype_translated[subvec_i].begin(),</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                         master_fine_doftype_translated[subvec_i].end());</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>.push_back(tmp_vec);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="comment">// Get the number of block types (and DOF types) in this preconditioner</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="comment">// from the length of the dof_map vector.</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">Doftype_in_master_preconditioner_fine</a>.size();</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="comment">// Nblock_types is later updated in block_setup(...)</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="comment">// Compute number of rows in this (sub) preconditioner using data from</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="comment">// the master.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a> = 0;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a> += this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">internal_dof_block_dimension</a>(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a> == 0)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        error_message</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Nrow=0 in subsidiary preconditioner. This seems fishy and\n&quot;</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;suggests that block_setup() was not called for the \n&quot;</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;master block preconditioner yet.&quot;</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">throw</span> OomphLibWarning(error_message.str(),</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// If this is a master block preconditioner, then set the</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// Doftype_coarsen_map_fine and Doftype_coarsen_map_coarse to the</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// identity. Recall that the Doftype_coarsen_map_fine maps the dof types</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// that this preconditioner requires with the most fine grain dof types (the</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// internal dof types) and the Doftype_coarsen_map_coarse maps the dof</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// types that this preconditioner requires with the dof types which this</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// preconditioner is given from a master preconditioner (these dof types may</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">// or may not be coarsened). In the case of the master preconditioner, these</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">// are the same (since dof types are not coarsened), furthermore the</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="comment">// identity mapping is provided to say that dof type 0 maps to dof type 0,</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// dof type 1 maps to dof type 1,</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// dof type 2 maps to dof type 2,</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">// etc...</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// If this is not a master block preconditioner, then the vectors</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// Doftype_coarsen_map_fine and Doftype_coarsen_map_coarse is handled</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// by the turn_into_subsidiary_block_preconditioner(...) function.</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="comment">// How many dof types does this preconditioner work with?</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordtype">unsigned</span> n_external_dof_types = dof_to_block_map.size();</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="comment">// Note: at the master level, the n_external_dof_types should be the same</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">// as the internal_ndof_types(), since the dof_to_block_map MUST describe</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="comment">// the mapping between every dof type (not yet coarsened - so it is the</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="comment">// same number as the internal dof types) to the block types. But we</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="comment">// distinguish them for clarity. We also check that this is the case.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordtype">unsigned</span> n_internal_dof_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a>();</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">if</span> (n_internal_dof_types != n_external_dof_types)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        err_msg</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The internal ndof types and the length of the dof_to_block_map\n&quot;</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;vector is not the same. Since this is the master block &quot;</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;preconditioner,\n&quot;</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;you must describe which block each DOF type belongs to,\n&quot;</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;no more, no less.&quot;</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;internal_ndof_types = &quot;</span> &lt;&lt; n_internal_dof_types &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;dof_to_block_map.size() = &quot;</span> &lt;&lt; n_external_dof_types &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">throw</span> OomphLibWarning(</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="comment">// Clear and reserve space.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>.clear();</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.clear();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>.reserve(n_external_dof_types);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.reserve(n_external_dof_types);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="comment">// Now push back the identity mapping.</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_external_dof_types; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="comment">// Create a vector and push it in.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        Vector&lt;unsigned&gt; tmp_vec(1, <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>.push_back(tmp_vec);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.push_back(tmp_vec);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">// Else this is a subsidiary block preconditioner.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="comment">// Both the Doftype_coarsen_map_fine and Doftype_coarsen_map_coarse</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="comment">// vectors must be already be handled by the</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">// turn_into_subsidiary_block_preconditioner(...) function. We check this.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>.size() == 0) ||</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.size() == 0))</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Either the Doftype_coarsen_map_fine or the \n&quot;</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Doftype_coarsen_map_coarse vectors is of size 0.\n&quot;</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Did you remember to call the function &quot;</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;turn_into_subsidiary_block_preconditioner(...)?&quot;</span>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">throw</span> OomphLibWarning(</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// Now we create the vector Block_to_dof_map_coarse.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">// Recall that the vector describe which dof types are in which block with</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// the relationship:</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">// Block_to_dof_map_coarse[block_number] = Vector[dof types];</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// Note that this is not the internal (underlying) dof type.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// Nor is this in relation to the parent block preconditioner&#39;s dof type.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">// The number of elements in it is the same as dof_to_block_map vector.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// Since the dof type coarsening feature is added later, we encapsulate this</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">// bit of the code so it does not affect things below.</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="comment">// Check that the dof_to_block map &quot;makes sense&quot; for the</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="comment">// Doftype_coarsen_map_coarse.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="comment">// The Doftype_coarsen_map_coarse describes which doftypes should be</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="comment">// considered as a single doftype in THIS preconditioner.</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="comment">// For example, if this preconditioner is the LSC block preconditioner</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="comment">// applied to a 3D problem, it expects 4 doftypes:</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="comment">// 3 velocity, [u, v, w] and 1 pressure [p],</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="comment">// giving us the dof type ordering</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="comment">// [u v w p].</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="comment">// The LSC preconditioner groups the velocity and pressure doftypes</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="comment">// separately, thus the dof_to_block_map will be:</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="comment">// [0 0 0 1]</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="comment">// Then the Doftype_coarsen_map_coarse MUST have length 4, to identify</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="comment">// which of the OTHER (possibly coarsened) dof types should be grouped</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="comment">// together to be considered as a single dof types of THIS preconditioner.</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">// For example, if the preconditioner above this one has the dof type</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="comment">// ordering:</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="comment">// 0  1  2  3  4  5  6  7  8  9</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="comment">// ub vb wb up vp wp ut vt wt p</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="comment">// Then we want to tell THIS preconditioner which dof types belongs to</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="comment">// u, v, w and p, by providing the optional argument</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="comment">// Doftype_coarsen_map_coarse to the</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="comment">// turn_into_subsidiary_block_preconditioner(...) function</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="comment">// [[0 3 6] [1 4 7] [2 5 8] [9]]</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="comment">// So, it is important that the length of dof_to_block_map is the same as</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="comment">// the length of Doftype_coarsen_map_coarse. We check this.</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keywordtype">unsigned</span> dof_to_block_map_size = dof_to_block_map.size();</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">if</span> (dof_to_block_map_size != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.size())</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        err_msg</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The size of dof_to_block_map and Doftype_coarsen_map_coarse is &quot;</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;             <span class="stringliteral">&quot;not &quot;</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;the same.\n&quot;</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;dof_to_block_map.size() = &quot;</span> &lt;&lt; dof_to_block_map_size &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Doftype_coarsen_map_coarse.size() = &quot;</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.size() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;One of the two list is incorrect, please look at the comments\n&quot;</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;in the source code for more details.&quot;</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">throw</span> OomphLibWarning(</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="comment">// Create the Block_to_dof_map_coarse from</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="comment">// the dof_to_block_map and Doftype_coarsen_map_coarse.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">// find the maximum block number</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="keywordtype">unsigned</span> max_block_number =</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        *std::max_element(dof_to_block_map.begin(), dof_to_block_map.end());</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="comment">// Now we do the following:</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="comment">// Lets say the Doftype_coarsen_map_coarse is:</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="comment">// [0 3 6]</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="comment">// [1 4 7]</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// [2 5 8]</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="comment">// [9]</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">// (this is the same as the above example)</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="comment">// and the dof_to_block_map is [0 0 0 1].</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="comment">// Then we need to form the Block_to_dof_map_coarse:</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">// [0 3 6 1 4 7 2 5 8]</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">// [9]</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">// Clear anything in the Block_to_dof_map_coarse</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>.clear();</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> tmp_nblock = max_block_number + 1;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>.resize(tmp_nblock);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dof_to_block_map_size; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[dof_to_block_map[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]].push_back(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      }</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>.clear();</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>.resize(tmp_nblock);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_i = 0; block_i &lt; tmp_nblock; block_i++)</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="comment">// get the dof types in this block.</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndof_in_block = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[block_i].size();</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0; dof_i &lt; ndof_in_block; dof_i++)</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> coarsened_dof_i =</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[block_i][dof_i];</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          <span class="comment">// Insert the most fine grain dofs which this dof_i corresponds to</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          <span class="comment">// into block_i</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          Vector&lt;unsigned&gt; dof_i_dofs =</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>[coarsened_dof_i];</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[block_i].insert(</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[block_i].<a class="code" href="../../df/d04/group__Core__Module.html#ga0e45b6b2adead7c6a29815b99f9f14dd">end</a>(),</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            dof_i_dofs.begin(),</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            dof_i_dofs.end());</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="comment">// Now set the dof_to_block_map to the identify.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="comment">// NOTE: We are now using the internal n dof types. This is because the</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="comment">// dof type coarsening feature was built on top of the existing block</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">// preconditioning framework which does not handle coarsening of dof</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="comment">// types. Hence, under the hood, it still works with the most fine grain</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="comment">// dof types and does not do any coarsening.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="comment">// Locally cache the internal ndof types (using access function because</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">// the Internal_ndof_type variable may not be set up yet if this is a</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">// master preconditioner).</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordtype">unsigned</span> tmp_internal_ndof_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a>();</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      dof_to_block_map.resize(tmp_internal_ndof_types, 0);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; tmp_internal_ndof_types; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        dof_to_block_map[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    } <span class="comment">// end of Block_to_dof_map_coarse encapsulation</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// Check that the meshes are ok. This only needs to be done in the master</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// because subsidiary preconditioners don&#39;t do anything with the meshes</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// here.</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="comment">// This is declared as local_nmesh because there are other variables</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="comment">// called nmesh floating about... but this will not exist if PARANOID is</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">// switched on.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordtype">unsigned</span> local_nmesh = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>();</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="comment">// Check that some mesh pointers have been assigned.</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">if</span> (local_nmesh == 0)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;Cannot setup blocks because no meshes have been set.&quot;</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="comment">// Each mesh must contain elements with the same number of dof.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="comment">// A stricter check is to ensure that the mesh contains only one type of</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="comment">// elements. This is relaxed in same cases.</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> mesh_i = 0; mesh_i &lt; local_nmesh; mesh_i++)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="comment">// The number of elements in the current mesh.</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordtype">unsigned</span> n_element = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(mesh_i)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#af01dfefb66c15579b540be62999d93ee">nelement</a>();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="comment">// When the bulk mesh is distributed, there may not be any elements</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="comment">// in the surface mesh(es).</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">if</span> (n_element &gt; 0)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;          <span class="comment">// The string of the first element in the current mesh.</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          <a class="code" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">std::string</a> first_element_string =</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keyword">typeid</span>(*(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(mesh_i)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">element_pt</a>(0))).name();</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          <span class="comment">// If there are multiple element types in the current mesh,</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          <span class="comment">// we can at least make sure that they contain the same types of DOFs.</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          <span class="keywordflow">if</span> (<span class="keywordtype">bool</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2f3a3ac8c192a83facd5b560f017413e">Allow_multiple_element_type_in_mesh</a>[mesh_i]))</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="comment">// The ndof types of the first element.</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="keywordtype">unsigned</span> first_element_ndof_type =</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(mesh_i)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">element_pt</a>(0)-&gt;<a class="code" href="../../dd/d46/classoomph_1_1GeneralisedElement.html#a0c6037a870597b35dcf1c780710b9a56">ndof_types</a>();</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="comment">// Loop through the meshes and compare the number of types of DOFs.</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> el_i = 1; el_i &lt; n_element; el_i++)</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;              <span class="comment">// The ndof type of the current element.</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;              <span class="keywordtype">unsigned</span> current_element_ndof_type =</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(mesh_i)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">element_pt</a>(el_i)-&gt;<a class="code" href="../../dd/d46/classoomph_1_1GeneralisedElement.html#a0c6037a870597b35dcf1c780710b9a56">ndof_types</a>();</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;              <span class="comment">// The string of the current element.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;              <a class="code" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">std::string</a> current_element_string =</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="keyword">typeid</span>(*(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(mesh_i)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">element_pt</a>(el_i))).name();</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;              <span class="comment">// Compare against the first element.</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;              <span class="keywordflow">if</span> (current_element_ndof_type != first_element_ndof_type)</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;              {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                std::ostringstream error_message;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                error_message</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;Elements in the same mesh MUST have the same number of &quot;</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                     <span class="stringliteral">&quot;types &quot;</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;of DOFs.\n&quot;</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;The element in mesh &quot;</span> &lt;&lt; mesh_i &lt;&lt; <span class="stringliteral">&quot;, at position &quot;</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                  &lt;&lt; el_i &lt;&lt; <span class="stringliteral">&quot; is: \n&quot;</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                  &lt;&lt; current_element_string &lt;&lt; <span class="stringliteral">&quot;, \n&quot;</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;with ndof types: &quot;</span> &lt;&lt; current_element_ndof_type &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;The first element in the same mesh is: \n&quot;</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                  &lt;&lt; first_element_string &lt;&lt; <span class="stringliteral">&quot;, \n&quot;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;with ndof types: &quot;</span> &lt;&lt; first_element_ndof_type &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                    <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                    <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;              }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;          <span class="comment">// There should be only one type of elements in the current mesh.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          <span class="comment">// Check that this is the case!</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="comment">// Loop through the elements in the current mesh.</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> el_i = 1; el_i &lt; n_element; el_i++)</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;              <span class="comment">// The string of the current element.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;              <a class="code" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">std::string</a> current_element_string =</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                <span class="keyword">typeid</span>(*(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(mesh_i)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">element_pt</a>(el_i))).name();</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;              <span class="comment">// Compare against the first element.</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;              <span class="keywordflow">if</span> (current_element_string.compare(first_element_string) != 0)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;              {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                std::ostringstream error_message;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                error_message</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;By default, a mesh containing block preconditionable &quot;</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;elements must contain only one type of element.\n&quot;</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;The element in mesh &quot;</span> &lt;&lt; mesh_i &lt;&lt; <span class="stringliteral">&quot;, at position &quot;</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                  &lt;&lt; el_i &lt;&lt; <span class="stringliteral">&quot; is: \n&quot;</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                  &lt;&lt; current_element_string &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;The first element in the same mesh is: \n&quot;</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                  &lt;&lt; first_element_string &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;If this is correct, consider calling the set_mesh(...) &quot;</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                     <span class="stringliteral">&quot;with\n&quot;</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;the optional argument set true to allow multiple &quot;</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                     <span class="stringliteral">&quot;element\n&quot;</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;types in the same mesh.\n&quot;</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;Note: A minimal requirement is that the elements in the &quot;</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                     <span class="stringliteral">&quot;same\n&quot;</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;mesh MUST have the same number of DOF types.&quot;</span>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                    <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                                    <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;              }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">// clear the memory</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">clear_block_preconditioner_base</a>();</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="comment">// get my_rank and nproc</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordtype">unsigned</span> my_rank = <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordtype">unsigned</span> nproc = <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// start of master block preconditioner only operations</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment"></span><span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordtype">unsigned</span>* nreq_sparse = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[nproc]();</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordtype">unsigned</span>* nreq_sparse_for_proc = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[nproc]();</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordtype">unsigned</span>** index_in_dof_block_sparse_send = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>*[nproc]();</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordtype">unsigned</span>** dof_number_sparse_send = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>*[nproc]();</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    Vector&lt;MPI_Request&gt; send_requests_sparse;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    Vector&lt;MPI_Request&gt; recv_requests_sparse;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">// If this preconditioner is the master preconditioner then we need</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// to assemble the vectors : Dof_number</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="comment">//                           Index_in_dof_block</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="comment">// Get the number of dof types in each mesh.</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">Ndof_types_in_mesh</a>.assign(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>(), 0);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>(); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">Ndof_types_in_mesh</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a16225f0094eeb234460f6cf963099c85">ndof_types</a>();</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="comment">// Setup the distribution of this preconditioner, assumed to be the same</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="comment">// as the matrix if the matrix is distributable.</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac9492d59cff9d9b0098712ae72989cd3">DistributableLinearAlgebraObject</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>()))</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac5340bac40b9559b0378037b57005203">build_distribution</a>(</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac9492d59cff9d9b0098712ae72989cd3">DistributableLinearAlgebraObject</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>())</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            -&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>());</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        LinearAlgebraDistribution dist(<a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>(), <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>()-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac5340bac40b9559b0378037b57005203">build_distribution</a>(dist);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>()-&gt;nrow();</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="comment">// Boolean to indicate whether the matrix is actually distributed,</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="comment">// ie distributed and on more than one processor.</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="keywordtype">bool</span> matrix_distributed =</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        (this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a05842d032d28880ae37951deae804ad8">distributed</a>() &amp;&amp;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;         this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>() &gt; 1);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160; </div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="comment">// Matrix must be a CR matrix.</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      CRDoubleMatrix* cr_matrix_pt = <span class="keyword">dynamic_cast&lt;</span>CRDoubleMatrix*<span class="keyword">&gt;</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>());</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160; </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="keywordflow">if</span> (cr_matrix_pt == 0)</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;Block setup for distributed matrices only works &quot;</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;for CRDoubleMatrices&quot;</span>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="comment">// Get distribution.</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">nrow_local</a>();</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordtype">unsigned</span> last_row = <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> + <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> - 1;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="comment">// storage for the rows required by each processor in the dense</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="comment">// block lookup storage scheme</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="comment">// dense_required_rows(p,0) is the minimum global index required by proc p</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <span class="comment">//                 ...(p,1) is the maximum global index required by proc p</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;unsigned&gt;</a> dense_required_rows(nproc, 2);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        dense_required_rows(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 0) = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        dense_required_rows(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 1) = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) +</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                    this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">nrow_local</a>(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) - 1;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="comment">// determine the global rows That are not in the range first_row to</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="comment">// first_row+nrow_local for which we should store the</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="comment">// Dof_index and Index_in_dof_block for</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="comment">// then send the lists to other processors</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      std::set&lt;unsigned&gt; sparse_global_rows_for_block_lookup;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="keywordflow">if</span> (matrix_distributed)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordtype">unsigned</span> nnz = cr_matrix_pt-&gt;nnz();</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordtype">int</span>* column_index = cr_matrix_pt-&gt;column_index();</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nnz; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;          <span class="keywordtype">unsigned</span> ci = column_index[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <span class="keywordflow">if</span> (ci &lt; first_row || ci &gt; last_row)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            sparse_global_rows_for_block_lookup.insert(ci);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keywordtype">int</span> nsparse = sparse_global_rows_for_block_lookup.size();</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      Global_index_sparse.resize(0);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <a class="code" href="../../de/d6c/level1__impl_8h.html#af1eb30bd79553c9e566435de1f82a94f">std::copy</a>(sparse_global_rows_for_block_lookup.begin(),</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                sparse_global_rows_for_block_lookup.end(),</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                std::back_inserter(Global_index_sparse));</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      Index_in_dof_block_sparse.resize(nsparse);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      Dof_number_sparse.resize(nsparse);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      sparse_global_rows_for_block_lookup.clear();</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      Vector&lt;MPI_Request&gt; recv_requests_sparse_nreq;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keywordflow">if</span> (matrix_distributed)</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        MPI_Aint base_displacement_sparse;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        MPI_Get_address(nreq_sparse, &amp;base_displacement_sparse);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../df/dc1/svd__common_8h.html#a4a86f5596ff1afa9113ff6cc07a60453">zero</a> = 0;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;          <span class="comment">// determine the global eqn numbers required by this processor</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;          <span class="comment">// that can be classified by processor p</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;          <span class="keywordtype">int</span> begin = 0;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nsparse; ++<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;          {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <span class="keywordflow">if</span> (Global_index_sparse[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; dense_required_rows(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 0))</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;              ++begin;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;              <span class="keywordflow">if</span> (Global_index_sparse[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;= dense_required_rows(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 1))</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;              {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                ++nreq_sparse[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;              }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;              {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;              }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;          <span class="comment">// if this processor has rows to be classified by proc p</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;          <span class="keywordflow">if</span> (nreq_sparse[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;          {</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="comment">// send the number of global eqn numbers</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            MPI_Request req1;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            MPI_Isend(&amp;nreq_sparse[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                      1,</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                      MPI_UNSIGNED,</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                      31,</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                      <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                      &amp;req1);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            send_requests_sparse.push_back(req1);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <span class="comment">// send the global eqn numbers</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            MPI_Request req2;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            MPI_Isend(&amp;Global_index_sparse[begin],</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                      nreq_sparse[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                      MPI_UNSIGNED,</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                      32,</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                      <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                      &amp;req2);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            send_requests_sparse.push_back(req2);</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            <span class="comment">// post the recvs for the data that will be returned</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            <span class="comment">// the datatypes, displacements, lengths for the two datatypes</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            MPI_Datatype types[2];</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            MPI_Aint displacements[2];</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="keywordtype">int</span> lengths[2];</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <span class="comment">// index in dof block</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            MPI_Type_contiguous(nreq_sparse[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED, &amp;types[0]);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            MPI_Type_commit(&amp;types[0]);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            MPI_Get_address(&amp;Index_in_dof_block_sparse[begin],</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                            &amp;displacements[0]);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            displacements[0] -= base_displacement_sparse;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            lengths[0] = 1;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            <span class="comment">// dof number</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            MPI_Type_contiguous(nreq_sparse[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED, &amp;types[1]);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            MPI_Type_commit(&amp;types[1]);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            MPI_Get_address(&amp;Dof_number_sparse[begin], &amp;displacements[1]);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            displacements[1] -= base_displacement_sparse;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            lengths[1] = 1;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            <span class="comment">// build the final type</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            MPI_Datatype recv_type;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            MPI_Type_create_struct(</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;              2, lengths, displacements, types, &amp;recv_type);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            MPI_Type_commit(&amp;recv_type);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            MPI_Type_free(&amp;types[0]);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            MPI_Type_free(&amp;types[1]);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <span class="comment">// and recv</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            MPI_Request req;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            MPI_Irecv(</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;              nreq_sparse, 1, recv_type, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 33, <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(), &amp;req);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            recv_requests_sparse.push_back(req);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            MPI_Type_free(&amp;recv_type);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;          }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;          <span class="comment">// if no communication required, confirm this</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;          <span class="keywordflow">if</span> (nreq_sparse[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] == 0)</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            MPI_Request req1;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            MPI_Isend(</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;              &amp;<a class="code" href="../../df/dc1/svd__common_8h.html#a4a86f5596ff1afa9113ff6cc07a60453">zero</a>, 1, MPI_UNSIGNED, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 31, <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(), &amp;req1);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            send_requests_sparse.push_back(req1);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;          }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160; </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          MPI_Request req;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;          MPI_Irecv(&amp;nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                    1,</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                    MPI_UNSIGNED,</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                    <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                    31,</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                    <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                    &amp;req);</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;          recv_requests_sparse_nreq.push_back(req);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        }</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="comment">// resize the storage</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>.resize(<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>.resize(<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="comment">// zero the number of dof types</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> = 0;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="comment">// Vector to keep track of previously assigned block numbers</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="comment">// to check consistency between multiple assignments.</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      Vector&lt;int&gt; previously_assigned_block_number(<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>,</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                                                   <a class="code" href="../../d8/dc5/classoomph_1_1Data.html#ac56011da9a923069793ecc3cb54f5e20">Data::Is_unclassified</a>);</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="comment">// determine whether the problem is distribution</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordtype">bool</span> problem_distributed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <span class="comment">// the problem method distributed() is only accessible with MPI</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      problem_distributed = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6fb68db9e79048615984b005f8aa43b3">any_mesh_distributed</a>();</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="comment">// if the problem is not distributed</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="keywordflow">if</span> (!problem_distributed)</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="comment">// Offset for the block type in the overall system.</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="comment">// Different meshes contain different block-preconditionable</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="comment">// elements -- their blocks are added one after the other.</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keywordtype">unsigned</span> dof_offset = 0;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="comment">// Loop over all meshes.</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> = 0; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>(); <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>++)</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        {</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          <span class="comment">// Number of elements in this mesh.</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;          <span class="keywordtype">unsigned</span> n_element = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#af01dfefb66c15579b540be62999d93ee">nelement</a>();</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;          <span class="comment">// Find the number of block types that the elements in this mesh</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;          <span class="comment">// are in charge of.</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;          <span class="keywordtype">unsigned</span> ndof_in_element = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">ndof_types_in_mesh</a>(<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> += ndof_in_element;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160; </div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; n_element; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;          {</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            <span class="comment">// List containing pairs of global equation number and</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            <span class="comment">// dof number for each global dof in an element.</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            std::list&lt;std::pair&lt;unsigned long, unsigned&gt;&gt; dof_lookup_list;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            <span class="comment">// Get list of blocks associated with the element&#39;s global unknowns.</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">element_pt</a>(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>)-&gt;<a class="code" href="../../dd/d46/classoomph_1_1GeneralisedElement.html#a29c6fb71cd7cabb29b4c289598aec601">get_dof_numbers_for_unknowns</a>(</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;              dof_lookup_list);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="comment">// Loop over all entries in the list</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="comment">// and store the block number.</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="keyword">typedef</span> std::list&lt;std::pair&lt;unsigned long, unsigned&gt;&gt;::iterator IT;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            <span class="keywordflow">for</span> (IT it = dof_lookup_list.begin(); it != dof_lookup_list.end();</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                 it++)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;              <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> global_dof = it-&gt;first;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;              <span class="keywordflow">if</span> (global_dof &gt;= <span class="keywordtype">unsigned</span>(<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>) &amp;&amp;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                  global_dof &lt;= <span class="keywordtype">unsigned</span>(last_row))</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;              {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                <span class="keywordtype">unsigned</span> dof_number = (it-&gt;second) + dof_offset;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[global_dof - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>] = dof_number;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                <span class="comment">// Check consistency of block numbers if assigned multiple times</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                <span class="keywordflow">if</span> (previously_assigned_block_number[global_dof - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>] &lt;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                    0)</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                  previously_assigned_block_number[global_dof - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>] =</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                    dof_number;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;              }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;          }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;          <span class="comment">// About to do the next mesh which contains block preconditionable</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;          <span class="comment">// elements of a different type; all the dofs that these elements are</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;          <span class="comment">// &quot;in charge of&quot; differ from the ones considered so far.</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;          <span class="comment">// Bump up the block counter to make sure we&#39;re not overwriting</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;          <span class="comment">// anything here</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;          dof_offset += ndof_in_element;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="comment">// check that every global equation number has been allocated a dof type</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;          <span class="keywordflow">if</span> (previously_assigned_block_number[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; 0)</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            std::ostringstream error_message;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            error_message &lt;&lt; <span class="stringliteral">&quot;Not all degrees of freedom have had DOF type &quot;</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;numbers allocated. Dof number &quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; is unallocated.&quot;</span>;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                                <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;          }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      <span class="comment">// else the problem is distributed</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <span class="comment">// Offset for the block type in the overall system.</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        <span class="comment">// Different meshes contain different block-preconditionable</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="comment">// elements -- their blocks are added one after the other...</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        <span class="keywordtype">unsigned</span> dof_offset = 0;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="comment">// the set of global degrees of freedom and their corresponding dof</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="comment">// number on this processor</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        std::map&lt;unsigned long, unsigned&gt; my_dof_map;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="comment">// Loop over all meshes</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> = 0; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>(); <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>++)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          <span class="comment">// Number of elements in this mesh</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;          <span class="keywordtype">unsigned</span> n_element = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#af01dfefb66c15579b540be62999d93ee">nelement</a>();</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; </div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;          <span class="comment">// Find the number of block types that the elements in this mesh</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;          <span class="comment">// are in charge of</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;          <span class="keywordtype">unsigned</span> ndof_in_element = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">ndof_types_in_mesh</a>(<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> += ndof_in_element;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160; </div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          <span class="comment">// Loop over all elements</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> = 0; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a> &lt; n_element; <a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>++)</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;          {</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            <span class="comment">// if the element is not a halo element</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>)-&gt;element_pt(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>)-&gt;is_halo())</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            {</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;              <span class="comment">// List containing pairs of global equation number and</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;              <span class="comment">// dof number for each global dof in an element</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;              std::list&lt;std::pair&lt;unsigned long, unsigned&gt;&gt; dof_lookup_list;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;              <span class="comment">// Get list of blocks associated with the element&#39;s global</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;              <span class="comment">// unknowns</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;              this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">element_pt</a>(<a class="code" href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a>)-&gt;<a class="code" href="../../dd/d46/classoomph_1_1GeneralisedElement.html#a29c6fb71cd7cabb29b4c289598aec601">get_dof_numbers_for_unknowns</a>(</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                dof_lookup_list);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;              <span class="comment">// update the block numbers and put it in the map.</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;              <span class="keyword">typedef</span> std::list&lt;std::pair&lt;unsigned long, unsigned&gt;&gt;::iterator</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                IT;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;              <span class="keywordflow">for</span> (IT it = dof_lookup_list.begin(); it != dof_lookup_list.end();</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                   it++)</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;              {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                it-&gt;second = (it-&gt;second) + dof_offset;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                my_dof_map[it-&gt;first] = it-&gt;second;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;              }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            }</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;          }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;          <span class="comment">// About to do the next mesh which contains block preconditionable</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;          <span class="comment">// elements of a different type; all the dofs that these elements are</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;          <span class="comment">// &quot;in charge of&quot; differ from the ones considered so far.</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;          <span class="comment">// Bump up the block counter to make sure we&#39;re not overwriting</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          <span class="comment">// anything here</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;          dof_offset += ndof_in_element;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="comment">// next copy the map of my dofs to two vectors to send</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <span class="keywordtype">unsigned</span> my_ndof = my_dof_map.size();</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* my_global_dofs = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>[my_ndof];</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordtype">unsigned</span>* my_dof_numbers = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[my_ndof];</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keyword">typedef</span> std::map&lt;unsigned long, unsigned&gt;::iterator IT;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordtype">unsigned</span> pt = 0;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordflow">for</span> (IT it = my_dof_map.begin(); it != my_dof_map.end(); it++)</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          my_global_dofs[pt] = it-&gt;first;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;          my_dof_numbers[pt] = it-&gt;second;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;          pt++;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        }</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="comment">// and then clear the map</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        my_dof_map.clear();</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <span class="comment">// count up how many DOFs need to be sent to each processor</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordtype">int</span>* first_dof_to_send = <span class="keyword">new</span> <span class="keywordtype">int</span>[nproc];</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="keywordtype">int</span>* ndof_to_send = <span class="keyword">new</span> <span class="keywordtype">int</span>[nproc];</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        {</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          first_dof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = 0;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          ndof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = 0;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          <span class="keywordflow">while</span> (ptr &lt; my_ndof &amp;&amp;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                 my_global_dofs[ptr] &lt; dense_required_rows(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 0))</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            ptr++;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;          }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;          first_dof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = ptr;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          <span class="keywordflow">while</span> (ptr &lt; my_ndof &amp;&amp;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                 my_global_dofs[ptr] &lt;= dense_required_rows(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, 1))</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            ndof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            ptr++;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;          }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        }</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <span class="comment">// next communicate to each processor how many dofs it expects to recv</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="keywordtype">int</span>* ndof_to_recv = <span class="keyword">new</span> <span class="keywordtype">int</span>[nproc];</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        MPI_Alltoall(ndof_to_send,</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                     1,</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                     MPI_INT,</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                     ndof_to_recv,</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                     1,</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                     MPI_INT,</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                     <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm());</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160; </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="comment">// the base displacements for the sends</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        MPI_Aint base_displacement;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        MPI_Get_address(my_global_dofs, &amp;base_displacement);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160; </div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="comment">// storage for paranoid check to ensure that every row as been</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <span class="comment">// imported</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        std::vector&lt;bool&gt; dof_recv(<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        <span class="comment">// next send and recv</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        Vector&lt;MPI_Request&gt; send_requests;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        Vector&lt;MPI_Request&gt; recv_requests;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        Vector&lt;unsigned long*&gt; global_dofs_recv(nproc, 0);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        Vector&lt;unsigned*&gt; dof_numbers_recv(nproc, 0);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        Vector&lt;unsigned&gt; proc;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          {</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            <span class="comment">// send</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;            <span class="keywordflow">if</span> (ndof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;              <span class="comment">// the datatypes, displacements, lengths for the two datatypes</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;              MPI_Datatype types[2];</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;              MPI_Aint displacements[2];</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;              <span class="keywordtype">int</span> lengths[2];</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;              <span class="comment">// my global dofs</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;              MPI_Type_contiguous(</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                ndof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED_LONG, &amp;types[0]);</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;              MPI_Type_commit(&amp;types[0]);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;              MPI_Get_address(my_global_dofs + first_dof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                              &amp;displacements[0]);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;              displacements[0] -= base_displacement;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;              lengths[0] = 1;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;              <span class="comment">// my dof numbers</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;              MPI_Type_contiguous(ndof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED, &amp;types[1]);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;              MPI_Type_commit(&amp;types[1]);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;              MPI_Get_address(my_dof_numbers + first_dof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                              &amp;displacements[1]);</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;              displacements[1] -= base_displacement;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;              lengths[1] = 1;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;              <span class="comment">// build the final type</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;              MPI_Datatype send_type;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;              MPI_Type_create_struct(</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                2, lengths, displacements, types, &amp;send_type);</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;              MPI_Type_commit(&amp;send_type);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;              MPI_Type_free(&amp;types[0]);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;              MPI_Type_free(&amp;types[1]);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160; </div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;              <span class="comment">// and send</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;              MPI_Request req;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;              MPI_Isend(my_global_dofs,</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                        1,</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                        send_type,</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                        <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                        2,</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                        <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                        &amp;req);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;              send_requests.push_back(req);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;              MPI_Type_free(&amp;send_type);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <span class="comment">// and recv</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            <span class="keywordflow">if</span> (ndof_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;              <span class="comment">// resize the storage</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;              global_dofs_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>[ndof_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;              dof_numbers_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[ndof_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;              proc.push_back(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160; </div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;              <span class="comment">// the datatypes, displacements, lengths for the two datatypes</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;              MPI_Datatype types[2];</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;              MPI_Aint displacements[2];</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;              <span class="keywordtype">int</span> lengths[2];</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;              <span class="comment">// my global dofs</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;              MPI_Type_contiguous(</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                ndof_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED_LONG, &amp;types[0]);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;              MPI_Type_commit(&amp;types[0]);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;              MPI_Get_address(global_dofs_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], &amp;displacements[0]);</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;              displacements[0] -= base_displacement;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;              lengths[0] = 1;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;              <span class="comment">// my dof numbers</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;              MPI_Type_contiguous(ndof_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED, &amp;types[1]);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;              MPI_Type_commit(&amp;types[1]);</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;              MPI_Get_address(dof_numbers_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], &amp;displacements[1]);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;              displacements[1] -= base_displacement;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;              lengths[1] = 1;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160; </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;              <span class="comment">// build the final type</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;              MPI_Datatype recv_type;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;              MPI_Type_create_struct(</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                2, lengths, displacements, types, &amp;recv_type);</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;              MPI_Type_commit(&amp;recv_type);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;              MPI_Type_free(&amp;types[0]);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;              MPI_Type_free(&amp;types[1]);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160; </div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;              <span class="comment">// and recv</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;              MPI_Request req;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;              MPI_Irecv(my_global_dofs,</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                        1,</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                        recv_type,</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                        <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                        2,</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                        <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                        &amp;req);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;              recv_requests.push_back(req);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;              MPI_Type_free(&amp;recv_type);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;          }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          <span class="comment">// send to self</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          {</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="keywordtype">unsigned</span> u = first_dof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] + ndof_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = first_dof_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; u; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            {</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;              <span class="comment">// indicate that this dof has ben recv</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;              dof_recv[my_global_dofs[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[my_global_dofs[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>] =</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                my_dof_numbers[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;          }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="comment">// recv and store the data</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordtype">unsigned</span> c_recv = recv_requests.size();</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="keywordflow">while</span> (c_recv &gt; 0)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;          <span class="comment">// wait for any communication to finish</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;          <span class="keywordtype">int</span> req_number;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;          MPI_Waitany(</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            c_recv, &amp;recv_requests[0], &amp;req_number, MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;          recv_requests.erase(recv_requests.begin() + req_number);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;          c_recv--;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160; </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;          <span class="comment">// determine the source processor</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = proc[req_number];</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;          proc.erase(proc.begin() + req_number);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;          <span class="comment">// import the data</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; ndof_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;          {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            <span class="comment">// indicate that this dof has ben recv</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            dof_recv[global_dofs_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[global_dofs_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>] =</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;              dof_numbers_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;          }</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;          <span class="comment">// delete the data</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;          <span class="keyword">delete</span>[] global_dofs_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;          <span class="keyword">delete</span>[] dof_numbers_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        <span class="comment">// finally wait for the send requests to complete as we are leaving</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <span class="comment">// an MPI block of code</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="keywordtype">unsigned</span> csr = send_requests.size();</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">if</span> (csr)</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;          MPI_Waitall(csr, &amp;send_requests[0], MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160; </div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="comment">// clean up</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="keyword">delete</span>[] ndof_to_send;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <span class="keyword">delete</span>[] first_dof_to_send;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="keyword">delete</span>[] ndof_to_recv;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="keyword">delete</span>[] my_global_dofs;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="keyword">delete</span>[] my_dof_numbers;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordtype">unsigned</span> all_recv = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        {</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;          <span class="keywordflow">if</span> (!dof_recv[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;          {</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            all_recv = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;          }</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        }</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">if</span> (!all_recv)</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        {</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;          std::ostringstream error_message;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;          error_message &lt;&lt; <span class="stringliteral">&quot;Not all the DOF numbers required were received&quot;</span>;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        }</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        error_message</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The problem appears to be distributed, MPI is required&quot;</span>;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      Vector&lt;unsigned*&gt; sparse_rows_for_proc(nproc, 0);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      Vector&lt;MPI_Request&gt; sparse_rows_for_proc_requests;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      <span class="keywordflow">if</span> (matrix_distributed)</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      {</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        <span class="comment">// wait for number of sparse rows each processor requires</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="comment">// post recvs for that data</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordflow">if</span> (recv_requests_sparse_nreq.size() &gt; 0)</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        {</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;          MPI_Waitall(recv_requests_sparse_nreq.size(),</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                      &amp;recv_requests_sparse_nreq[0],</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                      MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        }</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; ++<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;          <span class="keywordflow">if</span> (nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;          {</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            MPI_Request req;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            sparse_rows_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;            MPI_Irecv(sparse_rows_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                      nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                      MPI_UNSIGNED,</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                      32,</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                      <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                      &amp;req);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            sparse_rows_for_proc_requests.push_back(req);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;          }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160; </div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="comment">// for every global degree of freedom required by this processor we now</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="comment">// have the corresponding dof number</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160; </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="comment">// clear the Ndof_in_dof_block storage</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a>.assign(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>, 0);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160; </div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="comment">// first consider a non distributed matrix</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">if</span> (!matrix_distributed)</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="comment">// set the Index_in_dof_block</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#aafad0b69de2284808366b65bd63e493b">nrow</a>();</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>.resize(nrow);</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>.<a class="code" href="../../d4/df6/classoomph_1_1Vector.html#ad526bb1acccf11b485ebe12c9cde44fd">initialise</a>(0);</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        {</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]]++;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        }</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      }</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160; </div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="comment">// next a distributed matrix</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      {</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <span class="comment">// first compute how many instances of each dof are on this</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="comment">// processor</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="keywordtype">unsigned</span>* my_nrows_in_dof_block = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>];</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        {</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;          my_nrows_in_dof_block[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        }</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        {</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;          my_nrows_in_dof_block[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]]++;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        <span class="comment">// next share the data</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <span class="keywordtype">unsigned</span>* nrow_in_dof_block_recv =</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;          <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> * nproc];</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        MPI_Allgather(my_nrows_in_dof_block,</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>,</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                      MPI_UNSIGNED,</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                      nrow_in_dof_block_recv,</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>,</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                      MPI_UNSIGNED,</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                      <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm());</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keyword">delete</span>[] my_nrows_in_dof_block;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160; </div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="comment">// compute my first dof index and Nrows_in_dof_block</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        Vector&lt;unsigned&gt; my_first_dof_index(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>, 0);</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; my_rank; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;          {</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            my_first_dof_index[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] +=</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;              nrow_in_dof_block_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> * <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;          }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = my_first_dof_index[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = my_rank; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;          {</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] +=</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;              nrow_in_dof_block_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> * <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;          }</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        <span class="keyword">delete</span>[] nrow_in_dof_block_recv;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        <span class="comment">// next compute Index in dof block</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>.resize(<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>);</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>.<a class="code" href="../../d4/df6/classoomph_1_1Vector.html#ad526bb1acccf11b485ebe12c9cde44fd">initialise</a>(0);</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        Vector&lt;unsigned&gt; dof_counter(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>, 0);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        {</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] =</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            my_first_dof_index[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] +</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            dof_counter[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;          dof_counter[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]]++;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        }</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160; </div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        <span class="comment">// the base displacements for the sends</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordflow">if</span> (sparse_rows_for_proc_requests.size() &gt; 0)</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        {</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;          MPI_Waitall(sparse_rows_for_proc_requests.size(),</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                      &amp;sparse_rows_for_proc_requests[0],</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                      MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        }</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        MPI_Aint base_displacement;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        MPI_Get_address(dof_number_sparse_send, &amp;base_displacement);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>();</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> p = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; ++<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        {</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;          <span class="keywordflow">if</span> (nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;          {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            <span class="comment">// construct the data</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;            index_in_dof_block_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] =</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;              <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            dof_number_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; ++<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;            {</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;              <span class="keywordtype">unsigned</span> <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> = sparse_rows_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;              <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> -= <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;              index_in_dof_block_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] =</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>];</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;              dof_number_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>];</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;            }</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;            <span class="keyword">delete</span>[] sparse_rows_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;            <span class="comment">// send the data</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            <span class="comment">// the datatypes, displacements, lengths for the two datatypes</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            MPI_Datatype types[2];</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            MPI_Aint displacements[2];</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            <span class="keywordtype">int</span> lengths[2];</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <span class="comment">// index in dof block</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            MPI_Type_contiguous(</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;              nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED, &amp;types[0]);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            MPI_Type_commit(&amp;types[0]);</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            MPI_Get_address(index_in_dof_block_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                            &amp;displacements[0]);</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            displacements[0] -= base_displacement;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            lengths[0] = 1;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160; </div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            <span class="comment">// dof number</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;            MPI_Type_contiguous(</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;              nreq_sparse_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_UNSIGNED, &amp;types[1]);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            MPI_Type_commit(&amp;types[1]);</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            MPI_Get_address(dof_number_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], &amp;displacements[1]);</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            displacements[1] -= base_displacement;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;            lengths[1] = 1;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            <span class="comment">// build the final type</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            MPI_Datatype send_type;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;            MPI_Type_create_struct(</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;              2, lengths, displacements, types, &amp;send_type);</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            MPI_Type_commit(&amp;send_type);</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            MPI_Type_free(&amp;types[0]);</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            MPI_Type_free(&amp;types[1]);</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="comment">// and recv</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;            MPI_Request req;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            MPI_Isend(dof_number_sparse_send,</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                      1,</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                      send_type,</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                      33,</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                      <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                      &amp;req);</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            send_requests_sparse.push_back(req);</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            MPI_Type_free(&amp;send_type);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;          }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;          {</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            index_in_dof_block_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = 0;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;            dof_number_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = 0;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;          }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        }</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      }</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    }</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160; </div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="comment">// end of master block preconditioner only operations</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="comment">// compute the number of rows in each block</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160; </div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="comment">// check the vector is the correct length</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <span class="keywordflow">if</span> (dof_to_block_map.size() != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>)</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    {</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The dof_to_block_map vector (size=&quot;</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                    &lt;&lt; dof_to_block_map.size()</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;) must be of size Internal_ndof_types=&quot;</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                    &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    }</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160; </div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// find the maximum block number RAYAY use std::max_element</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keywordtype">unsigned</span> max_block_number = 0;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keywordflow">if</span> (dof_to_block_map[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] &gt; max_block_number)</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        max_block_number = dof_to_block_map[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      }</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="comment">// resize the storage the the block to dof map</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>.clear();</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>.resize(max_block_number + 1);</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">Ndof_in_block</a>.clear();</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">Ndof_in_block</a>.resize(max_block_number + 1);</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160; </div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="comment">// resize storage</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">Dof_number_to_block_number_lookup</a>.resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>);</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160; </div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <span class="comment">// build the storage for the two maps (block to dof) and (dof to block)</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">Dof_number_to_block_number_lookup</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = dof_to_block_map[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[dof_to_block_map[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]].push_back(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">Ndof_in_block</a>[dof_to_block_map[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]]++;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    }</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="comment">// paranoid check that every block number has at least one DOF associated</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="comment">// with it</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_block_number + 1; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>() == 0)</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      {</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;block number &quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; does not have any DOFs associated with it&quot;</span>;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <span class="keywordflow">throw</span> OomphLibWarning(error_message.str(),</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                              <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      }</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="comment">// Update the number of blocks types.</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a> = max_block_number + 1;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160; </div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="comment">// Distributed or not, depends on if we have more than one processor.</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">master_distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a05842d032d28880ae37951deae804ad8">distributed</a>();</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160; </div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="comment">// Create the new block distributions.</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>.resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <span class="keywordtype">unsigned</span> block_dim = 0;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">Ndof_in_block</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        block_dim +=</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">internal_dof_block_dimension</a>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      }</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] =</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="keyword">new</span> LinearAlgebraDistribution(<a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>(), block_dim, <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="comment">// Work out the distribution of the dof-level blocks.</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="comment">// Since several dof types may be coarsened into a single dof type.</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="comment">// We get the dof-level block distributions from the parent preconditioner.</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160; </div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="comment">// How many dof types are there?</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="comment">// Delete any pre-existing distributions.</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> dof_block_distribution_size =</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>.size();</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0; dof_i &lt; dof_block_distribution_size; dof_i++)</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      {</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        <span class="keyword">delete</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>[dof_i];</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      }</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndofs = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>();</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>.resize(ndofs, 0);</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160; </div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      <span class="comment">// For each dof type, work out how many parent preconditioner dof types</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="comment">// are in it.</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0; dof_i &lt; ndofs; dof_i++)</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      {</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="comment">// For each external dof, we get the dofs coarsened into it (from the</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        <span class="comment">// parent preconditioner level, not the most fine grain level).</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ncoarsened_dofs_in_dof_i =</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[dof_i].size();</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        Vector&lt;LinearAlgebraDistribution*&gt; tmp_dist_pt(ncoarsened_dofs_in_dof_i,</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                                                       0);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> parent_dof_i = 0; parent_dof_i &lt; ncoarsened_dofs_in_dof_i;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;             parent_dof_i++)</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        {</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;          tmp_dist_pt[parent_dof_i] =</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;dof_block_distribution_pt(</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                [<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[dof_i][parent_dof_i]]);</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        }</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160; </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>[dof_i] = <span class="keyword">new</span> LinearAlgebraDistribution;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160; </div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160; </div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;          tmp_dist_pt, *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>[dof_i]);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    }</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160; </div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="comment">// Create Block_distribution_pt</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    {</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      <span class="comment">// Delete any existing distributions in Block_distribution_pt.</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      <span class="comment">// (This should already be deleted in clear_block_preconditioner_base(...)</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="comment">// but we are just being extra safe!).</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      <span class="keywordtype">unsigned</span> n_existing_block_dist = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.size();</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dist_i = 0; dist_i &lt; n_existing_block_dist; dist_i++)</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      {</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="keyword">delete</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[dist_i];</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      }</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160; </div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.clear();</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160; </div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      <span class="comment">// Work out the distributions of the concatenated blocks.</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      <span class="keywordtype">unsigned</span> super_block_size = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>.size();</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.resize(super_block_size, 0);</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> super_block_i = 0; super_block_i &lt; super_block_size;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;           super_block_i++)</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      {</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        <span class="keywordtype">unsigned</span> sub_block_size = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[super_block_i].size();</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        Vector&lt;LinearAlgebraDistribution*&gt; tmp_dist_pt(sub_block_size, 0);</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160; </div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> sub_block_i = 0; sub_block_i &lt; sub_block_size;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;             sub_block_i++)</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        {</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;          tmp_dist_pt[sub_block_i] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">dof_block_distribution_pt</a>(</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[super_block_i][sub_block_i]);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        }</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160; </div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[super_block_i] = <span class="keyword">new</span> LinearAlgebraDistribution;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160; </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;          tmp_dist_pt, *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[super_block_i]);</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      }</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    } <span class="comment">// Creating Block_distribution_pt.</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160; </div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160; </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="comment">// Create the distribution of the preconditioner matrix,</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="comment">// if this preconditioner is a subsidiary preconditioner then it stored</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="comment">// at Distribution_pt;</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="comment">// if this preconditioner is a master preconditioner then it is stored</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    <span class="comment">// at Internal_preconditioner_matrix_distribution_pt.</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    LinearAlgebraDistribution dist;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>, dist);</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160; </div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="comment">// Build the distribution.</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    {</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac5340bac40b9559b0378037b57005203">build_distribution</a>(dist);</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    }</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    {</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">Internal_preconditioner_matrix_distribution_pt</a> =</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        <span class="keyword">new</span> LinearAlgebraDistribution(dist);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a> = <span class="keyword">new</span> LinearAlgebraDistribution;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>, *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a>);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160; </div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="comment">// Clear all distributions in Auxiliary_block_distribution_pt, except for</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="comment">// the one which corresponds to the preconditioner matrix distribution. This</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="comment">// is already deleted by clear_block_preconditioner_base(...)</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160; </div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="comment">// Create the key which corresponds to</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="comment">// preconditioner_matrix_distribution_pt.</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    {</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblocks = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.size();</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      Vector&lt;unsigned&gt; preconditioner_matrix_key(nblocks, 0);</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblocks; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      {</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        preconditioner_matrix_key[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      }</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="comment">// Now iterate through Auxiliary_block_distribution_pt and delete</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <span class="comment">// everything except for the value which corresponds to</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="comment">// preconditioner_matrix_key.</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      std::map&lt;Vector&lt;unsigned&gt;, LinearAlgebraDistribution*&gt;::iterator iter =</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.begin();</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordflow">while</span> (iter != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.end())</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;      {</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;first != preconditioner_matrix_key)</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        {</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;          <span class="keyword">delete</span> iter-&gt;second;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;          iter++;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        }</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        {</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;          ++iter;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        }</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      }</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160; </div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <span class="comment">// Clear it just to be safe!</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.clear();</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160; </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="comment">// Insert the preconditioner matrix distribution.</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">insert_auxiliary_block_distribution</a>(</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        preconditioner_matrix_key, <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a>);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    } <span class="comment">// End of Auxiliary_block_distribution_pt encapsulation.</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160; </div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <span class="comment">// Clearing up after comm to assemble sparse lookup schemes.</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keywordflow">if</span> (send_requests_sparse.size() &gt; 0)</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      MPI_Waitall(send_requests_sparse.size(),</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                  &amp;send_requests_sparse[0],</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                  MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    }</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">if</span> (recv_requests_sparse.size() &gt; 0)</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    {</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      MPI_Waitall(recv_requests_sparse.size(),</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                  &amp;recv_requests_sparse[0],</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                  MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    }</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    {</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      <span class="keyword">delete</span>[] index_in_dof_block_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <span class="keyword">delete</span>[] dof_number_sparse_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="keyword">delete</span>[] index_in_dof_block_sparse_send;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keyword">delete</span>[] dof_number_sparse_send;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keyword">delete</span>[] nreq_sparse;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <span class="keyword">delete</span>[] nreq_sparse_for_proc;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160; </div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    <span class="comment">// Next we assemble the lookup schemes for the rows</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="comment">// if the matrix is not distributed then we assemble Global_index</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="comment">// if the matrix is distributed then Rows_to_send_..., Rows_to_recv_... etc.</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>)</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="comment">// Resize the storage.</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>.resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>);</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      {</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a>());</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      }</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160; </div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="comment">// Compute:</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">master_nrow</a>();</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;      {</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        <span class="comment">// the dof type number;</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <span class="keywordtype">int</span> dof_number = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">internal_dof_number</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        <span class="keywordflow">if</span> (dof_number &gt;= 0)</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        {</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;          <span class="comment">// the block number;</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">block_number</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">Dof_number_to_block_number_lookup</a>[dof_number];</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;          <span class="comment">// the index in the block.</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">index_in_block</a> = 0;</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;          <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;          <span class="keywordflow">while</span> (<span class="keywordtype">int</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">block_number</a>][ptr]) !=</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                 dof_number)</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;          {</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">index_in_block</a> += <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">internal_dof_block_dimension</a>(</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">block_number</a>][ptr]);</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;            ptr++;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;          }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">index_in_block</a> += <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">internal_index_in_dof</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">block_number</a>][<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">index_in_block</a>] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    }</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="comment">// otherwise the matrix is distributed</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    {</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160; </div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      <span class="comment">// the pointer to the master distribution</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <span class="keyword">const</span> LinearAlgebraDistribution* <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">master_distribution_pt</a> =</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">master_distribution_pt</a>();</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160; </div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="comment">// resize the nrows... storage</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      Nrows_to_send_for_get_block.resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>, nproc);</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      Nrows_to_send_for_get_block.initialise(0);</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      Nrows_to_send_for_get_ordered.resize(nproc);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      Nrows_to_send_for_get_ordered.initialise(0);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160; </div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="comment">// loop over my rows</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">master_distribution_pt</a>-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">nrow_local</a>();</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">master_distribution_pt</a>-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>();</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      {</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        <span class="comment">// the block number</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(first_row + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160; </div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="comment">// check that the DOF i is associated with this preconditioner</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt;= 0)</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        {</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;          <span class="comment">// the block index</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(first_row + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160; </div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;          <span class="comment">// the processor this row will be sent to</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;          <span class="keywordtype">unsigned</span> block_p = 0;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;          <span class="keywordflow">while</span> (!(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>(block_p) &lt;= <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &amp;&amp;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                   (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>(block_p) +</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>(block_p) &gt;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                    <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>)))</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;          {</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;            block_p++;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;          }</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160; </div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;          <span class="comment">// and increment the counter</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;          Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)++;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;          Nrows_to_send_for_get_ordered[block_p]++;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        }</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      }</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160; </div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      <span class="comment">// resize the storage for Nrows_to_recv</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;      Nrows_to_recv_for_get_block.resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>, nproc);</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      Nrows_to_recv_for_get_block.initialise(0);</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      Nrows_to_recv_for_get_ordered.resize(nproc);</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      Nrows_to_recv_for_get_ordered.initialise(0);</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      <span class="comment">// next we send the number of rows that will be sent by this processor</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      Vector&lt;unsigned*&gt; nrows_to_send(nproc, 0);</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      Vector&lt;unsigned*&gt; nrows_to_recv(nproc, 0);</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      Vector&lt;MPI_Request&gt; send_requests_nrow;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      Vector&lt;MPI_Request&gt; recv_requests_nrow;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      Vector&lt;unsigned&gt; proc;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      {</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        {</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;          <span class="comment">// send</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;          proc.push_back(<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;          nrows_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>];</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;          {</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;            nrows_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;          }</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;          MPI_Request s_req;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;          MPI_Isend(nrows_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>,</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                    MPI_UNSIGNED,</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                    <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                    3,</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                    <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                    &amp;s_req);</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;          send_requests_nrow.push_back(s_req);</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160; </div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;          <span class="comment">// recv</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;          nrows_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span>[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>];</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;          MPI_Request r_req;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;          MPI_Irecv(nrows_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>,</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                    MPI_UNSIGNED,</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                    <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                    3,</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                    <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                    &amp;r_req);</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;          recv_requests_nrow.push_back(r_req);</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        }</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <span class="comment">// send to self</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        {</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;          {</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) =</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;              Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;          }</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;          Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;        }</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      }</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160; </div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="comment">// create some temporary storage for the global row indices that will</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      <span class="comment">// be received from another processor.</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;int*&gt;</a> block_rows_to_send(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>, nproc, 0);</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      Vector&lt;int*&gt; ordered_rows_to_send(nproc, 0);</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160; </div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;      <span class="comment">// resize the rows... storage</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      Rows_to_send_for_get_block.resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>, nproc);</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      Rows_to_send_for_get_block.initialise(0);</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      Rows_to_send_for_get_ordered.resize(nproc);</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      Rows_to_send_for_get_ordered.initialise(0);</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      Rows_to_recv_for_get_block.resize(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>, nproc);</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      Rows_to_recv_for_get_block.initialise(0);</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160; </div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;      <span class="comment">// resize the storage</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      {</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        {</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;          Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) =</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            <span class="keyword">new</span> <span class="keywordtype">int</span>[Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)];</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;          {</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;            block_rows_to_send(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) =</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;              <span class="keyword">new</span> <span class="keywordtype">int</span>[Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)];</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;          }</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;          {</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) =</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;              <span class="keyword">new</span> <span class="keywordtype">int</span>[Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)];</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;          }</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        }</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        Rows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] =</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;          <span class="keyword">new</span> <span class="keywordtype">int</span>[Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;      }</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160; </div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160; </div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      <span class="comment">// loop over my rows to allocate the nrows</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;unsigned&gt;</a> ptr_block(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>, nproc, 0);</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;      {</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        <span class="comment">// the block number</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(first_row + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160; </div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <span class="comment">// check that the DOF i is associated with this preconditioner</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt;= 0)</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        {</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;          <span class="comment">// the block index</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(first_row + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160; </div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;          <span class="comment">// the processor this row will be sent to</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;          <span class="keywordtype">unsigned</span> block_p = 0;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;          <span class="keywordflow">while</span> (!(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>(block_p) &lt;= <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &amp;&amp;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                   (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>(block_p) +</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>(block_p) &gt;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                    <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>)))</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;          {</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            block_p++;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;          }</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160; </div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;          <span class="comment">// and store the row</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;          Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)[ptr_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;          <span class="keywordflow">if</span> (block_p != my_rank)</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;          {</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;            block_rows_to_send(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)[ptr_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)] =</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;              <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> - <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;first_row(block_p);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;          }</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;          {</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)[ptr_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)] =</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;              <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> - <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;first_row(block_p);</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;          }</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;          ptr_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, block_p)++;</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        }</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;      }</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160; </div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;      <span class="comment">// next block ordered</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; ++<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      {</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <span class="keywordtype">int</span> pt = 0;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; ++<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>)</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        {</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); ++<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;          {</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;            Rows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][pt] =</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;              Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            pt++;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;          }</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        }</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      }</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160; </div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="comment">// next process the nrow recvs as they complete</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160; </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      <span class="comment">// recv and store the data</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = recv_requests_nrow.size();</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      <span class="keywordflow">while</span> (<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> &gt; 0)</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="comment">// wait for any communication to finish</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="keywordtype">int</span> req_number;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        MPI_Waitany(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>, &amp;recv_requests_nrow[0], &amp;req_number, MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        recv_requests_nrow.erase(recv_requests_nrow.begin() + req_number);</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>--;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160; </div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <span class="comment">// determine the source processor</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = proc[req_number];</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        proc.erase(proc.begin() + req_number);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160; </div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        <span class="comment">// copy the data to its final storage</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = 0;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        {</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;          Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) = nrows_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;          Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] += nrows_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        }</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160; </div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;        <span class="comment">// and clear</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        <span class="keyword">delete</span>[] nrows_to_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      }</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160; </div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      <span class="comment">// resize the storage for the incoming rows data</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      Rows_to_recv_for_get_ordered.resize(nproc, 0);</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      {</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        {</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;          {</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;            Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) =</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;              <span class="keyword">new</span> <span class="keywordtype">int</span>[Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)];</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;          }</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        }</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;      }</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160; </div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <span class="comment">// compute the number of sends and recv from this processor</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      <span class="comment">// to each other processor</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      Vector&lt;unsigned&gt; nsend_for_rows(nproc, 0);</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      Vector&lt;unsigned&gt; nrecv_for_rows(nproc, 0);</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      {</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        {</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;          {</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;            <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;            {</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;              nsend_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;            }</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;            <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;            {</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;              nrecv_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;            }</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;          }</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        }</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      }</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160; </div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      <span class="comment">// finally post the sends and recvs</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      MPI_Aint base_displacement;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      MPI_Get_address(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>(), &amp;base_displacement);</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      Vector&lt;MPI_Request&gt; req_rows;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      {</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        {</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;          <span class="comment">// send</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;          <span class="keywordflow">if</span> (nsend_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;          {</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            MPI_Datatype send_types[nsend_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            MPI_Aint send_displacements[nsend_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;            <span class="keywordtype">int</span> send_sz[nsend_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;            <span class="keywordtype">unsigned</span> send_ptr = 0;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;            {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;              <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;              {</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                MPI_Type_contiguous(Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                                    MPI_INT,</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                                    &amp;send_types[send_ptr]);</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                MPI_Type_commit(&amp;send_types[send_ptr]);</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                MPI_Get_address(block_rows_to_send(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                                &amp;send_displacements[send_ptr]);</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                send_displacements[send_ptr] -= base_displacement;</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                send_sz[send_ptr] = 1;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                send_ptr++;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;              }</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            }</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            MPI_Datatype final_send_type;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            MPI_Type_create_struct(nsend_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                                   send_sz,</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                                   send_displacements,</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                                   send_types,</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                                   &amp;final_send_type);</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            MPI_Type_commit(&amp;final_send_type);</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nsend_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            {</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;              MPI_Type_free(&amp;send_types[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            }</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;            MPI_Request send_req;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;            MPI_Isend(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>(),</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                      1,</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                      final_send_type,</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                      4,</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                      <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                      &amp;send_req);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;            req_rows.push_back(send_req);</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;            MPI_Type_free(&amp;final_send_type);</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;          }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160; </div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;          <span class="comment">// recv</span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;          <span class="keywordflow">if</span> (nrecv_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;          {</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            MPI_Datatype recv_types[nrecv_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;            MPI_Aint recv_displacements[nrecv_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;            <span class="keywordtype">int</span> recv_sz[nrecv_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;            <span class="keywordtype">unsigned</span> recv_ptr = 0;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;            {</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;              <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;              {</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                MPI_Type_contiguous(Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                                    MPI_INT,</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                                    &amp;recv_types[recv_ptr]);</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                MPI_Type_commit(&amp;recv_types[recv_ptr]);</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                MPI_Get_address(Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                                &amp;recv_displacements[recv_ptr]);</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                recv_displacements[recv_ptr] -= base_displacement;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                recv_sz[recv_ptr] = 1;</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                recv_ptr++;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;              }</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            }</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;            MPI_Datatype final_recv_type;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;            MPI_Type_create_struct(nrecv_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                                   recv_sz,</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                                   recv_displacements,</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                                   recv_types,</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                                   &amp;final_recv_type);</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            MPI_Type_commit(&amp;final_recv_type);</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nrecv_for_rows[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;            {</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;              MPI_Type_free(&amp;recv_types[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            }</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            MPI_Request recv_req;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;            MPI_Irecv(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>(),</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                      1,</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                      final_recv_type,</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                      4,</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                      <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;mpi_comm(),</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                      &amp;recv_req);</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            req_rows.push_back(recv_req);</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;            MPI_Type_free(&amp;final_recv_type);</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;          }</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        }</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      }</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160; </div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      <span class="comment">// cleaning up Waitalls</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160; </div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160; </div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      <span class="comment">// wait for the recv requests so we can compute</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      <span class="comment">// Nrows_to_recv_for_get_ordered</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      <span class="keywordtype">unsigned</span> n_req_rows = req_rows.size();</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="keywordflow">if</span> (n_req_rows)</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      {</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        MPI_Waitall(n_req_rows, &amp;req_rows[0], MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;      }</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160; </div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;      <span class="comment">// resize the storage</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      Rows_to_recv_for_get_ordered.resize(nproc);</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      Rows_to_recv_for_get_ordered.initialise(0);</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160; </div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <span class="comment">// construct block offset</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      Vector&lt;int&gt; vec_offset(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>, 0);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 1; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; ++<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>)</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      {</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        vec_offset[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = vec_offset[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> - 1] +</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> - 1]-&gt;nrow_local();</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      }</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160; </div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      {</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        <span class="keywordtype">int</span> pt = 0;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;        Rows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] =</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;          <span class="keyword">new</span> <span class="keywordtype">int</span>[Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        {</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;          {</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;            Rows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][pt] =</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;              Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] + vec_offset[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;            pt++;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;          }</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        }</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      }</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160; </div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      <span class="comment">// clean up</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        {</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;          {</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            <span class="keyword">delete</span>[] block_rows_to_send(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;          }</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;          {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;            <span class="keyword">delete</span>[] ordered_rows_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;          }</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;        }</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;      }</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160; </div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <span class="comment">// and the send reqs</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      <span class="keywordtype">unsigned</span> n_req_send_nrow = send_requests_nrow.size();</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <span class="keywordflow">if</span> (n_req_send_nrow)</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      {</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;        MPI_Waitall(n_req_send_nrow, &amp;send_requests_nrow[0], MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      }</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;      {</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;        <span class="keyword">delete</span>[] nrows_to_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;      }</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    }</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160; </div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <span class="comment">// If we asked for output of blocks to a file then do it.</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0bd0ab19a7501b79c16c1283766f0abb">block_output_on</a>()) <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adec848504d36ebcd8e27ec60f52f75a6">output_blocks_to_files</a>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">Output_base_filename</a>);</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  }</div>
<div class="ttc" id="aCwise__array__power__array_8cpp_html_a9eb5e92d9d691c1393e5e7c914731dbf"><div class="ttname"><a href="../../de/d2c/Cwise__array__power__array_8cpp.html#a9eb5e92d9d691c1393e5e7c914731dbf">e</a></div><div class="ttdeci">Array&lt; double, 1, 3 &gt; e(1./3., 0.5, 2.)</div></div>
<div class="ttc" id="aTutorial__Map__using_8cpp_html_a7fe964f6b1afd4591f637999272ab9a2"><div class="ttname"><a href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a></div><div class="ttdeci">float * p</div><div class="ttdef"><b>Definition:</b> Tutorial_Map_using.cpp:9</div></div>
<div class="ttc" id="abenchVecAdd_8cpp_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="../../db/ddc/benchVecAdd_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">Scalar Scalar int size</div><div class="ttdef"><b>Definition:</b> benchVecAdd.cpp:17</div></div>
<div class="ttc" id="aclassEigen_1_1Matrix_html"><div class="ttname"><a href="../../dc/d34/classEigen_1_1Matrix.html">Eigen::Matrix&lt; Scalar, Dynamic, Dynamic &gt;</a></div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a005d978655022d1a04da7397cf5d0e83"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">oomph::BlockPreconditioner::master_distribution_pt</a></div><div class="ttdeci">const LinearAlgebraDistribution * master_distribution_pt() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2017</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a015ba85d839a80512c6c4065e39a3d4a"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">oomph::BlockPreconditioner::Doftype_coarsen_map_coarse</a></div><div class="ttdeci">Vector&lt; Vector&lt; unsigned &gt; &gt; Doftype_coarsen_map_coarse</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3326</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a0ad82070ce2f6cdfa9ea6c7226ea28af"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">oomph::BlockPreconditioner::Index_in_dof_block_dense</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Index_in_dof_block_dense</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3415</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a0bd0ab19a7501b79c16c1283766f0abb"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0bd0ab19a7501b79c16c1283766f0abb">oomph::BlockPreconditioner::block_output_on</a></div><div class="ttdeci">bool block_output_on() const</div><div class="ttdoc">Test if output of blocks is on or not.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2088</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a1e0a33327b5042dfba04baf46c045373"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">oomph::BlockPreconditioner::internal_index_in_dof</a></div><div class="ttdeci">unsigned internal_index_in_dof(const unsigned &amp;i_dof) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3113</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a1ee4a9fcf226e8c4438fb25747cb6e93"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">oomph::BlockPreconditioner::dof_block_distribution_pt</a></div><div class="ttdeci">LinearAlgebraDistribution * dof_block_distribution_pt(const unsigned &amp;b)</div><div class="ttdoc">Access function to the dof-level block distributions.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1962</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a2d341eaf3312c7afcd663c7f4eba6fc2"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">oomph::BlockPreconditioner::Doftype_in_master_preconditioner_coarse</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Doftype_in_master_preconditioner_coarse</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3411</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a2f3a3ac8c192a83facd5b560f017413e"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2f3a3ac8c192a83facd5b560f017413e">oomph::BlockPreconditioner::Allow_multiple_element_type_in_mesh</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Allow_multiple_element_type_in_mesh</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3345</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a37b22a0a25030a4b08f2eaec261ae22b"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">oomph::BlockPreconditioner::Dof_number_dense</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Dof_number_dense</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3420</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a3a39411824a744d4569fe835dec13047"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a39411824a744d4569fe835dec13047">oomph::BlockPreconditioner::doftype_coarsen_map_fine</a></div><div class="ttdeci">Vector&lt; Vector&lt; unsigned &gt; &gt; doftype_coarsen_map_fine() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2334</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a3e5b553f65e6c25354a5c908d507e8ee"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">oomph::BlockPreconditioner::master_nrow</a></div><div class="ttdeci">unsigned master_nrow() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3222</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a45509677ccef78be13b5e4485312ddc1"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">oomph::BlockPreconditioner::ndof_types_in_mesh</a></div><div class="ttdeci">unsigned ndof_types_in_mesh(const unsigned &amp;i) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2037</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a4f3efe468cd6e133d6840ede8c3687b5"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner::internal_ndof_types</a></div><div class="ttdeci">unsigned internal_ndof_types() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2564</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a55900a517c9e354b9fc49624483b7273"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">oomph::BlockPreconditioner::Dof_dimension</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Dof_dimension</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3457</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a61561c20a262195f1bdacda515a2394b"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">oomph::BlockPreconditioner::Block_number_to_dof_number_lookup</a></div><div class="ttdeci">Vector&lt; Vector&lt; unsigned &gt; &gt; Block_number_to_dof_number_lookup</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3468</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a6fb68db9e79048615984b005f8aa43b3"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6fb68db9e79048615984b005f8aa43b3">oomph::BlockPreconditioner::any_mesh_distributed</a></div><div class="ttdeci">bool any_mesh_distributed() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3025</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a75742d54177935fb22e59d045209b11e"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">oomph::BlockPreconditioner::index_in_block</a></div><div class="ttdeci">int index_in_block(const unsigned &amp;i_dof) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1850</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a79ea9c428aa8533c371ef3f0048a3a92"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">oomph::BlockPreconditioner::Global_index</a></div><div class="ttdeci">Vector&lt; Vector&lt; unsigned &gt; &gt; Global_index</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3463</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a874cbe5520d546ee24004e229a48037e"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">oomph::BlockPreconditioner::Ndof_in_block</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Ndof_in_block</div><div class="ttdoc">Number of types of degree of freedom associated with each block.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3474</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a8a64cfc57ffd16b92ac78499de515138"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">oomph::BlockPreconditioner::block_number</a></div><div class="ttdeci">int block_number(const unsigned &amp;i_dof) const</div><div class="ttdoc">Return the block number corresponding to a global index i_dof.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1822</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a9ac4335ec07fc13f7bf1093fd0489c52"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner::is_subsidiary_block_preconditioner</a></div><div class="ttdeci">bool is_subsidiary_block_preconditioner() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2061</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a9b3c4072be2bf4f0dfdd18f56a5d51bf"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">oomph::BlockPreconditioner::insert_auxiliary_block_distribution</a></div><div class="ttdeci">void insert_auxiliary_block_distribution(const Vector&lt; unsigned &gt; &amp;block_vec_number, LinearAlgebraDistribution *dist_pt)</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2769</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_aa4e2e47f537f9b6b4deae5792c493d65"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">oomph::BlockPreconditioner::Doftype_coarsen_map_fine</a></div><div class="ttdeci">Vector&lt; Vector&lt; unsigned &gt; &gt; Doftype_coarsen_map_fine</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3334</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ab295a391e32dc00c4e56dfb0527ea354"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">oomph::BlockPreconditioner::Auxiliary_block_distribution_pt</a></div><div class="ttdeci">std::map&lt; Vector&lt; unsigned &gt;, LinearAlgebraDistribution * &gt; Auxiliary_block_distribution_pt</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3387</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ab84701c65bdfd8d2c14611176e5e6209"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">oomph::BlockPreconditioner::master_block_preconditioner_pt</a></div><div class="ttdeci">BlockPreconditioner&lt; MATRIX &gt; * master_block_preconditioner_pt() const</div><div class="ttdoc">Access function to the master block preconditioner pt.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2141</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_abb4dff3469cc6718103fddfdf3f3a7bb"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner::internal_dof_number</a></div><div class="ttdeci">int internal_dof_number(const unsigned &amp;i_dof) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3045</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_abe03c970690224b46a29e55e16992dd7"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">oomph::BlockPreconditioner::internal_dof_block_dimension</a></div><div class="ttdeci">unsigned internal_dof_block_dimension(const unsigned &amp;i) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3187</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_adec848504d36ebcd8e27ec60f52f75a6"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adec848504d36ebcd8e27ec60f52f75a6">oomph::BlockPreconditioner::output_blocks_to_files</a></div><div class="ttdeci">void output_blocks_to_files(const std::string &amp;basefilename, const unsigned &amp;precision=8) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2095</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ae2f496bfa8307485101a3b8ac57e8c71"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">oomph::BlockPreconditioner::Dof_number_to_block_number_lookup</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Dof_number_to_block_number_lookup</div><div class="ttdoc">Vector to the mapping from DOF number to block number.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3471</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ae8c06ce4f4baf8480a2f25b152031dad"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">oomph::BlockPreconditioner::Doftype_in_master_preconditioner_fine</a></div><div class="ttdeci">Vector&lt; unsigned &gt; Doftype_in_master_preconditioner_fine</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3404</div></div>
<div class="ttc" id="aclassoomph_1_1Data_html_ac56011da9a923069793ecc3cb54f5e20"><div class="ttname"><a href="../../d8/dc5/classoomph_1_1Data.html#ac56011da9a923069793ecc3cb54f5e20">oomph::Data::Is_unclassified</a></div><div class="ttdeci">static long Is_unclassified</div><div class="ttdef"><b>Definition:</b> nodes.h:192</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_a5505731e7e73d7e4251c67c7adec6bf5"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">oomph::DistributableLinearAlgebraObject::distributed</a></div><div class="ttdeci">bool distributed() const</div><div class="ttdoc">distribution is serial or distributed</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:493</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_a603105384d60c9a3710378af39f538b9"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt</a></div><div class="ttdeci">LinearAlgebraDistribution * distribution_pt() const</div><div class="ttdoc">access to the LinearAlgebraDistribution</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:457</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_a7569556f14fd68b28508920e89bd5eee"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">oomph::DistributableLinearAlgebraObject::nrow</a></div><div class="ttdeci">unsigned nrow() const</div><div class="ttdoc">access function to the number of global rows.</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:463</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_a9bd7e1d242c69a28da85a804a7717fce"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">oomph::DistributableLinearAlgebraObject::nrow_local</a></div><div class="ttdeci">unsigned nrow_local() const</div><div class="ttdoc">access function for the num of local rows on this processor.</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:469</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_ab00a3919b8634c698749f14a4d92947d"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">oomph::DistributableLinearAlgebraObject::first_row</a></div><div class="ttdeci">unsigned first_row() const</div><div class="ttdoc">access function for the first row on this processor</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:481</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_ac5340bac40b9559b0378037b57005203"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac5340bac40b9559b0378037b57005203">oomph::DistributableLinearAlgebraObject::build_distribution</a></div><div class="ttdeci">void build_distribution(const LinearAlgebraDistribution *const dist_pt)</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:507</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_ac9492d59cff9d9b0098712ae72989cd3"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ac9492d59cff9d9b0098712ae72989cd3">oomph::DistributableLinearAlgebraObject::DistributableLinearAlgebraObject</a></div><div class="ttdeci">DistributableLinearAlgebraObject()</div><div class="ttdoc">Default constructor - create a distribution.</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:438</div></div>
<div class="ttc" id="aclassoomph_1_1GeneralisedElement_html_a0c6037a870597b35dcf1c780710b9a56"><div class="ttname"><a href="../../dd/d46/classoomph_1_1GeneralisedElement.html#a0c6037a870597b35dcf1c780710b9a56">oomph::GeneralisedElement::ndof_types</a></div><div class="ttdeci">virtual unsigned ndof_types() const</div><div class="ttdef"><b>Definition:</b> elements.h:1202</div></div>
<div class="ttc" id="aclassoomph_1_1GeneralisedElement_html_a29c6fb71cd7cabb29b4c289598aec601"><div class="ttname"><a href="../../dd/d46/classoomph_1_1GeneralisedElement.html#a29c6fb71cd7cabb29b4c289598aec601">oomph::GeneralisedElement::get_dof_numbers_for_unknowns</a></div><div class="ttdeci">virtual void get_dof_numbers_for_unknowns(std::list&lt; std::pair&lt; unsigned long, unsigned &gt;&gt; &amp;dof_lookup_list) const</div><div class="ttdef"><b>Definition:</b> elements.h:1221</div></div>
<div class="ttc" id="aclassoomph_1_1LinearAlgebraDistribution_html_a05842d032d28880ae37951deae804ad8"><div class="ttname"><a href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a05842d032d28880ae37951deae804ad8">oomph::LinearAlgebraDistribution::distributed</a></div><div class="ttdeci">bool distributed() const</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:329</div></div>
<div class="ttc" id="aclassoomph_1_1LinearAlgebraDistribution_html_a2634e540a78fe1ee3f5c907aff500b58"><div class="ttname"><a href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">oomph::LinearAlgebraDistribution::first_row</a></div><div class="ttdeci">unsigned first_row() const</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:261</div></div>
<div class="ttc" id="aclassoomph_1_1LinearAlgebraDistribution_html_a2e4736826a65253f574d4f6f152ab514"><div class="ttname"><a href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">oomph::LinearAlgebraDistribution::communicator_pt</a></div><div class="ttdeci">OomphCommunicator * communicator_pt() const</div><div class="ttdoc">const access to the communicator pointer</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:335</div></div>
<div class="ttc" id="aclassoomph_1_1LinearAlgebraDistribution_html_aafad0b69de2284808366b65bd63e493b"><div class="ttname"><a href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#aafad0b69de2284808366b65bd63e493b">oomph::LinearAlgebraDistribution::nrow</a></div><div class="ttdeci">unsigned nrow() const</div><div class="ttdoc">access function to the number of global rows.</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:186</div></div>
<div class="ttc" id="aclassoomph_1_1LinearAlgebraDistribution_html_ac9310de740f9c3a61f8d5dab9bef88ca"><div class="ttname"><a href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">oomph::LinearAlgebraDistribution::nrow_local</a></div><div class="ttdeci">unsigned nrow_local() const</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:193</div></div>
<div class="ttc" id="aclassoomph_1_1Mesh_html_a16225f0094eeb234460f6cf963099c85"><div class="ttname"><a href="../../d6/db8/classoomph_1_1Mesh.html#a16225f0094eeb234460f6cf963099c85">oomph::Mesh::ndof_types</a></div><div class="ttdeci">unsigned ndof_types() const</div><div class="ttdoc">Return number of dof types in mesh.</div><div class="ttdef"><b>Definition:</b> mesh.cc:8764</div></div>
<div class="ttc" id="aclassoomph_1_1Mesh_html_a876faf1f87b24b220ea21a38d6adde5b"><div class="ttname"><a href="../../d6/db8/classoomph_1_1Mesh.html#a876faf1f87b24b220ea21a38d6adde5b">oomph::Mesh::element_pt</a></div><div class="ttdeci">GeneralisedElement *&amp; element_pt(const unsigned long &amp;e)</div><div class="ttdoc">Return pointer to element e.</div><div class="ttdef"><b>Definition:</b> mesh.h:448</div></div>
<div class="ttc" id="aclassoomph_1_1Mesh_html_af01dfefb66c15579b540be62999d93ee"><div class="ttname"><a href="../../d6/db8/classoomph_1_1Mesh.html#af01dfefb66c15579b540be62999d93ee">oomph::Mesh::nelement</a></div><div class="ttdeci">unsigned long nelement() const</div><div class="ttdoc">Return number of elements in the mesh.</div><div class="ttdef"><b>Definition:</b> mesh.h:590</div></div>
<div class="ttc" id="aclassoomph_1_1OomphCommunicator_html_a670b34aab05bfe0b96d0e0fabf583c7a"><div class="ttname"><a href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">oomph::OomphCommunicator::my_rank</a></div><div class="ttdeci">int my_rank() const</div><div class="ttdoc">my rank</div><div class="ttdef"><b>Definition:</b> communicator.h:176</div></div>
<div class="ttc" id="aclassoomph_1_1OomphCommunicator_html_a6c78c72666f4b102c2bccf200f0853b7"><div class="ttname"><a href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc</a></div><div class="ttdeci">int nproc() const</div><div class="ttdoc">number of processors</div><div class="ttdef"><b>Definition:</b> communicator.h:157</div></div>
<div class="ttc" id="aclassoomph_1_1Preconditioner_html_ada7219933e05d94f39a46a8ddb4c749a"><div class="ttname"><a href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">oomph::Preconditioner::comm_pt</a></div><div class="ttdeci">virtual const OomphCommunicator * comm_pt() const</div><div class="ttdoc">Get function for comm pointer.</div><div class="ttdef"><b>Definition:</b> preconditioner.h:171</div></div>
<div class="ttc" id="aclassoomph_1_1Vector_html_ad526bb1acccf11b485ebe12c9cde44fd"><div class="ttname"><a href="../../d4/df6/classoomph_1_1Vector.html#ad526bb1acccf11b485ebe12c9cde44fd">oomph::Vector::initialise</a></div><div class="ttdeci">void initialise(const _Tp &amp;__value)</div><div class="ttdoc">Iterate over all values and set to the desired value.</div><div class="ttdef"><b>Definition:</b> oomph-lib/src/generic/Vector.h:167</div></div>
<div class="ttc" id="alevel1__impl_8h_html_af1eb30bd79553c9e566435de1f82a94f"><div class="ttname"><a href="../../de/d6c/level1__impl_8h.html#af1eb30bd79553c9e566435de1f82a94f">copy</a></div><div class="ttdeci">EIGEN_BLAS_FUNC() copy(int *n, RealScalar *px, int *incx, RealScalar *py, int *incy)</div><div class="ttdef"><b>Definition:</b> level1_impl.h:32</div></div>
<div class="ttc" id="anamespaceUniformPSDSelfTest_html_a9ef26be0d5673c9bb0c2bb8bce5229d8"><div class="ttname"><a href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">UniformPSDSelfTest.r</a></div><div class="ttdeci">r</div><div class="ttdef"><b>Definition:</b> UniformPSDSelfTest.py:20</div></div>
<div class="ttc" id="anamespacecalibrate_html_a1919e193275bfcb62d1e5b79a3aea213"><div class="ttname"><a href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate.c</a></div><div class="ttdeci">int c</div><div class="ttdef"><b>Definition:</b> calibrate.py:100</div></div>
<div class="ttc" id="anamespaceoomph_1_1Global__string__for__annotation_html_ac5379de2fa7fe44f2cb31785fc208135"><div class="ttname"><a href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">oomph::Global_string_for_annotation::string</a></div><div class="ttdeci">std::string string(const unsigned &amp;i)</div><div class="ttdef"><b>Definition:</b> oomph_definitions.cc:286</div></div>
<div class="ttc" id="anamespaceoomph_1_1LinearAlgebraDistributionHelpers_html_af11187289196182ce650da88cfe37fc2"><div class="ttname"><a href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">oomph::LinearAlgebraDistributionHelpers::concatenate</a></div><div class="ttdeci">void concatenate(const Vector&lt; LinearAlgebraDistribution * &gt; &amp;in_distribution_pt, LinearAlgebraDistribution &amp;out_distribution)</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.cc:367</div></div>
<div class="ttc" id="asvd__common_8h_html_a4a86f5596ff1afa9113ff6cc07a60453"><div class="ttname"><a href="../../df/dc1/svd__common_8h.html#a4a86f5596ff1afa9113ff6cc07a60453">zero</a></div><div class="ttdeci">EIGEN_DONT_INLINE Scalar zero()</div><div class="ttdef"><b>Definition:</b> svd_common.h:232</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, and <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>.</p>

</div>
</div>
<a id="a7845d9301918e3f5cbecd729ec1e309b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7845d9301918e3f5cbecd729ec1e309b">&#9670;&nbsp;</a></span>clear_block_preconditioner_base()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::clear_block_preconditioner_base </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Clears all BlockPreconditioner data. Called by the destructor and the block_setup(...) methods </p>
<div class="fragment"><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    {</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a>.clear();</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160; </div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="comment">// clear the Distributions</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a30742aa2ac9abcfa037179f2d28ff43a">clear_distribution</a>();</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      <span class="keywordtype">unsigned</span> nblock = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>.size();</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      {</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        <span class="keyword">delete</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      }</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>.resize(0);</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160; </div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      <span class="comment">// clear the global index</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>.clear();</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160; </div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <span class="comment">// call the post block matrix assembly clear</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">post_block_matrix_assembly_partial_clear</a>();</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160; </div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <span class="comment">// storage if the matrix is distributed</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <span class="keywordtype">unsigned</span> nr = Rows_to_send_for_get_block.nrow();</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="keywordtype">unsigned</span> nc = Rows_to_send_for_get_block.ncol();</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;        <span class="keyword">delete</span>[] Rows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        <span class="keyword">delete</span>[] Rows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nr; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        {</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;          <span class="keyword">delete</span>[] Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;          <span class="keyword">delete</span>[] Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        }</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      }</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      Rows_to_recv_for_get_block.resize(0, 0);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      Nrows_to_recv_for_get_block.resize(0, 0);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      Rows_to_send_for_get_block.resize(0, 0);</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      Nrows_to_send_for_get_block.resize(0, 0);</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      Rows_to_recv_for_get_ordered.clear();</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      Nrows_to_recv_for_get_ordered.clear();</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      Rows_to_send_for_get_ordered.clear();</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      Nrows_to_send_for_get_ordered.clear();</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160; </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160; </div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      <span class="comment">// zero</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      {</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a> = 0;</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> = 0;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a> = 0;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      }</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160; </div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="comment">// delete the prec matrix dist pt</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keyword">delete</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">Internal_preconditioner_matrix_distribution_pt</a>;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">Internal_preconditioner_matrix_distribution_pt</a> = 0;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="keyword">delete</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a>;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a> = 0;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160; </div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      <span class="comment">// Delete any existing (external) block distributions.</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_existing_block_dist = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.size();</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dist_i = 0; dist_i &lt; n_existing_block_dist; dist_i++)</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      {</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        <span class="keyword">delete</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[dist_i];</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      }</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160; </div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;      <span class="comment">// Clear the vector.</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>.clear();</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160; </div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160; </div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="comment">// Create the identity key.</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      Vector&lt;unsigned&gt; preconditioner_matrix_key(n_existing_block_dist, 0);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_existing_block_dist; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      {</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        preconditioner_matrix_key[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      }</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160; </div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <span class="comment">// Now iterate through Auxiliary_block_distribution_pt</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="comment">// and delete all distributions, except for the one which corresponds</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <span class="comment">// to the identity since this is already deleted.</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      std::map&lt;Vector&lt;unsigned&gt;, LinearAlgebraDistribution*&gt;::iterator iter =</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.begin();</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160; </div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;      <span class="keywordflow">while</span> (iter != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.end())</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      {</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;first != preconditioner_matrix_key)</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        {</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;          <span class="keyword">delete</span> iter-&gt;second;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;          iter++;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        }</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        {</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;          ++iter;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        }</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      }</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160; </div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      <span class="comment">// Now clear it.</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.clear();</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160; </div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <span class="comment">// Delete any dof block distributions</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndof_block_dist = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>.size();</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0; dof_i &lt; ndof_block_dist; dof_i++)</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      {</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        <span class="keyword">delete</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>[dof_i];</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      }</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>.clear();</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160; </div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    } <span class="comment">// EOFunc clear_block_preconditioner_base()</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_aa760ae71a5aae488547ccf721d412b1e"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner::post_block_matrix_assembly_partial_clear</a></div><div class="ttdeci">void post_block_matrix_assembly_partial_clear()</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2120</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ad2cd49c5c823c4202046e97038f6e080"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">oomph::BlockPreconditioner::Replacement_dof_block_pt</a></div><div class="ttdeci">MapMatrix&lt; unsigned, CRDoubleMatrix * &gt; Replacement_dof_block_pt</div><div class="ttdoc">The replacement dof-level blocks.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3274</div></div>
<div class="ttc" id="aclassoomph_1_1DistributableLinearAlgebraObject_html_a30742aa2ac9abcfa037179f2d28ff43a"><div class="ttname"><a href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a30742aa2ac9abcfa037179f2d28ff43a">oomph::DistributableLinearAlgebraObject::clear_distribution</a></div><div class="ttdeci">void clear_distribution()</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:522</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">oomph::BlockPreconditioner&lt; MATRIX &gt;::Auxiliary_block_distribution_pt</a>, <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_distribution_pt</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a30742aa2ac9abcfa037179f2d28ff43a">oomph::DistributableLinearAlgebraObject::clear_distribution()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">oomph::BlockPreconditioner&lt; MATRIX &gt;::Global_index</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_nblock_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_ndof_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_preconditioner_matrix_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Nrow</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">oomph::BlockPreconditioner&lt; MATRIX &gt;::Preconditioner_matrix_distribution_pt</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">oomph::BlockPreconditioner&lt; MATRIX &gt;::Replacement_dof_block_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d31/classoomph_1_1GeneralPurposeBlockPreconditioner.html#a3272742d3c7f86327d33c5647af874e6">oomph::GeneralPurposeBlockPreconditioner&lt; MATRIX &gt;::clean_up_memory()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a78c33fc6f29101f027e22d64d158d567">oomph::BlockPreconditioner&lt; MATRIX &gt;::~BlockPreconditioner()</a>.</p>

</div>
</div>
<a id="a45b37f1934144d882831bf354f35d035"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45b37f1934144d882831bf354f35d035">&#9670;&nbsp;</a></span>disable_block_output_to_files()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::disable_block_output_to_files </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Turn off output of blocks (by clearing the basefilename string). </p>
<div class="fragment"><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    {</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">Output_base_filename</a>.clear();</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    } <span class="comment">// EOFunc disable_block_output_to_files()</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">oomph::BlockPreconditioner&lt; MATRIX &gt;::Output_base_filename</a>.</p>

</div>
</div>
<a id="a289db176ccafcc3719367fa98340f94d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a289db176ccafcc3719367fa98340f94d">&#9670;&nbsp;</a></span>document()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::document </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>debugging method to document the setup. Should only be called after block_setup(...). </p>
<div class="fragment"><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    {</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;===========================================&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Block Preconditioner Documentation&quot;</span> &lt;&lt; std::endl</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                 &lt;&lt; std::endl;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Number of DOF types: &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a>()</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                 &lt;&lt; std::endl;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Number of block types: &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>()</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                 &lt;&lt; std::endl;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      {</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>; d++)</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        {</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;          <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Master DOF number &quot;</span> &lt;&lt; d &lt;&lt; <span class="stringliteral">&quot; : &quot;</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                     &lt;&lt; this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">internal_master_dof_number</a>(d) &lt;&lt; std::endl;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        }</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      }</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>(); <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      {</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Block &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot; DOF types:&quot;</span>;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].size();</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;             <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        {</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;          <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        }</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      }</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Master block preconditioner distribution:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">master_distribution_pt</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Internal preconditioner matrix distribution:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a16de88bd5369e729d761a6498fdd3f">internal_preconditioner_matrix_distribution_pt</a>()</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                 &lt;&lt; std::endl;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Preconditioner matrix distribution:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74eeff188f842dd8abdff1b7d9801d44">preconditioner_matrix_distribution_pt</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;      {</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Internal block &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot; distribution:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] &lt;&lt; std::endl;</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      }</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>(); <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      {</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;Block &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot; distribution:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] &lt;&lt; std::endl;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;      }</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160; </div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="comment">// DS: the functions called here no longer exist and this function is</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="comment">// never used as far as I can tell, so it should be fine to comment this</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      <span class="comment">// bit out:</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      <span class="comment">// if (is_master_block_preconditioner())</span></div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      <span class="comment">//  {</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      <span class="comment">//   oomph_info &lt;&lt; &quot;First look-up row: &quot; &lt;&lt; this-&gt;first_lookup_row()</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <span class="comment">//              &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;      <span class="comment">//   oomph_info &lt;&lt; &quot;Number of look-up rows: &quot;</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      <span class="comment">//              &lt;&lt; this-&gt;nlookup_rows() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; <span class="stringliteral">&quot;===========================================&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;      <a class="code" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph_info</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    } <span class="comment">// EOFunc document()</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a3a16de88bd5369e729d761a6498fdd3f"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a16de88bd5369e729d761a6498fdd3f">oomph::BlockPreconditioner::internal_preconditioner_matrix_distribution_pt</a></div><div class="ttdeci">const LinearAlgebraDistribution * internal_preconditioner_matrix_distribution_pt() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3251</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a7297e4d24c2c7ae7af6a9ad009669928"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">oomph::BlockPreconditioner::internal_master_dof_number</a></div><div class="ttdeci">unsigned internal_master_dof_number(const unsigned &amp;b) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3238</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a74eeff188f842dd8abdff1b7d9801d44"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74eeff188f842dd8abdff1b7d9801d44">oomph::BlockPreconditioner::preconditioner_matrix_distribution_pt</a></div><div class="ttdeci">const LinearAlgebraDistribution * preconditioner_matrix_distribution_pt() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3267</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a7c2b9ed482db072b0cabe5a51eb76efa"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">oomph::BlockPreconditioner::internal_nblock_types</a></div><div class="ttdeci">unsigned internal_nblock_types() const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2522</div></div>
<div class="ttc" id="anamespaceoomph_html_aec474227917784dc0a255faf289cfc16"><div class="ttname"><a href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph::oomph_info</a></div><div class="ttdeci">OomphInfo oomph_info</div><div class="ttdef"><b>Definition:</b> oomph_definitions.cc:319</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_number_to_dof_number_lookup</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_master_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_nblock_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_nblock_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_ndof_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a16de88bd5369e729d761a6498fdd3f">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_preconditioner_matrix_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>, <a class="el" href="../../da/ddf/namespaceoomph.html#aec474227917784dc0a255faf289cfc16">oomph::oomph_info</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74eeff188f842dd8abdff1b7d9801d44">oomph::BlockPreconditioner&lt; MATRIX &gt;::preconditioner_matrix_distribution_pt()</a>.</p>

</div>
</div>
<a id="a1ee4a9fcf226e8c4438fb25747cb6e93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ee4a9fcf226e8c4438fb25747cb6e93">&#9670;&nbsp;</a></span>dof_block_distribution_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::dof_block_distribution_pt </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function to the dof-level block distributions. </p>
<div class="fragment"><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    {</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>())</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      {</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;You requested the distribution for the dof block &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>() &lt;&lt; <span class="stringliteral">&quot; DOF types.\n&quot;</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      }</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160; </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160; </div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      {</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>.size() == 0)</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        {</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;          std::ostringstream error_msg;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;          error_msg &lt;&lt; <span class="stringliteral">&quot;Internal block distributions are not set up.\n&quot;</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Have you called block_setup(...)?\n&quot;</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                    &lt;&lt; std::endl;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;            error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        }</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160; </div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="comment">// The dof block is distribution is the same as the internal</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        <span class="comment">// block distribution.</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      }</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>.size() == 0)</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        {</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;          std::ostringstream error_msg;</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;          error_msg &lt;&lt; <span class="stringliteral">&quot;Dof block distributions are not set up.\n&quot;</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Have you called block_setup(...)?\n&quot;</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                    &lt;&lt; std::endl;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;            error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      }</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    } <span class="comment">// EOFunc block_distribution_pt(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a0ae880f098d5b1e9df78fc74c31dbf">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_replacement_dof_block()</a>.</p>

</div>
</div>
<a id="a3a39411824a744d4569fe835dec13047"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a39411824a744d4569fe835dec13047">&#9670;&nbsp;</a></span>doftype_coarsen_map_fine()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; &gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::doftype_coarsen_map_fine </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Access function for the Doftype_coarsen_map_fine variable. </p>
<div class="fragment"><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    {</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>;</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">oomph::BlockPreconditioner&lt; MATRIX &gt;::Doftype_coarsen_map_fine</a>.</p>

</div>
</div>
<a id="a4c37f469646c689b5f1e79d0953bd588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c37f469646c689b5f1e79d0953bd588">&#9670;&nbsp;</a></span>get_block() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MATRIX <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;&#160;</td>
          <td class="paramname"><em>ignore_replacement_block</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return block (i,j). If the optional argument ignore_replacement_block is true, then any blocks in Replacement_dof_block_pt will be ignored throughout the preconditioning hierarchy. </p>
<div class="fragment"><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    {</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      MATRIX output_matrix;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">get_block</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, output_matrix, ignore_replacement_block);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="keywordflow">return</span> output_matrix;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    } <span class="comment">// EOFunc get_block(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a72b4dbe167da59d9ba12c7eff97d77e6"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner::get_block</a></div><div class="ttdeci">void get_block(const unsigned &amp;i, const unsigned &amp;j, MATRIX &amp;output_matrix, const bool &amp;ignore_replacement_block=false) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:673</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, and <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>.</p>

</div>
</div>
<a id="a72b4dbe167da59d9ba12c7eff97d77e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72b4dbe167da59d9ba12c7eff97d77e6">&#9670;&nbsp;</a></span>get_block() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MATRIX &amp;&#160;</td>
          <td class="paramname"><em>output_matrix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;&#160;</td>
          <td class="paramname"><em>ignore_replacement_block</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Put block (i,j) into output_matrix. This block accounts for any coarsening of dof types and any replaced dof-level blocks above this preconditioner. </p>
<div class="fragment"><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">// Check the range of i and j, they should not be greater than</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="comment">// nblock_types</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordtype">unsigned</span> n_block_types = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="keywordflow">if</span> ((i &gt; n_block_types) || (<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &gt; n_block_types))</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Requested block(&quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;but nblock_types() is &quot;</span> &lt;&lt; n_block_types &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Maybe your argument to block_setup(...) is incorrect?&quot;</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                &lt;&lt; std::endl;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="comment">// The logic is this:</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="comment">// Block_to_dof_map_coarse tells us which dof types belongs in each block.</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="comment">// This is relative to this preconditioner, and describes the external</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="comment">// block and dof type mappings (what the preconditioner writer</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="comment">// expects/sees).</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="comment">// As such, the dof types in Block_to_dof_map_coarse describes the</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="comment">// dof-level blocks needed to be concatenated to produce block(i,j). These</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="comment">// dofs may have been coarsened.</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="comment">// Now, the dof blocks to concatenate comes from:</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="comment">// If the dof block exists in Replacement_dof_block_pt, then we make a</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="comment">// deep copy of it. Otherwise, if this is the upper-most master block</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="comment">// preconditioner then we get it from the original matrix via function</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="comment">// internal_get_block(...) otherwise, if this is a subsidiary</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="comment">// block preconditioner, we go one level up the hierarchy and repeat the</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="comment">// process.</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="comment">// A small note about indirections which caused me some headache.</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="comment">// Thought I would mention it here in case the below code needs to be</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="comment">// re-visited.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="comment">// A small subtlety with indirections:</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="comment">// The underlying ordering of the dof-level blocks is STILL AND ALWAYS the</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="comment">// `natural&#39; ordering determined by first the elements then the order of</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="comment">// the meshes.</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="comment">// But during the process of block_setup(...), the external (perceived)</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="comment">// block ordering may have changed. So some indirection has to take place,</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="comment">// this mapping is maintained in Block_to_dof_map_coarse.</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="comment">// For example, take the Lagrangian preconditioner, which expects the</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="comment">// natural dof type ordering:</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="comment">// 0 1 2 3  4  5</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="comment">// u v p uc vc L</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="comment">// If the mapping given to block_setup(...) is:</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">// dof_to_block_map = [0, 1, 4, 2, 3, 5]</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="comment">// saying that: dof type 0 goes to block 0</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">//              dof type 1 goes to block 1</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">//              dof type 2 goes to block 4</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="comment">//              dof type 3 goes to block 2</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="comment">//              dof type 4 goes to block 3</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="comment">//              dof type 5 goes to block 5</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="comment">// The function block_setup(...) will populate the vector</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="comment">// Block_to_dof_map_coarse with [[0][1][3][4][2][5]],</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="comment">// which says that get_block(0,0) will get the u block</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="comment">//                 get_block(1,1) will get the v block</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="comment">//                 get_block(2,2) will get the uc block</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="comment">//                 get_block(3,3) will get the vc block</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="comment">//                 get_block(4,4) will get the p block</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="comment">//                 get_block(5,5) will get the L block</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="comment">// i.e. the ordering of the block types is a permutation of the dof types,</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="comment">// so that we now have the following block ordering:</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// 0 1 2  3  4 5 &lt;- block ordering</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="comment">// u v uc vc p L</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="comment">// Now, the writer expects to work with the block ordering. I.e. when we</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="comment">// replace a dof-level block, say the pressure block, we call</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="comment">// set_replacement_dof_block(4,4,Matrix);</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="comment">// Similarly, when we want the pressure block, we call</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="comment">// get_block(4,4);</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="comment">// Now, the below code uses the indirection maintained in</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="comment">// Block_to_dof_map_coarse. I.e. When we call get_block(4,4), we use the</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="comment">// mapping Block_to_dof_map_coarse[4] = 2, we get the block (2,2)</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="comment">// (from Replacement_dof_block_pt or internal_get_block), since the</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <span class="comment">// underlying dof_to_block mapping is still the identity, i.e. it has not</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="comment">// changed from:</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="comment">// 0 1 2 3  4  5</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="comment">// u v p uc vc L</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="comment">// So, block (4,4) (pressure block) maps to the block (2,2).</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="comment">// How many external dof types are in this block?</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndofblock_in_row = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndofblock_in_col = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>].size();</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="comment">// If there is only one dof block in this block then there is no need to</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="comment">// concatenate.</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordflow">if</span> (ndofblock_in_row == 1 &amp;&amp; ndofblock_in_col == 1)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="comment">// Get the indirection for the dof we want.</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> wanted_dof_row = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> wanted_dof_col = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>][0];</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="comment">// If the block has NOT been replaced or if we want to ignore the</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="comment">// replacement, then we call get_dof_level_block(...) which will get the</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="comment">// dof-level blocks up the preconditioning hierarchy, dragging down</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="comment">// any replacement dof blocks of parent preconditioners if required.</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a>.get(wanted_dof_row, wanted_dof_col) ==</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;             0) ||</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            ignore_replacement_block)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a314fc14d95f2833be66067cd5b45e093">get_dof_level_block</a>(wanted_dof_row,</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                              wanted_dof_col,</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                              output_matrix,</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                              ignore_replacement_block);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="comment">// Replacement_dof_block_pt.get(wanted_dof_row,wanted_dof_col) is not</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">// null, this means that the block has been replaced. We simply make</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="comment">// a deep copy of it.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          <a class="code" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a157511f700993ab8bc014f9d0d44f4c7">CRDoubleMatrixHelpers::deep_copy</a>(</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a>.get(wanted_dof_row, wanted_dof_col),</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            output_matrix);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="comment">// This block contains more than one dof-level block. So we need to</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="comment">// concatenate the (external) dof-level blocks.</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">// The CRDoubleMatrixHelpers::concatenate_without_communication(...)</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="comment">// takes a DenseMatrix of pointers to CRDoubleMatrices to concatenate.</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;CRDoubleMatrix*&gt;</a> tmp_blocks_pt(</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          ndofblock_in_row, ndofblock_in_col, 0);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="comment">// Vector of Vectors of unsigns to indicate whether we have created</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="comment">// CRDoubleMatrices with new or not... so we can delete it later.</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="comment">// 0 - no new CRDoubleMatrix is created.</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="comment">// 1 - a new CRDoubleMatrix is created.</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="comment">// If we ever use C++11, remove this and use smart pointers.</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        Vector&lt;Vector&lt;unsigned&gt;&gt; new_block(</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;          ndofblock_in_row, Vector&lt;unsigned&gt;(ndofblock_in_col, 0));</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="comment">// Loop through the number of dof block rows and then the number of dof</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <span class="comment">// block columns, either get the pointer from Replacement_dof_block_pt</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="comment">// or from get_dof_level_block(...).</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_dofblock = 0; row_dofblock &lt; ndofblock_in_row;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;             row_dofblock++)</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;          <span class="comment">// Indirection for the row, as discuss in the large chunk of text</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;          <span class="comment">// previously.</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> wanted_dof_row =</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][row_dofblock];</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_dofblock = 0; col_dofblock &lt; ndofblock_in_col;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;               col_dofblock++)</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;          {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <span class="comment">// Indirection for the column as discussed in the large chunk of</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="comment">// text above.</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> wanted_dof_col =</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>][col_dofblock];</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="comment">// Get the pointer from Replacement_dof_block_pt.</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            tmp_blocks_pt(row_dofblock, col_dofblock) =</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a>.get(wanted_dof_row, wanted_dof_col);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160; </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            <span class="comment">// If the pointer from Replacement_dof_block_pt is null, or if</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <span class="comment">// we have to ignore replacement blocks, build a new CRDoubleMatrix</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            <span class="comment">// via get_dof_level_block.</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keywordflow">if</span> ((tmp_blocks_pt(row_dofblock, col_dofblock) == 0) ||</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                ignore_replacement_block)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;              <span class="comment">// We have to create a new CRDoubleMatrix, so put in 1 to indicate</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;              <span class="comment">// that we have to delete it later.</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;              new_block[row_dofblock][col_dofblock] = 1;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;              <span class="comment">// Create the new CRDoubleMatrix. Note that we do not use the</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;              <span class="comment">// indirection, since the indirection is only used one way.</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;              tmp_blocks_pt(row_dofblock, col_dofblock) = <span class="keyword">new</span> CRDoubleMatrix;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;              <span class="comment">// Get the dof-level block, as discussed above.</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a314fc14d95f2833be66067cd5b45e093">get_dof_level_block</a>(wanted_dof_row,</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                                  wanted_dof_col,</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                                  *tmp_blocks_pt(row_dofblock, col_dofblock),</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                  ignore_replacement_block);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="comment">// Concatenation of matrices require the distribution of the individual</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="comment">// sub-matrices (for both row and column). This is because concatenation</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="comment">// is implemented without communication in such a way that the rows</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="comment">// and column values are both permuted, the permutation is defined by</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="comment">// the individual distributions of the sub blocks.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="comment">// Without a vector of distributions describing the distributions of</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="comment">// of the rows, we do not know how to permute the rows. For the columns,</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="comment">// although CRDoubleMatrices does not have a column distribution, the</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="comment">// concatenated matrix must have it&#39;s columns permuted, so we mirror</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="comment">// the diagonal and get the corresponding row distribution.</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="comment">// Confused? - Example: Say we have a matrix with dof blocking</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="comment">//   | a | b | c | d | e |</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="comment">// --|---|---|---|---|---|</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="comment">// a |   |   |   |   |   |</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="comment">// --|---|---|---|---|---|</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="comment">// b |   |   |   |   |   |</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="comment">// --|---|---|---|---|---|</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">// c |   |   |   |   |   |</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">// --|---|---|---|---|---|</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="comment">// d |   |   |   |   |   |</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="comment">// --|---|---|---|---|---|</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="comment">// e |   |   |   |   |   |</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="comment">// --|---|---|---|---|---|</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="comment">// We wish to concatenate the blocks</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="comment">//   | d | e |</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="comment">// --|---|---|</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="comment">// a |   |   |</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="comment">// --|---|---|</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="comment">// b |   |   |</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="comment">// --|---|---|</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="comment">// Then clearly the row distributions required are the distributions for</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">// the dof blocks a and b. But block(a,d) does not have a column</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment">// distribution since it is a CRDoubleMatrix! - We use the distribution</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="comment">// mirrored by the diagonal, so the column distributions required to</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="comment">// concatenate these blocks is the same as the distributions of the rows</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="comment">// for dof block d and e.</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="comment">// First we do the row distribution.</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="comment">// Storage for the row distribution pointers.</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        Vector&lt;LinearAlgebraDistribution*&gt; tmp_row_dist_pt(ndofblock_in_row, 0);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="comment">// Loop through the number of dof blocks in the row. For the upper-most</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="comment">// master block preconditioner, the external dof distributions is the</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="comment">// same as the internal BLOCK distributions. Recall what we said above</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="comment">// about the underlying blocks maintaining it&#39;s natural ordering.</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="comment">// If this is a subsidiary block preconditioner, then the distributions</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="comment">// for the dof blocks are stored in Dof_block_distribution_pt. The</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="comment">// reason why this is different for subsidiary block preconditioners is</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="comment">// because subsidiary block preconditioners would have it&#39;s dof types</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="comment">// coarsened. Then a single dof distribution in a subsidiary block</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="comment">// preconditioner could be a concatenation of many dof distributions of</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <span class="comment">// the master dof distributions.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_dof_i = 0; row_dof_i &lt; ndofblock_in_row; row_dof_i++)</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_dof_i = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>][row_dof_i];</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;          {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            tmp_row_dist_pt[row_dof_i] =</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[mapped_dof_i];</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;          }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;          {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            tmp_row_dist_pt[row_dof_i] =</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>[mapped_dof_i];</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="comment">// Storage for the column distribution pointers.</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        Vector&lt;LinearAlgebraDistribution*&gt; tmp_col_dist_pt(ndofblock_in_col, 0);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="comment">// We do the same thing as before.</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_dof_i = 0; col_dof_i &lt; ndofblock_in_col; col_dof_i++)</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_dof_j = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>[<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>][col_dof_i];</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;          {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            tmp_col_dist_pt[col_dof_i] =</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[mapped_dof_j];</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;          }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;          {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            tmp_col_dist_pt[col_dof_i] =</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">Dof_block_distribution_pt</a>[mapped_dof_j];</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="comment">// Perform the concatenation.</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <a class="code" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a996568831ca0db90f080560dd400b3d6">CRDoubleMatrixHelpers::concatenate_without_communication</a>(</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;          tmp_row_dist_pt, tmp_col_dist_pt, tmp_blocks_pt, output_matrix);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <span class="comment">// Delete any new CRDoubleMatrices we have created.</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_i = 0; row_i &lt; ndofblock_in_row; row_i++)</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_i = 0; col_i &lt; ndofblock_in_col; col_i++)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;          {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <span class="keywordflow">if</span> (new_block[row_i][col_i])</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;              <span class="keyword">delete</span> tmp_blocks_pt(row_i, col_i);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;          }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      } <span class="comment">// else need to concatenate</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    } <span class="comment">// EOFunc get_block(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a314fc14d95f2833be66067cd5b45e093"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a314fc14d95f2833be66067cd5b45e093">oomph::BlockPreconditioner::get_dof_level_block</a></div><div class="ttdeci">void get_dof_level_block(const unsigned &amp;i, const unsigned &amp;j, MATRIX &amp;output_block, const bool &amp;ignore_replacement_block=false) const</div></div>
<div class="ttc" id="anamespaceoomph_1_1CRDoubleMatrixHelpers_html_a157511f700993ab8bc014f9d0d44f4c7"><div class="ttname"><a href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a157511f700993ab8bc014f9d0d44f4c7">oomph::CRDoubleMatrixHelpers::deep_copy</a></div><div class="ttdeci">void deep_copy(const CRDoubleMatrix *const in_matrix_pt, CRDoubleMatrix &amp;out_matrix)</div><div class="ttdoc">Create a deep copy of the matrix pointed to by in_matrix_pt.</div><div class="ttdef"><b>Definition:</b> matrices.h:3490</div></div>
<div class="ttc" id="anamespaceoomph_1_1CRDoubleMatrixHelpers_html_a996568831ca0db90f080560dd400b3d6"><div class="ttname"><a href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a996568831ca0db90f080560dd400b3d6">oomph::CRDoubleMatrixHelpers::concatenate_without_communication</a></div><div class="ttdeci">void concatenate_without_communication(const Vector&lt; LinearAlgebraDistribution * &gt; &amp;row_distribution_pt, const Vector&lt; LinearAlgebraDistribution * &gt; &amp;col_distribution_pt, const DenseMatrix&lt; CRDoubleMatrix * &gt; &amp;matrix_pt, CRDoubleMatrix &amp;result_matrix)</div><div class="ttdef"><b>Definition:</b> matrices.cc:5223</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_to_dof_map_coarse</a>, <a class="el" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a996568831ca0db90f080560dd400b3d6">oomph::CRDoubleMatrixHelpers::concatenate_without_communication()</a>, <a class="el" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a157511f700993ab8bc014f9d0d44f4c7">oomph::CRDoubleMatrixHelpers::deep_copy()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a21867eb330dd1177c530a590ad1fa571">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a314fc14d95f2833be66067cd5b45e093">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_dof_level_block()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">oomph::BlockPreconditioner&lt; MATRIX &gt;::Replacement_dof_block_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4c37f469646c689b5f1e79d0953bd588">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9dae351352d344321ea82999d7003e17">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block_other_matrix()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a51636746e5921ee2845daf60b1c322dc">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_concatenated_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adec848504d36ebcd8e27ec60f52f75a6">oomph::BlockPreconditioner&lt; MATRIX &gt;::output_blocks_to_files()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a5806236b991ac2d7fe4bc7a4f19e98fb">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::solve()</a>, and <a class="el" href="../../df/df9/classoomph_1_1HelmholtzFGMRESMG.html#a36a1d601676df2ebe39fcdb7a0837864">oomph::HelmholtzFGMRESMG&lt; MATRIX &gt;::solve()</a>.</p>

</div>
</div>
<a id="afd37323d2b5ba31e2d14f3ce8e6e474d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd37323d2b5ba31e2d14f3ce8e6e474d">&#9670;&nbsp;</a></span>get_block_ordered_preconditioner_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_block_ordered_preconditioner_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given the naturally ordered vector, v, return the vector rearranged in block order in w. This function calls get_concatenated_block_vector(...) with the identity block mapping.</p>
<p>This function has been re-written to work with the new dof type coarsening feature. The old function is kept alive in internal_get_block_ordered_preconditioner_vector(...) and is moved to the private section of the code. The differences between the two are:</p>
<p>1) This function extracts all the block vectors (in one go) via the function internal_get_block_vectors(...), and concatenates them.</p>
<p>2) The old function makes use of the variables ending in "get_ordered", thus is slightly more efficient since it does not have to concatenate any block vectors.</p>
<p>3) The old function no longer respect the new indirections if dof types have been coarsened.</p>
<p>4) This function extracts the most fine grain dof-level vectors and concatenates them. These dof-level vectors respect the re-ordering caused by the coarsening of dof types. The overhead associated with concatenating DoubleVectors without communication is very small.</p>
<p>This function should be used. </p>
<div class="fragment"><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;  {</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;    {</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;    }</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt() != *this-&gt;master_distribution_pt())</div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;    {</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;    }</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160; </div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;    <span class="comment">// Get the number of blocks.</span></div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;    <span class="keywordtype">unsigned</span> nblocks = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160; </div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;    <span class="comment">// Fill in the identity mapping.</span></div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;    Vector&lt;unsigned&gt; block_vec_number(nblocks, 0);</div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblocks; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;    {</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;      block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>;</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    }</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160; </div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    <span class="comment">// Do the work.</span></div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af9321cdab3f506ab95fe51cd9b93deab">get_concatenated_block_vector</a>(block_vec_number, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>);</div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;  } <span class="comment">// get_block_ordered_preconditioner_vector(...)</span></div>
<div class="ttc" id="aArray__initializer__list__vector__cxx11_8cpp_html_a32398b762ddd48fa3a6d504de68009f9"><div class="ttname"><a href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a></div><div class="ttdeci">Array&lt; int, Dynamic, 1 &gt; v</div><div class="ttdef"><b>Definition:</b> Array_initializer_list_vector_cxx11.cpp:1</div></div>
<div class="ttc" id="aMatrix__resize__int_8cpp_html_aab236ce080522c9832217fd5f157541b"><div class="ttname"><a href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a></div><div class="ttdeci">RowVector3d w</div><div class="ttdef"><b>Definition:</b> Matrix_resize_int.cpp:3</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_af9321cdab3f506ab95fe51cd9b93deab"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af9321cdab3f506ab95fe51cd9b93deab">oomph::BlockPreconditioner::get_concatenated_block_vector</a></div><div class="ttdeci">void get_concatenated_block_vector(const Vector&lt; unsigned &gt; &amp;block_vec_number, const DoubleVector &amp;v, DoubleVector &amp;b)</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:2608</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, and <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.</p>

</div>
</div>
<a id="a9dae351352d344321ea82999d7003e17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9dae351352d344321ea82999d7003e17">&#9670;&nbsp;</a></span>get_block_other_matrix()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_block_other_matrix </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MATRIX *&#160;</td>
          <td class="paramname"><em>in_matrix_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MATRIX &amp;&#160;</td>
          <td class="paramname"><em>output_matrix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get a block from a different matrix using the blocking scheme that has already been set up. </p>
<div class="fragment"><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      MATRIX* backup_matrix_pt = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>();</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">set_master_matrix_pt</a>(in_matrix_pt);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">get_block</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, output_matrix, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">set_master_matrix_pt</a>(backup_matrix_pt);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    } <span class="comment">// EOFunc get_block_other_matrix(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a748e2ad8836bc8edf5b9a42373a7ad61"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">oomph::BlockPreconditioner::set_master_matrix_pt</a></div><div class="ttdeci">void set_master_matrix_pt(MATRIX *in_matrix_pt)</div><div class="ttdoc">Set the matrix_pt in the upper-most master preconditioner.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:998</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">oomph::BlockPreconditioner&lt; MATRIX &gt;::matrix_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_master_matrix_pt()</a>.</p>

</div>
</div>
<a id="a7efc9f2f0209764902e4e45fcb2556d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7efc9f2f0209764902e4e45fcb2556d1">&#9670;&nbsp;</a></span>get_block_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_block_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the naturally ordered vector, v and returns the n-th block vector, b. Here n is the block number in the current preconditioner. </p>
<div class="fragment"><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;  {</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    <span class="comment">// the number of blocks</span></div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_n_blocks = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160; </div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;    <span class="comment">// paranoid check that block i is in this block preconditioner</span></div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt;= para_n_blocks)</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;    {</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;Requested block vector &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, however this preconditioner has only &quot;</span> &lt;&lt; para_n_blocks</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; block types&quot;</span></div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;    }</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160; </div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;    {</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;    }</div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;    {</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    }</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160; </div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;    <span class="comment">// Recall that, the relationship between the external blocks and the</span></div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;    <span class="comment">// external dof types, as seen by the preconditioner writer is stored in the</span></div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;    <span class="comment">// mapping Block_to_dof_map_coarse.</span></div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;    <span class="comment">// However, each dof type could have been coarsened! The relationship</span></div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;    <span class="comment">// between the dof types of this preconditioner and the parent</span></div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;    <span class="comment">// preconditioner is stored in the mapping Doftype_coarsen_map_coarse. The</span></div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;    <span class="comment">// dof numbers in this map is relative to this preconditioner.</span></div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;    <span class="comment">// Finally, the relationship between the dof types of this preconditioner</span></div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    <span class="comment">// and the most fine grain dof types is stored in the mapping</span></div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    <span class="comment">// Doftype_coarsen_map_fine. Again, the dof numbers in this map is relative</span></div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;    <span class="comment">// to this preconditioner.</span></div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;    <span class="comment">// Furthermore, we note that concatenation of vectors without communication</span></div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;    <span class="comment">//  is associative, but not commutative. I.e.</span></div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;    <span class="comment">// (V1+V2)+V3 = V1 + (V2 + V3), where + is concatenation without</span></div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;    <span class="comment">// communication.</span></div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;    <span class="comment">// So all we need is the vectors listed in the correct order.</span></div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;    <span class="comment">// We need only Block_to_dof_map_coarse to tell us which external dof types</span></div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;    <span class="comment">// are in this block, then Doftype_coarsen_map_fine to tell us which most</span></div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;    <span class="comment">// fine grain dofs to concatenate!</span></div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    <span class="comment">// All the mapping vectors are constructed to respect the ordering of</span></div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;    <span class="comment">// the dof types.</span></div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160; </div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;    <span class="comment">// Get the most fine grain block to dof mapping.</span></div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;    Vector&lt;unsigned&gt; most_fine_grain_dof = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160; </div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;    <span class="comment">// How many vectors do we need to concatenate?</span></div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dof_vec = most_fine_grain_dof.size();</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160; </div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;    <span class="keywordflow">if</span> (n_dof_vec == 1)</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;    <span class="comment">// No need to concatenate, just extract the vector.</span></div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    {</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae3cf61f61e1aa50e2315e999827e7d59">internal_get_block_vector</a>(most_fine_grain_dof[0], <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>);</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;    }</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;    <span class="comment">// Need to concatenate dof-level vectors.</span></div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;    {</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;      Vector&lt;DoubleVector&gt; dof_vector(n_dof_vec);</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160; </div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;      <span class="comment">// Get all the dof-level vectors in one go</span></div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace6e9dbdfe9a1c3571452e2cd6ec9780">internal_get_block_vectors</a>(most_fine_grain_dof, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, dof_vector);</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;      <span class="comment">// Build w with the correct distribution.</span></div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;      <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.build(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>], 0);</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160; </div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;      <span class="comment">// Concatenate the vectors.</span></div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">DoubleVectorHelpers::concatenate_without_communication</a>(dof_vector, <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>);</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160; </div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      dof_vector.clear();</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;    }</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;  } <span class="comment">// get_block_vector(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ace6e9dbdfe9a1c3571452e2cd6ec9780"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace6e9dbdfe9a1c3571452e2cd6ec9780">oomph::BlockPreconditioner::internal_get_block_vectors</a></div><div class="ttdeci">void internal_get_block_vectors(const Vector&lt; unsigned &gt; &amp;block_vec_number, const DoubleVector &amp;v, Vector&lt; DoubleVector &gt; &amp;s) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:3131</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ae3cf61f61e1aa50e2315e999827e7d59"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae3cf61f61e1aa50e2315e999827e7d59">oomph::BlockPreconditioner::internal_get_block_vector</a></div><div class="ttdeci">void internal_get_block_vector(const unsigned &amp;n, const DoubleVector &amp;v, DoubleVector &amp;b) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:4009</div></div>
<div class="ttc" id="anamespaceoomph_1_1DoubleVectorHelpers_html_a3ea9f7c40548e1a88402312e6f15d1fc"><div class="ttname"><a href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">oomph::DoubleVectorHelpers::concatenate_without_communication</a></div><div class="ttdeci">void concatenate_without_communication(const Vector&lt; DoubleVector * &gt; &amp;in_vector_pt, DoubleVector &amp;out_vector)</div><div class="ttdef"><b>Definition:</b> double_vector.cc:1856</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">oomph::DoubleVectorHelpers::concatenate_without_communication()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, and <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.</p>

</div>
</div>
<a id="a0517a3678def8b89ae69840345a8f838"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0517a3678def8b89ae69840345a8f838">&#9670;&nbsp;</a></span>get_block_vectors() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the naturally ordered vector and rearranges it into a vector of sub vectors corresponding to the blocks, so s[b][i] contains the i-th entry in the vector associated with block b. Note: If the preconditioner is a subsidiary preconditioner then only the sub-vectors associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas the total length of the s vectors is Nrow. This is simply a wrapper around the other get_block_vectors(...) function where the block_vec_number Vector is the identity, i.e. block_vec_number is [0, 1, ..., nblock_types - 1]. </p>
<div class="fragment"><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  {</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    <span class="comment">// Get the number of blocks in this block preconditioner.</span></div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_block = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160; </div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="comment">// Create the identity vector.</span></div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    Vector&lt;unsigned&gt; required_block(n_block, 0);</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_block; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    {</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      required_block[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    }</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160; </div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;    <span class="comment">// Call the other function which does the work.</span></div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad356946d5de4f0817cdf8793fa3cdc74">get_block_vectors</a>(required_block, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>);</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ad356946d5de4f0817cdf8793fa3cdc74"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad356946d5de4f0817cdf8793fa3cdc74">oomph::BlockPreconditioner::get_block_vectors</a></div><div class="ttdeci">void get_block_vectors(const Vector&lt; unsigned &gt; &amp;block_vec_number, const DoubleVector &amp;v, Vector&lt; DoubleVector &gt; &amp;s) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:2939</div></div>
<div class="ttc" id="alevel1__cplx__impl_8h_html_a462761ca92ad97a9a705cb875828b0b8"><div class="ttname"><a href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a></div><div class="ttdeci">RealScalar s</div><div class="ttdef"><b>Definition:</b> level1_cplx_impl.h:130</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="ad356946d5de4f0817cdf8793fa3cdc74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad356946d5de4f0817cdf8793fa3cdc74">&#9670;&nbsp;</a></span>get_block_vectors() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_vec_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the naturally ordered vector and rearranges it into a vector of sub vectors corresponding to the blocks, so s[b][i] contains the i-th entry in the vector associated with block b. Note: If the preconditioner is a subsidiary preconditioner then only the sub-vectors associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas the total length of the s vectors is the sum of the lengths of the individual block vectors defined in block_vec_number. </p>
<div class="fragment"><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;  {</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160; </div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <span class="comment">// Check if v is built.</span></div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    {</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    }</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160; </div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="comment">// v must have the same distribution as the upper-most master block</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    <span class="comment">// preconditioner, since the upper-most master block preconditioner</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <span class="comment">// should have the same distribution as the matrix pointed to</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    <span class="comment">// by matrix_pt().</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    {</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;    }</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160; </div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;    <span class="comment">// Check to see if there are more blocks defined in the block_vec_number</span></div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <span class="comment">// vector than the number of block types. This is not allowed.</span></div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_nblock_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_block_vec_number_size = block_vec_number.size();</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    <span class="keywordflow">if</span> (para_block_vec_number_size &gt; para_nblock_types)</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    {</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;You have requested &quot;</span> &lt;&lt; para_block_vec_number_size</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; number of blocks, (block_vec_number.size() is &quot;</span></div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;              &lt;&lt; para_block_vec_number_size &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span></div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_nblock_types</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; nblock_types.\n&quot;</span></div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Please make sure that block_vec_number is correctly sized.\n&quot;</span>;</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    }</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160; </div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="comment">// Check if any block numbers defined in block_vec_number is equal to or</span></div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="comment">// greater than the number of block types.</span></div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="comment">// E.g. if there are 5 block types, we can only have block numbers:</span></div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    <span class="comment">//  0, 1, 2, 3 and 4.</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; para_block_vec_number_size; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    {</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_required_block = block_vec_number[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <span class="keywordflow">if</span> (para_required_block &gt; para_nblock_types)</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      {</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;block_vec_number[&quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;] is &quot;</span> &lt;&lt; para_required_block</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_nblock_types</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; nblock_types.\n&quot;</span>;</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;      }</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    }</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="comment">// Check that no block number is inserted twice.</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    std::set&lt;unsigned&gt; para_set;</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    {</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      std::pair&lt;std::set&lt;unsigned&gt;::iterator, <span class="keywordtype">bool</span>&gt; para_set_ret;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      para_set_ret = para_set.insert(block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]);</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160; </div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;      <span class="keywordflow">if</span> (!para_set_ret.second)</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      {</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Error: the block number &quot;</span> &lt;&lt; block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; appears twice.\n&quot;</span>;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      }</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;    }</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160; </div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    <span class="comment">// Number of blocks to get.</span></div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_block = block_vec_number.size();</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;    <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>.resize(n_block);</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160; </div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="comment">// Each block is made of dof types. We get the most fine grain dof types.</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;    <span class="comment">// Most fine grain in the sense that these are the dof types that belongs</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;    <span class="comment">// in this block before any coarsening of dof types has taken place.</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    <span class="comment">// The ordering of the dof types matters, this is handled properly when</span></div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="comment">// creating the Block_to_dof_map_fine vector and must be respected here.</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    <span class="comment">// I.e. we cannot arbitrarily insert dof types (even if they are correct)</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    <span class="comment">// in the vector most_fine_grain_dof.</span></div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    Vector&lt;unsigned&gt; most_fine_grain_dof;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; n_block; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    {</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_b = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160; </div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      most_fine_grain_dof.insert(most_fine_grain_dof.end(),</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].begin(),</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].end());</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    }</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160; </div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;    <span class="comment">// Get all the dof level vectors in one go.</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;    Vector&lt;DoubleVector&gt; dof_vector;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace6e9dbdfe9a1c3571452e2cd6ec9780">internal_get_block_vectors</a>(most_fine_grain_dof, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, dof_vector);</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160; </div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;    <span class="comment">// For each block vector requested,</span></div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    <span class="comment">// build the block s[b],</span></div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    <span class="comment">// concatenate the corresponding dof vector</span></div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160; </div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    <span class="comment">// Since all the dof vectors are in dof_vector,</span></div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    <span class="comment">// we need to loop through this.</span></div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="comment">// The offset helps us loop through this.</span></div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <span class="keywordtype">unsigned</span> offset = 0;</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160; </div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; n_block; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    {</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;      <span class="comment">// The actual block number required.</span></div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_b = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160; </div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;      <span class="comment">// How many most fine grain dofs are in this block?</span></div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dof = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].size();</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160; </div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      <span class="keywordflow">if</span> (n_dof == 1)</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      <span class="comment">// No need to concatenate, just copy the DoubleVector.</span></div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;      {</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;        <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = dof_vector[offset];</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;      }</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      <span class="comment">// Concatenate the relevant dof vectors into s[b].</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      {</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;        <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].build(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[mapped_b], 0);</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;        Vector&lt;DoubleVector*&gt; tmp_vec_pt(n_dof, 0);</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> vec_i = 0; vec_i &lt; n_dof; vec_i++)</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;        {</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;          tmp_vec_pt[vec_i] = &amp;dof_vector[offset + vec_i];</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;        }</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160; </div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">DoubleVectorHelpers::concatenate_without_communication</a>(tmp_vec_pt,</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;                                                               <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      }</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160; </div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      <span class="comment">// Update the offset.</span></div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;      offset += n_dof;</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;    }</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;  } <span class="comment">// get_block_vectors(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">oomph::DoubleVectorHelpers::concatenate_without_communication()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a7c1c50d1a0a7bdd8a3c5dc9bb777e9b3">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::update()</a>.</p>

</div>
</div>
<a id="a69fa79db7073f39a1ac5333c8bd9c1d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69fa79db7073f39a1ac5333c8bd9c1d5">&#9670;&nbsp;</a></span>get_blocks()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_blocks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html">DenseMatrix</a>&lt; <a class="el" href="../../d9/db9/classbool.html">bool</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>required_blocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html">DenseMatrix</a>&lt; MATRIX * &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_matrix_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get all the block matrices required by the block preconditioner. Takes a pointer to a matrix of bools that indicate if a specified sub-block is required for the preconditioning operation. Computes the required block matrices, and stores pointers to them in the matrix block_matrix_pt. If an entry in block_matrix_pt is equal to NULL on return, that sub-block has not been requested and is therefore not available.</p>
<p>WARNING: the matrix pointers are created using new so you must delete them all manually!</p>
<p>WARNING 2: the matrix pointers in block_matrix_pt MUST be null because Richard in all his wisdom decided to call delete on any non-null pointers. Presumably to avoid fixing his memory leaks properly...</p>
<p>Get the block matrices required for the block preconditioner. Takes a pointer to a matrix of bools that indicate if a specified sub-block is required for the preconditioning operation. Computes the required block matrices, and stores pointers to them in the matrix block_matrix_pt. If an entry in block_matrix_pt is equal to NULL that sub-block has not been requested and is therefore not available. </p>
<div class="fragment"><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <span class="comment">// Cache number of block types</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_block_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160; </div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    <span class="comment">// If required blocks matrix pointer is not the correct size then abort.</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    <span class="keywordflow">if</span> ((required_blocks.<a class="code" href="../../d6/d13/classoomph_1_1DenseMatrix.html#a1b425094510d833ffe91920747a0a962">nrow</a>() != n_block_types) ||</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        (required_blocks.<a class="code" href="../../d6/d13/classoomph_1_1DenseMatrix.html#a9937181f1cb4cfaed7aaf3b483c42456">ncol</a>() != n_block_types))</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    {</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The size of the matrix of bools required_blocks &quot;</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;(which indicates which blocks are required) is not the &quot;</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;right size, required_blocks is &quot;</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                    &lt;&lt; required_blocks.<a class="code" href="../../d6/d13/classoomph_1_1DenseMatrix.html#a9937181f1cb4cfaed7aaf3b483c42456">ncol</a>() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; required_blocks.<a class="code" href="../../d6/d13/classoomph_1_1DenseMatrix.html#a1b425094510d833ffe91920747a0a962">nrow</a>()</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;, whereas it should &quot;</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;be &quot;</span> &lt;&lt; n_block_types &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; n_block_types;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    }</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160; </div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <span class="comment">// If block matrix pointer is not the correct size then abort.</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    <span class="keywordflow">if</span> ((block_matrix_pt.nrow() != n_block_types) ||</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        (block_matrix_pt.ncol() != n_block_types))</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    {</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The size of the block matrix pt is not the &quot;</span></div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;right size, block_matrix_pt is &quot;</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                    &lt;&lt; block_matrix_pt.ncol() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; block_matrix_pt.nrow()</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;, whereas it should &quot;</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;be &quot;</span> &lt;&lt; n_block_types &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; n_block_types;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    }</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160; </div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160; </div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="comment">// Loop over the blocks</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_block_types; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    {</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; n_block_types; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      {</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        <span class="comment">// If block(i,j) is required then create a matrix and fill it in.</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;        <span class="keywordflow">if</span> (required_blocks(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>))</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;        {</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;          <span class="comment">//??ds might want to remove this use of new as well?</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;          block_matrix_pt(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>) = <span class="keyword">new</span> MATRIX;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">get_block</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, *block_matrix_pt(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>));</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        }</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160; </div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;        <span class="comment">// Otherwise set pointer to null.</span></div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        {</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;          block_matrix_pt(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>) = 0;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;        }</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      }</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    }</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1DenseMatrix_html_a1b425094510d833ffe91920747a0a962"><div class="ttname"><a href="../../d6/d13/classoomph_1_1DenseMatrix.html#a1b425094510d833ffe91920747a0a962">oomph::DenseMatrix::nrow</a></div><div class="ttdeci">unsigned long nrow() const</div><div class="ttdoc">Return the number of rows of the matrix.</div><div class="ttdef"><b>Definition:</b> matrices.h:485</div></div>
<div class="ttc" id="aclassoomph_1_1DenseMatrix_html_a9937181f1cb4cfaed7aaf3b483c42456"><div class="ttname"><a href="../../d6/d13/classoomph_1_1DenseMatrix.html#a9937181f1cb4cfaed7aaf3b483c42456">oomph::DenseMatrix::ncol</a></div><div class="ttdeci">unsigned long ncol() const</div><div class="ttdoc">Return the number of columns of the matrix.</div><div class="ttdef"><b>Definition:</b> matrices.h:491</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html#a9937181f1cb4cfaed7aaf3b483c42456">oomph::DenseMatrix&lt; T &gt;::ncol()</a>, <a class="el" href="../../d6/d13/classoomph_1_1DenseMatrix.html#a1b425094510d833ffe91920747a0a962">oomph::DenseMatrix&lt; T &gt;::nrow()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="a51636746e5921ee2845daf60b1c322dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51636746e5921ee2845daf60b1c322dc">&#9670;&nbsp;</a></span>get_concatenated_block()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MATRIX <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_concatenated_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/dea/classoomph_1_1VectorMatrix.html">VectorMatrix</a>&lt; <a class="el" href="../../dd/da7/classoomph_1_1BlockSelector.html">BlockSelector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>selected_block</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns a concatenation of the block matrices specified by the argument selected_block. The VectorMatrix selected_block must be correctly sized as it is used to determine the number of sub block matrices to concatenate.</p>
<p>For each entry in the VectorMatrix, the following variables must correctly set: BlockSelector::Row_index - Refers to the row index of the block. BlockSelector::Column_index - Refers to the column index of the block. BlockSelector::Wanted - Do we want the block? BlockSelector::Replacement_block_pt - If not null, this block will be used instead of get_block(Row_index,Column_index).</p>
<p>For example, assume that we have a matrix of the following blocking: 0 1 2 3 4 | a | b | c | d | e | &ndash;|&mdash;|&mdash;|&mdash;|&mdash;|&mdash;| </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">0 a   </th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1 b   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&ndash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2 c   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&ndash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3 d   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&ndash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4 e   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&ndash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td><td class="markdownTableBodyNone">&mdash;   </td></tr>
</table>
<p>If we want a block matrix corresponding to the concatenation of the blocks [(a,d), (a,e) , (b,e)* ] where top left and top right blocks comes from the function get_block(...), the bottom left entry is empty, and the bottom right is a modified block.</p>
<p>Then we create a VectorMatrix of size 2 by 2 VectorMatrix&lt;BlockSelector&gt; selected_block(2,2);</p>
<p>In the [0][0] entry: row index is 0, column index is 3, do we want this block? - yes (true). selected_block[0][0].select_block(0,3,true);</p>
<p>In the [0][1] entry: row index is 0, column index is 4, do we want this block? - yes (true). selected_block[0][0].select_block(0,4,true);</p>
<p>In the [1][0] entry: row index is 1, column index is 3, do we want this block? - no (false). selected_block[0][0].select_block(1,3,false);</p>
<p>In the [1][1] entry: row index is 1, column index is 4, do we want this block? - yes (true). selected_block[0][0].select_block(1,4,true,block_pt);</p>
<p>where block_pt is a pointer to the modified block.</p>
<p>Then we can call:</p>
<p>CRDoubleMatrix my_block = get_concatenated_block(selected_block);</p>
<p>NOTE: It is important to set the row and column indices even if you do not want the block. This is because, if we allow the row and column indices to be "not set", then we can have a whole empty block row without any indices. But concatenation of blocks without communication requires both the row and column distributions, so we know how to permute the rows and columns. So in short, we require that the column and row indices to always be set for every entry in the VectorMatrix&lt;BlockSelector&gt; object for convenience and consistency checks. </p>
<div class="fragment"><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    {</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160; </div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keyword">const</span> para_selected_block_nrow = selected_block.nrow();</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keyword">const</span> para_selected_block_ncol = selected_block.ncol();</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keyword">const</span> para_nblocks = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      <span class="comment">// Check that selected_block size is not 0.</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="keywordflow">if</span> (para_selected_block_nrow == 0)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      {</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;selected_block has nrow = 0.\n&quot;</span>;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      }</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; </div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="comment">// Check that the number of blocks is not outside of the range</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="comment">// nblock_types(). Since this function builds matrices for block</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="comment">// preconditioning, it does not make sense for us to concatenate more</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="comment">// blocks than nblock_types().</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="keywordflow">if</span> ((para_selected_block_nrow &gt; para_nblocks) ||</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          (para_selected_block_ncol &gt; para_nblocks))</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;Trying to concatenate a &quot;</span> &lt;&lt; para_selected_block_nrow</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; by &quot;</span> &lt;&lt; para_selected_block_ncol &lt;&lt; <span class="stringliteral">&quot; block matrix,\n&quot;</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;but there are only &quot;</span> &lt;&lt; para_nblocks &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      }</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="comment">// Check that selected_block make sense, i.e. the row indices of each row</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <span class="comment">// are the same, and the column indices of each column are the same.</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <span class="comment">// First check if the row indices are consistent.</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <span class="comment">// For each row, loop through the columns, comparing the row index against</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <span class="comment">// the first column.</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_i = 0; row_i &lt; para_selected_block_nrow; row_i++)</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> col_0_row_index = selected_block[row_i][0].row_index();</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_i = 0; col_i &lt; para_selected_block_ncol; col_i++)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_i = selected_block[row_i][col_i].row_index();</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_j = selected_block[row_i][col_i].column_index();</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;          <span class="keywordflow">if</span> (col_0_row_index != para_b_i)</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;          {</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            std::ostringstream err_msg;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            err_msg &lt;&lt; <span class="stringliteral">&quot;Block index for block(&quot;</span> &lt;&lt; row_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; col_i &lt;&lt; <span class="stringliteral">&quot;) &quot;</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;contains block indices (&quot;</span> &lt;&lt; para_b_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; para_b_j</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;But the row index for the first column is &quot;</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                    &lt;&lt; col_0_row_index &lt;&lt; <span class="stringliteral">&quot;, they must be the same!\n&quot;</span>;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;              err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;          }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      <span class="comment">// Do the same for the column indices, consistency check.</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <span class="comment">// For each column, loop through the rows, comparing the column index</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="comment">// against the first row.</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_i = 0; col_i &lt; para_selected_block_ncol; col_i++)</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> row_0_col_index =</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;          selected_block[0][col_i].column_index();</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_i = 0; row_i &lt; para_selected_block_nrow; row_i++)</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        {</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_i = selected_block[row_i][col_i].row_index();</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_j = selected_block[row_i][col_i].column_index();</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;          <span class="keywordflow">if</span> (row_0_col_index != para_b_j)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;          {</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            std::ostringstream err_msg;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;            err_msg &lt;&lt; <span class="stringliteral">&quot;Block index for block(&quot;</span> &lt;&lt; row_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; col_i &lt;&lt; <span class="stringliteral">&quot;) &quot;</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;contains block indices (&quot;</span> &lt;&lt; para_b_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; para_b_j</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;But the col index for the first row is &quot;</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                    &lt;&lt; row_0_col_index &lt;&lt; <span class="stringliteral">&quot;, they must be the same!\n&quot;</span>;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;              err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          }</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <span class="comment">// Check to see if the values in selected_block is within the range</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="comment">// nblock_types()</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="comment">// Since we know that the column and row indices are consistent (by the</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      <span class="comment">// two paranoia checks above), we only need to check the column indices</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="comment">// in the first row, and the row indices in the first column.</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="comment">// Check that the row indices in the first column are within the range</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="comment">// nblock_types()</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_i = 0; row_i &lt; para_selected_block_nrow; row_i++)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_i = selected_block[row_i][0].row_index();</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_j = selected_block[row_i][0].column_index();</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">if</span> (para_b_i &gt; para_nblocks)</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;          std::ostringstream err_msg;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;          err_msg &lt;&lt; <span class="stringliteral">&quot;Block index for block(&quot;</span> &lt;&lt; row_i &lt;&lt; <span class="stringliteral">&quot;,0) &quot;</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;contains block indices (&quot;</span> &lt;&lt; para_b_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; para_b_j</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_nblocks</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; nblock_types().\n&quot;</span>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        }</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      }</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160; </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      <span class="comment">// Check that the col indices in the first row are within the range</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="comment">// nblock_types()</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_i = 0; col_i &lt; para_selected_block_ncol; col_i++)</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_i = selected_block[0][col_i].row_index();</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_b_j = selected_block[0][col_i].column_index();</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        <span class="keywordflow">if</span> (para_b_j &gt; para_nblocks)</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        {</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;          std::ostringstream err_msg;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          err_msg &lt;&lt; <span class="stringliteral">&quot;Block index for block(0,&quot;</span> &lt;&lt; col_i &lt;&lt; <span class="stringliteral">&quot;) &quot;</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;contains block indices (&quot;</span> &lt;&lt; para_b_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; para_b_j</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_nblocks</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; nblock_types().\n&quot;</span>;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        }</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="comment">// Stricter test - can be removed is required in the future. For the first</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="comment">// column, check that the row indices does not repeat.</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      std::set&lt;unsigned&gt; row_index_set;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_i = 0; row_i &lt; para_selected_block_nrow; row_i++)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      {</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        std::pair&lt;std::set&lt;unsigned&gt;::iterator, <span class="keywordtype">bool</span>&gt; row_index_set_ret;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160; </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> row_i_index = selected_block[row_i][0].row_index();</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        row_index_set_ret = row_index_set.insert(row_i_index);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="keywordflow">if</span> (!row_index_set_ret.second)</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;          std::ostringstream err_msg;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;          err_msg &lt;&lt; <span class="stringliteral">&quot;The row &quot;</span> &lt;&lt; row_i_index &lt;&lt; <span class="stringliteral">&quot; is already inserted.\n&quot;</span>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      }</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160; </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="comment">// Stricter test - can be removed is required in the future. For the first</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="comment">// row, check that the column indices does not repeat.</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      std::set&lt;unsigned&gt; col_index_set;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_i = 0; col_i &lt; para_selected_block_ncol; col_i++)</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        std::pair&lt;std::set&lt;unsigned&gt;::iterator, <span class="keywordtype">bool</span>&gt; col_index_set_ret;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> col_i_index = selected_block[0][col_i].column_index();</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160; </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        col_index_set_ret = col_index_set.insert(col_i_index);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="keywordflow">if</span> (!col_index_set_ret.second)</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          std::ostringstream err_msg;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;          err_msg &lt;&lt; <span class="stringliteral">&quot;The col &quot;</span> &lt;&lt; col_i_index &lt;&lt; <span class="stringliteral">&quot; is already inserted.\n&quot;</span>;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        }</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      }</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160; </div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      <span class="comment">// Loop through all the block_pt and check:</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="comment">// 1) The non-null pointers point to built matrices.</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <span class="comment">// 2) The distribution matches those defined by selected_block within</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="comment">//    Block_distribution_pt.</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_i = 0; block_i &lt; para_selected_block_nrow; block_i++)</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_j = 0; block_j &lt; para_selected_block_ncol;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;             block_j++)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        {</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          <span class="keyword">const</span> CRDoubleMatrix* tmp_block_pt =</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            selected_block[block_i][block_j].replacement_block_pt();</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;          <span class="keywordflow">if</span> (tmp_block_pt != 0)</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;          {</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <span class="keywordflow">if</span> (!tmp_block_pt-&gt;built())</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;              std::ostringstream err_msg;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;              err_msg &lt;&lt; <span class="stringliteral">&quot;The matrix pointed to by block(&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                      &lt;&lt; block_j &lt;&lt; <span class="stringliteral">&quot;) is not built.\n&quot;</span>;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;              <span class="keywordflow">throw</span> OomphLibError(err_msg.str(),</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            }</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160; </div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            <span class="keyword">const</span> LinearAlgebraDistribution* <span class="keyword">const</span> tmp_block_dist_pt =</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;              tmp_block_pt-&gt;distribution_pt();</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160; </div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> row_selected_block =</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;              selected_block[block_i][block_j].row_index();</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160; </div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;            <span class="keyword">const</span> LinearAlgebraDistribution* <span class="keyword">const</span> another_tmp_block_dist_pt =</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">block_distribution_pt</a>(row_selected_block);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            <span class="keywordflow">if</span> (*tmp_block_dist_pt != *another_tmp_block_dist_pt)</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            {</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;              std::ostringstream err_msg;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;              err_msg &lt;&lt; <span class="stringliteral">&quot;block_distribution_pt &quot;</span> &lt;&lt; row_selected_block &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;does not match the distribution from the block_pt() &quot;</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; in selected_block[&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; block_j</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;].\n&quot;</span>;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;              <span class="keywordflow">throw</span> OomphLibError(err_msg.str(),</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            }</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;          }</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160; </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      <span class="comment">// Attempt a similar check for the column index. This is not as rigorous</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <span class="comment">// since a CRDoubleMatrix does not have a distribution for the columns.</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <span class="comment">// However, we can check if the ncol of the matrices in block_pt matches</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      <span class="comment">// those in the block_distribution_pt corresponding to the columns.</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <span class="comment">// (I hope this makes sense... both the row and columns are permuted in</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="comment">// CRDoubleMatrixHelpers::concatenate_without_communication(...))</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;      <span class="comment">// The test for the row distributions checks if the nrow_local is correct.</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      <span class="comment">// We do not have the equivalent for columns.</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_i = 0; block_i &lt; para_selected_block_nrow; block_i++)</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_j = 0; block_j &lt; para_selected_block_ncol;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;             block_j++)</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;          <span class="comment">// Cache the block_pt</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;          <span class="keyword">const</span> CRDoubleMatrix* tmp_block_pt =</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;            selected_block[block_i][block_j].replacement_block_pt();</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160; </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;          <span class="keywordflow">if</span> (tmp_block_pt != 0)</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;          {</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> tmp_block_ncol = tmp_block_pt-&gt;ncol();</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160; </div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> selected_block_col =</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;              selected_block[block_i][block_j].column_index();</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160; </div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            <span class="comment">// YES, nrow, this is not incorrect.</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> another_tmp_block_ncol =</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">block_distribution_pt</a>(selected_block_col)-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#aafad0b69de2284808366b65bd63e493b">nrow</a>();</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            <span class="keywordflow">if</span> (tmp_block_ncol != another_tmp_block_ncol)</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            {</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;              std::ostringstream err_msg;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;              err_msg &lt;&lt; <span class="stringliteral">&quot;block_pt in selected_block[&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;][&quot;</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                      &lt;&lt; block_j &lt;&lt; <span class="stringliteral">&quot;] &quot;</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;has ncol = &quot;</span> &lt;&lt; tmp_block_ncol &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;But the corresponding block_distribution_pt(&quot;</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                      &lt;&lt; selected_block_col</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;) has nrow = &quot;</span> &lt;&lt; another_tmp_block_ncol &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;              <span class="keywordflow">throw</span> OomphLibError(err_msg.str(),</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;            }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;          }</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        }</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160; </div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <span class="comment">// The return matrix.</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      MATRIX output_matrix;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160; </div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      <span class="comment">// How many sub matrices are there in the row and column?</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblock_row = selected_block.nrow();</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblock_col = selected_block.ncol();</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160; </div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="comment">// Get the row and col distributions, this is required for concatenation</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      <span class="comment">// without communication.</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      Vector&lt;LinearAlgebraDistribution*&gt; row_dist_pt(nblock_row, 0);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      Vector&lt;LinearAlgebraDistribution*&gt; col_dist_pt(nblock_col, 0);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160; </div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      <span class="comment">// For the row distributions, use the first column of selected_block</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <span class="comment">// Also, store the index of the block rows.</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      Vector&lt;unsigned&gt; block_row_index(nblock_row, 0);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> row_i = 0; row_i &lt; nblock_row; row_i++)</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      {</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> selected_row_index =</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;          selected_block[row_i][0].row_index();</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        row_dist_pt[row_i] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[selected_row_index];</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        block_row_index[row_i] = selected_row_index;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      }</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160; </div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="comment">// For the col distributions, use the first row of selected_block</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      Vector&lt;unsigned&gt; block_col_index(nblock_col, 0);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> col_i = 0; col_i &lt; nblock_col; col_i++)</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> selected_col_index =</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;          selected_block[0][col_i].column_index();</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160; </div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        col_dist_pt[col_i] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[selected_col_index];</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        block_col_index[col_i] = selected_col_index;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="comment">// Now build the output matrix. The output_matrix needs a distribution,</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      <span class="comment">// this distribution is a concatenation of the block rows. But because</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      <span class="comment">// concatenation of distributions requires communication, we try to</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="comment">// minimise this process by creating it once, then store a key to the</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <span class="comment">// concatenated distribution. First check to see if the block row indices</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      <span class="comment">// is already a key in Auxiliary_block_distribution_pt, if it is in there,</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      <span class="comment">// we use the distribution it corresponds to. Otherwise, we create the</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      <span class="comment">// distribution and store it for possible further use.</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      std::map&lt;Vector&lt;unsigned&gt;, LinearAlgebraDistribution*&gt;::const_iterator</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        iter;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160; </div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      iter = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.find(block_row_index);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160; </div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      <span class="keywordflow">if</span> (iter != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.end())</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      {</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        output_matrix.build(iter-&gt;second);</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      }</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        LinearAlgebraDistribution* tmp_dist_pt = <span class="keyword">new</span> LinearAlgebraDistribution;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(row_dist_pt,</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                                                      *tmp_dist_pt);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">insert_auxiliary_block_distribution</a>(block_row_index, tmp_dist_pt);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        output_matrix.build(tmp_dist_pt);</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      }</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160; </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="comment">// Do the same for the column dist, since we might need it for the RHS</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="comment">// vector..</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      iter = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.find(block_col_index);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordflow">if</span> (iter == <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.end())</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      {</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        LinearAlgebraDistribution* tmp_dist_pt = <span class="keyword">new</span> LinearAlgebraDistribution;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(col_dist_pt,</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                                                      *tmp_dist_pt);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">insert_auxiliary_block_distribution</a>(block_col_index, tmp_dist_pt);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      }</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="comment">// Storage for the pointers to CRDoubleMatrices to concatenate.</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;CRDoubleMatrix*&gt;</a> block_pt(nblock_row, nblock_col, 0);</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="comment">// Vector of Vectors of unsigns to indicate whether we have created</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="comment">// CRDoubleMatrices with new or not... so we can delete it later.</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      <span class="comment">// 0 - no new CRDoubleMatrix is created.</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      <span class="comment">// 1 - a new CRDoubleMatrix is created.</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="comment">// If we ever use C++11, remove this and use smart pointers.</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      Vector&lt;Vector&lt;unsigned&gt;&gt; new_block(nblock_row,</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                                         Vector&lt;unsigned&gt;(nblock_col, 0));</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="comment">// Get blocks if wanted.</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_i = 0; block_i &lt; nblock_row; block_i++)</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_j = 0; block_j &lt; nblock_col; block_j++)</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        {</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> block_wanted = selected_block[block_i][block_j].wanted();</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;          <span class="keywordflow">if</span> (block_wanted)</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;          {</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            CRDoubleMatrix* tmp_block_pt =</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;              selected_block[block_i][block_j].replacement_block_pt();</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <span class="keywordflow">if</span> (tmp_block_pt == 0)</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;              new_block[block_i][block_j] = 1;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;              block_pt(block_i, block_j) = <span class="keyword">new</span> CRDoubleMatrix;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;              <span class="comment">// temp variables for readability purposes.</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> tmp_block_i = block_row_index[block_i];</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> tmp_block_j = block_col_index[block_j];</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160; </div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;              <span class="comment">// Get the block.</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;              this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">get_block</a>(</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                tmp_block_i, tmp_block_j, *block_pt(block_i, block_j));</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            }</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;            {</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;              block_pt(block_i, block_j) = tmp_block_pt;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            }</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;          }</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        }</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      }</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160; </div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <span class="comment">// Perform the concatenation.</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      <a class="code" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a996568831ca0db90f080560dd400b3d6">CRDoubleMatrixHelpers::concatenate_without_communication</a>(</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        row_dist_pt, col_dist_pt, block_pt, output_matrix);</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      <span class="comment">// Delete any new CRDoubleMatrices we created.</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_i = 0; block_i &lt; nblock_row; block_i++)</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      {</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> block_j = 0; block_j &lt; nblock_col; block_j++)</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        {</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;          <span class="keywordflow">if</span> (new_block[block_i][block_j])</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;          {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            <span class="keyword">delete</span> block_pt(block_i, block_j);</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;          }</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        }</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      <span class="keywordflow">return</span> output_matrix;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    } <span class="comment">// EOFunc get_concatenated_block(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a77ac0b71404620e7be8b15ac2d588495"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">oomph::BlockPreconditioner::block_distribution_pt</a></div><div class="ttdeci">const LinearAlgebraDistribution * block_distribution_pt(const unsigned &amp;b) const</div><div class="ttdoc">Access function to the block distributions (const version).</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:1903</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">oomph::BlockPreconditioner&lt; MATRIX &gt;::Auxiliary_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">oomph::BlockPreconditioner&lt; MATRIX &gt;::block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_distribution_pt</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html#aa0503bc64ef0ccb60cb7d7e645425a62">oomph::CRDoubleMatrix::built()</a>, <a class="el" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">oomph::LinearAlgebraDistributionHelpers::concatenate()</a>, <a class="el" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a996568831ca0db90f080560dd400b3d6">oomph::CRDoubleMatrixHelpers::concatenate_without_communication()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">oomph::BlockPreconditioner&lt; MATRIX &gt;::insert_auxiliary_block_distribution()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html#a4ed5597d8a34dd14f90b0e6cfb88ca2e">oomph::CRDoubleMatrix::ncol()</a>, <a class="el" href="../../d0/dea/classoomph_1_1VectorMatrix.html#a6f59576c296539356370814fc658f463">oomph::VectorMatrix&lt; VALUE_TYPE &gt;::ncol()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#aafad0b69de2284808366b65bd63e493b">oomph::LinearAlgebraDistribution::nrow()</a>, <a class="el" href="../../d0/dea/classoomph_1_1VectorMatrix.html#a9beb051515fea3a264843aae9783e386">oomph::VectorMatrix&lt; VALUE_TYPE &gt;::nrow()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="af9321cdab3f506ab95fe51cd9b93deab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9321cdab3f506ab95fe51cd9b93deab">&#9670;&nbsp;</a></span>get_concatenated_block_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_concatenated_block_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_vec_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the naturally ordered vector and extracts the blocks indicated by the block number (the values) in the Vector block_vec_number all at once, then concatenates them without communication. Here, the values in block_vec_number is the block number in the current preconditioner. This is a non-const function because distributions may be created and stored in Auxiliary_block_distribution_pt for future use. </p>
<div class="fragment"><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  {</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160; </div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    <span class="comment">// Check if v is built.</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    {</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    }</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160; </div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="comment">// v must have the same distribution as the upper-most master block</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    <span class="comment">// preconditioner, since the upper-most master block preconditioner</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="comment">// should have the same distribution as the matrix pointed to</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="comment">// by matrix_pt().</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    {</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    }</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160; </div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <span class="comment">// Check to see if there are more blocks defined in the block_vec_number</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <span class="comment">// vector than the number of block types. This is not allowed.</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_nblock_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_block_vec_number_size = block_vec_number.size();</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;    <span class="keywordflow">if</span> (para_block_vec_number_size &gt; para_nblock_types)</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    {</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;You have requested &quot;</span> &lt;&lt; para_block_vec_number_size</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; number of blocks, (block_vec_number.size() is &quot;</span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;              &lt;&lt; para_block_vec_number_size &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_nblock_types</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; nblock_types.\n&quot;</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Please make sure that block_vec_number is correctly sized.\n&quot;</span>;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    }</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160; </div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    <span class="comment">// Check if any block numbers defined in block_vec_number is equal to or</span></div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="comment">// greater than the number of block types.</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    <span class="comment">// E.g. if there are 5 block types, we can only have block numbers:</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="comment">//  0, 1, 2, 3 and 4.</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; para_block_vec_number_size; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    {</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_required_block = block_vec_number[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;      <span class="keywordflow">if</span> (para_required_block &gt;= para_nblock_types)</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      {</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;block_vec_number[&quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;] is &quot;</span> &lt;&lt; para_required_block</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_nblock_types</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; nblock_types.\n&quot;</span>;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;      }</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    }</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160; </div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    <span class="comment">// Check that no block number is inserted twice.</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    std::set&lt;unsigned&gt; para_set;</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    {</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;      std::pair&lt;std::set&lt;unsigned&gt;::iterator, <span class="keywordtype">bool</span>&gt; para_set_ret;</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;      para_set_ret = para_set.insert(block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]);</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160; </div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;      <span class="keywordflow">if</span> (!para_set_ret.second)</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      {</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Error: the block number &quot;</span> &lt;&lt; block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; appears twice.\n&quot;</span>;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      }</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    }</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160; </div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <span class="comment">// Number of blocks to get.</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_block = block_vec_number.size();</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160; </div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    <span class="comment">// Each block is made of dof types. We get the most fine grain dof types.</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    <span class="comment">// Most fine grain in the sense that these are the dof types that belongs</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    <span class="comment">// in this block before any coarsening of dof types has taken place.</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <span class="comment">// The ordering of the dof types matters, this is handled properly when</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    <span class="comment">// creating the Block_to_dof_map_fine vector and must be respected here.</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    <span class="comment">// I.e. we cannot arbitrarily insert dof types (even if they are correct)</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    <span class="comment">// in the vector most_fine_grain_dof.</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    Vector&lt;unsigned&gt; most_fine_grain_dof;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; n_block; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    {</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_b = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;      most_fine_grain_dof.insert(most_fine_grain_dof.end(),</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].begin(),</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].end());</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    }</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160; </div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="comment">// Get all the dof level vectors in one go.</span></div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    Vector&lt;DoubleVector&gt; dof_block_vector;</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace6e9dbdfe9a1c3571452e2cd6ec9780">internal_get_block_vectors</a>(most_fine_grain_dof, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, dof_block_vector);</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160; </div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    <span class="comment">// Next we need to build the output DoubleVector w with the correct</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <span class="comment">// distribution: the concatenation of the distributions of all the</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="comment">// dof-level vectors. This is the same as the concatenation of the</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <span class="comment">// distributions of the blocks within this preconditioner.</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    <span class="comment">// So we first check if it exists already, if not, we create it and</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    <span class="comment">// store it for future use. We store it because concatenation of</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="comment">// distributions requires communication, so concatenation of</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="comment">// distributions on-the-fly should be avoided.</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    std::map&lt;Vector&lt;unsigned&gt;, LinearAlgebraDistribution*&gt;::const_iterator iter;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160; </div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;    <span class="comment">// Attempt to get an iterator pointing to the pair with the value</span></div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    <span class="comment">// block_vec_number.</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    iter = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.find(block_vec_number);</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160; </div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    <span class="keywordflow">if</span> (iter != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.end())</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    <span class="comment">// If it exists, build w with the distribution pointed to</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    <span class="comment">// by pair::second.</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    {</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;      <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.build(iter-&gt;second);</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    }</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    <span class="comment">// Else, we need to create the distribution and store it in</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    <span class="comment">// Auxiliary_block_distribution_pt.</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    {</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      Vector&lt;LinearAlgebraDistribution*&gt; tmp_vec_dist_pt(n_block, 0);</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; n_block; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;      {</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        tmp_vec_dist_pt[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]];</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      }</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160; </div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;      <span class="comment">// Note that the distribution is created with new but not deleted here.</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      <span class="comment">// This is handled in the clean up functions.</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      LinearAlgebraDistribution* tmp_dist_pt = <span class="keyword">new</span> LinearAlgebraDistribution;</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(tmp_vec_dist_pt,</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                                                    *tmp_dist_pt);</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160; </div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;      <span class="comment">// Store the pair of Vector&lt;unsigned&gt; and LinearAlgebraDistribution*</span></div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">insert_auxiliary_block_distribution</a>(block_vec_number, tmp_dist_pt);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160; </div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      <span class="comment">// Build w.</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.build(tmp_dist_pt);</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    }</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160; </div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <span class="comment">// Now concatenate all the dof level vectors into the vector w.</span></div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">DoubleVectorHelpers::concatenate_without_communication</a>(dof_block_vector, <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>);</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160; </div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;  } <span class="comment">// get_concatenated_block_vector(...)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1df550d281ec99914115edfa1a40b982"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1df550d281ec99914115edfa1a40b982">&#9670;&nbsp;</a></span>get_dof_level_block() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &gt;::get_dof_level_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>output_block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;&#160;</td>
          <td class="paramname"><em>ignore_replacement_block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets dof-level block (i,j). If Replacement_dof_block_pt(i,j) is not null, then the replacement block is returned via a deep copy.</p>
<p>Otherwise if this is the uppermost block preconditioner then it calls internal_get_block(i,j), else if it is a subsidiary block preconditioner, it will call it's master block preconditioners' get_dof_level_block function. </p>
<div class="fragment"><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;  {</div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;    <span class="comment">// the number of dof types.</span></div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;    <span class="keywordtype">unsigned</span> para_ndofs = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>();</div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160; </div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;    <span class="comment">// paranoid check that block i is in this block preconditioner</span></div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;    <span class="keywordflow">if</span> (block_i &gt;= para_ndofs || block_j &gt;= para_ndofs)</div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;    {</div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;Requested dof block (&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; block_j</div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;), however this preconditioner has ndof_types() &quot;</span></div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;= &quot;</span> &lt;&lt; para_ndofs &lt;&lt; std::endl;</div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;    }</div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160; </div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;    CRDoubleMatrix* tmp_block_pt =</div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a>.get(block_i, block_j);</div>
<div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160; </div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;    <span class="keywordflow">if</span> ((tmp_block_pt == 0) || ignore_replacement_block)</div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;    {</div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;      <span class="comment">// Getting the block from parent preconditioner</span></div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndof_in_parent_i =</div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_i].size();</div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndof_in_parent_j =</div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_j].size();</div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160; </div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;      <span class="keywordflow">if</span> (ndof_in_parent_i == 1 &amp;&amp; ndof_in_parent_j == 1)</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;      {</div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;        <span class="keywordtype">unsigned</span> parent_dof_i = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_i][0];</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;        <span class="keywordtype">unsigned</span> parent_dof_j = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_j][0];</div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160; </div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;        {</div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe001ffe270c96e761ec5205364976a7">internal_get_block</a>(parent_dof_i, parent_dof_j, output_block);</div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;        }</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;        {</div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;          parent_dof_i = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[parent_dof_i];</div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;          parent_dof_j = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[parent_dof_j];</div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160; </div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;get_dof_level_block(</div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;            parent_dof_i, parent_dof_j, output_block, ignore_replacement_block);</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;        }</div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;      }</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;      {</div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;        <a class="code" href="../../dc/d34/classEigen_1_1Matrix.html">DenseMatrix&lt;CRDoubleMatrix*&gt;</a> tmp_blocks_pt(</div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;          ndof_in_parent_i, ndof_in_parent_j, 0);</div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160; </div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;        Vector&lt;Vector&lt;unsigned&gt;&gt; new_block(</div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;          ndof_in_parent_i, Vector&lt;unsigned&gt;(ndof_in_parent_j, 0));</div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160; </div>
<div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0; dof_i &lt; ndof_in_parent_i; dof_i++)</div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;        {</div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;          <span class="keywordtype">unsigned</span> parent_dof_i = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_i][dof_i];</div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;          {</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;            parent_dof_i =</div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[parent_dof_i];</div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;          }</div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160; </div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_j = 0; dof_j &lt; ndof_in_parent_j; dof_j++)</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;          {</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;            <span class="keywordtype">unsigned</span> parent_dof_j = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_j][dof_j];</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160; </div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;            tmp_blocks_pt(dof_i, dof_j) = <span class="keyword">new</span> CRDoubleMatrix;</div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160; </div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;            new_block[dof_i][dof_j] = 1;</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160; </div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;            {</div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe001ffe270c96e761ec5205364976a7">internal_get_block</a>(</div>
<div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;                parent_dof_i, parent_dof_j, *tmp_blocks_pt(dof_i, dof_j));</div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;            }</div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;            {</div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;              parent_dof_j =</div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;                <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[parent_dof_j];</div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160; </div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;get_dof_level_block(</div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;                parent_dof_i,</div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;                parent_dof_j,</div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;                *tmp_blocks_pt(dof_i, dof_j),</div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;                ignore_replacement_block);</div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;            }</div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;          }</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;        }</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160; </div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;        Vector&lt;LinearAlgebraDistribution*&gt; tmp_row_dist_pt(ndof_in_parent_i, 0);</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160; </div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> parent_dof_i = 0; parent_dof_i &lt; ndof_in_parent_i;</div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;             parent_dof_i++)</div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;        {</div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;          <span class="keywordtype">unsigned</span> mapped_dof_i =</div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_i][parent_dof_i];</div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160; </div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;          {</div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;            tmp_row_dist_pt[parent_dof_i] =</div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[mapped_dof_i];</div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;          }</div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;          {</div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;            mapped_dof_i =</div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[mapped_dof_i];</div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160; </div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;            tmp_row_dist_pt[parent_dof_i] =</div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;dof_block_distribution_pt(</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;                mapped_dof_i);</div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;          }</div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;        }</div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160; </div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;        Vector&lt;LinearAlgebraDistribution*&gt; tmp_col_dist_pt(ndof_in_parent_j, 0);</div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160; </div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> parent_dof_j = 0; parent_dof_j &lt; ndof_in_parent_j;</div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;             parent_dof_j++)</div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;        {</div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;          <span class="keywordtype">unsigned</span> mapped_dof_j =</div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>[block_j][parent_dof_j];</div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160; </div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;          {</div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;            tmp_col_dist_pt[parent_dof_j] =</div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[mapped_dof_j];</div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;          }</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;          {</div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;            mapped_dof_j =</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a>[mapped_dof_j];</div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;            tmp_col_dist_pt[parent_dof_j] =</div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;              <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;dof_block_distribution_pt(</div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;                mapped_dof_j);</div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;          }</div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;        }</div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160; </div>
<div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;        <a class="code" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a996568831ca0db90f080560dd400b3d6">CRDoubleMatrixHelpers::concatenate_without_communication</a>(</div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;          tmp_row_dist_pt, tmp_col_dist_pt, tmp_blocks_pt, output_block);</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160; </div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0; dof_i &lt; ndof_in_parent_i; dof_i++)</div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;        {</div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_j = 0; dof_j &lt; ndof_in_parent_j; dof_j++)</div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;          {</div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;            <span class="keywordflow">if</span> (new_block[dof_i][dof_j])</div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;            {</div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;              <span class="keyword">delete</span> tmp_blocks_pt(dof_i, dof_j);</div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;            }</div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;          }</div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;        }</div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;      }</div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;    }</div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;    {</div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;      <a class="code" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a157511f700993ab8bc014f9d0d44f4c7">CRDoubleMatrixHelpers::deep_copy</a>(tmp_block_pt, output_block);</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;    }</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_abe001ffe270c96e761ec5205364976a7"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe001ffe270c96e761ec5205364976a7">oomph::BlockPreconditioner::internal_get_block</a></div><div class="ttdeci">void internal_get_block(const unsigned &amp;i, const unsigned &amp;j, MATRIX &amp;output_block) const</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#a3ea9f7c40548e1a88402312e6f15d1fc">oomph::DoubleVectorHelpers::concatenate_without_communication()</a>, <a class="el" href="../../dd/d95/namespaceoomph_1_1CRDoubleMatrixHelpers.html#a157511f700993ab8bc014f9d0d44f4c7">oomph::CRDoubleMatrixHelpers::deep_copy()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="a314fc14d95f2833be66067cd5b45e093"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a314fc14d95f2833be66067cd5b45e093">&#9670;&nbsp;</a></span>get_dof_level_block() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_dof_level_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MATRIX &amp;&#160;</td>
          <td class="paramname"><em>output_block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;&#160;</td>
          <td class="paramname"><em>ignore_replacement_block</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets dof-level block (i,j). If Replacement_dof_block_pt(i,j) is not null, then the replacement block is returned via a deep copy.</p>
<p>Otherwise if this is the uppermost block preconditioner then it calls internal_get_block(i,j), else if it is a subsidiary block preconditioner, it will call it's master block preconditioners' get_dof_level_block function. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>.</p>

</div>
</div>
<a id="a433adda4f658cc7880121bf9ca4293c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a433adda4f658cc7880121bf9ca4293c4">&#9670;&nbsp;</a></span>get_fine_grain_dof_types_in()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_fine_grain_dof_types_in </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the most fine grain dof types in a (possibly coarsened) dof type. </p>
<div class="fragment"><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    {</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dof_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>();</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160; </div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= n_dof_types)</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      {</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Trying to get the most fine grain dof types in dof type &quot;</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;,\nbut there are only &quot;</span> &lt;&lt; n_dof_types</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; number of dof types.\n&quot;</span>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      }</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">oomph::BlockPreconditioner&lt; MATRIX &gt;::Doftype_coarsen_map_fine</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="acac55e8dea1a0f63fcf32b7b058b0979"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acac55e8dea1a0f63fcf32b7b058b0979">&#9670;&nbsp;</a></span>get_index_of_value()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<div class="memtemplate">
template&lt;typename myType &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::get_index_of_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; myType &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const myType&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>sorted</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the index of first occurrence of value in a vector. If the element does not exist, -1 is returned. The optional parameter indicates of the Vector is sorted or not. Complexity: if the Vector is sorted, then on average, logarithmic in the distance between first and last: Performs approximately log2(N)+2 element comparisons. Otherwise, up to linear in the distance between first and last: Compares elements until a match is found. </p>
<div class="fragment"><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    {</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      <span class="keywordflow">if</span> (sorted)</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;      {</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        <span class="keyword">typename</span> Vector&lt;myType&gt;::const_iterator low =</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;          std::lower_bound(vec.begin(), vec.end(), <a class="code" href="../../d9/d33/namespacecalibrate.html#a31df7464b3365cfaf9733094a0a5f8fc">val</a>);</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160; </div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;        <span class="keywordflow">return</span> (low == vec.end() || *low != <a class="code" href="../../d9/d33/namespacecalibrate.html#a31df7464b3365cfaf9733094a0a5f8fc">val</a>) ? -1 : (low - vec.begin());</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      }</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;      {</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;        <span class="keywordtype">int</span> pos = std::find(vec.begin(), vec.end(), <a class="code" href="../../d9/d33/namespacecalibrate.html#a31df7464b3365cfaf9733094a0a5f8fc">val</a>) - vec.begin();</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;        <span class="keywordflow">return</span> (pos &lt; <span class="keywordtype">int</span>(vec.size()) &amp;&amp; pos &gt;= 0) ? pos : -1;</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;      }</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    }</div>
<div class="ttc" id="anamespacecalibrate_html_a31df7464b3365cfaf9733094a0a5f8fc"><div class="ttname"><a href="../../d9/d33/namespacecalibrate.html#a31df7464b3365cfaf9733094a0a5f8fc">calibrate.val</a></div><div class="ttdeci">val</div><div class="ttdef"><b>Definition:</b> calibrate.py:119</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d9/d33/namespacecalibrate.html#a31df7464b3365cfaf9733094a0a5f8fc">calibrate::val</a>.</p>

</div>
</div>
<a id="a75742d54177935fb22e59d045209b11e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75742d54177935fb22e59d045209b11e">&#9670;&nbsp;</a></span>index_in_block()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::index_in_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i_dof</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Given a global dof number, returns the index in the block it belongs to. This is the overall index, not local block (in parallel). </p>
<div class="fragment"><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    {</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <span class="comment">// the dof block number</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="keywordtype">int</span> internal_dof_block_number = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">internal_dof_number</a>(i_dof);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160; </div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="keywordflow">if</span> (internal_dof_block_number &gt;= 0)</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      {</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <span class="comment">// the external block number</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="keywordtype">unsigned</span> ex_blk_number = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">block_number</a>(i_dof);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160; </div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">internal_index_in_dof</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">internal_index_in_dof</a>(i_dof);</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160; </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        <span class="comment">// find the processor which this global index in block belongs to.</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keywordtype">unsigned</span> block_proc =</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">internal_block_distribution_pt</a>(internal_dof_block_number)</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            -&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#acd5ffc5ff4b91a8e63677f9677cd0039">rank_of_global_row</a>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">internal_index_in_dof</a>);</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160; </div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        <span class="comment">// Add up all of the first rows.</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndof_in_block =</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[ex_blk_number].size();</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160; </div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        <span class="keywordtype">unsigned</span> index = 0;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0; dof_i &lt; ndof_in_block; dof_i++)</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        {</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;          index += <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">internal_block_distribution_pt</a>(</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                     <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[ex_blk_number][dof_i])</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                     -&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>(block_proc);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        }</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160; </div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="comment">// Now add up all the nrow_local up to this dof block.</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160; </div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <span class="keywordflow">while</span> (<span class="keywordtype">int</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[ex_blk_number][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]) !=</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;               internal_dof_block_number)</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        {</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;          index += <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">internal_block_distribution_pt</a>(</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                     <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[ex_blk_number][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>])</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                     -&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">nrow_local</a>(block_proc);</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;          <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        }</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160; </div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="comment">// Now add the index of this block...</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        index += (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">internal_index_in_dof</a> -</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                  <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">internal_block_distribution_pt</a>(internal_dof_block_number)</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                    -&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>(block_proc));</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160; </div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      }</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160; </div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a19f8ca9f40ab804262cf95c1d5eb598c"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">oomph::BlockPreconditioner::internal_block_distribution_pt</a></div><div class="ttdeci">const LinearAlgebraDistribution * internal_block_distribution_pt(const unsigned &amp;b) const</div><div class="ttdoc">Access function to the internal block distributions.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2734</div></div>
<div class="ttc" id="aclassoomph_1_1LinearAlgebraDistribution_html_acd5ffc5ff4b91a8e63677f9677cd0039"><div class="ttname"><a href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#acd5ffc5ff4b91a8e63677f9677cd0039">oomph::LinearAlgebraDistribution::rank_of_global_row</a></div><div class="ttdeci">unsigned rank_of_global_row(const unsigned i) const</div><div class="ttdoc">return the processor rank of the global row number i</div><div class="ttdef"><b>Definition:</b> linear_algebra_distribution.h:387</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">oomph::BlockPreconditioner&lt; MATRIX &gt;::block_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_to_dof_map_fine</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">oomph::LinearAlgebraDistribution::first_row()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_dof()</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">oomph::LinearAlgebraDistribution::nrow_local()</a>, and <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#acd5ffc5ff4b91a8e63677f9677cd0039">oomph::LinearAlgebraDistribution::rank_of_global_row()</a>.</p>

</div>
</div>
<a id="a9b3c4072be2bf4f0dfdd18f56a5d51bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b3c4072be2bf4f0dfdd18f56a5d51bf">&#9670;&nbsp;</a></span>insert_auxiliary_block_distribution()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::insert_auxiliary_block_distribution </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_vec_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a> *&#160;</td>
          <td class="paramname"><em>dist_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>insert a Vector&lt;unsigned&gt; and LinearAlgebraDistribution* pair into Auxiliary_block_distribution_pt. The Auxiliary_block_distribution_pt should only contain pointers to distributions concatenated at this block level. We try to ensure this by checking if the block_vec_number vector is within the range nblock_types(). Of course, this does not guarantee correctness, but this is the least we can do. </p>
<div class="fragment"><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    {</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> max_block_number =</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;        *std::max_element(block_vec_number.begin(), block_vec_number.end());</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160; </div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblocks = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      <span class="keywordflow">if</span> (max_block_number &gt;= nblocks)</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;      {</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Cannot insert into Auxiliary_block_distribution_pt\n&quot;</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;because &quot;</span> &lt;&lt; max_block_number &lt;&lt; <span class="stringliteral">&quot; is equal to or \n&quot;</span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;greater than &quot;</span> &lt;&lt; nblocks &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      }</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160; </div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      <span class="comment">// Now check if the pair already exists in</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;      <span class="comment">// Auxiliary_block_distribution_pt. This is a stricter test and can be</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;      <span class="comment">// removed if required.</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160; </div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;      <span class="comment">// Attempt to get an iterator pointing to the pair with the value</span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;      <span class="comment">// block_vec_number.</span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      std::map&lt;Vector&lt;unsigned&gt;, LinearAlgebraDistribution*&gt;::const_iterator</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;        iter = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.find(block_vec_number);</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160; </div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      <span class="keywordflow">if</span> (iter != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.end())</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;      <span class="comment">// If it exists, we throw an error</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;      {</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Cannot insert into Auxiliary_block_distribution_pt\n&quot;</span></div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;because the first in the pair already exists.\n&quot;</span>;</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      }</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160; </div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.insert(</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;        std::make_pair(block_vec_number, dist_pt));</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    } <span class="comment">// insert_auxiliary_block_distribution(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">oomph::BlockPreconditioner&lt; MATRIX &gt;::Auxiliary_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a51636746e5921ee2845daf60b1c322dc">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_concatenated_block()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adbe1ae854ee9831649249d50162bb6a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::setup_matrix_vector_product()</a>.</p>

</div>
</div>
<a id="ac460225afc092cc5ed9d77acc6316536"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac460225afc092cc5ed9d77acc6316536">&#9670;&nbsp;</a></span>internal_block_dimension()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_block_dimension </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of degrees of freedom in block b. Note that if this preconditioner acts as a subsidiary preconditioner then b refers to the block number in the subsidiary preconditioner not the master block preconditioner. </p>
<div class="fragment"><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    {</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> i_nblock_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>();</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt;= i_nblock_types)</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;      {</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Trying to get internal block dimension for \n&quot;</span></div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;internal block &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; i_nblock_types</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; internal dof types.\n&quot;</span>;</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;      }</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]-&gt;nrow();</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_nblock_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="a19f8ca9f40ab804262cf95c1d5eb598c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19f8ca9f40ab804262cf95c1d5eb598c">&#9670;&nbsp;</a></span>internal_block_distribution_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_block_distribution_pt </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function to the internal block distributions. </p>
<div class="fragment"><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    {</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>.size() == 0)</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;      {</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;Internal block distributions are not set up.\n&quot;</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;Have you called block_setup(...)?\n&quot;</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;      }</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &gt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>())</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      {</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;You requested the distribution for the internal block &quot;</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                  &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>()</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span></div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      }</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    } <span class="comment">// EOFunc internal_block_distribution_pt(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_block_distribution_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_nblock_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">oomph::BlockPreconditioner&lt; MATRIX &gt;::index_in_block()</a>.</p>

</div>
</div>
<a id="af3eadb5d8d36200c4738537eac1647a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3eadb5d8d36200c4738537eac1647a6">&#9670;&nbsp;</a></span>internal_block_number()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_block_number </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i_dof</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the block number corresponding to a global index i_dof. This returns the block number corresponding to the internal blocks. What this means is that this returns the most fine grain dof-block number which this global index i_dof corresponds to. Since the writer of the preconditioner does not need to care about the internal block types, this function should not be used and thus moved to private. This function should not be removed since it is still used deep within the inner workings of the block preconditioning framework. </p>
<div class="fragment"><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    {</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <span class="keywordtype">int</span> dn = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">internal_dof_number</a>(i_dof);</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;      <span class="keywordflow">if</span> (dn == -1)</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;      {</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        <span class="keywordflow">return</span> dn;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      }</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;      {</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">Dof_number_to_block_number_lookup</a>[dn];</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;      }</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    } <span class="comment">// EOFunc internal_block_number(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_number_to_block_number_lookup</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">oomph::BlockPreconditioner&lt; MATRIX &gt;::block_number()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_block()</a>.</p>

</div>
</div>
<a id="abe03c970690224b46a29e55e16992dd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe03c970690224b46a29e55e16992dd7">&#9670;&nbsp;</a></span>internal_dof_block_dimension()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_dof_block_dimension </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the size of the dof "block" i, i.e. how many degrees of freedom are associated with it. Note that if this preconditioner acts as a subsidiary preconditioner, then i refers to the block number in the subsidiary preconditioner not the master block preconditioner </p>
<div class="fragment"><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    {</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> i_n_dof_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a>();</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= i_n_dof_types)</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;      {</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Trying to get internal dof block dimension for \n&quot;</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;internal dof block &quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; i_n_dof_types</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; internal dof types.\n&quot;</span>;</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;      }</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;      <span class="comment">// I don&#39;t understand the difference between this function and</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;      <span class="comment">// block_dimension(...) but I&#39;m not going to mess with it... David</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160; </div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      {</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      }</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      {</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <span class="keywordtype">unsigned</span> master_i = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">internal_master_dof_number</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>-&gt;internal_dof_block_dimension(</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;          master_i);</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      }</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_dimension</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_master_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_block()</a>.</p>

</div>
</div>
<a id="abb4dff3469cc6718103fddfdf3f3a7bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb4dff3469cc6718103fddfdf3f3a7bb">&#9670;&nbsp;</a></span>internal_dof_number()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_dof_number </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i_dof</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of the block associated with global unknown i_dof. If this preconditioner is a subsidiary block preconditioner then the block number in the subsidiary block preconditioner is returned. If a particular global DOF is not associated with this preconditioner then -1 is returned </p>
<div class="fragment"><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    {</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;      {</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>();</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">nrow_local</a>();</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        <span class="keywordtype">unsigned</span> last_row = <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> + <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> - 1;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        <span class="keywordflow">if</span> (i_dof &gt;= <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> &amp;&amp; i_dof &lt;= last_row)</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;        {</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[i_dof - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>]);</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;        }</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        {</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;          <span class="comment">// int index = this-&gt;get_index_of_element(Global_index_sparse,i_dof);</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;          <span class="keywordtype">int</span> index =</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;            get_index_of_value&lt;unsigned&gt;(Global_index_sparse, i_dof, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;          <span class="keywordflow">if</span> (index &gt;= 0)</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;          {</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;            <span class="keywordflow">return</span> Dof_number_sparse[index];</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;          }</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        }</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;        <span class="comment">// if we here we couldn&#39;t find the i_dof</span></div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;        <span class="keywordtype">unsigned</span> my_rank = <a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">comm_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;Proc &quot;</span> &lt;&lt; my_rank</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;: Requested internal_dof_number(...) for global DOF &quot;</span></div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;                      &lt;&lt; i_dof &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;cannot be found.\n&quot;</span>;</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>[i_dof]);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      }</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      <span class="comment">// else this preconditioner  is a subsidiary one, and its Block_number</span></div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;      <span class="comment">// lookup schemes etc haven&#39;t been set up</span></div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      {</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <span class="comment">// Block number in master prec</span></div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        <span class="keywordtype">unsigned</span> blk_num =</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>-&gt;internal_dof_number(i_dof);</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160; </div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        <span class="comment">// Search through the Block_number_in_master_preconditioner for master</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        <span class="comment">// block blk_num and return the block number in this preconditioner</span></div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a>(); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;        {</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">Doftype_in_master_preconditioner_fine</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] == blk_num)</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;          {</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;          }</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        }</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        <span class="comment">// if the master block preconditioner number is not found return -1</span></div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;      }</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160; </div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;      <span class="comment">// Shouldn&#39;t get here</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        <span class="stringliteral">&quot;Never get here\n&quot;</span>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      <span class="comment">// Dummy return</span></div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#ada7219933e05d94f39a46a8ddb4c749a">oomph::Preconditioner::comm_pt()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_number_dense</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">oomph::BlockPreconditioner&lt; MATRIX &gt;::Doftype_in_master_preconditioner_fine</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">oomph::LinearAlgebraDistribution::first_row()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">oomph::DistributableLinearAlgebraObject::first_row()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">oomph::OomphCommunicator::my_rank()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">oomph::LinearAlgebraDistribution::nrow_local()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">oomph::DistributableLinearAlgebraObject::nrow_local()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">oomph::BlockPreconditioner&lt; MATRIX &gt;::index_in_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_number()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_block()</a>.</p>

</div>
</div>
<a id="a4f714d01cd2fdb791aa0795f34b9610a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f714d01cd2fdb791aa0795f34b9610a">&#9670;&nbsp;</a></span>internal_get_block() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &gt;::internal_get_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>output_block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets block (i,j) from the matrix pointed to by Matrix_pt and returns it in output_block. This is associated with the internal blocks. Please use the other get_block(...) function. </p>
<div class="fragment"><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;  {</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;    <span class="comment">// the number of blocks</span></div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_blocks = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>();</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160; </div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;    <span class="comment">// paranoid check that block i is in this block preconditioner</span></div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;    <span class="keywordflow">if</span> (block_i &gt;= n_blocks || block_j &gt;= n_blocks)</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;    {</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;      error_message</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Requested block (&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; block_j</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;), however this preconditioner has internal_nblock_types() &quot;</span></div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;= &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;    }</div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160; </div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;    <span class="comment">// Check that the matrix is the same as that of the master</span></div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;    {</div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>() != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>())</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;      {</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;        <a class="code" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">std::string</a> err = <span class="stringliteral">&quot;Master and subs should have same matrix.&quot;</span>;</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;          err, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;      }</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;    }</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160; </div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;    <span class="comment">// Cast the pointer</span></div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;    CRDoubleMatrix* cr_matrix_pt = <span class="keyword">dynamic_cast&lt;</span>CRDoubleMatrix*<span class="keyword">&gt;</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">matrix_pt</a>());</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160; </div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;    <span class="comment">// if + only one processor</span></div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    <span class="comment">//    + more than one processor but matrix_pt is not distributed</span></div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;    <span class="comment">// then use the serial get_block method</span></div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;    <span class="keywordflow">if</span> (cr_matrix_pt-&gt;distribution_pt()-&gt;communicator_pt()-&gt;nproc() == 1 ||</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;        !cr_matrix_pt-&gt;distribution_pt()-&gt;distributed())</div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;    {</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;      <span class="comment">// pointers for the jacobian matrix is compressed row sparse format</span></div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;      <span class="keywordtype">int</span>* j_row_start;</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;      <span class="keywordtype">int</span>* j_column_index;</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;      <span class="keywordtype">double</span>* j_value;</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160; </div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;      <span class="comment">// sets pointers to jacobian matrix</span></div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;      j_row_start = cr_matrix_pt-&gt;row_start();</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;      j_column_index = cr_matrix_pt-&gt;column_index();</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;      j_value = cr_matrix_pt-&gt;value();</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160; </div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;      <span class="comment">// get the block dimensions</span></div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;      <span class="keywordtype">unsigned</span> block_nrow = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a>(block_i);</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;      <span class="keywordtype">unsigned</span> block_ncol = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a>(block_j);</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160; </div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;      <span class="comment">// allocate temporary storage for the component vectors of block (i,j)</span></div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;      <span class="comment">// temp_ptr is used to point to an element in each column - required as</span></div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;      <span class="comment">// cannot assume that order of block&#39;s rows in jacobian and the block</span></div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;      <span class="comment">// matrix will be the same</span></div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;      <span class="keywordtype">int</span>* temp_row_start = <span class="keyword">new</span> <span class="keywordtype">int</span>[block_nrow + 1];</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= block_nrow; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;      {</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;        temp_row_start[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;      }</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;      Vector&lt;int&gt; temp_ptr(block_nrow + 1);</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;      <span class="keywordtype">int</span> block_nnz = 0;</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160; </div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;      <span class="comment">// get number of rows in source matrix</span></div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">master_nrow</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">master_nrow</a>();</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160; </div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;      <span class="comment">// determine how many non zeros there are in the block (i,j)</span></div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;      <span class="comment">// also determines how many non zeros are stored in each row or column -</span></div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;      <span class="comment">// stored in temp_ptr temporarily</span></div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> = 0; <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">master_nrow</a>; <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>++)</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;      {</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>) == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(block_i))</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;        {</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = j_row_start[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>]; l &lt; j_row_start[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> + 1]; l++)</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;          {</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(j_column_index[l]) ==</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;                <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(block_j))</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;            {</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;              block_nnz++;</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;              temp_ptr[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>) + 1]++;</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;            }</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;          }</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;        }</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;      }</div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160; </div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;      <span class="comment">// if the matrix is not empty</span></div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;      <span class="keywordtype">int</span>* temp_column_index = <span class="keyword">new</span> <span class="keywordtype">int</span>[block_nnz];</div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;      <span class="keywordtype">double</span>* temp_value = <span class="keyword">new</span> <span class="keywordtype">double</span>[block_nnz];</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;      <span class="keywordflow">if</span> (block_nnz &gt; 0)</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;      {</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;        <span class="comment">// uses number of elements in each column of block to determine values</span></div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;        <span class="comment">// for the block column start (temp_row_start)</span></div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;        temp_row_start[0] = 0;</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> = 1; <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> &lt;= block_nrow; <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>++)</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;        {</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;          temp_row_start[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>] = temp_row_start[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> - 1] + temp_ptr[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>];</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;          temp_ptr[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>] = temp_row_start[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>];</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;        }</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160; </div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;        <span class="comment">// copies the relevant elements of the jacobian to the correct entries</span></div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;        <span class="comment">// of the block matrix</span></div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> = 0; <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">master_nrow</a>; <a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>++)</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;        {</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>) == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(block_i))</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;          {</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = j_row_start[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>]; l &lt; j_row_start[<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a> + 1]; l++)</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;            {</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(j_column_index[l]) ==</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;                  <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(block_j))</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;              {</div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;                <span class="keywordtype">int</span> kk = temp_ptr[<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(<a class="code" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>)]++;</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;                temp_value[kk] = j_value[l];</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;                temp_column_index[kk] =</div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;                  <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(j_column_index[l]);</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;              }</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;            }</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;          }</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;        }</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;      }</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160; </div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160; </div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;      <span class="comment">// Fill in the compressed row matrix ??ds Note: I kept the calls to</span></div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;      <span class="comment">// build as close as I could to before (had to replace new(dist) with</span></div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;      <span class="comment">// .build(dist) ).</span></div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;      output_block.build(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[block_i]);</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;      output_block.build_without_copy(</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;        block_ncol, block_nnz, temp_value, temp_column_index, temp_row_start);</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160; </div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;      <span class="comment">// checks to see if block matrix has been set up correctly</span></div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;      <span class="comment">//   block_matrix_test(matrix_pt,block_i,block_j,block_pt);</span></div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6e6a40988711a64c622c2fd9104c56cf">Run_block_matrix_test</a>)</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;      {</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;        <span class="comment">// checks to see if block matrix has been set up correctly</span></div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4d8ff67e34e85a71c0f9bb68c0b10496">block_matrix_test</a>(block_i, block_j, &amp;output_block);</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;      }</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;    }</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160; </div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160; </div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;    <span class="comment">// otherwise we are dealing with a distributed matrix</span></div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;    {</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;      <span class="comment">// number of processors</span></div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;      <span class="keywordtype">unsigned</span> nproc = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160; </div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;      <span class="comment">// my rank</span></div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;      <span class="keywordtype">unsigned</span> my_rank = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160; </div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;      <span class="comment">// sets pointers to jacobian matrix</span></div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;      <span class="keywordtype">int</span>* j_row_start = cr_matrix_pt-&gt;row_start();</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;      <span class="keywordtype">int</span>* j_column_index = cr_matrix_pt-&gt;column_index();</div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;      <span class="keywordtype">double</span>* j_value = cr_matrix_pt-&gt;value();</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160; </div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;      <span class="comment">// number of non zeros in each row to be sent</span></div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;      Vector&lt;int*&gt; nnz_send(nproc, 0);</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160; </div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;      <span class="comment">// number of non zeros in each row to be received</span></div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;      Vector&lt;int*&gt; nnz_recv(nproc, 0);</div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160; </div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;      <span class="comment">// storage for data to be sent</span></div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;      Vector&lt;int*&gt; column_index_for_proc(nproc, 0);</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;      Vector&lt;double*&gt; values_for_proc(nproc, 0);</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160; </div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;      <span class="comment">// number of non zeros to be sent to each processor</span></div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;      Vector&lt;unsigned&gt; total_nnz_send(nproc, 0);</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160; </div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;      <span class="comment">// number of rows of the block matrix on this processor</span></div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> =</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[block_i]-&gt;nrow_local();</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160; </div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;      <span class="comment">// resize the nnz storage and compute nnz_send</span></div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;      <span class="comment">// and send and recv the nnz</span></div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;      Vector&lt;MPI_Request&gt; send_req;</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;      Vector&lt;MPI_Request&gt; recv1_req;</div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;      {</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;        <span class="keywordtype">int</span> nrow_send = Nrows_to_send_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;        <span class="keywordtype">int</span> nrow_recv = Nrows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160; </div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;        <span class="comment">// assemble nnz recv</span></div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;        nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">int</span>[nrow_recv];</div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160; </div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;        <span class="comment">// assemble the storage to send</span></div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;        <span class="keywordflow">if</span> (nrow_send &gt; 0 &amp;&amp; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;        {</div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;          nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">int</span>[nrow_send];</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;        }</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160; </div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;        <span class="comment">// compute the number of nnzs in each row and the total number</span></div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;        <span class="comment">// of nnzs</span></div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nrow_send; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;        {</div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a> = Rows_to_send_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;          <span class="keywordtype">int</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = 0;</div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> = j_row_start[<a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a>]; <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> &lt; j_row_start[<a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a> + 1]; <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>++)</div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;          {</div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(j_column_index[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>]) == <span class="keywordtype">int</span>(block_j))</div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;            {</div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;              <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>++;</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;            }</div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;          }</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;          {</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;            nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>;</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;          }</div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;          {</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;            nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>;</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;          }</div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;          total_nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] += <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>;</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;        }</div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160; </div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;        <span class="comment">// send</span></div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;        {</div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;          <span class="keywordflow">if</span> (nrow_send)</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;          {</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;            MPI_Request req;</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;            MPI_Isend(nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;                      nrow_send,</div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;                      MPI_INT,</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;                      0,</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;                      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;                      &amp;req);</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;            send_req.push_back(req);</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;          }</div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160; </div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;          <span class="comment">// recv</span></div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;          <span class="keywordflow">if</span> (nrow_recv)</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;          {</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;            MPI_Request req;</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;            MPI_Irecv(nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;                      nrow_recv,</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;                      MPI_INT,</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;                      0,</div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;                      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;                      &amp;req);</div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;            recv1_req.push_back(req);</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;          }</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;        }</div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;      }</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160; </div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;      <span class="comment">// next assemble the values and row_start data to be sent for each</span></div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;      <span class="comment">// processor</span></div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;      {</div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;        <span class="keywordtype">int</span> nrow_send = Nrows_to_send_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160; </div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;        <span class="comment">// assemble the storage for the values and column indices to be sent</span></div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;        {</div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;          <span class="keywordflow">if</span> (total_nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;          {</div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;            values_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">double</span>[total_nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;            column_index_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">int</span>[total_nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160; </div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;            <span class="comment">// copy the values and column indices to the storage</span></div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;            <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nrow_send; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;            {</div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;              <span class="keywordtype">unsigned</span> <a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a> = Rows_to_send_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> = j_row_start[<a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a>]; <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> &lt; j_row_start[<a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a> + 1]; <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>++)</div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;              {</div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(j_column_index[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>]) == <span class="keywordtype">int</span>(block_j))</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;                {</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;                  values_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][ptr] = j_value[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>];</div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;                  column_index_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][ptr] =</div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;                    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(j_column_index[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>]);</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;                  ptr++;</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;                }</div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;              }</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;            }</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160; </div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;            <span class="comment">// create the datatypes</span></div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;            MPI_Datatype types[2];</div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;            MPI_Type_contiguous(total_nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_DOUBLE, &amp;types[0]);</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;            MPI_Type_commit(&amp;types[0]);</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;            MPI_Type_contiguous(total_nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], MPI_INT, &amp;types[1]);</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;            MPI_Type_commit(&amp;types[1]);</div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160; </div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;            <span class="comment">// get the start address of the vectors</span></div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;            MPI_Aint displacement[2];</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;            MPI_Get_address(values_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], &amp;displacement[0]);</div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;            MPI_Get_address(column_index_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>], &amp;displacement[1]);</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160; </div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;            <span class="comment">// compute the displacements</span></div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;            displacement[1] -= displacement[0];</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;            displacement[0] -= displacement[0];</div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160; </div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;            <span class="comment">// compute the block lengths</span></div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;            <span class="keywordtype">int</span> length[2];</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;            length[0] = length[1] = 1;</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160; </div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;            <span class="comment">// build the struct data type</span></div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;            MPI_Datatype final_type;</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;            MPI_Type_create_struct(2, length, displacement, types, &amp;final_type);</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;            MPI_Type_commit(&amp;final_type);</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;            MPI_Type_free(&amp;types[0]);</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;            MPI_Type_free(&amp;types[1]);</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160; </div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;            <span class="comment">// and send</span></div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;            MPI_Request req;</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;            MPI_Isend(values_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;                      1,</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;                      final_type,</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;                      1,</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;                      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;                      &amp;req);</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;            send_req.push_back(req);</div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;            MPI_Type_free(&amp;final_type);</div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;          }</div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;        }</div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;      }</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160; </div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;      <span class="comment">// wait for the recv to complete (the row_start recv which actually</span></div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;      <span class="comment">// contains the number of nnzs in each row)</span></div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;      <span class="keywordtype">int</span> c_recv = recv1_req.size();</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;      <span class="keywordflow">if</span> (c_recv != 0)</div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;      {</div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;        MPI_Waitall(c_recv, &amp;recv1_req[0], MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;      }</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160; </div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;      <span class="comment">// compute the total number of nnzs to be received</span></div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;      Vector&lt;int&gt; total_nnz_recv_from_proc(nproc);</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;      <span class="keywordtype">int</span> local_block_nnz = 0;</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;      {</div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;        <span class="comment">// compute the total nnzs</span></div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;        {</div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;          total_nnz_recv_from_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] += nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;        }</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;        local_block_nnz += total_nnz_recv_from_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;      }</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160; </div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;      <span class="comment">// compute the offset for each block of nnzs (a matrix row) in the</span></div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;      <span class="comment">// values_recv and column_index_recv vectors</span></div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160; </div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;      <span class="comment">// fisrt determine how many blocks of rows are to be recv</span></div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;      Vector&lt;int&gt; n_recv_block(nproc, 0);</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;      {</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;        <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;        {</div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;          n_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = 1;</div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;        }</div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;        {</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;          <span class="keywordflow">if</span> (Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] !=</div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;              Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1] + 1)</div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;          {</div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;            n_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;          }</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;        }</div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;      }</div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160; </div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;      <span class="comment">// next assemble row start recv</span></div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;      <span class="keywordtype">int</span>* row_start_recv = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> + 1];</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;      {</div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;        row_start_recv[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;      }</div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;      {</div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;        {</div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;          row_start_recv[Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] =</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;            nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;        }</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;      }</div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;      <span class="keywordtype">int</span> g = row_start_recv[0];</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;      row_start_recv[0] = 0;</div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;      {</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;        <span class="keywordtype">int</span> temp_g = g;</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;        g = row_start_recv[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;        row_start_recv[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = row_start_recv[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1] + temp_g;</div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;      }</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;      row_start_recv[<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a>] = row_start_recv[<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> - 1] + g;</div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160; </div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;      <span class="comment">// next assemble the offset and the number of nzs in each recv block</span></div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;      Vector&lt;int*&gt; offset_recv_block(nproc, 0);</div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;      Vector&lt;int*&gt; nnz_recv_block(nproc, 0);</div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;      {</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;        <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;        {</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;          offset_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">int</span>[n_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;          offset_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][0] = 0;</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;          nnz_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] = <span class="keyword">new</span> <span class="keywordtype">int</span>[n_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;          {</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;            nnz_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;          }</div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;          <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;          nnz_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][ptr] += nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][0];</div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;          offset_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][0] =</div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;            row_start_recv[Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[0]];</div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;          {</div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;            <span class="keywordflow">if</span> (Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] !=</div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;                Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1] + 1)</div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;            {</div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;              ptr++;</div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;              offset_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][ptr] =</div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;                row_start_recv[Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;            }</div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;            nnz_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][ptr] += nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;          }</div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;        }</div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;        <span class="keyword">delete</span>[] nnz_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;      }</div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160; </div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;      <span class="comment">// post the receives</span></div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;      <span class="keywordtype">int</span>* column_index_recv = <span class="keyword">new</span> <span class="keywordtype">int</span>[local_block_nnz];</div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;      <span class="keywordtype">double</span>* values_recv = <span class="keyword">new</span> <span class="keywordtype">double</span>[local_block_nnz];</div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;      Vector&lt;MPI_Request&gt; recv2_req;</div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;      {</div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;        {</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;          <span class="keywordflow">if</span> (total_nnz_recv_from_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] != 0)</div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;          {</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;            <span class="comment">// create the datatypes</span></div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;            MPI_Datatype types[2];</div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;            MPI_Type_indexed(n_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;                             nnz_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;                             offset_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;                             &amp;types[0]);</div>
<div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;            MPI_Type_commit(&amp;types[0]);</div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;            MPI_Type_indexed(n_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;                             nnz_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;                             offset_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;                             MPI_INT,</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;                             &amp;types[1]);</div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;            MPI_Type_commit(&amp;types[1]);</div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160; </div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;            <span class="comment">// compute the displacements</span></div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;            MPI_Aint displacements[2];</div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;            MPI_Get_address(values_recv, &amp;displacements[0]);</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;            MPI_Get_address(column_index_recv, &amp;displacements[1]);</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;            displacements[1] -= displacements[0];</div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;            displacements[0] -= displacements[0];</div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160; </div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;            <span class="comment">// compute the block lengths</span></div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;            <span class="keywordtype">int</span> length[2];</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;            length[0] = length[1] = 1;</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160; </div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;            <span class="comment">// create the final datatype</span></div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;            MPI_Datatype final_type;</div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;            MPI_Type_create_struct(</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;              2, length, displacements, types, &amp;final_type);</div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;            MPI_Type_commit(&amp;final_type);</div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;            MPI_Type_free(&amp;types[0]);</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;            MPI_Type_free(&amp;types[1]);</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160; </div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;            <span class="comment">// and the recv</span></div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;            MPI_Request req;</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;            MPI_Irecv(values_recv,</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;                      1,</div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;                      final_type,</div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;                      1,</div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;                      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;                      &amp;req);</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;            recv2_req.push_back(req);</div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;            MPI_Type_free(&amp;final_type);</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;          }</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;        }</div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;        {</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;          <span class="comment">// next send the values and column indices to self</span></div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;          <span class="keywordtype">unsigned</span> block_ptr = 0;</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;          <span class="keywordtype">unsigned</span> counter = 0;</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;          <span class="keywordtype">int</span> nrow_send = Nrows_to_send_for_get_block(block_i, my_rank);</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;          <span class="keywordflow">if</span> (nrow_send &gt; 0)</div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;          {</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;            <span class="keywordtype">unsigned</span> offset = offset_recv_block[my_rank][0];</div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nrow_send; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;            {</div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0)</div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;              {</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;                <span class="keywordflow">if</span> (Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] !=</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;                    Rows_to_recv_for_get_block(block_i, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1] + 1)</div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;                {</div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;                  counter = 0;</div>
<div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;                  block_ptr++;</div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;                  offset = offset_recv_block[my_rank][block_ptr];</div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;                }</div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;              }</div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;              <span class="keywordtype">unsigned</span> <a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a> = Rows_to_send_for_get_block(block_i, my_rank)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> = j_row_start[<a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a>]; <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a> &lt; j_row_start[<a class="code" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a> + 1]; <a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>++)</div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;              {</div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(j_column_index[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>]) == <span class="keywordtype">int</span>(block_j))</div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;                {</div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;                  values_recv[offset + counter] = j_value[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>];</div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;                  column_index_recv[offset + counter] =</div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;                    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">internal_index_in_block</a>(j_column_index[<a class="code" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">r</a>]);</div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;                  counter++;</div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;                }</div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;              }</div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;            }</div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;          }</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;        }</div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;      }</div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160; </div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;      <span class="comment">// wait for the recv to complete (for the column_index and the values_</span></div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;      c_recv = recv2_req.size();</div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;      <span class="keywordflow">if</span> (c_recv != 0)</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;      {</div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;        MPI_Waitall(c_recv, &amp;recv2_req[0], MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;      }</div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160; </div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;      <span class="comment">// Fill in the compressed row matrix</span></div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;      output_block.build(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[block_i]);</div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;      output_block.build_without_copy(this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a>(block_j),</div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;                                      local_block_nnz,</div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;                                      values_recv,</div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;                                      column_index_recv,</div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;                                      row_start_recv);</div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160; </div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;      <span class="comment">// wait for the send to complete (nnz / row_start)</span></div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;      <span class="keywordtype">int</span> c_send = send_req.size();</div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;      <span class="keywordflow">if</span> (c_send)</div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;      {</div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;        MPI_Waitall(c_send, &amp;send_req[0], MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;      }</div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160; </div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;      <span class="comment">// delete temp storage used for assembling data for communication</span></div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;      {</div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;        <span class="keyword">delete</span>[] nnz_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;        <span class="keyword">delete</span>[] column_index_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;        <span class="keyword">delete</span>[] values_for_proc[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;        <span class="keyword">delete</span>[] offset_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;        <span class="keyword">delete</span>[] nnz_recv_block[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>];</div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;      }</div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;      <span class="comment">// throw error</span></div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The matrix is distributed and on more than one &quot;</span></div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;processor. MPI is required.&quot;</span>;</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;    }</div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;  }</div>
<div class="ttc" id="aMatrixBase__row_8cpp_html_a64ef8efef59f875033a27e7cbbc879ec"><div class="ttname"><a href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row</a></div><div class="ttdeci">m row(1)</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a4d8ff67e34e85a71c0f9bb68c0b10496"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4d8ff67e34e85a71c0f9bb68c0b10496">oomph::BlockPreconditioner::block_matrix_test</a></div><div class="ttdeci">void block_matrix_test(const unsigned &amp;i, const unsigned &amp;j, const MATRIX *block_matrix_pt) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:5839</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a6e6a40988711a64c622c2fd9104c56cf"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6e6a40988711a64c622c2fd9104c56cf">oomph::BlockPreconditioner::Run_block_matrix_test</a></div><div class="ttdeci">static bool Run_block_matrix_test</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3527</div></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ac460225afc092cc5ed9d77acc6316536"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">oomph::BlockPreconditioner::internal_block_dimension</a></div><div class="ttdeci">unsigned internal_block_dimension(const unsigned &amp;b) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:3165</div></div>
<div class="ttc" id="alevel2__impl_8h_html_ad46ea6bf5745e72b985b11878e46a45d"><div class="ttname"><a href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a></div><div class="ttdeci">char char char int int * k</div><div class="ttdef"><b>Definition:</b> level2_impl.h:374</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html#af44bac2acd071317f96dae49cbb0d977">oomph::CRDoubleMatrix::build()</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html#aafb4d7de0a87b4bda560928e6a128060">oomph::CRDoubleMatrix::build_without_copy()</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate::c</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html#a21b3dbb8ee74e1247f80ce4506c395f8">oomph::CRDoubleMatrix::column_index()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">oomph::LinearAlgebraDistribution::communicator_pt()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a05842d032d28880ae37951deae804ad8">oomph::LinearAlgebraDistribution::distributed()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../df/db8/level2__impl_8h.html#ad46ea6bf5745e72b985b11878e46a45d">k</a>, <a class="el" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">oomph::OomphCommunicator::nproc()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../de/d6c/namespaceUniformPSDSelfTest.html#a9ef26be0d5673c9bb0c2bb8bce5229d8">UniformPSDSelfTest::r</a>, <a class="el" href="../../df/ddc/MatrixBase__row_8cpp.html#a64ef8efef59f875033a27e7cbbc879ec">row()</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html#a25f1efd00318183abd8c65efede3f3f4">oomph::CRDoubleMatrix::row_start()</a>, <a class="el" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">oomph::Global_string_for_annotation::string()</a>, and <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html#ab8220b7c2bb763dab32a4d0fea7da6f4">oomph::CRDoubleMatrix::value()</a>.</p>

</div>
</div>
<a id="abe001ffe270c96e761ec5205364976a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe001ffe270c96e761ec5205364976a7">&#9670;&nbsp;</a></span>internal_get_block() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_get_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MATRIX &amp;&#160;</td>
          <td class="paramname"><em>output_block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets block (i,j) from the matrix pointed to by Matrix_pt and returns it in output_block. This is associated with the internal blocks. Please use the other get_block(...) function. </p>

</div>
</div>
<a id="afba1bef13cebdce65a0a49ff3381269a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afba1bef13cebdce65a0a49ff3381269a">&#9670;&nbsp;</a></span>internal_get_block_ordered_preconditioner_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_get_block_ordered_preconditioner_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given the naturally ordered vector, v, return the vector rearranged in block order in w. This is a legacy function from the old block preconditioning framework. Kept alive in case it may be needed again.</p>
<p>This uses the variables ending in "get_ordered". We no longer use this type of method. This function copy values from v and re-order them in "block order" and place them in w. Block order means that the values in w are the same as the concatenated block vectors.</p>
<p>I.e. - v is naturally ordered. v -&gt; s_b, v is ordered into blocks vectors (requires communication) concatenate_without_communication(s_{0,...,nblocks},w) gives w.</p>
<p>But this function skips out the concatenation part and builds w directly from v.</p>
<p>This is nice but the function is implemented in such a way that it always use all the (internal) blocks and concatenated with the identity ordering. I.e. if this preconditioner has 3 block types, then w will always be: concatenate_without_communication([s_0, s_1, s_2], w). There is easy way to change this.</p>
<p>Furthermore, it does not take into account the new dof type coarsening feature. So this function will most likely produce the incorrect vector w from what the user intended. It still works, but w will be the concatenation of the most fine grain dof block vectors with the "natural" dof type ordering.</p>
<p>This has been superseded by the function get_block_ordered_preconditioner_vector(...) which does the correct thing. </p>
<div class="fragment"><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;  {</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;    {</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    }</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt() != *this-&gt;master_distribution_pt())</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;    {</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    }</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160; </div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    <span class="comment">//  Cleared and resized w for reordered vector</span></div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.build(this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a16de88bd5369e729d761a6498fdd3f">internal_preconditioner_matrix_distribution_pt</a>(), 0.0);</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160; </div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    <span class="comment">// if + only one processor</span></div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <span class="comment">//    + more than one processor but matrix_pt is not distributed</span></div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    <span class="comment">// then use the serial get_block method</span></div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;nproc() == 1 ||</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;        !this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>())</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    {</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;      <span class="comment">// number of blocks</span></div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;      <span class="keywordtype">unsigned</span> nblock = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>;</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160; </div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;      <span class="comment">// copy to w</span></div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;      <span class="keywordtype">unsigned</span> block_offset = 0;</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;      <span class="keywordtype">double</span>* w_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span>* v_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;      {</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;        <span class="keywordtype">unsigned</span> block_nrow = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a>(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>);</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; block_nrow; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;        {</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;          w_pt[block_offset + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = v_pt[this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;        }</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;        block_offset += block_nrow;</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;      }</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    }</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;    <span class="comment">// otherwise use mpi</span></div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;    {</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160; </div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;      <span class="comment">// my rank</span></div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;      <span class="keywordtype">unsigned</span> my_rank = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160; </div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;      <span class="comment">// the number of processors</span></div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;      <span class="keywordtype">unsigned</span> nproc = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160; </div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;      <span class="comment">// determine the maximum number of rows to be sent or recv</span></div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;      <span class="keywordtype">unsigned</span> max_n_send_or_recv = 0;</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;      {</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]);</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]);</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;      }</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160; </div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;      <span class="comment">// create a vectors of 1s (the size of the nblock for the mpi indexed</span></div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;      <span class="comment">// data types</span></div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;      <span class="keywordtype">int</span>* block_lengths = <span class="keyword">new</span> <span class="keywordtype">int</span>[max_n_send_or_recv];</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_n_send_or_recv; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;      {</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;        block_lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;      }</div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160; </div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;      <span class="comment">// perform the sends and receives</span></div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;      Vector&lt;MPI_Request&gt; requests;</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;      {</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;        <span class="comment">// send and recv with other processors</span></div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;        {</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;          {</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;            <span class="comment">// create the send datatype</span></div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;            MPI_Datatype type_send;</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;            MPI_Type_indexed(Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;                             Rows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;                             &amp;type_send);</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;            MPI_Type_commit(&amp;type_send);</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160; </div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;            <span class="comment">// send</span></div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;            MPI_Request send_req;</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;            MPI_Isend(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt()),</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;                      1,</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;                      type_send,</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;                      0,</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;                      &amp;send_req);</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;            MPI_Type_free(&amp;type_send);</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;            requests.push_back(send_req);</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;          }</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160; </div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;          {</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;            <span class="comment">// create the recv datatype</span></div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;            MPI_Datatype type_recv;</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;            MPI_Type_indexed(Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;                             Rows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;                             &amp;type_recv);</div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;            MPI_Type_commit(&amp;type_recv);</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160; </div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;            <span class="comment">// recv</span></div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;            MPI_Request recv_req;</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;            MPI_Irecv(<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt(),</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;                      1,</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;                      type_recv,</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;                      0,</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;                      &amp;recv_req);</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;            MPI_Type_free(&amp;type_recv);</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;            requests.push_back(recv_req);</div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;          }</div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;        }</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160; </div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;        <span class="comment">// communicate with self</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;        {</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;          <span class="keywordtype">double</span>* w_values_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span>* v_values_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;          {</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;            w_values_pt[Rows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] =</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;              v_values_pt[Rows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;          }</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;        }</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;      }</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160; </div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;      <span class="comment">// and then just wait</span></div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = requests.size();</div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;      Vector&lt;MPI_Status&gt; stat(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>);</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>)</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;      {</div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;        MPI_Waitall(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>, &amp;requests[0], &amp;stat[0]);</div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;      }</div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;      <span class="keyword">delete</span>[] block_lengths;</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160; </div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;      <span class="comment">// throw error</span></div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The preconditioner is distributed and on more than one &quot;</span></div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;processor. MPI is required.&quot;</span>;</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;    }</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;  }</div>
<div class="ttc" id="adatatypes_8h_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>Definition:</b> datatypes.h:23</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate::c</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, and <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.</p>

</div>
</div>
<a id="ae3cf61f61e1aa50e2315e999827e7d59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3cf61f61e1aa50e2315e999827e7d59">&#9670;&nbsp;</a></span>internal_get_block_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_get_block_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A helper function, takes the naturally ordered vector, v, and extracts the n-th block vector, b. Here n is the block number in the current preconditioner. NOTE: The ordering of the vector b is the same as the ordering of the block matrix from internal_get_block(...). </p>
<div class="fragment"><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;  {</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;    <span class="comment">// the number of blocks</span></div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_blocks = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>();</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160; </div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    <span class="comment">// paranoid check that block i is in this block preconditioner</span></div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    <span class="keywordflow">if</span> (b &gt;= n_blocks)</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;    {</div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;      error_message</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Requested block  vector &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, however this preconditioner has internal_nblock_types() &quot;</span></div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;= &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;    }</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;    {</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;    }</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;    {</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;    }</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160; </div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;    <span class="comment">// rebuild the block vector</span></div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;    <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.build(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>], 0.0);</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160; </div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;    <span class="comment">// if + only one processor</span></div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;    <span class="comment">//    + more than one processor but matrix_pt is not distributed</span></div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;    <span class="comment">// then use the serial get_block method</span></div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;nproc() == 1 ||</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        !this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>())</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;    {</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;      <span class="keywordtype">double</span>* w_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span>* v_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;      <span class="keywordtype">unsigned</span> n_row = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.nrow();</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_row; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;      {</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;        w_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = v_pt[this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;      }</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;    }</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;    <span class="comment">// otherwise use mpi</span></div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;    {</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160; </div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;      <span class="comment">// my rank</span></div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;      <span class="keywordtype">unsigned</span> my_rank = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160; </div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;      <span class="comment">// the number of processors</span></div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;      <span class="keywordtype">unsigned</span> nproc = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160; </div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;      <span class="comment">// determine the maximum number of rows to be sent or recv</span></div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;      <span class="keywordtype">unsigned</span> max_n_send_or_recv = 0;</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;      {</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;      }</div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160; </div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;      <span class="comment">// create a vectors of 1s (the size of the nblock for the mpi indexed</span></div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;      <span class="comment">// data types</span></div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;      <span class="keywordtype">int</span>* block_lengths = <span class="keyword">new</span> <span class="keywordtype">int</span>[max_n_send_or_recv];</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_n_send_or_recv; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;      {</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;        block_lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;      }</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160; </div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;      <span class="comment">// perform the sends and receives</span></div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;      Vector&lt;MPI_Request&gt; requests;</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;      {</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;        <span class="comment">// send and recv with other processors</span></div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;        {</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;          {</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;            <span class="comment">// create the send datatype</span></div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;            MPI_Datatype type_send;</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;            MPI_Type_indexed(Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;                             Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;                             &amp;type_send);</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;            MPI_Type_commit(&amp;type_send);</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160; </div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;            <span class="comment">// send</span></div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;            MPI_Request send_req;</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;            MPI_Isend(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt()),</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;                      1,</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;                      type_send,</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;                      0,</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;                      &amp;send_req);</div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;            MPI_Type_free(&amp;type_send);</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;            requests.push_back(send_req);</div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;          }</div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160; </div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;          {</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;            <span class="comment">// create the recv datatype</span></div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;            MPI_Datatype type_recv;</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;            MPI_Type_indexed(Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;                             Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;                             &amp;type_recv);</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;            MPI_Type_commit(&amp;type_recv);</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160; </div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;            <span class="comment">// recv</span></div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;            MPI_Request recv_req;</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;            MPI_Irecv(<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt(),</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;                      1,</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;                      type_recv,</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;                      0,</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;                      &amp;recv_req);</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;            MPI_Type_free(&amp;type_recv);</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;            requests.push_back(recv_req);</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;          }</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;        }</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160; </div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;        <span class="comment">// communicate with self</span></div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;        {</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;          <span class="keywordtype">double</span>* w_values_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span>* v_values_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;          {</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;            w_values_pt[Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] =</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;              v_values_pt[Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;          }</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;        }</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;      }</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160; </div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;      <span class="comment">// and then just wait</span></div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = requests.size();</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;      Vector&lt;MPI_Status&gt; stat(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>);</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>)</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;      {</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;        MPI_Waitall(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>, &amp;requests[0], &amp;stat[0]);</div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      }</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;      <span class="keyword">delete</span>[] block_lengths;</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160; </div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      <span class="comment">// throw error</span></div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The preconditioner is distributed and on more than one &quot;</span></div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;processor. MPI is required.&quot;</span>;</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;    }</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;  }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate::c</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, and <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.</p>

</div>
</div>
<a id="a0cde8af922cd8054dbf352527dd682b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cde8af922cd8054dbf352527dd682b1">&#9670;&nbsp;</a></span>internal_get_block_vectors() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_get_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A helper function, takes the naturally ordered vector and rearranges it into a vector of sub vectors corresponding to the blocks, so s[b][i] contains the i-th entry in the vector associated with block b. The block_vec_number indicates which blocks we want. These blocks and vectors are those corresponding to the internal blocks. Note: If the preconditioner is a subsidiary preconditioner then only the sub-vectors associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas the total length of the s vectors is the sum of the Nrow of the sub vectors. This is simply a wrapper around the other internal_get_block_vectors(...) function with the identity block_vec_number vector. </p>
<div class="fragment"><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;  {</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;    <span class="comment">// Number of block types</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblock = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>();</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;    Vector&lt;unsigned&gt; block_vec_number(nblock, 0);</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;    {</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;      block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>;</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    }</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160; </div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ace6e9dbdfe9a1c3571452e2cd6ec9780">internal_get_block_vectors</a>(block_vec_number, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>);</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;  }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="ace6e9dbdfe9a1c3571452e2cd6ec9780"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace6e9dbdfe9a1c3571452e2cd6ec9780">&#9670;&nbsp;</a></span>internal_get_block_vectors() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_get_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_vec_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the naturally ordered vector and rearranges it into a vector of sub vectors corresponding to the blocks, so s[b][i] contains the i-th entry in the vector associated with block b. The block_vec_number indicates which blocks we want. These blocks and vectors are those corresponding to the internal blocks. Note: If the preconditioner is a subsidiary preconditioner then only the sub-vectors associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas the total length of the s vectors is the sum of the Nrow of the sub vectors. </p>
<div class="fragment"><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;  {</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    }</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    {</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    }</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160; </div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    <span class="comment">// Number of block types</span></div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="comment">// const unsigned nblock = this-&gt;internal_nblock_types();</span></div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblock = block_vec_number.size();</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160; </div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="comment">// if + only one processor</span></div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    <span class="comment">//    + more than one processor but matrix_pt is not distributed</span></div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <span class="comment">// then use the serial get_block method</span></div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;nproc() == 1 ||</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;        !this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>())</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    {</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;      <span class="comment">// Vector of vectors for each section of residual vector</span></div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;      <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>.resize(nblock);</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160; </div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;      <span class="comment">// pointer to the data in v</span></div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span>* v_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160; </div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;      <span class="comment">// setup the block vector and then insert the data</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;      {</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].build(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[required_block], 0.0);</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        <span class="keywordtype">double</span>* s_pt = <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].values_pt();</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a> = <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].nrow();</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;        {</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;          s_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = v_pt[this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[required_block][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;        }</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;      }</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    }</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    <span class="comment">// otherwise use mpi</span></div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    {</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;      <span class="comment">// my rank</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      <span class="keywordtype">unsigned</span> my_rank = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160; </div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      <span class="comment">// the number of processors</span></div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;      <span class="keywordtype">unsigned</span> nproc = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160; </div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      <span class="comment">// build the vectors</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;      <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>.resize(nblock);</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;      {</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;        <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].build(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[required_block], 0.0);</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;      }</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160; </div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;      <span class="comment">// determine the maximum number of rows to be sent or recv</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;      <span class="comment">// and determine the number of blocks each processor will send and recv</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      <span class="comment">// communication for</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      Vector&lt;int&gt; nblock_send(nproc, 0);</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      Vector&lt;int&gt; nblock_recv(nproc, 0);</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      <span class="keywordtype">unsigned</span> max_n_send_or_recv = 0;</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      {</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        {</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;          max_n_send_or_recv = <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;            max_n_send_or_recv, Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;          max_n_send_or_recv = <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;            max_n_send_or_recv, Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;          {</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;            nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;          }</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;          {</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;            nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;          }</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        }</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      }</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160; </div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;      <span class="comment">// create a vectors of 1s the size of the nblock for the mpi indexed</span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;      <span class="comment">// data types</span></div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;      <span class="keywordtype">int</span>* block_lengths = <span class="keyword">new</span> <span class="keywordtype">int</span>[max_n_send_or_recv];</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_n_send_or_recv; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;      {</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        block_lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      }</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160; </div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      <span class="comment">// perform the sends and receives</span></div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      Vector&lt;MPI_Request&gt; requests;</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      {</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <span class="comment">// send and recv with other processors</span></div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        {</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;          <span class="comment">// send</span></div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;          <span class="keywordflow">if</span> (nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;          {</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;            <span class="comment">// create the datatypes vector</span></div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;            MPI_Datatype block_send_types[nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160; </div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            <span class="comment">// create the datatypes</span></div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;            {</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160; </div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;              <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;              {</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                MPI_Type_indexed(Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;                                 block_lengths,</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;                                 Rows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;                                 MPI_DOUBLE,</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;                                 &amp;block_send_types[ptr]);</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;                MPI_Type_commit(&amp;block_send_types[ptr]);</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;                ptr++;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;              }</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;            }</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160; </div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;            <span class="comment">// compute the displacements and lengths</span></div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;            MPI_Aint displacements[nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;            <span class="keywordtype">int</span> lengths[nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;            {</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;              lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;              displacements[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;            }</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160; </div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;            <span class="comment">// build the final datatype</span></div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;            MPI_Datatype type_send;</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;            MPI_Type_create_struct(nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;                                   lengths,</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                                   displacements,</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;                                   block_send_types,</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                                   &amp;type_send);</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;            MPI_Type_commit(&amp;type_send);</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160; </div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;            <span class="comment">// send</span></div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;            MPI_Request send_req;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;            MPI_Isend(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt()),</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                      1,</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                      type_send,</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                      0,</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;                      &amp;send_req);</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;            MPI_Type_free(&amp;type_send);</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;            {</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;              MPI_Type_free(&amp;block_send_types[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;            }</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;            requests.push_back(send_req);</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;          }</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160; </div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;          <span class="comment">// recv</span></div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;          <span class="keywordflow">if</span> (nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;          {</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;            <span class="comment">// create the datatypes vector</span></div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;            MPI_Datatype block_recv_types[nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160; </div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;            <span class="comment">// and the displacements</span></div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;            MPI_Aint displacements[nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160; </div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;            <span class="comment">// and the lengths</span></div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;            <span class="keywordtype">int</span> lengths[nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160; </div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;            <span class="comment">// all displacements are computed relative to s[0] values</span></div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            MPI_Aint displacements_base;</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;            MPI_Get_address(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[0].values_pt(), &amp;displacements_base);</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160; </div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;            <span class="comment">// now build</span></div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;            <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;            {</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160; </div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;              <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;              {</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;                MPI_Type_indexed(Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;                                 block_lengths,</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;                                 Rows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;                                 MPI_DOUBLE,</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;                                 &amp;block_recv_types[ptr]);</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;                MPI_Type_commit(&amp;block_recv_types[ptr]);</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;                MPI_Get_address(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].values_pt(), &amp;displacements[ptr]);</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;                displacements[ptr] -= displacements_base;</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                lengths[ptr] = 1;</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                ptr++;</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;              }</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            }</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160; </div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;            <span class="comment">// build the final data type</span></div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            MPI_Datatype type_recv;</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;            MPI_Type_create_struct(nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                                   lengths,</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;                                   displacements,</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;                                   block_recv_types,</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                                   &amp;type_recv);</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;            MPI_Type_commit(&amp;type_recv);</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160; </div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;            <span class="comment">// recv</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;            MPI_Request recv_req;</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            MPI_Irecv(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[0].values_pt(),</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                      1,</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;                      type_recv,</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;                      0,</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;                      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;                      &amp;recv_req);</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;            MPI_Type_free(&amp;type_recv);</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;            {</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;              MPI_Type_free(&amp;block_recv_types[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            }</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;            requests.push_back(recv_req);</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;          }</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;        }</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160; </div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        <span class="comment">// communicate with self</span></div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;        {</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span>* v_values_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;          {</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160; </div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;            <span class="keywordtype">double</span>* w_values_pt = <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].values_pt();</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                 <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;                 <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;            {</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;              w_values_pt[Rows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] =</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;                v_values_pt[Rows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;            }</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;          }</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;        }</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;      }</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160; </div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;      <span class="comment">// and then just wait</span></div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = requests.size();</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;      Vector&lt;MPI_Status&gt; stat(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>);</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>)</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;      {</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        MPI_Waitall(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>, &amp;requests[0], &amp;stat[0]);</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;      }</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;      <span class="keyword">delete</span>[] block_lengths;</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160; </div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      <span class="comment">// throw error</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The preconditioner is distributed and on more than one &quot;</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;processor. MPI is required.&quot;</span>;</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    }</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;  }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate::c</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="affcfd24c1ba15bf9cac712ffd46dc283"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affcfd24c1ba15bf9cac712ffd46dc283">&#9670;&nbsp;</a></span>internal_index_in_block()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d2a/level1__real__impl_8h.html#a4e8e1c1bb9d4e05fc671fc133ec9dc9b">int</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_index_in_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i_dof</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the index in the block corresponding to a global block number i_dof. The index returned corresponds to the internal blocks, which is the most fine grain dof blocks. </p>
<div class="fragment"><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    {</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;      <span class="comment">// the index in the dof block</span></div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;      <span class="keywordtype">unsigned</span> index = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">internal_index_in_dof</a>(i_dof);</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160; </div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      <span class="comment">// the dof block number</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;      <span class="keywordtype">int</span> internal_dof_block_number = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">internal_dof_number</a>(i_dof);</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      <span class="keywordflow">if</span> (internal_dof_block_number &gt;= 0)</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;      {</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="comment">// the &#39;actual&#39; block number</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;        <span class="keywordtype">unsigned</span> blk_number = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">internal_block_number</a>(i_dof);</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160; </div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        <span class="comment">// compute the index in the block</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0;</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;        <span class="keywordflow">while</span> (<span class="keywordtype">int</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[blk_number][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]) !=</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;               internal_dof_block_number)</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        {</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;          index += <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">internal_dof_block_dimension</a>(</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>[blk_number][<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]);</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;          <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        }</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160; </div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        <span class="comment">// and return</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;        <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      }</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;      <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    } <span class="comment">// EOFunc internal_index_in_block(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_number_to_dof_number_lookup</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_block_dimension()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_dof()</a>, and <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>.</p>

</div>
</div>
<a id="a1e0a33327b5042dfba04baf46c045373"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e0a33327b5042dfba04baf46c045373">&#9670;&nbsp;</a></span>internal_index_in_dof()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_index_in_dof </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i_dof</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the row/column number of global unknown i_dof within it's block. </p>
<div class="fragment"><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;    {</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;      {</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">first_row</a>();</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">nrow_local</a>();</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        <span class="keywordtype">unsigned</span> last_row = <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> + <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">nrow_local</a> - 1;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        <span class="keywordflow">if</span> (i_dof &gt;= <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a> &amp;&amp; i_dof &lt;= last_row)</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        {</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>[i_dof - <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">first_row</a>]);</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        }</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        {</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;          <span class="comment">// int index = this-&gt;get_index_of_element(Global_index_sparse,i_dof);</span></div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;          <span class="keywordtype">int</span> index =</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;            get_index_of_value&lt;unsigned&gt;(Global_index_sparse, i_dof, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;          <span class="keywordflow">if</span> (index &gt;= 0)</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;          {</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;            <span class="keywordflow">return</span> Index_in_dof_block_sparse[index];</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;          }</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;        }</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;        <span class="comment">// if we here we couldn&#39;t find the i_dof</span></div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;Requested internal_index_in_dof(...) for global DOF &quot;</span></div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;                      &lt;&lt; i_dof &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;cannot be found.\n&quot;</span>;</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>[i_dof];</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;      }</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;      {</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>-&gt;internal_index_in_dof(i_dof);</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;      }</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160; </div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;      <span class="comment">// Shouldn&#39;t get here</span></div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        <span class="stringliteral">&quot;Never get here\n&quot;</span>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;      <span class="comment">// Dummy return</span></div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;      <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2634e540a78fe1ee3f5c907aff500b58">oomph::LinearAlgebraDistribution::first_row()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#ab00a3919b8634c698749f14a4d92947d">oomph::DistributableLinearAlgebraObject::first_row()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">oomph::BlockPreconditioner&lt; MATRIX &gt;::Index_in_dof_block_dense</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#ac9310de740f9c3a61f8d5dab9bef88ca">oomph::LinearAlgebraDistribution::nrow_local()</a>, <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a9bd7e1d242c69a28da85a804a7717fce">oomph::DistributableLinearAlgebraObject::nrow_local()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">oomph::BlockPreconditioner&lt; MATRIX &gt;::index_in_block()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_block()</a>.</p>

</div>
</div>
<a id="a7297e4d24c2c7ae7af6a9ad009669928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7297e4d24c2c7ae7af6a9ad009669928">&#9670;&nbsp;</a></span>internal_master_dof_number()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_master_dof_number </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Takes the block number within this preconditioner and returns the corresponding block number in the master preconditioner. If this preconditioner does not have a master block preconditioner then the block number passed is returned </p>
<div class="fragment"><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    {</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>()) <span class="keywordflow">return</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>;</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">Doftype_in_master_preconditioner_fine</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae8c06ce4f4baf8480a2f25b152031dad">oomph::BlockPreconditioner&lt; MATRIX &gt;::Doftype_in_master_preconditioner_fine</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_block_dimension()</a>.</p>

</div>
</div>
<a id="a7c2b9ed482db072b0cabe5a51eb76efa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c2b9ed482db072b0cabe5a51eb76efa">&#9670;&nbsp;</a></span>internal_nblock_types()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_nblock_types </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number internal blocks. This should be the same as the number of internal dof types. Internally, the block preconditioning framework always work with the most fine grain blocks. I.e. it always deal with the most fine grain dof-level blocks. This allows for coarsening of dof types. When we extract a block, we look at the Block_to_dof_map_fine vector to find out which most fine grain dof types belongs to this block.</p>
<p>The preconditioner writer should not have to deal with internal dof/block types and thus this function has been moved to private.</p>
<p>This is legacy code from before the coarsening dof type functionality was added. This is kept alive because it is still used in the internal workings of the block preconditioning framework.</p>
<p>The function nblock_types(...) should be used if the number of block types is required. </p>
<div class="fragment"><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    {</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a> == 0)</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      {</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        err_msg</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;(Internal_nblock_types == 0) is true. \n&quot;</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Did you remember to call the function block_setup(...)?\n\n&quot;</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160; </div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;This variable is always set up within block_setup(...).\n&quot;</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;If block_setup() is already called, then perhaps there is\n&quot;</span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;something wrong with your block preconditionable elements.\n&quot;</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;          &lt;&lt; std::endl;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      }</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160; </div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a> != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a>())</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;      {</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        err_msg</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The number of internal block types and &quot;</span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;internal dof types does not match... \n\n&quot;</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Internally, the number of block types and the number of dof &quot;</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;types must be the same.\n&quot;</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;          &lt;&lt; std::endl;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      }</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160; </div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;      <span class="comment">// return the number of internal block types.</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    } <span class="comment">// EOFunc internal_nblock_types(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_nblock_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_dimension()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_distribution_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adec848504d36ebcd8e27ec60f52f75a6">oomph::BlockPreconditioner&lt; MATRIX &gt;::output_blocks_to_files()</a>.</p>

</div>
</div>
<a id="a4f3efe468cd6e133d6840ede8c3687b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f3efe468cd6e133d6840ede8c3687b5">&#9670;&nbsp;</a></span>internal_ndof_types()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_ndof_types </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of internal dof types. This is the number of most fine grain dof types. The preconditioner writer should not have to concern him/her-self with the internal dof/block types. Thus this fuction is moved to private. We have kept this function alive since it it still used deep within the inner workings of the block preconditioning framework. </p>
<div class="fragment"><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    {</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      <span class="comment">// If this is a subsidiary block preconditioner, then the variable</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      <span class="comment">// Internal_ndof_types must always be set up.</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      {</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a> == 0)</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        {</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;          std::ostringstream error_msg;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;          error_msg</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;(Internal_ndof_types == 0) is true.\n&quot;</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;This means that the Master_block_preconditioner_pt pointer is\n&quot;</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;set but possibly not by the function\n&quot;</span></div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;turn_into_subsidiary_block_preconditioner(...).\n\n&quot;</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160; </div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;This goes against the block preconditioning framework &quot;</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;methodology.\n&quot;</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Many machinery relies on the look up lists set up by the \n&quot;</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;function turn_into_subsidiary_block_preconditioner(...) \n&quot;</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;between the parent and child block preconditioners.\n&quot;</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            &lt;&lt; std::endl;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;            error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;        }</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">Internal_ndof_types</a>;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;      }</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      <span class="comment">// Else, this is a master block preconditioner, calculate the number of</span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      <span class="comment">// dof types from the meshes.</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;      {</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        <span class="keywordtype">unsigned</span> ndof = 0;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>(); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        {</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;          ndof += <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">ndof_types_in_mesh</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        }</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        <span class="keywordflow">return</span> ndof;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;      }</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    } <span class="comment">// EOFunc internal_ndof_types(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3985436e4645c202eadd47a4f4f466e2">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_ndof_types</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types_in_mesh()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">oomph::BlockPreconditioner&lt; MATRIX &gt;::nmesh()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_block_dimension()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_nblock_types()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>.</p>

</div>
</div>
<a id="a3a16de88bd5369e729d761a6498fdd3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a16de88bd5369e729d761a6498fdd3f">&#9670;&nbsp;</a></span>internal_preconditioner_matrix_distribution_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_preconditioner_matrix_distribution_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>access function to the internal preconditioner matrix distribution pt. preconditioner_matrix_distribution_pt always returns the concatenation of the internal block distributions. Since the writer of the preconditioner does not need to concern themselves with the internal dof/block, please use preconditioner_matrix_distribution_pt(). </p>
<div class="fragment"><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    {</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">Internal_preconditioner_matrix_distribution_pt</a>;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;        <span class="keywordflow">return</span> this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>();</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a58079eb938b4d3602d0819cf68b318c0">oomph::BlockPreconditioner&lt; MATRIX &gt;::Internal_preconditioner_matrix_distribution_pt</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>.</p>

</div>
</div>
<a id="a679a82067056628cc4bbc8bb68d088f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a679a82067056628cc4bbc8bb68d088f2">&#9670;&nbsp;</a></span>internal_return_block_ordered_preconditioner_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_return_block_ordered_preconditioner_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the block ordered vector, w, and reorders it in the natural order. Reordered vector is returned in v. Note: If the preconditioner is a subsidiary preconditioner then only the components of the vector associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas that of the vector w is of length this-&gt;nrow().</p>
<p>This is the return function for the function internal_get_block_ordered_preconditioner_vector(...). Both internal_get_block_ordered_preconditioner_vector(...) and internal_return_block_ordered_preconditioner_vector(...) has been superseded by the functions</p>
<p>get_block_ordered_preconditioner_vector(...) and return_block_ordered_preconditioner_vector(...),</p>
<p>Thus this function is moved to the private section of the code. </p>
<div class="fragment"><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;  {</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;    {</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;    }</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt() != *this-&gt;master_distribution_pt())</div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;    {</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;    }</div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.built())</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;    {</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w must be setup.&quot;</span>;</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;    }</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.distribution_pt() !=</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;        *this-&gt;internal_preconditioner_matrix_distribution_pt())</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;    {</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w must match the &quot;</span></div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified distribution at Distribution_pt[b]&quot;</span>;</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;    }</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160; </div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160; </div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;    <span class="comment">// if + only one processor</span></div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;    <span class="comment">//    + more than one processor but matrix_pt is not distributed</span></div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;    <span class="comment">// then use the serial get_block method</span></div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;nproc() == 1 ||</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;        !this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>())</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;    {</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;      <span class="comment">// number of blocks</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;      <span class="keywordtype">unsigned</span> nblock = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a06c7426a2c8c096c8f4dc583444e0e0e">Internal_nblock_types</a>;</div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160; </div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;      <span class="comment">// copy to w</span></div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;      <span class="keywordtype">unsigned</span> block_offset = 0;</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span>* w_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;      <span class="keywordtype">double</span>* v_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;      {</div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;        <span class="keywordtype">unsigned</span> block_nrow = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a>(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>);</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; block_nrow; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;        {</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;          v_pt[this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] = w_pt[block_offset + <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;        }</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;        block_offset += block_nrow;</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;      }</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;    }</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;    <span class="comment">// otherwise use mpi</span></div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;    {</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160; </div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;      <span class="comment">// my rank</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;      <span class="keywordtype">unsigned</span> my_rank = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160; </div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;      <span class="comment">// the number of processors</span></div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;      <span class="keywordtype">unsigned</span> nproc = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160; </div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;      <span class="comment">// determine the maximum number of rows to be sent or recv</span></div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;      <span class="keywordtype">unsigned</span> max_n_send_or_recv = 0;</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;      {</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]);</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]);</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;      }</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160; </div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;      <span class="comment">// create a vectors of 1s (the size of the nblock for the mpi indexed</span></div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;      <span class="comment">// data types</span></div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;      <span class="keywordtype">int</span>* block_lengths = <span class="keyword">new</span> <span class="keywordtype">int</span>[max_n_send_or_recv];</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_n_send_or_recv; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;      {</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;        block_lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;      }</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160; </div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;      <span class="comment">// perform the sends and receives</span></div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;      Vector&lt;MPI_Request&gt; requests;</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;      {</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;        <span class="comment">// send and recv with other processors</span></div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;        {</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;          {</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;            <span class="comment">// create the send datatype</span></div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;            MPI_Datatype type_send;</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;            MPI_Type_indexed(Nrows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;                             Rows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;                             &amp;type_send);</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;            MPI_Type_commit(&amp;type_send);</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160; </div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;            <span class="comment">// send</span></div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;            MPI_Request send_req;</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;            MPI_Isend(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt()),</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;                      1,</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;                      type_send,</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;                      0,</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;                      &amp;send_req);</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;            MPI_Type_free(&amp;type_send);</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;            requests.push_back(send_req);</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;          }</div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160; </div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;          {</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;            <span class="comment">// create the recv datatype</span></div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;            MPI_Datatype type_recv;</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;            MPI_Type_indexed(Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;                             Rows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;                             &amp;type_recv);</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;            MPI_Type_commit(&amp;type_recv);</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160; </div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;            <span class="comment">// recv</span></div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;            MPI_Request recv_req;</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;            MPI_Irecv(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt(),</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;                      1,</div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;                      type_recv,</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;                      0,</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;                      &amp;recv_req);</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;            MPI_Type_free(&amp;type_recv);</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;            requests.push_back(recv_req);</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;          }</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;        }</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160; </div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;        <span class="comment">// communicate wih self</span></div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;        {</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span>* w_values_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;          <span class="keywordtype">double</span>* v_values_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;          {</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;            v_values_pt[Rows_to_send_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] =</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;              w_values_pt[Rows_to_recv_for_get_ordered[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;          }</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;        }</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;      }</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160; </div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;      <span class="comment">// and then just wait</span></div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = requests.size();</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;      Vector&lt;MPI_Status&gt; stat(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>);</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>)</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;      {</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;        MPI_Waitall(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>, &amp;requests[0], &amp;stat[0]);</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;      }</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;      <span class="keyword">delete</span>[] block_lengths;</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160; </div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;      <span class="comment">// throw error</span></div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The preconditioner is distributed and on more than one &quot;</span></div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;processor. MPI is required.&quot;</span>;</div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;    } <span class="comment">// else use mpi</span></div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;  } <span class="comment">// function return_block_ordered_preconditioner_vector</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate::c</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, and <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.</p>

</div>
</div>
<a id="a04e260cc4160a952db2d410109fb2684"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04e260cc4160a952db2d410109fb2684">&#9670;&nbsp;</a></span>internal_return_block_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_return_block_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the n-th block ordered vector, b, and copies its entries to the appropriate entries in the naturally ordered vector, v. Here n is the block number in the current block preconditioner. If the preconditioner is a subsidiary block preconditioner the other entries in v that are not associated with it are left alone.</p>
<p>This version works with the internal block types. This is legacy code but is kept alive, hence moved to private. Please use the function "return_block_vector(...)". </p>
<div class="fragment"><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;  {</div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;    <span class="comment">// the number of blocks</span></div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_blocks = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>();</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160; </div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;    <span class="comment">// paranoid check that block i is in this block preconditioner</span></div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;    <span class="keywordflow">if</span> (b &gt;= n_blocks)</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;    {</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;      error_message</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Requested block  vector &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, however this preconditioner has internal_nblock_types() &quot;</span></div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;= &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;    }</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;    {</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    }</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt() != *this-&gt;master_distribution_pt())</div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;    {</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;    }</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.built())</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;    {</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w must be setup.&quot;</span>;</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;    }</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.distribution_pt() != *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>])</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;    {</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;      error_message</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w must match the &quot;</span></div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; specified distribution at Internal_block_distribution_pt[b]&quot;</span>;</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;    }</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160; </div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;    <span class="comment">// if + only one processor</span></div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;    <span class="comment">//    + more than one processor but matrix_pt is not distributed</span></div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;    <span class="comment">// then use the serial get_block method</span></div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;nproc() == 1 ||</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        !this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>())</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;    {</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;      <span class="comment">// length of vector</span></div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;      <span class="keywordtype">unsigned</span> n_row = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a>(b);</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160; </div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;      <span class="comment">// copy back from the block vector to the naturally ordered vector</span></div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;      <span class="keywordtype">double</span>* v_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span>* w_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_row; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;      {</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;        v_pt[this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] = w_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;      }</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    }</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;    <span class="comment">// otherwise use mpi</span></div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;    {</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160; </div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;      <span class="comment">// my rank</span></div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;      <span class="keywordtype">unsigned</span> my_rank = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160; </div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;      <span class="comment">// the number of processors</span></div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;      <span class="keywordtype">unsigned</span> nproc = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160; </div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;      <span class="comment">// determine the maximum number of rows to be sent or recv</span></div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;      <span class="keywordtype">unsigned</span> max_n_send_or_recv = 0;</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;      {</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;        max_n_send_or_recv =</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;          <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(max_n_send_or_recv, Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;      }</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160; </div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;      <span class="comment">// create a vectors of 1s (the size of the nblock for the mpi indexed</span></div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;      <span class="comment">// data types</span></div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;      <span class="keywordtype">int</span>* block_lengths = <span class="keyword">new</span> <span class="keywordtype">int</span>[max_n_send_or_recv];</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_n_send_or_recv; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;      {</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        block_lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;      }</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160; </div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;      <span class="comment">// perform the sends and receives</span></div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;      Vector&lt;MPI_Request&gt; requests;</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;      {</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;        <span class="comment">// send and recv with other processors</span></div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;        {</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;          {</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;            <span class="comment">// create the send datatype</span></div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;            MPI_Datatype type_send;</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;            MPI_Type_indexed(Nrows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;                             Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;                             &amp;type_send);</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;            MPI_Type_commit(&amp;type_send);</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160; </div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;            <span class="comment">// send</span></div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;            MPI_Request send_req;</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;            MPI_Isend(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt()),</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;                      1,</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;                      type_send,</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;                      0,</div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;                      &amp;send_req);</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;            MPI_Type_free(&amp;type_send);</div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;            requests.push_back(send_req);</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;          }</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160; </div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;          {</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;            <span class="comment">// create the recv datatype</span></div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;            MPI_Datatype type_recv;</div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;            MPI_Type_indexed(Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;                             block_lengths,</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;                             Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;                             MPI_DOUBLE,</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;                             &amp;type_recv);</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;            MPI_Type_commit(&amp;type_recv);</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160; </div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;            <span class="comment">// recv</span></div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;            MPI_Request recv_req;</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;            MPI_Irecv(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt(),</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;                      1,</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;                      type_recv,</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;                      0,</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;                      &amp;recv_req);</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;            MPI_Type_free(&amp;type_recv);</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;            requests.push_back(recv_req);</div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;          }</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;        }</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160; </div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;        <span class="comment">// communicate wih self</span></div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;        {</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span>* w_values_pt = <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.values_pt();</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;          <span class="keywordtype">double</span>* v_values_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>); <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;          {</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;            v_values_pt[Rows_to_send_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] =</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;              w_values_pt[Rows_to_recv_for_get_block(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;          }</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;        }</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;      }</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160; </div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;      <span class="comment">// and then just wait</span></div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = requests.size();</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;      Vector&lt;MPI_Status&gt; stat(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>);</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>)</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;      {</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;        MPI_Waitall(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>, &amp;requests[0], &amp;stat[0]);</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;      }</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      <span class="keyword">delete</span>[] block_lengths;</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160; </div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      <span class="comment">// throw error</span></div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The preconditioner is distributed and on more than one &quot;</span></div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;processor. MPI is required.&quot;</span>;</div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;    }</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;  }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate::c</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, and <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.</p>

</div>
</div>
<a id="a9e2ce77e3efbcdd465f7ad7252936dfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e2ce77e3efbcdd465f7ad7252936dfd">&#9670;&nbsp;</a></span>internal_return_block_vectors() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_return_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A helper function, takes the vector of block vectors, s, and copies its entries into the naturally ordered vector, v. If this is a subsidiary block preconditioner only those entries in v that are associated with its blocks are affected. This is simple a wrapper around the other internal_return_block_vectors(...) function with the identity block_vec_number vector.</p>
<p>A helper function, takes the naturally ordered vector and rearranges it into a vector of sub vectors corresponding to the blocks, so s[b][i] contains the i-th entry in the vector associated with block b. The block_vec_number indicates which blocks we want. These blocks and vectors are those corresponding to the internal blocks. Note: If the preconditioner is a subsidiary preconditioner then only the sub-vectors associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas the total length of the s vectors is the sum of the Nrow of the sub vectors. This is simply a wrapper around the other internal_get_block_vectors(...) function with the identity block_vec_number vector. </p>
<div class="fragment"><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;  {</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    <span class="comment">// the number of blocks</span></div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblock = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>();</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    Vector&lt;unsigned&gt; block_vec_number(nblock, 0);</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;    {</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;      block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>;</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;    }</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160; </div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2ca7f125e50493073d116ba8da271af5">internal_return_block_vectors</a>(block_vec_number, <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>);</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a2ca7f125e50493073d116ba8da271af5"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2ca7f125e50493073d116ba8da271af5">oomph::BlockPreconditioner::internal_return_block_vectors</a></div><div class="ttdeci">void internal_return_block_vectors(const Vector&lt; unsigned &gt; &amp;block_vec_number, const Vector&lt; DoubleVector &gt; &amp;s, DoubleVector &amp;v) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:3684</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="a2ca7f125e50493073d116ba8da271af5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ca7f125e50493073d116ba8da271af5">&#9670;&nbsp;</a></span>internal_return_block_vectors() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::internal_return_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_vec_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A helper function, takes the vector of block vectors, s, and copies its entries into the naturally ordered vector, v. If this is a subsidiary block preconditioner only those entries in v that are associated with its blocks are affected.</p>
<p>Takes the naturally ordered vector and rearranges it into a vector of sub vectors corresponding to the blocks, so s[b][i] contains the i-th entry in the vector associated with block b. The block_vec_number indicates which blocks we want. These blocks and vectors are those corresponding to the internal blocks. Note: If the preconditioner is a subsidiary preconditioner then only the sub-vectors associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas the total length of the s vectors is the sum of the Nrow of the sub vectors. </p>
<div class="fragment"><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;  {</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;    <span class="comment">// the number of blocks</span></div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblock = block_vec_number.size();</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160; </div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;    {</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;    }</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;    {</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    }</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;    {</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].built())</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;      {</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; must be setup.&quot;</span>;</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;      }</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;      <span class="keywordflow">if</span> (*(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()) !=</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;          *(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[required_block]))</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;      {</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;        error_message</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot; must match the&quot;</span></div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; specified distribution at Internal_block_distribution_pt[&quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;      }</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;    }</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160; </div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;    <span class="comment">// if + only one processor</span></div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;    <span class="comment">//    + more than one processor but matrix_pt is not distributed</span></div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;    <span class="comment">// then use the serial get_block method</span></div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;nproc() == 1 ||</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;        !this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a5505731e7e73d7e4251c67c7adec6bf5">distributed</a>())</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    {</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;      <span class="keywordtype">double</span>* v_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;      {</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160; </div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span>* s_pt = <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].values_pt();</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a> = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">internal_block_dimension</a>(required_block);</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a7569556f14fd68b28508920e89bd5eee">nrow</a>; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;        {</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;          v_pt[this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a79ea9c428aa8533c371ef3f0048a3a92">Global_index</a>[required_block][<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] = s_pt[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;        }</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;      }</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;    }</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;    <span class="comment">// otherwise use mpi</span></div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;    {</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160; </div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;      <span class="comment">// my rank</span></div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;      <span class="keywordtype">unsigned</span> my_rank = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a670b34aab05bfe0b96d0e0fabf583c7a">my_rank</a>();</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160; </div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;      <span class="comment">// the number of processors</span></div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;      <span class="keywordtype">unsigned</span> nproc = this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#a2e4736826a65253f574d4f6f152ab514">communicator_pt</a>()-&gt;<a class="code" href="../../de/d83/classoomph_1_1OomphCommunicator.html#a6c78c72666f4b102c2bccf200f0853b7">nproc</a>();</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160; </div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;      <span class="comment">// determine the maximum number of rows to be sent or recv</span></div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;      <span class="comment">// and determine the number of blocks each processor will send and recv</span></div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;      <span class="comment">// communication for</span></div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;      Vector&lt;int&gt; nblock_send(nproc, 0);</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;      Vector&lt;int&gt; nblock_recv(nproc, 0);</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;      <span class="keywordtype">unsigned</span> max_n_send_or_recv = 0;</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;      {</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;        {</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160; </div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;          max_n_send_or_recv = <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;            max_n_send_or_recv, Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;          max_n_send_or_recv = <a class="code" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">std::max</a>(</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;            max_n_send_or_recv, Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>));</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;          {</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;            nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;          }</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;          <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;          {</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;            nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]++;</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;          }</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        }</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;      }</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160; </div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;      <span class="comment">// create a vectors of 1s the size of the nblock for the mpi indexed</span></div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;      <span class="comment">// data types</span></div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;      <span class="keywordtype">int</span>* block_lengths = <span class="keyword">new</span> <span class="keywordtype">int</span>[max_n_send_or_recv];</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_n_send_or_recv; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;      {</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        block_lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;      }</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160; </div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;      <span class="comment">// perform the sends and receives</span></div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;      Vector&lt;MPI_Request&gt; requests;</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> = 0; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> &lt; nproc; <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>++)</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      {</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;        <span class="comment">// send and recv with other processors</span></div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a> != my_rank)</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;        {</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;          <span class="comment">// recv</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;          <span class="keywordflow">if</span> (nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;          {</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            <span class="comment">// create the datatypes vector</span></div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;            MPI_Datatype block_recv_types[nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160; </div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;            <span class="comment">// create the datatypes</span></div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;            <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;            {</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160; </div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;              <span class="keywordflow">if</span> (Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;              {</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;                MPI_Type_indexed(Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;                                 block_lengths,</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;                                 Rows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;                                 MPI_DOUBLE,</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;                                 &amp;block_recv_types[ptr]);</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;                MPI_Type_commit(&amp;block_recv_types[ptr]);</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;                ptr++;</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;              }</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;            }</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160; </div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;            <span class="comment">// compute the displacements and lengths</span></div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;            MPI_Aint displacements[nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;            <span class="keywordtype">int</span> lengths[nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;            {</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;              lengths[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1;</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;              displacements[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;            }</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160; </div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;            <span class="comment">// build the final datatype</span></div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;            MPI_Datatype type_recv;</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;            MPI_Type_create_struct(nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;                                   lengths,</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;                                   displacements,</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;                                   block_recv_types,</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                                   &amp;type_recv);</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;            MPI_Type_commit(&amp;type_recv);</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160; </div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;            <span class="comment">// recv</span></div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;            MPI_Request recv_req;</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;            MPI_Irecv(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt(),</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;                      1,</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;                      type_recv,</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;                      0,</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;                      this-&gt;distribution_pt()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;                      &amp;recv_req);</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;            MPI_Type_free(&amp;type_recv);</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblock_recv[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;            {</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;              MPI_Type_free(&amp;block_recv_types[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;            }</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;            requests.push_back(recv_req);</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;          }</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160; </div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;          <span class="comment">// send</span></div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;          <span class="keywordflow">if</span> (nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>] &gt; 0)</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;          {</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;            <span class="comment">// create the datatypes vector</span></div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;            MPI_Datatype block_send_types[nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160; </div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;            <span class="comment">// and the displacements</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;            MPI_Aint displacements[nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160; </div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;            <span class="comment">// and the lengths</span></div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;            <span class="keywordtype">int</span> lengths[nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]];</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160; </div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;            <span class="comment">// all displacements are computed relative to s[0] values</span></div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;            MPI_Aint displacements_base;</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;            MPI_Get_address(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[0].values_pt()),</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;                            &amp;displacements_base);</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160; </div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;            <span class="comment">// now build</span></div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;            <span class="keywordtype">unsigned</span> ptr = 0;</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;            {</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160; </div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;              <span class="keywordflow">if</span> (Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>) &gt; 0)</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;              {</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;                MPI_Type_indexed(Nrows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;                                 block_lengths,</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;                                 Rows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>),</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;                                 MPI_DOUBLE,</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;                                 &amp;block_send_types[ptr]);</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;                MPI_Type_commit(&amp;block_send_types[ptr]);</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;                MPI_Get_address(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].values_pt()),</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;                                &amp;displacements[ptr]);</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;                displacements[ptr] -= displacements_base;</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                lengths[ptr] = 1;</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;                ptr++;</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;              }</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;            }</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160; </div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;            <span class="comment">// build the final data type</span></div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;            MPI_Datatype type_send;</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;            MPI_Type_create_struct(nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>],</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;                                   lengths,</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;                                   displacements,</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;                                   block_send_types,</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;                                   &amp;type_send);</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;            MPI_Type_commit(&amp;type_send);</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160; </div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;            <span class="comment">// send</span></div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;            MPI_Request send_req;</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;            MPI_Isend(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[0].values_pt()),</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;                      1,</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;                      type_send,</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;                      <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>,</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;                      0,</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;                      this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()-&gt;communicator_pt()-&gt;mpi_comm(),</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;                      &amp;send_req);</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;            MPI_Type_free(&amp;type_send);</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblock_send[<a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>]; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;            {</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;              MPI_Type_free(&amp;block_send_types[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;            }</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;            requests.push_back(send_req);</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;          }</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;        }</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160; </div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;        <span class="comment">// communicate wih self</span></div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;        {</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;          <span class="keywordtype">double</span>* v_values_pt = <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.values_pt();</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;          {</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160; </div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span>* w_values_pt = <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].values_pt();</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;                 <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Nrows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>);</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;                 <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;            {</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;              v_values_pt[Rows_to_send_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] =</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;                w_values_pt[Rows_to_recv_for_get_block(required_block, <a class="code" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>)[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;            }</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;          }</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        }</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;      }</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160; </div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      <span class="comment">// and then just wait</span></div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a> = requests.size();</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;      Vector&lt;MPI_Status&gt; stat(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>);</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>)</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;      {</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;        MPI_Waitall(<a class="code" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">c</a>, &amp;requests[0], &amp;stat[0]);</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;      }</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;      <span class="keyword">delete</span>[] block_lengths;</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160; </div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;      <span class="comment">// throw error</span></div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The preconditioner is distributed and on more than one &quot;</span></div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;processor. MPI is required.&quot;</span>;</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    }</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;  }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d9/d33/namespacecalibrate.html#a1919e193275bfcb62d1e5b79a3aea213">calibrate::c</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dc/d51/datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d0/db0/Tutorial__Map__using_8cpp.html#a7fe964f6b1afd4591f637999272ab9a2">p</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="a804e1975f170d2ad941b3b7d2dd50407"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a804e1975f170d2ad941b3b7d2dd50407">&#9670;&nbsp;</a></span>is_master_block_preconditioner()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::is_master_block_preconditioner </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return true if this preconditioner is the master block preconditioner. </p>
<div class="fragment"><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    {</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      <span class="keywordflow">return</span> (this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a> == 0);</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    } <span class="comment">// EOFunc is_master_block_preconditioner()</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">oomph::BlockPreconditioner&lt; MATRIX &gt;::dof_block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_block_dimension()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_dof()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_master_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a16de88bd5369e729d761a6498fdd3f">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_preconditioner_matrix_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_block_preconditioner_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_nrow()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>.</p>

</div>
</div>
<a id="a9ac4335ec07fc13f7bf1093fd0489c52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ac4335ec07fc13f7bf1093fd0489c52">&#9670;&nbsp;</a></span>is_subsidiary_block_preconditioner()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::is_subsidiary_block_preconditioner </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return true if this preconditioner is a subsidiary preconditioner. </p>
<div class="fragment"><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    {</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      <span class="keywordflow">return</span> (this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a> != 0);</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    } <span class="comment">// EOFunc is_subsidiary_block_preconditioner()</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">oomph::BlockPreconditioner&lt; MATRIX &gt;::matrix_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">oomph::BlockPreconditioner&lt; MATRIX &gt;::mesh_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types_in_mesh()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_master_matrix_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8ed741a5fbf514fc29f0a332a211255f">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_off_recursive_debug_flag()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0d977a81515458e59b94438a215e93e1">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_on_recursive_debug_flag()</a>.</p>

</div>
</div>
<a id="ab84701c65bdfd8d2c14611176e5e6209"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab84701c65bdfd8d2c14611176e5e6209">&#9670;&nbsp;</a></span>master_block_preconditioner_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt;MATRIX&gt;* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::master_block_preconditioner_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function to the master block preconditioner pt. </p>
<div class="fragment"><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    {</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      {</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        error_message &lt;&lt; <span class="stringliteral">&quot;This block preconditioner does not have &quot;</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;a master preconditioner.&quot;</span>;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>;</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    } <span class="comment">// EOFunc master_block_preconditioner_pt()</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9aac48fd53e579e6db8eeed58933a14b">oomph::BlockPreconditioner&lt; MATRIX &gt;::matrix_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a748e2ad8836bc8edf5b9a42373a7ad61">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_master_matrix_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8ed741a5fbf514fc29f0a332a211255f">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_off_recursive_debug_flag()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0d977a81515458e59b94438a215e93e1">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_on_recursive_debug_flag()</a>.</p>

</div>
</div>
<a id="a005d978655022d1a04da7397cf5d0e83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a005d978655022d1a04da7397cf5d0e83">&#9670;&nbsp;</a></span>master_distribution_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::master_distribution_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Access function to the distribution of the master preconditioner. If this preconditioner does not have a master preconditioner then the distribution of this preconditioner is returned. </p>
<div class="fragment"><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    {</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;      {</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <span class="keywordflow">return</span> this-&gt;<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>();</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      }</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      {</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>-&gt;master_distribution_pt();</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      }</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    } <span class="comment">// EOFunc master_distribution_pt(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">oomph::DistributableLinearAlgebraObject::distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>.</p>

</div>
</div>
<a id="a3e5b553f65e6c25354a5c908d507e8ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e5b553f65e6c25354a5c908d507e8ee">&#9670;&nbsp;</a></span>master_nrow()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::master_nrow </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of dofs (number of rows or columns) in the overall problem. The prefix "master_" is sort of redundant when used as a stand-alone block preconditioner but is required to avoid ambiguities. The latter is stored (and maintained) separately for each specific block preconditioner regardless of its role. </p>
<div class="fragment"><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    {</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;      {</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">Nrow</a>;</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      }</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;      {</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;        <span class="keywordflow">return</span> (this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a>-&gt;master_nrow());</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      }</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">oomph::BlockPreconditioner&lt; MATRIX &gt;::Master_block_preconditioner_pt</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4aa232afd2a76adac97fb7d484a18c5e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Nrow</a>.</p>

</div>
</div>
<a id="a9aac48fd53e579e6db8eeed58933a14b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9aac48fd53e579e6db8eeed58933a14b">&#9670;&nbsp;</a></span>matrix_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MATRIX* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::matrix_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Access function to matrix_pt. If this is the master then cast the matrix pointer to MATRIX*, error check and return. Otherwise ask the master for its matrix pointer. </p>

<p>Reimplemented from <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a66726e9df31365df646cdf83a975aa26">oomph::Preconditioner</a>.</p>
<div class="fragment"><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;matrix_pt();</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        MATRIX* m_pt = <span class="keyword">dynamic_cast&lt;</span>MATRIX*<span class="keyword">&gt;</span>(<a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#a66726e9df31365df646cdf83a975aa26">Preconditioner::matrix_pt</a>());</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">if</span> (m_pt == 0)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;          std::ostringstream error_msg;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;          error_msg &lt;&lt; <span class="stringliteral">&quot;Matrix is not correct type.&quot;</span>;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">return</span> m_pt;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    } <span class="comment">// EOFunc matrix_pt()</span></div>
<div class="ttc" id="aclassoomph_1_1Preconditioner_html_a66726e9df31365df646cdf83a975aa26"><div class="ttname"><a href="../../db/d9e/classoomph_1_1Preconditioner.html#a66726e9df31365df646cdf83a975aa26">oomph::Preconditioner::matrix_pt</a></div><div class="ttdeci">virtual DoubleMatrixBase * matrix_pt() const</div><div class="ttdoc">Get function for matrix pointer.</div><div class="ttdef"><b>Definition:</b> preconditioner.h:150</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_block_preconditioner_pt()</a>, <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#a66726e9df31365df646cdf83a975aa26">oomph::Preconditioner::matrix_pt()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9dae351352d344321ea82999d7003e17">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block_other_matrix()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#ad6937ea7f72719eb9e33c28c002fa380">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::resolve()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a5806236b991ac2d7fe4bc7a4f19e98fb">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::solve()</a>, and <a class="el" href="../../df/df9/classoomph_1_1HelmholtzFGMRESMG.html#a36a1d601676df2ebe39fcdb7a0837864">oomph::HelmholtzFGMRESMG&lt; MATRIX &gt;::solve()</a>.</p>

</div>
</div>
<a id="a3c0e92cb77c3e3179007fe9fd99b6428"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c0e92cb77c3e3179007fe9fd99b6428">&#9670;&nbsp;</a></span>mesh_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::mesh_pt </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Access to i-th mesh (of the various meshes that contain block preconditionable elements of the same number of dof type).</p>
<p>WARNING: This should only be used if the derived class is the upper-most master block preconditioner. An error is thrown is this function is called from a subsidiary preconditioner. They (and since every block preconditioner can in principle be used as s subsidiary preconditioner: all block preconditioners) should store local copies of "their meshes" (if they're needed for anything) </p>
<div class="fragment"><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    {</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      {</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;The mesh_pt() function should not be called on a\n&quot;</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;subsidiary block preconditioner.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      }</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160; </div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <span class="keyword">const</span> Mesh* mesh_i_pt = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160; </div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <span class="keywordflow">if</span> (mesh_i_pt == 0)</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      {</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        error_msg &lt;&lt; <span class="stringliteral">&quot;Mesh pointer &quot;</span> &lt;&lt; mesh_i_pt &lt;&lt; <span class="stringliteral">&quot; is null.&quot;</span>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      }</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160; </div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      <span class="keywordflow">return</span> mesh_i_pt;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    } <span class="comment">// EOFunc mesh_pt(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">oomph::BlockPreconditioner&lt; MATRIX &gt;::Mesh_pt</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d2/d5b/classoomph_1_1SimpleBlockDiagonalPreconditioner.html#ac9880d75792c2a140362c6f19100fbf8">oomph::SimpleBlockDiagonalPreconditioner&lt; MATRIX &gt;::add_mesh()</a>, <a class="el" href="../../d5/d31/classoomph_1_1GeneralPurposeBlockPreconditioner.html#a8a92f8e0db68105f2fb548e5f7cd0732">oomph::GeneralPurposeBlockPreconditioner&lt; MATRIX &gt;::add_mesh()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6fb68db9e79048615984b005f8aa43b3">oomph::BlockPreconditioner&lt; MATRIX &gt;::any_mesh_distributed()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types_in_mesh()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af97821621b570d409e6662939e5f818d">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_mesh()</a>, <a class="el" href="../../d5/d9e/classSimpleFSIPreconditioner.html#afbb8638346e70c33794e36f83af14ba2">SimpleFSIPreconditioner&lt; MATRIX &gt;::set_navier_stokes_mesh()</a>, <a class="el" href="../../d3/d3a/classoomph_1_1SimpleFSIPreconditioner.html#ab9c5875d7186cfb5c55cecb72bed50b3">oomph::SimpleFSIPreconditioner&lt; MATRIX &gt;::set_navier_stokes_mesh()</a>, <a class="el" href="../../d5/d9e/classSimpleFSIPreconditioner.html#a3725465ac0e9e9a36158310afe91be8e">SimpleFSIPreconditioner&lt; MATRIX &gt;::set_solid_mesh()</a>, and <a class="el" href="../../d3/d3a/classoomph_1_1SimpleFSIPreconditioner.html#a324b53aaedfc8f0a2cc3da921ef94686">oomph::SimpleFSIPreconditioner&lt; MATRIX &gt;::set_wall_mesh()</a>.</p>

</div>
</div>
<a id="a80808d42be8db74fd58af80b019bf317"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80808d42be8db74fd58af80b019bf317">&#9670;&nbsp;</a></span>nblock_types()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::nblock_types </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the number of block types. </p>
<div class="fragment"><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    {</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>.size() == 0)</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      {</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        std::ostringstream error_msg;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        error_msg</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The Block_to_dof_map_coarse vector is not setup for \n&quot;</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;this block preconditioner.\n\n&quot;</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160; </div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;This vector is always set up within block_setup(...).\n&quot;</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;If block_setup() is already called, then perhaps there is\n&quot;</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;something wrong with your block preconditionable elements.\n&quot;</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;          &lt;&lt; std::endl;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;          error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      }</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160; </div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="comment">// Return the number of block types.</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">Block_to_dof_map_coarse</a>.size();</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    } <span class="comment">// EOFunc nblock_types(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae047d81b8179dfd09b70cf35f40f62ca">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_to_dof_map_coarse</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">oomph::BlockPreconditioner&lt; MATRIX &gt;::block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a51636746e5921ee2845daf60b1c322dc">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_concatenated_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">oomph::BlockPreconditioner&lt; MATRIX &gt;::insert_auxiliary_block_distribution()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a0ae880f098d5b1e9df78fc74c31dbf">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_replacement_dof_block()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a5806236b991ac2d7fe4bc7a4f19e98fb">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::solve()</a>, and <a class="el" href="../../df/df9/classoomph_1_1HelmholtzFGMRESMG.html#a36a1d601676df2ebe39fcdb7a0837864">oomph::HelmholtzFGMRESMG&lt; MATRIX &gt;::solve()</a>.</p>

</div>
</div>
<a id="ab6cca480686ea8e44244ac60a0db23ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6cca480686ea8e44244ac60a0db23ba">&#9670;&nbsp;</a></span>ndof_types()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::ndof_types </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the total number of DOF types. </p>
<div class="fragment"><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="comment">// Subsidiary preconditioners don&#39;t really need the meshes</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      <span class="keywordflow">if</span> (this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>();</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> == 0)</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        {</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;          err_msg &lt;&lt; <span class="stringliteral">&quot;No meshes have been set for this block preconditioner!\n&quot;</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;Set one with set_nmesh(...), set_mesh(...)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;            err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> = 0; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt; <a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>++)</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;          {</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a>[<a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>] == 0)</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;              err_msg &lt;&lt; <span class="stringliteral">&quot;The mesh pointer to mesh &quot;</span> &lt;&lt; <a class="code" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a> &lt;&lt; <span class="stringliteral">&quot; is null!\n&quot;</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Set a non-null one with set_mesh(...)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;              <span class="keywordflow">throw</span> OomphLibError(err_msg.str(),</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                                  <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            }</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;          }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      }</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160; </div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      <span class="comment">// If this is a subsidiary block preconditioner, then the function</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <span class="comment">// turn_into_subsidiary_block_preconditioner(...) should have been called,</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="comment">// this function would have set up the look up lists between coarsened</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="comment">// dof types and the internal dof types. Of coarse, the user (the writer</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="comment">// of the preconditioners) should not care about the internal dof types</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="comment">// and what happens under the hood. Thus they should get the number of</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="comment">// coarsened dof types (i.e. the number of dof types the preconditioner</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      <span class="comment">// above (parent preconditioner) decides to give to this preconditioner).</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      {</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.size() == 0)</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        {</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;          std::ostringstream error_msg;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;          error_msg</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;The Doftype_coarsen_map_coarse vector is not setup for \n&quot;</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;this SUBSIDIARY block preconditioner.\n\n&quot;</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160; </div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;For SUBSIDARY block preconditioners at any level, this\n&quot;</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;vector is set up in the function \n&quot;</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;turn_into_subsidiary_block_preconditioner(...).\n\n&quot;</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Being a SUBSIDIARY block preconditioner means that \n&quot;</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;(Master_block_preconditioner_pt == 0) is true.\n&quot;</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;The Master_block_preconditioner_pt MUST be set in the &quot;</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;function \n&quot;</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;turn_into_subsidiary_block_preconditioner(...).\n\n&quot;</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160; </div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Somewhere, the Master_block_preconditioner_pt pointer is\n&quot;</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;set but not by the function\n&quot;</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;turn_into_subsidiary_block_preconditioner(...).\n&quot;</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            &lt;&lt; std::endl;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;          <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;            error_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        }</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        <span class="comment">// return the number of dof types.</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a>.size();</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="comment">// Otherwise the number of ndof types is the same as the internal number</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      <span class="comment">// of dof types, since no coarsening of the dof types is done at the</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;      <span class="comment">// top-most master level.</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      {</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">internal_ndof_types</a>();</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      }</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    } <span class="comment">// EOFunc ndof_types(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">oomph::BlockPreconditioner&lt; MATRIX &gt;::Doftype_coarsen_map_coarse</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../da/dc6/level2__cplx__impl_8h.html#a8d334fd8388055a029936c59d361ff00">m</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">oomph::BlockPreconditioner&lt; MATRIX &gt;::Mesh_pt</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">oomph::BlockPreconditioner&lt; MATRIX &gt;::nmesh()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">oomph::BlockPreconditioner&lt; MATRIX &gt;::dof_block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a433adda4f658cc7880121bf9ca4293c4">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_fine_grain_dof_types_in()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a50b76a374797805f64e2af34d581cdc2">oomph::BlockPreconditioner&lt; MATRIX &gt;::nfine_grain_dof_types_in()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a0ae880f098d5b1e9df78fc74c31dbf">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_replacement_dof_block()</a>.</p>

</div>
</div>
<a id="a45509677ccef78be13b5e4485312ddc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45509677ccef78be13b5e4485312ddc1">&#9670;&nbsp;</a></span>ndof_types_in_mesh()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::ndof_types_in_mesh </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of DOF types in mesh i. WARNING: This should only be used by the upper-most master block preconditioner. An error is thrown is this function is called from a subsidiary preconditioner. They (and since every block preconditioner can in principle be used as s subsidiary preconditioner: all block preconditioners) should store local copies of "their meshes" (if they're needed for anything) </p>
<div class="fragment"><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    {</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      {</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;A subsidiary block preconditioner should not care about\n&quot;</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;anything to do with meshes.&quot;</span>;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      }</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">Ndof_types_in_mesh</a>.size() == 0)</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      {</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d6/db8/classoomph_1_1Mesh.html#a16225f0094eeb234460f6cf963099c85">ndof_types</a>();</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      }</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      {</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">Ndof_types_in_mesh</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      }</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    } <span class="comment">// EOFunc ndof_types_in_mesh(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">oomph::BlockPreconditioner&lt; MATRIX &gt;::mesh_pt()</a>, <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html#a16225f0094eeb234460f6cf963099c85">oomph::Mesh::ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a43e9d73ff61daa00aea4e4deff0d6aff">oomph::BlockPreconditioner&lt; MATRIX &gt;::Ndof_types_in_mesh</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>.</p>

</div>
</div>
<a id="a50b76a374797805f64e2af34d581cdc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50b76a374797805f64e2af34d581cdc2">&#9670;&nbsp;</a></span>nfine_grain_dof_types_in()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::nfine_grain_dof_types_in </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Access function for the number of most fine grain dof types in a (possibly coarsened) dof type. </p>
<div class="fragment"><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    {</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dof_types = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>();</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160; </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= n_dof_types)</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;      {</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Trying to get the number of most fine grain dof types &quot;</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;in dof type &quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;,\n&quot;</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;but there are only &quot;</span> &lt;&lt; n_dof_types</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; number of dof types.\n&quot;</span>;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      }</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">Doftype_coarsen_map_fine</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa4e2e47f537f9b6b4deae5792c493d65">oomph::BlockPreconditioner&lt; MATRIX &gt;::Doftype_coarsen_map_fine</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

</div>
</div>
<a id="a193776a271f7c23d20d2102de0ff1cb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a193776a271f7c23d20d2102de0ff1cb9">&#9670;&nbsp;</a></span>nmesh()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::nmesh </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of meshes in Mesh_pt.</p>
<p>WARNING: This should only be used if the derived class is the upper-most master block preconditioner. All block preconditioners) should store local copies of "their meshes" (if they're needed for anything) </p>
<div class="fragment"><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    {</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a>.size();</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    } <span class="comment">// EOFunc nmesh()</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">oomph::BlockPreconditioner&lt; MATRIX &gt;::Mesh_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6fb68db9e79048615984b005f8aa43b3">oomph::BlockPreconditioner&lt; MATRIX &gt;::any_mesh_distributed()</a>, <a class="el" href="../../d5/d31/classoomph_1_1GeneralPurposeBlockPreconditioner.html#a99a80a26b189ecabeb3e7dfad9c45f0c">oomph::GeneralPurposeBlockPreconditioner&lt; MATRIX &gt;::gp_preconditioner_set_all_meshes()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af97821621b570d409e6662939e5f818d">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_mesh()</a>.</p>

</div>
</div>
<a id="a8f07557542d4ebeba0e5a2307c7a7d48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f07557542d4ebeba0e5a2307c7a7d48">&#9670;&nbsp;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Broken assignment operator. </p>

</div>
</div>
<a id="adec848504d36ebcd8e27ec60f52f75a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adec848504d36ebcd8e27ec60f52f75a6">&#9670;&nbsp;</a></span>output_blocks_to_files()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::output_blocks_to_files </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>basefilename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>precision</em> = <code>8</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Output all blocks to numbered files. Called at the end of get blocks if an output filename has been set. </p>
<div class="fragment"><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    {</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      <span class="keywordtype">unsigned</span> nblocks = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">internal_nblock_types</a>();</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160; </div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nblocks; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      {</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> = 0; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a> &lt; nblocks; <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++)</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        {</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;          <span class="comment">// Construct the filename.</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;          <a class="code" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">std::string</a> <a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a>(basefilename + <span class="stringliteral">&quot;_block_&quot;</span> +</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                               <a class="code" href="../../d0/d49/namespaceoomph_1_1StringConversion.html#a9d30fabdc1a0694bdb91dddd2833bbd6">StringConversion::to_string</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) + <span class="stringliteral">&quot;_&quot;</span> +</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                               <a class="code" href="../../d0/d49/namespaceoomph_1_1StringConversion.html#a9d30fabdc1a0694bdb91dddd2833bbd6">StringConversion::to_string</a>(<a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>));</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160; </div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;          <span class="comment">// Write out the block.</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">get_block</a>(<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>).sparse_indexed_output(<a class="code" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">filename</a>, precision, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        }</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      }</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    } <span class="comment">// EOFunc output_blocks_to_files(...)</span></div>
<div class="ttc" id="anamespaceMergeRestartFiles_html_a210231ed06d822ca8be83bd7f75aa572"><div class="ttname"><a href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">MergeRestartFiles.filename</a></div><div class="ttdeci">string filename</div><div class="ttdef"><b>Definition:</b> MergeRestartFiles.py:39</div></div>
<div class="ttc" id="anamespaceoomph_1_1StringConversion_html_a9d30fabdc1a0694bdb91dddd2833bbd6"><div class="ttname"><a href="../../d0/d49/namespaceoomph_1_1StringConversion.html#a9d30fabdc1a0694bdb91dddd2833bbd6">oomph::StringConversion::to_string</a></div><div class="ttdeci">std::string to_string(T object, unsigned float_precision=8)</div><div class="ttdef"><b>Definition:</b> oomph_utilities.h:189</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/db2/namespaceMergeRestartFiles.html#a210231ed06d822ca8be83bd7f75aa572">MergeRestartFiles::filename</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_nblock_types()</a>, <a class="el" href="../../da/dd4/tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>, <a class="el" href="../../d2/dc3/namespaceoomph_1_1Global__string__for__annotation.html#ac5379de2fa7fe44f2cb31785fc208135">oomph::Global_string_for_annotation::string()</a>, and <a class="el" href="../../d0/d49/namespaceoomph_1_1StringConversion.html#a9d30fabdc1a0694bdb91dddd2833bbd6">oomph::StringConversion::to_string()</a>.</p>

</div>
</div>
<a id="aa760ae71a5aae488547ccf721d412b1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa760ae71a5aae488547ccf721d412b1e">&#9670;&nbsp;</a></span>post_block_matrix_assembly_partial_clear()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A helper method to reduce the memory requirements of block preconditioners. Once the methods get_block(...), get_blocks(...) and build_preconditioner_matrix(...) have been called in this and all subsidiary block preconditioners this method can be called to clean up. </p>
<div class="fragment"><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    {</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">is_master_block_preconditioner</a>())</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      {</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">Index_in_dof_block_dense</a>.clear();</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">Dof_number_dense</a>.clear();</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_MPI</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        Index_in_dof_block_sparse.clear();</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        Dof_number_sparse.clear();</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        Global_index_sparse.clear();</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        Index_in_dof_block_sparse.clear();</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        Dof_number_sparse.clear();</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">Dof_dimension</a>.clear();</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      }</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">Ndof_in_block</a>.clear();</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">Dof_number_to_block_number_lookup</a>.clear();</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">Block_number_to_dof_number_lookup</a>.clear();</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    } <span class="comment">// EOFunc post_block_matrix_assembly_partial_clear()</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a61561c20a262195f1bdacda515a2394b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_number_to_dof_number_lookup</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a55900a517c9e354b9fc49624483b7273">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_dimension</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a37b22a0a25030a4b08f2eaec261ae22b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_number_dense</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae2f496bfa8307485101a3b8ac57e8c71">oomph::BlockPreconditioner&lt; MATRIX &gt;::Dof_number_to_block_number_lookup</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0ad82070ce2f6cdfa9ea6c7226ea28af">oomph::BlockPreconditioner&lt; MATRIX &gt;::Index_in_dof_block_dense</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a874cbe5520d546ee24004e229a48037e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Ndof_in_block</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>.</p>

</div>
</div>
<a id="a74eeff188f842dd8abdff1b7d9801d44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74eeff188f842dd8abdff1b7d9801d44">&#9670;&nbsp;</a></span>preconditioner_matrix_distribution_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::preconditioner_matrix_distribution_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Access function to the preconditioner matrix distribution pointer. This is the concatenation of the block distributions with the identity ordering. I.e. if this preconditioner has three block types, with the three associated block distributions dist_b0, dist_b1 and dist_b2, then this distribution is: LinearAlgebraDistributionHelpers::concatenate(dist_b0, dist_b1, dist_b2). </p>
<div class="fragment"><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    {</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">Preconditioner_matrix_distribution_pt</a>;</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad647cfa61939e3c118dcc2595a7f9240">oomph::BlockPreconditioner&lt; MATRIX &gt;::Preconditioner_matrix_distribution_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>.</p>

</div>
</div>
<a id="a571824cedc7e458a612111b51f20e5fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a571824cedc7e458a612111b51f20e5fb">&#9670;&nbsp;</a></span>replacement_dof_block_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/d3a/classoomph_1_1MapMatrix.html">MapMatrix</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a>*&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::replacement_dof_block_pt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Access function to the replaced dof-level blocks. </p>
<div class="fragment"><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    {</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a>;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    } <span class="comment">// EOFunc replacement_block_pt()</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">oomph::BlockPreconditioner&lt; MATRIX &gt;::Replacement_dof_block_pt</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a0ae880f098d5b1e9df78fc74c31dbf">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_replacement_dof_block()</a>.</p>

</div>
</div>
<a id="a98e920e003f085b02dbb30510fb23a0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98e920e003f085b02dbb30510fb23a0f">&#9670;&nbsp;</a></span>return_block_ordered_preconditioner_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::return_block_ordered_preconditioner_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the block ordered vector, w, and reorders it in natural order. Reordered vector is returned in v. Note: If the preconditioner is a subsidiary preconditioner then only the components of the vector associated with the blocks of the subsidiary preconditioner will be included. Hence the length of v is master_nrow() whereas that of the vector w is of length this-&gt;nrow().</p>
<p>This is the return function for the function get_block_ordered_preconditioner_vector(...).</p>
<p>It calls the function return_concatenated_block_vector(...) with the identity block number ordering. </p>
<div class="fragment"><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;  {</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;    {</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;    }</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt() != *this-&gt;master_distribution_pt())</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;    {</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;    }</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.built())</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;    {</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w must be setup.&quot;</span>;</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;    }</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.distribution_pt() != *this-&gt;preconditioner_matrix_distribution_pt())</div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;    {</div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w must match the &quot;</span></div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;concatenations of distributions in &quot;</span></div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Block_distribution_pt.\n&quot;</span>;</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;        error_message.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;    }</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160; </div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;    <span class="comment">// Split into the block vectors.</span></div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblocks = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;    Vector&lt;unsigned&gt; block_vec_number(nblocks, 0);</div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblocks; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;    {</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;      block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>;</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;    }</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160; </div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6d5106c0b9dca23aa1cc7f7fd8e696cb">return_concatenated_block_vector</a>(block_vec_number, <a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>);</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;  } <span class="comment">// function return_block_ordered_preconditioner_vector</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a6d5106c0b9dca23aa1cc7f7fd8e696cb"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a6d5106c0b9dca23aa1cc7f7fd8e696cb">oomph::BlockPreconditioner::return_concatenated_block_vector</a></div><div class="ttdeci">void return_concatenated_block_vector(const Vector&lt; unsigned &gt; &amp;block_vec_number, const DoubleVector &amp;b, DoubleVector &amp;v) const</div><div class="ttdoc">Takes concatenated block ordered vector, b, and copies its.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:2774</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>, and <a class="el" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.</p>

</div>
</div>
<a id="a1dd4d3cd6b64fa64e1ff6730b0deecc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dd4d3cd6b64fa64e1ff6730b0deecc7">&#9670;&nbsp;</a></span>return_block_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::return_block_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the n-th block ordered vector, b, and copies its entries to the appropriate entries in the naturally ordered vector, v. Here n is the block number in the current block preconditioner. If the preconditioner is a subsidiary block preconditioner the other entries in v that are not associated with it are left alone. </p>
<div class="fragment"><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;  {</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;    <span class="comment">// the number of blocks</span></div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_n_blocks = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160; </div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;    <span class="comment">// paranoid check that block i is in this block preconditioner</span></div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a> &gt;= para_n_blocks)</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;    {</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;Requested block vector &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, however this preconditioner has &quot;</span> &lt;&lt; para_n_blocks</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span>;</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;    }</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;    {</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;    }</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt() != *this-&gt;master_distribution_pt())</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;    {</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;    }</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>.built())</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;    {</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector b must be setup.&quot;</span>;</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;    }</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160; </div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160; </div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;    <span class="comment">// Get the most fine grain dof</span></div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;    Vector&lt;unsigned&gt; most_fine_grain_dof = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>];</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160; </div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;    <span class="comment">// How many dofs are in this block?</span></div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dof_vec = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>].size();</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160; </div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;    <span class="keywordflow">if</span> (n_dof_vec == 1)</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;    <span class="comment">// There is only one dof, no need to split.</span></div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;    {</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a04e260cc4160a952db2d410109fb2684">internal_return_block_vector</a>(most_fine_grain_dof[0], <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>);</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;    }</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;    <span class="comment">// Need to split the vector up before we insert them all in one go.</span></div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;    {</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;      Vector&lt;DoubleVector&gt; dof_vector(n_dof_vec);</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; n_dof_vec; d++)</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;      {</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;        dof_vector[d].build(</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">internal_block_distribution_pt</a>(most_fine_grain_dof[d]));</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      }</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160; </div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;      <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">DoubleVectorHelpers::split_without_communication</a>(<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, dof_vector);</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160; </div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      <span class="comment">// return to v</span></div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2ca7f125e50493073d116ba8da271af5">internal_return_block_vectors</a>(most_fine_grain_dof, dof_vector, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>);</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;    }</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;  } <span class="comment">// return_block_vector(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a04e260cc4160a952db2d410109fb2684"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a04e260cc4160a952db2d410109fb2684">oomph::BlockPreconditioner::internal_return_block_vector</a></div><div class="ttdeci">void internal_return_block_vector(const unsigned &amp;n, const DoubleVector &amp;b, DoubleVector &amp;v) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:4293</div></div>
<div class="ttc" id="anamespaceoomph_1_1DoubleVectorHelpers_html_aa87594da930b3eed12a27838972f10f8"><div class="ttname"><a href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">oomph::DoubleVectorHelpers::split_without_communication</a></div><div class="ttdeci">void split_without_communication(const DoubleVector &amp;in_vector, Vector&lt; DoubleVector * &gt; &amp;out_vector_pt)</div><div class="ttdef"><b>Definition:</b> double_vector.cc:2075</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">oomph::DoubleVectorHelpers::split_without_communication()</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="a628f3ab6c3c41ccb449da642fb7e1feb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a628f3ab6c3c41ccb449da642fb7e1feb">&#9670;&nbsp;</a></span>return_block_vectors() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::return_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the vector of block vectors, s, and copies its entries into the naturally ordered vector, v. If this is a subsidiary block preconditioner only those entries in v that are associated with its blocks are affected. The block_vec_number indicates which block the vectors in s came from. The block number corresponds to the block numbers in this preconditioner. This is simply a wrapper around the other return_block_vectors(...) function where the block_vec_number Vector is the identity, i.e. block_vec_number is [0, 1, ..., nblock_types - 1]. </p>
<div class="fragment"><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;  {</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;    <span class="comment">// The number of block types in this preconditioner.</span></div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_block = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160; </div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;    <span class="comment">// Create the identity vector.</span></div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;    Vector&lt;unsigned&gt; required_block(n_block, 0);</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n_block; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;    {</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;      required_block[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    }</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160; </div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;    <span class="comment">// Call the other return_block_vectors function which does the work.</span></div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a71d48d8a70151ef0febd4537a2214c53">return_block_vectors</a>(required_block, <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>);</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;  } <span class="comment">// return_block_vectors(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a71d48d8a70151ef0febd4537a2214c53"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a71d48d8a70151ef0febd4537a2214c53">oomph::BlockPreconditioner::return_block_vectors</a></div><div class="ttdeci">void return_block_vectors(const Vector&lt; unsigned &gt; &amp;block_vec_number, const Vector&lt; DoubleVector &gt; &amp;s, DoubleVector &amp;v) const</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:3443</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="a71d48d8a70151ef0febd4537a2214c53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71d48d8a70151ef0febd4537a2214c53">&#9670;&nbsp;</a></span>return_block_vectors() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::return_block_vectors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_vec_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Takes the vector of block vectors, s, and copies its entries into the naturally ordered vector, v. If this is a subsidiary block preconditioner only those entries in v that are associated with its blocks are affected. The block_vec_number indicates which block the vectors in s came from. The block number corresponds to the block numbers in this preconditioner. </p>
<div class="fragment"><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;  {</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160; </div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;    <span class="comment">// Check if v is built.</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;    {</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    }</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160; </div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;    <span class="comment">// v must have the same distribution as the upper-most master block</span></div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    <span class="comment">// preconditioner, since the upper-most master block preconditioner</span></div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="comment">// should have the same distribution as the matrix pointed to</span></div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <span class="comment">// by matrix_pt().</span></div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    {</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    }</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160; </div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    <span class="comment">// Check if the number of vectors in s is the same as the number of block</span></div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;    <span class="comment">// numbers described in block_vec_number.</span></div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_block_vec_number_size = block_vec_number.size();</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_s_size = <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>.size();</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;    <span class="keywordflow">if</span> (para_block_vec_number_size != para_s_size)</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    {</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;block_vec_number.size() is &quot;</span> &lt;&lt; para_block_vec_number_size</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\n.&quot;</span></div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;s.size() is &quot;</span> &lt;&lt; para_s_size &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;But they must be the same size!\n&quot;</span>;</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;    }</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160; </div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    <span class="comment">// Check to see if there are more blocks defined in the block_vec_number</span></div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;    <span class="comment">// vector than the number of block types. This is not allowed.</span></div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_n_block = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;    <span class="keywordflow">if</span> (para_block_vec_number_size &gt; para_n_block)</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;    {</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;Trying to return &quot;</span> &lt;&lt; para_block_vec_number_size</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; block vectors.\n&quot;</span></div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_n_block &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span>;</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;    }</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160; </div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;    <span class="comment">// Check if any block numbers defined in block_vec_number is equal to or</span></div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    <span class="comment">// greater than the number of block types.</span></div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    <span class="comment">// E.g. if there are 5 block types, we can only have block numbers:</span></div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;    <span class="comment">//  0, 1, 2, 3 and 4.</span></div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    {</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;      <span class="keywordflow">if</span> (para_required_block &gt; para_n_block)</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;      {</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;block_vec_number[&quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot;] is &quot;</span> &lt;&lt; para_required_block</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_n_block &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span>;</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;      }</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;    }</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160; </div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    <span class="comment">// Check that no block number is inserted twice.</span></div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    std::set&lt;unsigned&gt; para_set;</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    {</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;      std::pair&lt;std::set&lt;unsigned&gt;::iterator, <span class="keywordtype">bool</span>&gt; para_set_ret;</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;      para_set_ret = para_set.insert(block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]);</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160; </div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;      <span class="keywordflow">if</span> (!para_set_ret.second)</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;      {</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Error: the block number &quot;</span> &lt;&lt; block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; appears twice.\n&quot;</span>;</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      }</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    }</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160; </div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    <span class="comment">// Check to see that all the vectors in s are built</span></div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;    <span class="comment">// (since we are trying to return them).</span></div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    {</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].built())</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;      {</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector s[&quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a></div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;] must be setup.\n&quot;</span>;</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;      }</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    }</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160; </div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    <span class="comment">// Since these are built, we check that the distributions are correct.</span></div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    <span class="comment">// This are incorrect if the block numbers in block_vec_number and</span></div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;    <span class="comment">// the vectors in s does not match.</span></div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    {</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      <span class="keywordflow">if</span> (*(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>].<a class="code" href="../../df/d1e/classoomph_1_1DistributableLinearAlgebraObject.html#a603105384d60c9a3710378af39f538b9">distribution_pt</a>()) !=</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;          *(<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]]))</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      {</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;        std::ostringstream error_message;</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;        error_message</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector &quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot; must match the&quot;</span></div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; specified distribution at &quot;</span></div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Block_distribution_pt[&quot;</span> &lt;&lt; block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] &lt;&lt; <span class="stringliteral">&quot;].\n&quot;</span></div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;The distribution of the Block_distribution_pt is determined by\n&quot;</span></div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;the vector block_vec_number. Perhaps it is incorrect?\n&quot;</span>;</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>,</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;                            <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      }</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    }</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160; </div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    <span class="comment">// Number of blocks to get.</span></div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_block = block_vec_number.size();</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160; </div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;    <span class="comment">// Each block is made of dof types. We get the most fine grain dof types.</span></div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;    <span class="comment">// Most fine grain in the sense that these are the dof types that belongs</span></div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    <span class="comment">// in this block before any coarsening of dof types has taken place.</span></div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;    <span class="comment">// The ordering of the dof types matters, this is handled properly when</span></div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;    <span class="comment">// creating the Block_to_dof_map_fine vector and must be respected here.</span></div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;    <span class="comment">// I.e. we cannot arbitrarily insert dof types (even if they are correct)</span></div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;    <span class="comment">// in the vector most_fine_grain_dof.</span></div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    Vector&lt;unsigned&gt; most_fine_grain_dof;</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; n_block; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;    {</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_b = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160; </div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;      most_fine_grain_dof.insert(most_fine_grain_dof.end(),</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].begin(),</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].end());</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    }</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160; </div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;    <span class="comment">// Split all the blocks into it&#39;s most fine grain dof vector.</span></div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;    Vector&lt;DoubleVector&gt; dof_vector(most_fine_grain_dof.size());</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160; </div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;    <span class="keywordtype">unsigned</span> offset = 0;</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160; </div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;    <span class="comment">// Perform the splitting for each block.</span></div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; n_block; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;    {</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      <span class="comment">// The actual block number.</span></div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_b = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160; </div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;      <span class="comment">// How many most fine grain dof types are associated with this block?</span></div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndof = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].size();</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160; </div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;      <span class="keywordflow">if</span> (ndof == 1)</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;      <span class="comment">// No need to split, just copy.</span></div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;      {</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;        dof_vector[offset] = <a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;      }</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;      <span class="comment">// Need to split s[b] into it&#39;s most fine grain dof vectors</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;      {</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;        <span class="comment">// To store pointers to the dof vectors associated with this block.</span></div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        Vector&lt;DoubleVector*&gt; tmp_dof_vector_pt(ndof, 0);</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160; </div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; ndof; d++)</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;        {</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> offset_plus_d = offset + d;</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160; </div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;          <span class="comment">// build the dof vector.</span></div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;          dof_vector[offset_plus_d].build(</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;            <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a38de6514d7065086335e0e6f60dc77a9">Internal_block_distribution_pt</a>[most_fine_grain_dof[offset_plus_d]]);</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160; </div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;          <span class="comment">// Store the pointer.</span></div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;          tmp_dof_vector_pt[d] = &amp;dof_vector[offset_plus_d];</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;        }</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160; </div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;        <span class="comment">// Split without communication.</span></div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;        <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">DoubleVectorHelpers::split_without_communication</a>(<a class="code" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>],</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                                                         tmp_dof_vector_pt);</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;      }</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160; </div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;      <span class="comment">// Update the offset!</span></div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;      offset += ndof;</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    }</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160; </div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;    <span class="comment">// Return the block vectors all in one go.</span></div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2ca7f125e50493073d116ba8da271af5">internal_return_block_vectors</a>(most_fine_grain_dof, dof_vector, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>);</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;  } <span class="comment">// return_block_vectors(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../d2/d2e/level1__cplx__impl_8h.html#a462761ca92ad97a9a705cb875828b0b8">s</a>, <a class="el" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">oomph::DoubleVectorHelpers::split_without_communication()</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a7c1c50d1a0a7bdd8a3c5dc9bb777e9b3">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::update()</a>.</p>

</div>
</div>
<a id="a6d5106c0b9dca23aa1cc7f7fd8e696cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d5106c0b9dca23aa1cc7f7fd8e696cb">&#9670;&nbsp;</a></span>return_concatenated_block_vector()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::return_concatenated_block_vector </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_vec_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5b/classoomph_1_1DoubleVector.html">DoubleVector</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Takes concatenated block ordered vector, b, and copies its. </p>
<p>Takes concatenated block ordered vector, b, and copies its entries to the appropriate entries in the naturally ordered vector, v. Here the values in block_vec_number indicates which blocks the vector b is a concatenation of. The block number are those in the current preconditioner. If the preconditioner is a subsidiary block preconditioner the other entries in v that are not associated with it are left alone. </p>
<div class="fragment"><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  {</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160; </div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    <span class="comment">// Check if v is built.</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.built())</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    {</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must be setup.&quot;</span>;</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    }</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160; </div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    <span class="comment">// v must have the same distribution as the upper-most master block</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="comment">// preconditioner, since the upper-most master block preconditioner</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    <span class="comment">// should have the same distribution as the matrix pointed to</span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <span class="comment">// by matrix_pt().</span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="keywordflow">if</span> (*(<a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.distribution_pt()) != *(this-&gt;master_distribution_pt()))</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    {</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the global vector v must match the &quot;</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; specified master_distribution_pt(). \n&quot;</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;i.e. Distribution_pt in the master preconditioner&quot;</span>;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    }</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160; </div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="comment">// Check to see if there are more blocks defined in the block_vec_number</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="comment">// vector than the number of block types. This is not allowed.</span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_block_vec_number_size = block_vec_number.size();</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_n_block = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>();</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    <span class="keywordflow">if</span> (para_block_vec_number_size &gt; para_n_block)</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    {</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;Trying to return &quot;</span> &lt;&lt; para_block_vec_number_size</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; block vectors.\n&quot;</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_n_block &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span>;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    }</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160; </div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    <span class="comment">// Check if any block numbers defined in block_vec_number is equal to or</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    <span class="comment">// greater than the number of block types.</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    <span class="comment">// E.g. if there are 5 block types, we can only have block numbers:</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="comment">//  0, 1, 2, 3 and 4.</span></div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    {</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_required_block = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;      <span class="keywordflow">if</span> (para_required_block &gt; para_n_block)</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;      {</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;block_vec_number[&quot;</span> &lt;&lt; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt;&lt; <span class="stringliteral">&quot;] is &quot;</span> &lt;&lt; para_required_block</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;But there are only &quot;</span> &lt;&lt; para_n_block &lt;&lt; <span class="stringliteral">&quot; block types.\n&quot;</span>;</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      }</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    }</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160; </div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <span class="comment">// Check that no block number is inserted twice.</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    std::set&lt;unsigned&gt; para_set;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    {</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;      std::pair&lt;std::set&lt;unsigned&gt;::iterator, <span class="keywordtype">bool</span>&gt; para_set_ret;</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;      para_set_ret = para_set.insert(block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]);</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160; </div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;      <span class="keywordflow">if</span> (!para_set_ret.second)</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;      {</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Error: the block number &quot;</span> &lt;&lt; block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; appears twice.\n&quot;</span>;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;      }</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    }</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160; </div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    <span class="comment">// Check that w is built.</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.built())</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    {</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w must be setup.&quot;</span>;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;    }</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160; </div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;    <span class="comment">// Check that the distributions defined by block_vec_number is correct for</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    <span class="comment">// the distribution from w.</span></div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="comment">// Recall that w is the concatenation of the block vectors defined by</span></div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="comment">// the values in block_vec_number. We check that this is the case.</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    Vector&lt;LinearAlgebraDistribution*&gt; para_vec_dist_pt(</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;      para_block_vec_number_size, 0);</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160; </div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; para_block_vec_number_size; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    {</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      para_vec_dist_pt[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]];</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    }</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160; </div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    LinearAlgebraDistribution para_tmp_dist;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160; </div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(para_vec_dist_pt,</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;                                                  para_tmp_dist);</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160; </div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>.distribution_pt() != para_tmp_dist)</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    {</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;      std::ostringstream err_msg;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the block vector w does not match \n&quot;</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;the concatenation of the block distributions defined in \n&quot;</span></div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;block_vec_number.\n&quot;</span>;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    }</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160; </div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="comment">// Number of blocks to return.</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_block = block_vec_number.size();</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160; </div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    <span class="comment">// Each block is made of dof types. We get the most fine grain dof types.</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="comment">// Most fine grain in the sense that these are the dof types that belongs</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    <span class="comment">// in this block before any coarsening of dof types has taken place.</span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    <span class="comment">// The ordering of the dof types matters, this is handled properly when</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <span class="comment">// creating the Block_to_dof_map_fine vector and must be respected here.</span></div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="comment">// I.e. we cannot arbitrarily insert dof types (even if they are correct)</span></div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    <span class="comment">// in the vector most_fine_grain_dof.</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    Vector&lt;unsigned&gt; most_fine_grain_dof;</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; n_block; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    {</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> mapped_b = block_vec_number[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>];</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      most_fine_grain_dof.insert(most_fine_grain_dof.end(),</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].begin(),</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                                 <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a278946969944848b12bdc2ceaed91a07">Block_to_dof_map_fine</a>[mapped_b].end());</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    }</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160; </div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <span class="comment">// The number of most fine grain dof types associated with the blocks</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;    <span class="comment">// defined by block_vec_number.</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ndof = most_fine_grain_dof.size();</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160; </div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    <span class="comment">// Build each dof level vector with the correct distribution.</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    Vector&lt;DoubleVector&gt; dof_vector(ndof);</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; ndof; d++)</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    {</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      dof_vector[d].build(</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">internal_block_distribution_pt</a>(most_fine_grain_dof[d]));</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    }</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160; </div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    <span class="comment">// Perform the splitting of w into the most fine grain dof level vectors.</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <a class="code" href="../../da/d09/namespaceoomph_1_1DoubleVectorHelpers.html#aa87594da930b3eed12a27838972f10f8">DoubleVectorHelpers::split_without_communication</a>(<a class="code" href="../../d5/df8/Matrix__resize__int_8cpp.html#aab236ce080522c9832217fd5f157541b">w</a>, dof_vector);</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160; </div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    <span class="comment">// Return all the dof level vectors in one go.</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2ca7f125e50493073d116ba8da271af5">internal_return_block_vectors</a>(most_fine_grain_dof, dof_vector, <a class="code" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>);</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;  } <span class="comment">// return_concatenated_block_vector(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, and <a class="el" href="../../dc/d69/Array__initializer__list__vector__cxx11_8cpp.html#a32398b762ddd48fa3a6d504de68009f9">v</a>.</p>

</div>
</div>
<a id="ab36e905f7da268328709d62951d64ace"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab36e905f7da268328709d62951d64ace">&#9670;&nbsp;</a></span>set_block_output_to_files()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::set_block_output_to_files </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>basefilename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set the base part of the filename to output blocks to. If it is set then all blocks will be output at the end of block_setup. If it is left empty nothing will be output. </p>
<div class="fragment"><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    {</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">Output_base_filename</a> = basefilename;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    } <span class="comment">// EOFunc set_block_output_to_files(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a915ff2775ccef6ac3dadf072566da9e7">oomph::BlockPreconditioner&lt; MATRIX &gt;::Output_base_filename</a>.</p>

</div>
</div>
<a id="a748e2ad8836bc8edf5b9a42373a7ad61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a748e2ad8836bc8edf5b9a42373a7ad61">&#9670;&nbsp;</a></span>set_master_matrix_pt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::set_master_matrix_pt </td>
          <td>(</td>
          <td class="paramtype">MATRIX *&#160;</td>
          <td class="paramname"><em>in_matrix_pt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the matrix_pt in the upper-most master preconditioner. </p>
<div class="fragment"><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;set_master_matrix_pt(in_matrix_pt);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        this-&gt;<a class="code" href="../../db/d9e/classoomph_1_1Preconditioner.html#af459b7333c4c64435fd8fa933535901f">set_matrix_pt</a>(in_matrix_pt);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div>
<div class="ttc" id="aclassoomph_1_1Preconditioner_html_af459b7333c4c64435fd8fa933535901f"><div class="ttname"><a href="../../db/d9e/classoomph_1_1Preconditioner.html#af459b7333c4c64435fd8fa933535901f">oomph::Preconditioner::set_matrix_pt</a></div><div class="ttdeci">virtual void set_matrix_pt(DoubleMatrixBase *matrix_pt)</div><div class="ttdoc">Set the matrix pointer.</div><div class="ttdef"><b>Definition:</b> preconditioner.h:165</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_block_preconditioner_pt()</a>, and <a class="el" href="../../db/d9e/classoomph_1_1Preconditioner.html#af459b7333c4c64435fd8fa933535901f">oomph::Preconditioner::set_matrix_pt()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9dae351352d344321ea82999d7003e17">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block_other_matrix()</a>.</p>

</div>
</div>
<a id="af97821621b570d409e6662939e5f818d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af97821621b570d409e6662939e5f818d">&#9670;&nbsp;</a></span>set_mesh()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::set_mesh </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a> *const&#160;</td>
          <td class="paramname"><em>mesh_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d9/db9/classbool.html">bool</a> &amp;&#160;</td>
          <td class="paramname"><em>allow_multiple_element_type_in_mesh</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set the i-th mesh for this block preconditioner. Note: The method set_nmesh(...) must be called before this method to specify the number of meshes. By default, it is assumed that each mesh only contains elements of the same type. This condition may be relaxed by setting the boolean allow_multiple_element_type_in_mesh to true, however, each mesh must only contain elements with the same number of dof types. </p>
<div class="fragment"><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    {</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      <span class="comment">// paranoid check that mesh i can be set</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>())</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;      {</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;The mesh pointer has space for &quot;</span> &lt;&lt; <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">nmesh</a>() &lt;&lt; <span class="stringliteral">&quot; meshes.\n&quot;</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Cannot store a mesh at entry &quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Has set_nmesh(...) been called?&quot;</span>;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;      }</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160; </div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      <span class="comment">// Check that the mesh pointer is not null.</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a> == 0)</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;      {</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Tried to set the &quot;</span> &lt;&lt; <a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;-th mesh pointer, but it is null.&quot;</span>;</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      }</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160; </div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      <span class="comment">// store the mesh pt and n dof types</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">mesh_pt</a>;</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160; </div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      <span class="comment">// Does this mesh contain multiple element types?</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2f3a3ac8c192a83facd5b560f017413e">Allow_multiple_element_type_in_mesh</a>[<a class="code" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] =</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        <a class="code" href="../../d0/d1d/classunsigned.html">unsigned</a>(allow_multiple_element_type_in_mesh);</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    } <span class="comment">// EOFunc set_mesh(...)</span></div>
<div class="ttc" id="aclassunsigned_html"><div class="ttname"><a href="../../d0/d1d/classunsigned.html">unsigned</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2f3a3ac8c192a83facd5b560f017413e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Allow_multiple_element_type_in_mesh</a>, <a class="el" href="../../d5/de3/BiCGSTAB__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">oomph::BlockPreconditioner&lt; MATRIX &gt;::mesh_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">oomph::BlockPreconditioner&lt; MATRIX &gt;::Mesh_pt</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">oomph::BlockPreconditioner&lt; MATRIX &gt;::nmesh()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, and <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d31/classoomph_1_1GeneralPurposeBlockPreconditioner.html#a99a80a26b189ecabeb3e7dfad9c45f0c">oomph::GeneralPurposeBlockPreconditioner&lt; MATRIX &gt;::gp_preconditioner_set_all_meshes()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a5806236b991ac2d7fe4bc7a4f19e98fb">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::solve()</a>, and <a class="el" href="../../df/df9/classoomph_1_1HelmholtzFGMRESMG.html#a36a1d601676df2ebe39fcdb7a0837864">oomph::HelmholtzFGMRESMG&lt; MATRIX &gt;::solve()</a>.</p>

</div>
</div>
<a id="ae055f998f6145656352aacac22e545ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae055f998f6145656352aacac22e545ad">&#9670;&nbsp;</a></span>set_nmesh()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::set_nmesh </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Specify the number of meshes required by this block preconditioner. Note: elements in different meshes correspond to different types of DOF. </p>
<div class="fragment"><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    {</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">Mesh_pt</a>.resize(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, 0);</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2f3a3ac8c192a83facd5b560f017413e">Allow_multiple_element_type_in_mesh</a>.resize(<a class="code" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>, 0);</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    } <span class="comment">// EOFunc set_nmesh(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2f3a3ac8c192a83facd5b560f017413e">oomph::BlockPreconditioner&lt; MATRIX &gt;::Allow_multiple_element_type_in_mesh</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a89adb506e8f9103c80b4b36cc309f536">oomph::BlockPreconditioner&lt; MATRIX &gt;::Mesh_pt</a>, and <a class="el" href="../../d8/d88/CG3DPackingUnitTest_8cpp.html#a7026fd16370249ce97cb3d062326baf9">n</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d31/classoomph_1_1GeneralPurposeBlockPreconditioner.html#a99a80a26b189ecabeb3e7dfad9c45f0c">oomph::GeneralPurposeBlockPreconditioner&lt; MATRIX &gt;::gp_preconditioner_set_all_meshes()</a>, <a class="el" href="../../d3/d3a/classoomph_1_1SimpleFSIPreconditioner.html#a597c5d3292b1e5e9001f8a738f186a73">oomph::SimpleFSIPreconditioner&lt; MATRIX &gt;::SimpleFSIPreconditioner()</a>, <a class="el" href="../../d7/d86/classoomph_1_1HelmholtzGMRESMG.html#a5806236b991ac2d7fe4bc7a4f19e98fb">oomph::HelmholtzGMRESMG&lt; MATRIX &gt;::solve()</a>, and <a class="el" href="../../df/df9/classoomph_1_1HelmholtzFGMRESMG.html#a36a1d601676df2ebe39fcdb7a0837864">oomph::HelmholtzFGMRESMG&lt; MATRIX &gt;::solve()</a>.</p>

</div>
</div>
<a id="a8a0ae880f098d5b1e9df78fc74c31dbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a0ae880f098d5b1e9df78fc74c31dbf">&#9670;&nbsp;</a></span>set_replacement_dof_block()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::set_replacement_dof_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> *&#160;</td>
          <td class="paramname"><em>replacement_dof_block_pt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set replacement dof-level blocks. Only dof-level blocks can be set. This is important due to how the dof type coarsening feature operates.</p>
<p>IMPORTANT: The block indices (block_i, block_j) is the dof-level ordering, NOT the block-ordering. The block-ordering is determined by the parameters given to block_setup(...). The DOF-ordering is determined by the two-level ordering scheme of first the elements, then the meshes. </p>
<div class="fragment"><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    {</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;      <span class="comment">// Check if block_setup(...) has been called.</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">nblock_types</a>() == 0)</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      {</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;nblock_types() is 0, has block_setup(...) been called?\n&quot;</span>;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;      }</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160; </div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160; </div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;      <span class="comment">// Range checking for replacement dof block.</span></div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;      <span class="keywordtype">unsigned</span> para_ndof_types = this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">ndof_types</a>();</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160; </div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;      <span class="keywordflow">if</span> ((block_i &gt;= para_ndof_types) || (block_j &gt;= para_ndof_types))</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;      {</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Replacement dof block (&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; block_j</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;) is outside of range:\n&quot;</span></div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                &lt;&lt; para_ndof_types;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      }</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160; </div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160; </div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;      <span class="comment">//    // Check that the most fine grain mapping has been used in</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      <span class="comment">//    block_setup(...)</span></div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      <span class="comment">//    // i.e. nblock_types() == ndof_types()</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <span class="comment">//    if(ndof_types() != nblock_types())</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      <span class="comment">//    {</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      <span class="comment">//      std::ostringstream err_msg;</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      <span class="comment">//      err_msg &lt;&lt; &quot;ndof_types() != nblock_types()\n&quot;</span></div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;      <span class="comment">//              &lt;&lt; &quot;Only the dof-level blocks can be replaced.\n&quot;</span></div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      <span class="comment">//              &lt;&lt; &quot;Please re-think your blocking scheme.\n&quot;;</span></div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      <span class="comment">//      throw OomphLibError(err_msg.str(),</span></div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;      <span class="comment">//          OOMPH_CURRENT_FUNCTION,</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;      <span class="comment">//          OOMPH_EXCEPTION_LOCATION);</span></div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      <span class="comment">//    }</span></div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160; </div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      <span class="comment">// Check that the replacement block pt is not null</span></div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">replacement_dof_block_pt</a> == 0)</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;      {</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Replacing block(&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; but the pointer is NULL.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      }</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160; </div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      <span class="comment">// Check that the replacement block has been built</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">replacement_dof_block_pt</a>-&gt;built())</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      {</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Replacement block(&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; block_i &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; is not built.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      }</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160; </div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      <span class="comment">// Check if the distribution matches. Determine which natural ordering dof</span></div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      <span class="comment">// this should go to. I.e. we convert from dof-block index to dof index.</span></div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <span class="comment">// Luckily, this is stored in Block_to_dof_map_coarse.</span></div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      <span class="comment">//    const unsigned para_dof_block_i =</span></div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <span class="comment">//    Block_to_dof_map_coarse[block_i][0];</span></div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_dof_block_i = block_i;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160; </div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      <span class="keywordflow">if</span> (*<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">dof_block_distribution_pt</a>(para_dof_block_i) !=</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;          *<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">replacement_dof_block_pt</a>-&gt;distribution_pt())</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      {</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;The distribution of the replacement dof_block_pt\n&quot;</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;is different from the Dof_block_distribution_pt[&quot;</span></div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;                &lt;&lt; para_dof_block_i &lt;&lt; <span class="stringliteral">&quot;].\n&quot;</span>;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      }</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160; </div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      <span class="comment">// Now that we know the distribution of the replacement block is</span></div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <span class="comment">// correct, we check the number of columns.</span></div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> para_dof_block_j = block_j;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;      <span class="keywordtype">unsigned</span> para_replacement_block_ncol = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">replacement_dof_block_pt</a>-&gt;ncol();</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      <span class="keywordtype">unsigned</span> para_required_ncol =</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">dof_block_distribution_pt</a>(para_dof_block_j)-&gt;<a class="code" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#aafad0b69de2284808366b65bd63e493b">nrow</a>();</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      <span class="keywordflow">if</span> (para_replacement_block_ncol != para_required_ncol)</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      {</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        std::ostringstream err_msg;</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;        err_msg &lt;&lt; <span class="stringliteral">&quot;Replacement dof block has ncol = &quot;</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                &lt;&lt; para_replacement_block_ncol &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;But required ncol is &quot;</span> &lt;&lt; para_required_ncol &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;        <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;          err_msg.str(), <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="code" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>);</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;      }</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160; </div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      <span class="comment">// Block_to_dof_map_coarse[x][0] sense because we only can use this if</span></div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;      <span class="comment">// nblock_types() == ndof_types(), i.e. each sub-vector is of length 1.</span></div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      <span class="comment">// We use this indirection so that the placement of the pointer is</span></div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;      <span class="comment">// consistent with internal_get_block(...).</span></div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <span class="comment">//    const unsigned dof_block_i = Block_to_dof_map_coarse[block_i][0];</span></div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      <span class="comment">//    const unsigned dof_block_j = Block_to_dof_map_coarse[block_j][0];</span></div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160; </div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      <span class="comment">//    Replacement_dof_block_pt(dof_block_i,dof_block_j)</span></div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="comment">//      = replacement_dof_block_pt;</span></div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160; </div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">Replacement_dof_block_pt</a>(block_i, block_j) = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">replacement_dof_block_pt</a>;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_a571824cedc7e458a612111b51f20e5fb"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">oomph::BlockPreconditioner::replacement_dof_block_pt</a></div><div class="ttdeci">MapMatrix&lt; unsigned, CRDoubleMatrix * &gt; replacement_dof_block_pt() const</div><div class="ttdoc">Access function to the replaced dof-level blocks.</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2381</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">oomph::BlockPreconditioner&lt; MATRIX &gt;::dof_block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html#aafad0b69de2284808366b65bd63e493b">oomph::LinearAlgebraDistribution::nrow()</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#aa260cc4af589e30cea7fde997ae16667">OOMPH_CURRENT_FUNCTION</a>, <a class="el" href="../../dd/d6f/oomph__definitions_8h.html#a25c6813cc7341d125e2502f8923fb6c4">OOMPH_EXCEPTION_LOCATION</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">oomph::BlockPreconditioner&lt; MATRIX &gt;::replacement_dof_block_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ad2cd49c5c823c4202046e97038f6e080">oomph::BlockPreconditioner&lt; MATRIX &gt;::Replacement_dof_block_pt</a>.</p>

</div>
</div>
<a id="a65059c036724814a0e490716fa6eaf0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65059c036724814a0e490716fa6eaf0a">&#9670;&nbsp;</a></span>setup_matrix_vector_product() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::setup_matrix_vector_product </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/dac/classoomph_1_1MatrixVectorProduct.html">MatrixVectorProduct</a> *&#160;</td>
          <td class="paramname"><em>matvec_prod_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> *&#160;</td>
          <td class="paramname"><em>block_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &amp;&#160;</td>
          <td class="paramname"><em>block_col_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Setup matrix vector product. This is simply a wrapper around the other setup_matrix_vector_product function. </p>
<div class="fragment"><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    {</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;      Vector&lt;unsigned&gt; col_index_vector(1, block_col_index);</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adbe1ae854ee9831649249d50162bb6a9">setup_matrix_vector_product</a>(matvec_prod_pt, block_pt, col_index_vector);</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    } <span class="comment">// EOFunc setup_matrix_vector_product(...)</span></div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_adbe1ae854ee9831649249d50162bb6a9"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adbe1ae854ee9831649249d50162bb6a9">oomph::BlockPreconditioner::setup_matrix_vector_product</a></div><div class="ttdeci">void setup_matrix_vector_product(MatrixVectorProduct *matvec_prod_pt, CRDoubleMatrix *block_pt, const Vector&lt; unsigned &gt; &amp;block_col_indices)</div><div class="ttdef"><b>Definition:</b> block_preconditioner.h:2397</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adbe1ae854ee9831649249d50162bb6a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::setup_matrix_vector_product()</a>.</p>

</div>
</div>
<a id="adbe1ae854ee9831649249d50162bb6a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbe1ae854ee9831649249d50162bb6a9">&#9670;&nbsp;</a></span>setup_matrix_vector_product() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::setup_matrix_vector_product </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/dac/classoomph_1_1MatrixVectorProduct.html">MatrixVectorProduct</a> *&#160;</td>
          <td class="paramname"><em>matvec_prod_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a> *&#160;</td>
          <td class="paramname"><em>block_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block_col_indices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Setup a matrix vector product. matvec_prod_pt is a pointer to the MatrixVectorProduct, block_pt is a pointer to the block matrix, block_col_indices is a vector indicating which block indices does the RHS vector we want to multiply the matrix by.</p>
<p>The distribution of the block column must be the same as the RHS vector being solved. By default, OOMPH-LIB's uniform row distribution is employed. When block matrices are concatenated without communication, the columns are permuted, as a result, the distribution of the columns may no longer be uniform. </p>
<div class="fragment"><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    {</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nblock = block_col_indices.size();</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160; </div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keywordflow">if</span> (nblock == 1)</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;      {</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> col_index = block_col_indices[0];</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        matvec_prod_pt-&gt;setup(block_pt, <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[col_index]);</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      }</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      {</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        std::map&lt;Vector&lt;unsigned&gt;, LinearAlgebraDistribution*&gt;::const_iterator</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;          iter;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160; </div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        iter = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.find(block_col_indices);</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        <span class="keywordflow">if</span> (iter != <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">Auxiliary_block_distribution_pt</a>.end())</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        {</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;          matvec_prod_pt-&gt;setup(block_pt, iter-&gt;second);</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        }</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        {</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;          Vector&lt;LinearAlgebraDistribution*&gt; tmp_vec_dist_pt(nblock, 0);</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> = 0; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a> &lt; nblock; <a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>++)</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;          {</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;            tmp_vec_dist_pt[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>] = <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">Block_distribution_pt</a>[block_col_indices[<a class="code" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>]];</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;          }</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160; </div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;          LinearAlgebraDistribution* tmp_dist_pt =</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;            <span class="keyword">new</span> LinearAlgebraDistribution;</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;          <a class="code" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">LinearAlgebraDistributionHelpers::concatenate</a>(tmp_vec_dist_pt,</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                                                        *tmp_dist_pt);</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;          <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">insert_auxiliary_block_distribution</a>(block_col_indices, tmp_dist_pt);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;          matvec_prod_pt-&gt;setup(block_pt, tmp_dist_pt);</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        }</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      }</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    } <span class="comment">// EOFunc setup_matrix_vector_product(...)</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab295a391e32dc00c4e56dfb0527ea354">oomph::BlockPreconditioner&lt; MATRIX &gt;::Auxiliary_block_distribution_pt</a>, <a class="el" href="../../db/ddc/benchVecAdd_8cpp.html#af9816f50f32fc22762a8289c3cc44f22">b</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a59e83eca59e3cdc41a93668539e138f1">oomph::BlockPreconditioner&lt; MATRIX &gt;::Block_distribution_pt</a>, <a class="el" href="../../d4/dd0/namespaceoomph_1_1LinearAlgebraDistributionHelpers.html#af11187289196182ce650da88cfe37fc2">oomph::LinearAlgebraDistributionHelpers::concatenate()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">oomph::BlockPreconditioner&lt; MATRIX &gt;::insert_auxiliary_block_distribution()</a>, and <a class="el" href="../../d1/dac/classoomph_1_1MatrixVectorProduct.html#aec74f9bdb65ee7ce86590e26a705f3e9">oomph::MatrixVectorProduct::setup()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a65059c036724814a0e490716fa6eaf0a">oomph::BlockPreconditioner&lt; MATRIX &gt;::setup_matrix_vector_product()</a>.</p>

</div>
</div>
<a id="ab8e2478caa8370dd12462f17e1cc8082"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8e2478caa8370dd12462f17e1cc8082">&#9670;&nbsp;</a></span>turn_into_subsidiary_block_preconditioner() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::turn_into_subsidiary_block_preconditioner </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; *&#160;</td>
          <td class="paramname"><em>master_block_prec_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>doftype_in_master_preconditioner_coarse</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function to turn this preconditioner into a subsidiary preconditioner that operates within a bigger "master block preconditioner (e.g. a Navier-Stokes 2x2 block preconditioner dealing with the fluid sub-blocks within a 3x3 FSI preconditioner. Once this is done the master block preconditioner deals with the block setup etc. The vector doftype_in_master_preconditioner_coarse must specify the dof number in the master preconditioner that corresponds to a dof number in this preconditioner. <b>1</b>. The length of the vector is used to determine the number of blocks in this preconditioner therefore it must be correctly sized. <b>2</b>. block_setup(...) should be called in the master preconditioner before this method is called. <b>3</b>. block_setup(...) should be called in the corresponding subsidiary preconditioner after this method is called.</p>
<p>This calls the other turn_into_subsidiary_block_preconditioner function with the identity mapping for doftype_coarsen_map_coarse vector.</p>
<p>Function to turn this preconditioner into a subsidiary preconditioner that operates within a bigger "master block preconditioner (e.g. a Navier-Stokes 2x2 block preconditioner dealing with the fluid sub-blocks within a 3x3 FSI preconditioner. Once this is done the master block preconditioner deals with the block setup etc. The vector block_map must specify the dof number in the master preconditioner that corresponds to a block number in this preconditioner. ??ds horribly misleading comment! The length of the vector is used to determine the number of blocks in this preconditioner therefore it must be correctly sized. This calls the other turn_into_subsidiary_block_preconditioner(...) function providing an empty doftype_to_doftype_map vector. </p>
<div class="fragment"><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  {</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="comment">// Create the identity dof_coarsen_map</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    Vector&lt;Vector&lt;unsigned&gt;&gt; doftype_coarsen_map_coarse;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="keywordtype">unsigned</span> doftype_in_master_preconditioner_coarse_size =</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      doftype_in_master_preconditioner_coarse.size();</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160; </div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> dof_i = 0;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;         dof_i &lt; doftype_in_master_preconditioner_coarse_size;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;         dof_i++)</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    {</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      <span class="comment">// Create a vector of size 1 and value i,</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <span class="comment">// then push it into the dof_coarsen_map vector.</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      Vector&lt;unsigned&gt; tmp_vec(1, dof_i);</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      doftype_coarsen_map_coarse.push_back(tmp_vec);</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    }</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160; </div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <span class="comment">// Call the other turn_into_subsidiary_block_preconditioner function.</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab8e2478caa8370dd12462f17e1cc8082">turn_into_subsidiary_block_preconditioner</a>(</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      master_block_prec_pt,</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      doftype_in_master_preconditioner_coarse,</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      doftype_coarsen_map_coarse);</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;  }</div>
<div class="ttc" id="aclassoomph_1_1BlockPreconditioner_html_ab8e2478caa8370dd12462f17e1cc8082"><div class="ttname"><a href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab8e2478caa8370dd12462f17e1cc8082">oomph::BlockPreconditioner::turn_into_subsidiary_block_preconditioner</a></div><div class="ttdeci">void turn_into_subsidiary_block_preconditioner(BlockPreconditioner&lt; MATRIX &gt; *master_block_prec_pt, const Vector&lt; unsigned &gt; &amp;doftype_in_master_preconditioner_coarse)</div><div class="ttdef"><b>Definition:</b> block_preconditioner.cc:2376</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="../../dc/d0b/classoomph_1_1CoarseTwoIntoOne.html#a75b0c4fde102a890b6940f28bd896ba3">oomph::CoarseTwoIntoOne&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../d1/d95/classoomph_1_1TwoPlusThreeUpperTriangularWithOneLevelSubsidiary.html#af18d75d60a1292c66467c3d4c3c2b458">oomph::TwoPlusThreeUpperTriangularWithOneLevelSubsidiary&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../df/ddb/classoomph_1_1TwoPlusOneUpperTriangularPreconditioner.html#acf2f10a520bbd439939b40c12e0ed265">oomph::TwoPlusOneUpperTriangularPreconditioner&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../df/d0e/classoomph_1_1TwoPlusThreeUpperTriangularWithTwoLevelSubsidiary.html#af199b494a7e1533ac7625f47b3ef7a93">oomph::TwoPlusThreeUpperTriangularWithTwoLevelSubsidiary&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../de/de8/classoomph_1_1TwoPlusThreeUpperTriangularWithReplace.html#a75cfdf16578beca8f41761f1ad3d68d0">oomph::TwoPlusThreeUpperTriangularWithReplace&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../d7/d0c/classoomph_1_1CoarseTwoPlusTwoPlusOne.html#af7a2532dbb3cd3687573d6e393c33a05">oomph::CoarseTwoPlusTwoPlusOne&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../dd/ded/classoomph_1_1OnePlusFourWithTwoCoarse.html#aa2f68ff935b8dd2762dc471156ebf846">oomph::OnePlusFourWithTwoCoarse&lt; MATRIX &gt;::setup()</a>, <a class="el" href="../../dd/d59/classoomph_1_1FSIPreconditioner.html#adadfe9f4332af610b00f1f45d1ad432e">oomph::FSIPreconditioner::setup()</a>, <a class="el" href="../../d1/dc5/classoomph_1_1PseudoElasticFSIPreconditioner.html#a460ad5eea59f4c07dfde8b11696fabb1">oomph::PseudoElasticFSIPreconditioner::setup()</a>, <a class="el" href="../../dc/d64/classoomph_1_1PseudoElasticPreconditioner.html#a69909eef3e1530ca7faf48c653ec7327">oomph::PseudoElasticPreconditioner::setup()</a>, <a class="el" href="../../d0/dc5/classoomph_1_1PseudoElasticPreconditionerOld.html#a25d542a5b98d70be1aa1dd6000402978">oomph::PseudoElasticPreconditionerOld::setup()</a>, <a class="el" href="../../d8/d77/classoomph_1_1LagrangeEnforcedFlowPreconditioner.html#aadcbdb5af92d7889c956098cb86dee87">oomph::LagrangeEnforcedFlowPreconditioner::setup()</a>, <a class="el" href="../../d7/da4/classoomph_1_1PressureBasedSolidLSCPreconditioner.html#aba594f38c2d36775115adbc90bcd0025">oomph::PressureBasedSolidLSCPreconditioner::setup()</a>, and <a class="el" href="../../de/d0d/classoomph_1_1GMRESBlockPreconditioner.html#ae517d83cf8eddba9f9e2ed709f503da2">oomph::GMRESBlockPreconditioner::setup()</a>.</p>

</div>
</div>
<a id="ac0d2887082cf856b680b4ae61b510d29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0d2887082cf856b680b4ae61b510d29">&#9670;&nbsp;</a></span>turn_into_subsidiary_block_preconditioner() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::turn_into_subsidiary_block_preconditioner </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt; MATRIX &gt; *&#160;</td>
          <td class="paramname"><em>master_block_prec_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>doftype_in_master_preconditioner_coarse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt; <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>doftype_coarsen_map_coarse</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function to turn this preconditioner into a subsidiary preconditioner that operates within a bigger "master block preconditioner (e.g. a Navier-Stokes 2x2 block preconditioner dealing with the fluid sub-blocks within a 3x3 FSI preconditioner. Once this is done the master block preconditioner deals with the block setup etc. The vector doftype_in_master_preconditioner_coarse must specify the dof number in the master preconditioner that corresponds to a dof number in this preconditioner. <b>1</b>. The length of the vector is used to determine the number of blocks in this preconditioner therefore it must be correctly sized. <b>2</b>. block_setup(...) should be called in the master preconditioner before this method is called. <b>3</b>. block_setup(...) should be called in the corresponding subsidiary preconditioner after this method is called.</p>
<p>The doftype_coarsen_map_coarse is a mapping of the dof numbers in the master preconditioner to the dof numbers REQUIRED by THIS preconditioner. This allows for coarsening of the dof types if the master preconditioner has a more fine grain dof type splitting.</p>
<p>For example, the Lagrangian preconditioner (in 3D with one constraint) has doftypes: 0 1 2 3 4 5 6 7 ub vb wb uc vc wc p Lc</p>
<p>We wish to use an existing Navier-Stokes preconditioner, for example, LSC, to solve the sub-system associated with the dof numbers 0, 1, 2, 3, 4, 5, 6. But the existing LSC preconditioner only works with four dof types (3 velocity dof types and 1 pressure dof types). We need to coarsen the number of dof types in the master preconditioner.</p>
<p>If the LSC preconditioner requires the dof ordering: u, v, w, p. Then the doftype_coarsen_map_coarse will be: [0 3] -&gt; u velocity dof type [1 4] -&gt; v velocity dof type [2 5] -&gt; w velocity dof type [6] -&gt; pressure dof type.</p>
<p>Function to turn this block preconditioner into a subsidiary block preconditioner that operates within a bigger master block preconditioner (e.g. a Navier-Stokes 2x2 block preconditioner dealing with the fluid sub-blocks within a 3x3 FSI preconditioner. Once this is done the master block preconditioner deals with the block setup etc.</p>
<p>The vector doftype_map must specify the dof type in the master preconditioner that corresponds to a dof type in this block preconditioner.</p>
<p>In general, we want: doftype_map[doftype in subsidiary prec] = doftype in master prec.</p>
<p>It tells this block preconditioner which dof types of the master block preconditioner it is working with.</p>
<p>The length of the vector is used to determine the number of dof types in THIS block preconditioner therefore it must be correctly sized.</p>
<p>For example, let the master block preconditioner have 5 dof types in total and a 1-4 dof type splitting where the block (0,0) corresponds to dof type 0 and the block (1,1) corresponds to dof types 1, 2, 3 and 4 (i.e. it would have given to block_setup the vector [0,1,1,1,1]). Furthermore, it solves (1,1) block with subsidiary block preconditioner. Then the doftype_map passed to this function of the subsidiary block preconditioner would be [1, 2, 3, 4].</p>
<p>Dof type coarsening (following on from the example above): Let the subsidiary block preconditioner (THIS block preconditioner) only works with two DOF types, then the master block preconditioner must "coarsen" the dof types by providing the optional argument doftype_coarsen_map vector.</p>
<p>The doftype_coarsen_map vector (in this case) might be [[0,1], [2,3]] telling the subsidiary block preconditioner that the SUBSIDIARY dof types 0 and 1 should be treated as dof type 0 and the subsidiary dof types 2 and 3 should be treated as subsidiary dof type 1.</p>
<p>If no doftype_coarsen_map vector is provided, then the identity is used automatically (see the turn_into_subsidiary_block_preconditioner(...) function with only two arguments). In the above case, the identity doftype_coarsen_map vector for the subsidiary block preconditioner would be the 2D vector [[0], [1], [2], [3]] which means dof type 0 is treated as dof type 0, dof type 1 is treated as dof type 1, dof type 2 is treated as dof type 2, and dof type 3 is treated as dof type 3. </p>
<div class="fragment"><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  {</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="comment">// Set the master block preconditioner pointer</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7759d79eefa52fb688caac08a4ff4894">Master_block_preconditioner_pt</a> = master_block_prec_pt;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160; </div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <span class="comment">// Set the Doftype_coarsen_map_coarse.</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a015ba85d839a80512c6c4065e39a3d4a">Doftype_coarsen_map_coarse</a> = doftype_coarsen_map_coarse;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160; </div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a2d341eaf3312c7afcd663c7f4eba6fc2">Doftype_in_master_preconditioner_coarse</a> =</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      doftype_in_master_preconditioner_coarse;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  } <span class="comment">// end of turn_into_subsidiary_block_preconditioner(...)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a46c57c6a2f4b54e27d2aaccc4ec90665"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46c57c6a2f4b54e27d2aaccc4ec90665">&#9670;&nbsp;</a></span>turn_off_debug_flag()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::turn_off_debug_flag </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Toggles off the debug flag. </p>
<div class="fragment"><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">Debug_flag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">oomph::BlockPreconditioner&lt; MATRIX &gt;::Debug_flag</a>.</p>

</div>
</div>
<a id="a8ed741a5fbf514fc29f0a332a211255f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ed741a5fbf514fc29f0a332a211255f">&#9670;&nbsp;</a></span>turn_off_recursive_debug_flag()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::turn_off_recursive_debug_flag </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Toggles off the recursive debug flag. The change goes up the block preconditioning hierarchy. </p>
<div class="fragment"><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">Recursive_debug_flag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;turn_off_recursive_debug_flag();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_block_preconditioner_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Recursive_debug_flag</a>.</p>

</div>
</div>
<a id="a271bf5ea70579e43797187498d98f9a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a271bf5ea70579e43797187498d98f9a9">&#9670;&nbsp;</a></span>turn_on_debug_flag()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::turn_on_debug_flag </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Toggles on the debug flag. </p>
<div class="fragment"><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">Debug_flag</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab4647ea06ca7cf44c8de695ba35f3e97">oomph::BlockPreconditioner&lt; MATRIX &gt;::Debug_flag</a>.</p>

</div>
</div>
<a id="a0d977a81515458e59b94438a215e93e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d977a81515458e59b94438a215e93e1">&#9670;&nbsp;</a></span>turn_on_recursive_debug_flag()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::turn_on_recursive_debug_flag </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Toggles on the recursive debug flag. The change goes up the block preconditioning hierarchy. </p>
<div class="fragment"><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">Recursive_debug_flag</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">is_subsidiary_block_preconditioner</a>())</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        this-&gt;<a class="code" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">master_block_preconditioner_pt</a>()-&gt;turn_on_recursive_debug_flag();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_block_preconditioner_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae6ce543de76eedb34a2562eecceb222b">oomph::BlockPreconditioner&lt; MATRIX &gt;::Recursive_debug_flag</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a2f3a3ac8c192a83facd5b560f017413e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f3a3ac8c192a83facd5b560f017413e">&#9670;&nbsp;</a></span>Allow_multiple_element_type_in_mesh</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Allow_multiple_element_type_in_mesh</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Vector of unsigned to indicate which meshes contain multiple element types. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af97821621b570d409e6662939e5f818d">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_mesh()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae055f998f6145656352aacac22e545ad">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_nmesh()</a>.</p>

</div>
</div>
<a id="ab295a391e32dc00c4e56dfb0527ea354"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab295a391e32dc00c4e56dfb0527ea354">&#9670;&nbsp;</a></span>Auxiliary_block_distribution_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt;, <a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>*&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Auxiliary_block_distribution_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Stores any block-level distributions / concatenation of block-level distributions required. The first in the pair (Vector&lt;unsigned&gt;) represents the block numbers of the distributions concatenated to get the second in the pair (LinearAlgebraDistribution*). </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a51636746e5921ee2845daf60b1c322dc">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_concatenated_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9b3c4072be2bf4f0dfdd18f56a5d51bf">oomph::BlockPreconditioner&lt; MATRIX &gt;::insert_auxiliary_block_distribution()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adbe1ae854ee9831649249d50162bb6a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::setup_matrix_vector_product()</a>.</p>

</div>
</div>
<a id="a59e83eca59e3cdc41a93668539e138f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59e83eca59e3cdc41a93668539e138f1">&#9670;&nbsp;</a></span>Block_distribution_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>*&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Block_distribution_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The distribution for the blocks. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a77ac0b71404620e7be8b15ac2d588495">oomph::BlockPreconditioner&lt; MATRIX &gt;::block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a51636746e5921ee2845daf60b1c322dc">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_concatenated_block()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#adbe1ae854ee9831649249d50162bb6a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::setup_matrix_vector_product()</a>.</p>

</div>
</div>
<a id="a61561c20a262195f1bdacda515a2394b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61561c20a262195f1bdacda515a2394b">&#9670;&nbsp;</a></span>Block_number_to_dof_number_lookup</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; &gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Block_number_to_dof_number_lookup</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Vector of vectors to store the mapping from block number to the DOF number (each element could be a vector because we allow multiple DOFs types in a single block). </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#affcfd24c1ba15bf9cac712ffd46dc283">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_block()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>.</p>

</div>
</div>
<a id="ae047d81b8179dfd09b70cf35f40f62ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae047d81b8179dfd09b70cf35f40f62ca">&#9670;&nbsp;</a></span>Block_to_dof_map_coarse</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; &gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Block_to_dof_map_coarse</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Mapping for block types to dof types. These are the dof types the writer of the preconditioner expects. For the upper-most master block preconditioner, this would be the sum of the dof types in the meshes. For subsidiary block preconditioners, this is determined by the parent preconditioner when passing in the doftype_coarsen_map_coarse vector in turn_into_subsidiary_block_preconditioner(...). </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a80808d42be8db74fd58af80b019bf317">oomph::BlockPreconditioner&lt; MATRIX &gt;::nblock_types()</a>.</p>

</div>
</div>
<a id="a278946969944848b12bdc2ceaed91a07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a278946969944848b12bdc2ceaed91a07">&#9670;&nbsp;</a></span>Block_to_dof_map_fine</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; &gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Block_to_dof_map_fine</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Mapping for the block types to the most fine grain dof types. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a64cfc57ffd16b92ac78499de515138">oomph::BlockPreconditioner&lt; MATRIX &gt;::block_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a75742d54177935fb22e59d045209b11e">oomph::BlockPreconditioner&lt; MATRIX &gt;::index_in_block()</a>.</p>

</div>
</div>
<a id="ab4647ea06ca7cf44c8de695ba35f3e97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4647ea06ca7cf44c8de695ba35f3e97">&#9670;&nbsp;</a></span>Debug_flag</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Debug_flag</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Debugging variable. Set true or false via the access functions turn_on_debug_flag(...) turn_off_debug_flag(...) </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a46c57c6a2f4b54e27d2aaccc4ec90665">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_off_debug_flag()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a271bf5ea70579e43797187498d98f9a9">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_on_debug_flag()</a>.</p>

</div>
</div>
<a id="a21867eb330dd1177c530a590ad1fa571"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21867eb330dd1177c530a590ad1fa571">&#9670;&nbsp;</a></span>Dof_block_distribution_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>*&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Dof_block_distribution_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Storage for the default distribution for each dof block at this level. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">oomph::BlockPreconditioner&lt; MATRIX &gt;::dof_block_distribution_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>.</p>

</div>
</div>
<a id="a55900a517c9e354b9fc49624483b7273"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55900a517c9e354b9fc49624483b7273">&#9670;&nbsp;</a></span>Dof_dimension</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Dof_dimension</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Vector containing the size of each block, i.e. the number of global DOFs associated with it. (Empty if this preconditioner has a master preconditioner as this information is obtain from the master preconditioner.) </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_block_dimension()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>.</p>

</div>
</div>
<a id="a37b22a0a25030a4b08f2eaec261ae22b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37b22a0a25030a4b08f2eaec261ae22b">&#9670;&nbsp;</a></span>Dof_number_dense</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Dof_number_dense</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Vector to store the mapping from the global DOF number to its block. Empty if this preconditioner has a master preconditioner, in this case the information is obtained from the master preconditioner. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>.</p>

</div>
</div>
<a id="ae2f496bfa8307485101a3b8ac57e8c71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2f496bfa8307485101a3b8ac57e8c71">&#9670;&nbsp;</a></span>Dof_number_to_block_number_lookup</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Dof_number_to_block_number_lookup</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector to the mapping from DOF number to block number. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af3eadb5d8d36200c4738537eac1647a6">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_number()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>.</p>

</div>
</div>
<a id="a015ba85d839a80512c6c4065e39a3d4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a015ba85d839a80512c6c4065e39a3d4a">&#9670;&nbsp;</a></span>Doftype_coarsen_map_coarse</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; &gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Doftype_coarsen_map_coarse</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Mapping for dof types within THIS precondition. This is usually passed down from the parent preconditioner. This list is used to tell which does types should be considered as a single dof type within this preconditioner. I.e. we "coarsen" the dof types. The values are local to this preconditioner, for example, even if the Doftype_in_master_preconditioner_coarse = [2,3,4], the vector Doftype_coarsen_map_coarse = [[0],[1,2]], saying your local dof types 0 should be considered as dof type 0 and dof types 1 and 2 are considered as dof type 1.</p>
<p>Furthermore, the dof types are that the preconditioner above this one knows; these dof types may or may not be coarsened. For example, say that this preconditioner expects two dof types, 0 and 1. The preconditioner above this one wishes to use this preconditioner to solve the block associated with it's dof types 2, 3 and 4. It passes the Vector [2,3,4] to this preconditioner via the function turn_into_subsidiary_block_preconditioner(...), this list is to be stored in Doftype_in_master_preconditioner_coarse. It also passes in the 2D vector [[0][1,2]] (as described above), this list is to be stored in Doftype_coarsen_map_coarse. BUT, the master's preconditioner dof types may also be coarsened. I.e. the underlying dof types of the master block preconditioner may be [0,1,2,3,4,5,6,7], for which it may have the Doftype_coarsen_map_coarse = [[0,1][2,3][4,5][6,7]].</p>
<p>An additional list has to be kept for the most fine grain dof type mapping. This is stored in Doftype_coarsen_map_fine, in this case it would be:</p>
<p>Doftype_coarsen_map_fine = [[0,1][2,3,4,5]], since the dof types passed to this preconditioner is [2, 3, 4] from the master preconditioner, but it actually refers to the underlying dof types [2,3,4,5,6,7].</p>
<p>In the case of the top most master block preconditioner, the block_setup(...) function fills the vector with the identity mapping. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>.</p>

</div>
</div>
<a id="aa4e2e47f537f9b6b4deae5792c493d65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4e2e47f537f9b6b4deae5792c493d65">&#9670;&nbsp;</a></span>Doftype_coarsen_map_fine</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; &gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Doftype_coarsen_map_fine</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Mapping the dof types within this preconditioner. The values in here refers to the most grain dof types. This list is automatically generated either in block_setup(...) (for the top-most preconditioner) or the turn_into_subsidiary_block_preconditioner(...) function. Please refer to the comment above Doftype_coarsen_map_coarse for more details. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a39411824a744d4569fe835dec13047">oomph::BlockPreconditioner&lt; MATRIX &gt;::doftype_coarsen_map_fine()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a433adda4f658cc7880121bf9ca4293c4">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_fine_grain_dof_types_in()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a50b76a374797805f64e2af34d581cdc2">oomph::BlockPreconditioner&lt; MATRIX &gt;::nfine_grain_dof_types_in()</a>.</p>

</div>
</div>
<a id="a2d341eaf3312c7afcd663c7f4eba6fc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d341eaf3312c7afcd663c7f4eba6fc2">&#9670;&nbsp;</a></span>Doftype_in_master_preconditioner_coarse</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Doftype_in_master_preconditioner_coarse</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The map between the dof types in this preconditioner and the master preconditioner. If there is no master preconditioner, it remains empty. This is the version for which the master preconditioner expects. The dof types in here may or may not be coarsened in the preconditioner above this one. </p>

</div>
</div>
<a id="ae8c06ce4f4baf8480a2f25b152031dad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8c06ce4f4baf8480a2f25b152031dad">&#9670;&nbsp;</a></span>Doftype_in_master_preconditioner_fine</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Doftype_in_master_preconditioner_fine</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The map between the dof types in this preconditioner and the master preconditioner. If there is no master preconditioner it remains empty. This list contains the mapping for the underlying dof types. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7297e4d24c2c7ae7af6a9ad009669928">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_master_dof_number()</a>.</p>

</div>
</div>
<a id="a79ea9c428aa8533c371ef3f0048a3a92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79ea9c428aa8533c371ef3f0048a3a92">&#9670;&nbsp;</a></span>Global_index</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; &gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Global_index</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Vectors of vectors for the mapping from block number and block row to global row number. Empty if this preconditioner has a master preconditioner as this information is obtain from the master preconditioner. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>.</p>

</div>
</div>
<a id="a0ad82070ce2f6cdfa9ea6c7226ea28af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ad82070ce2f6cdfa9ea6c7226ea28af">&#9670;&nbsp;</a></span>Index_in_dof_block_dense</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Index_in_dof_block_dense</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><b>This was uncommented</b> Presumably a non-distributed analogue of Index_in_dof_block_sparse. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_dof()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>.</p>

</div>
</div>
<a id="a38de6514d7065086335e0e6f60dc77a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38de6514d7065086335e0e6f60dc77a9">&#9670;&nbsp;</a></span>Internal_block_distribution_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>*&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Internal_block_distribution_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Storage for the default distribution for each internal block. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1ee4a9fcf226e8c4438fb25747cb6e93">oomph::BlockPreconditioner&lt; MATRIX &gt;::dof_block_distribution_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ac460225afc092cc5ed9d77acc6316536">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_dimension()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a19f8ca9f40ab804262cf95c1d5eb598c">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_block_distribution_pt()</a>.</p>

</div>
</div>
<a id="a06c7426a2c8c096c8f4dc583444e0e0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06c7426a2c8c096c8f4dc583444e0e0e">&#9670;&nbsp;</a></span>Internal_nblock_types</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Internal_nblock_types</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of different block types in this preconditioner. Note that this information is maintained if used as a subsidiary or stand-alone block preconditioner, in the latter case it stores the number of blocks within the subsidiary preconditioner. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7c2b9ed482db072b0cabe5a51eb76efa">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_nblock_types()</a>.</p>

</div>
</div>
<a id="a3985436e4645c202eadd47a4f4f466e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3985436e4645c202eadd47a4f4f466e2">&#9670;&nbsp;</a></span>Internal_ndof_types</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Internal_ndof_types</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of different DOF types in this preconditioner. Note that this information is maintained if used as a subsidiary or stand-alone block preconditioner, in the latter case it stores the number of dofs within the subsidiary preconditioner. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a289db176ccafcc3719367fa98340f94d">oomph::BlockPreconditioner&lt; MATRIX &gt;::document()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a4f3efe468cd6e133d6840ede8c3687b5">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_ndof_types()</a>.</p>

</div>
</div>
<a id="a58079eb938b4d3602d0819cf68b318c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58079eb938b4d3602d0819cf68b318c0">&#9670;&nbsp;</a></span>Internal_preconditioner_matrix_distribution_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Internal_preconditioner_matrix_distribution_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The distribution of the (internal) preconditioner matrix. This is formed by concatenating the distribution of the internal blocks. This is obsolete code, maintained for backwards compatibility. Below is the old comment:</p>
<ul>
<li>only used if this preconditioner is a master preconditioner. Warning: always use the access function internal_preconditioner_matrix_distribution_pt(). </li>
</ul>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3a16de88bd5369e729d761a6498fdd3f">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_preconditioner_matrix_distribution_pt()</a>.</p>

</div>
</div>
<a id="a7759d79eefa52fb688caac08a4ff4894"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7759d79eefa52fb688caac08a4ff4894">&#9670;&nbsp;</a></span>Master_block_preconditioner_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a>&lt;MATRIX&gt;* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Master_block_preconditioner_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>If the block preconditioner is acting a subsidiary block preconditioner then a pointer to the master preconditioner is stored here. If the preconditioner does not have a master block preconditioner then this pointer remains null. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abe03c970690224b46a29e55e16992dd7">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_block_dimension()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#abb4dff3469cc6718103fddfdf3f3a7bb">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_dof_number()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a1e0a33327b5042dfba04baf46c045373">oomph::BlockPreconditioner&lt; MATRIX &gt;::internal_index_in_dof()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a804e1975f170d2ad941b3b7d2dd50407">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_master_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a9ac4335ec07fc13f7bf1093fd0489c52">oomph::BlockPreconditioner&lt; MATRIX &gt;::is_subsidiary_block_preconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab84701c65bdfd8d2c14611176e5e6209">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_block_preconditioner_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a005d978655022d1a04da7397cf5d0e83">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_distribution_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_nrow()</a>.</p>

</div>
</div>
<a id="a89adb506e8f9103c80b4b36cc309f536"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89adb506e8f9103c80b4b36cc309f536">&#9670;&nbsp;</a></span>Mesh_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;const <a class="el" href="../../d6/db8/classoomph_1_1Mesh.html">Mesh</a>*&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Mesh_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Vector of pointers to the meshes containing the elements used in the block preconditioner. Const pointers to prevent modification of the mesh by the preconditioner (this could be relaxed if needed). If this is a subsidiary preconditioner, then the information is looked up in the master preconditioner. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3c0e92cb77c3e3179007fe9fd99b6428">oomph::BlockPreconditioner&lt; MATRIX &gt;::mesh_pt()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab6cca480686ea8e44244ac60a0db23ba">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a193776a271f7c23d20d2102de0ff1cb9">oomph::BlockPreconditioner&lt; MATRIX &gt;::nmesh()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#af97821621b570d409e6662939e5f818d">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_mesh()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ae055f998f6145656352aacac22e545ad">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_nmesh()</a>.</p>

</div>
</div>
<a id="a874cbe5520d546ee24004e229a48037e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a874cbe5520d546ee24004e229a48037e">&#9670;&nbsp;</a></span>Ndof_in_block</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Ndof_in_block</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of types of degree of freedom associated with each block. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#aa760ae71a5aae488547ccf721d412b1e">oomph::BlockPreconditioner&lt; MATRIX &gt;::post_block_matrix_assembly_partial_clear()</a>.</p>

</div>
</div>
<a id="a43e9d73ff61daa00aea4e4deff0d6aff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43e9d73ff61daa00aea4e4deff0d6aff">&#9670;&nbsp;</a></span>Ndof_types_in_mesh</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/df6/classoomph_1_1Vector.html">Vector</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Ndof_types_in_mesh</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Storage for number of types of degree of freedom of the elements in each mesh. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45509677ccef78be13b5e4485312ddc1">oomph::BlockPreconditioner&lt; MATRIX &gt;::ndof_types_in_mesh()</a>.</p>

</div>
</div>
<a id="a4aa232afd2a76adac97fb7d484a18c5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4aa232afd2a76adac97fb7d484a18c5e">&#9670;&nbsp;</a></span>Nrow</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Nrow</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of DOFs (# of rows or columns in the matrix) in this preconditioner. Note that this information is maintained if used as a subsidiary or stand-alone block preconditioner, in the latter case it stores the number of rows within the subsidiary preconditioner. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a3e5b553f65e6c25354a5c908d507e8ee">oomph::BlockPreconditioner&lt; MATRIX &gt;::master_nrow()</a>.</p>

</div>
</div>
<a id="a915ff2775ccef6ac3dadf072566da9e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a915ff2775ccef6ac3dadf072566da9e7">&#9670;&nbsp;</a></span>Output_base_filename</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Output_base_filename</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>String giving the base of the files to write block data into. If empty then do not output blocks. Default is empty. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0bd0ab19a7501b79c16c1283766f0abb">oomph::BlockPreconditioner&lt; MATRIX &gt;::block_output_on()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a45b37f1934144d882831bf354f35d035">oomph::BlockPreconditioner&lt; MATRIX &gt;::disable_block_output_to_files()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#ab36e905f7da268328709d62951d64ace">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_block_output_to_files()</a>.</p>

</div>
</div>
<a id="ad647cfa61939e3c118dcc2595a7f9240"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad647cfa61939e3c118dcc2595a7f9240">&#9670;&nbsp;</a></span>Preconditioner_matrix_distribution_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/dcb/classoomph_1_1LinearAlgebraDistribution.html">LinearAlgebraDistribution</a>* <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Preconditioner_matrix_distribution_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The distribution of the preconditioner matrix. This is the concatenation of the block distribution. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74eeff188f842dd8abdff1b7d9801d44">oomph::BlockPreconditioner&lt; MATRIX &gt;::preconditioner_matrix_distribution_pt()</a>.</p>

</div>
</div>
<a id="ae6ce543de76eedb34a2562eecceb222b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6ce543de76eedb34a2562eecceb222b">&#9670;&nbsp;</a></span>Recursive_debug_flag</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Recursive_debug_flag</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Debugging variable. Set true or false via the access functions turn_on_recursive_debug_flag(...) turn_off_recursive_debug_flag(...) These will turn on/off the debug flag up the hierarchy. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a74c4b4bef4371b72816631445689a2e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::BlockPreconditioner()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8ed741a5fbf514fc29f0a332a211255f">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_off_recursive_debug_flag()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a0d977a81515458e59b94438a215e93e1">oomph::BlockPreconditioner&lt; MATRIX &gt;::turn_on_recursive_debug_flag()</a>.</p>

</div>
</div>
<a id="ad2cd49c5c823c4202046e97038f6e080"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2cd49c5c823c4202046e97038f6e080">&#9670;&nbsp;</a></span>Replacement_dof_block_pt</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/d3a/classoomph_1_1MapMatrix.html">MapMatrix</a>&lt;<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a>, <a class="el" href="../../d6/dd4/classoomph_1_1CRDoubleMatrix.html">CRDoubleMatrix</a>*&gt; <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Replacement_dof_block_pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The replacement dof-level blocks. </p>

<p class="reference">Referenced by <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a7845d9301918e3f5cbecd729ec1e309b">oomph::BlockPreconditioner&lt; MATRIX &gt;::clear_block_preconditioner_base()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a72b4dbe167da59d9ba12c7eff97d77e6">oomph::BlockPreconditioner&lt; MATRIX &gt;::get_block()</a>, <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a571824cedc7e458a612111b51f20e5fb">oomph::BlockPreconditioner&lt; MATRIX &gt;::replacement_dof_block_pt()</a>, and <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html#a8a0ae880f098d5b1e9df78fc74c31dbf">oomph::BlockPreconditioner&lt; MATRIX &gt;::set_replacement_dof_block()</a>.</p>

</div>
</div>
<a id="a6e6a40988711a64c622c2fd9104c56cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e6a40988711a64c622c2fd9104c56cf">&#9670;&nbsp;</a></span>Run_block_matrix_test</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename MATRIX &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> <a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">oomph::BlockPreconditioner</a>&lt; MATRIX &gt;::Run_block_matrix_test = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Static boolean to allow block_matrix_test(...) to be run. Defaults to false. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../da/d34/block__preconditioner_8h_source.html">block_preconditioner.h</a></li>
<li><a class="el" href="../../da/d78/block__preconditioner_8cc.html">block_preconditioner.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../da/ddf/namespaceoomph.html">oomph</a></li><li class="navelem"><a class="el" href="../../dd/d57/classoomph_1_1BlockPreconditioner.html">BlockPreconditioner</a></li>
    <li class="footer">Generated on Wed Aug 27 2025 17:09:01 for MercuryDPM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
